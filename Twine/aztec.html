<!DOCTYPE html>
<html data-init="no-js">
<head>
<meta charset="UTF-8" />
<title>Spanish Aztec War Ver 1.0.1</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v2.37.0-alpha.5): A free (gratis and libre) story format.

Copyright © 2013–2021 Thomas Michael Edwards <thomasmedwards@gmail.com>.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<script id="script-libraries" type="text/javascript">
if(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute("data-init", "loading");
/*! @source http://purl.eligrey.com/github/classList.js/blob/1.2.20171210/classList.js */
"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||!function(t){"use strict";if("Element"in t){var e="classList",n="prototype",i=t.Element[n],s=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},c=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},a=function(t,e){if(""===e)throw new c("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(e))throw new c("INVALID_CHARACTER_ERR","The token must not contain space characters.");return o.call(t,e)},l=function(t){for(var e=r.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],i=0,s=n.length;s>i;i++)this.push(n[i]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},u=l[n]=[],h=function(){return new l(this)};if(c[n]=Error[n],u.item=function(t){return this[t]||null},u.contains=function(t){return~a(this,t+"")},u.add=function(){var t,e=arguments,n=0,i=e.length,s=!1;do t=e[n]+"",~a(this,t)||(this.push(t),s=!0);while(++n<i);s&&this._updateClassName()},u.remove=function(){var t,e,n=arguments,i=0,s=n.length,r=!1;do for(t=n[i]+"",e=a(this,t);~e;)this.splice(e,1),r=!0,e=a(this,t);while(++i<s);r&&this._updateClassName()},u.toggle=function(t,e){var n=this.contains(t),i=n?e!==!0&&"remove":e!==!1&&"add";return i&&this[i](t),e===!0||e===!1?e:!n},u.replace=function(t,e){var n=a(t+"");~n&&(this.splice(n,1,e),this._updateClassName())},u.toString=function(){return this.join(" ")},s.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{s.defineProperty(i,e,f)}catch(p){void 0!==p.number&&-2146823252!==p.number||(f.enumerable=!1,s.defineProperty(i,e,f))}}else s[n].__defineGetter__&&i.__defineGetter__(e,h)}}(self),function(){"use strict";var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,i=arguments.length;for(n=0;i>n;n++)t=arguments[n],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(t,e){var n=this.toString().split(" "),i=n.indexOf(t+"");~i&&(n=n.slice(i),this.remove.apply(this,n),this.add(e),this.add.apply(this,n.slice(1)))}),t=null}());
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2020 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.5.14/LICENSE
 */
(function(t,r){"use strict";if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var D;var S=Function.prototype.toString,x=/^\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\/\/.*\n/g,"");var n=e.replace(/\/\*[.\s\S]*\*\//g,"");var i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return x.test(i)}catch(a){return false}},E=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},j="[object Function]",I="[object GeneratorFunction]",D=function isCallable(t){if(!t){return false}if(typeof t!=="function"&&typeof t!=="object"){return false}if(m){return E(t)}if(O(t)){return false}var r=T.call(t);return r===j||r===I};var M;var U=RegExp.prototype.exec,$=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},F="[object RegExp]";M=function isRegex(t){if(typeof t!=="object"){return false}return m?$(t):T.call(t)===F};var N;var C=String.prototype.valueOf,k=function tryStringObject(t){try{C.call(t);return true}catch(r){return false}},A="[object String]";N=function isString(t){if(typeof t==="string"){return true}if(typeof t!=="object"){return false}return m?k(t):T.call(t)===A};var R=e.defineProperty&&function(){try{var t={};e.defineProperty(t,"x",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var P=function(t){var r;if(R){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!=="object"&&r!=="function"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var Z=function Empty(){};P(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,"$"+l)}a=i("binder","return function ("+y.call(u,",")+"){ return binder.apply(this, arguments); }")(o);if(r.prototype){Z.prototype=r.prototype;a.prototype=new Z;Z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var H=d.bind(n.toString);var W=d.bind(s);var B=g.bind(s);if(typeof document==="object"&&document&&document.documentElement){try{W(document.documentElement.childNodes)}catch(X){var L=W;var q=B;W=function arraySliceIE(t){var r=[];var e=t.length;while(e-- >0){r[e]=t[e]}return q(r,L(arguments,1))};B=function arraySliceApplyIE(t,r){return q(W(t),r)}}}var K=d.bind(f.slice);var Q=d.bind(f.split);var V=d.bind(f.indexOf);var _=d.bind(v);var tt=d.bind(n.propertyIsEnumerable);var rt=d.bind(r.sort);var et=t.isArray||function isArray(t){return H(t)==="[object Array]"};var nt=[].unshift(0)!==1;P(r,{unshift:function(){h.apply(this,arguments);return this.length}},nt);P(t,{isArray:et});var it=e("a");var at=it[0]!=="a"||!(0 in it);var ot=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}});t.call([1],function(){"use strict";e=typeof this==="string"},"x")}catch(i){n=true}}return!!t&&!n&&r&&e};P(r,{forEach:function forEach(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=-1;var i=z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<i){if(n in e){if(typeof a==="undefined"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!ot(r.forEach));P(r,{map:function map(r){var e=z.ToObject(this);var n=at&&N(this)?Q(this,""):e;var i=z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError("Array.prototype.map callback must be a function")}for(var f=0;f<i;f++){if(f in n){if(typeof o==="undefined"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!ot(r.map));P(r,{filter:function filter(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o==="undefined"?t(a,f,r):t.call(o,a,f,r)){_(i,a)}}}return i}},!ot(r.filter));P(r,{every:function every(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.every callback must be a function")}for(var a=0;a<n;a++){if(a in e&&!(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!ot(r.every));P(r,{some:function some(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.some callback must be a function")}for(var a=0;a<n;a++){if(a in e&&(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!ot(r.some));var ft=false;if(r.reduce){ft=typeof r.reduce.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduce:function reduce(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!ft);var ut=false;if(r.reduceRight){ut=typeof r.reduceRight.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduceRight:function reduceRight(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!ut);var lt=r.indexOf&&[0,1].indexOf(1,2)!==-1;P(r,{indexOf:function indexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},lt);var st=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;P(r,{lastIndexOf:function lastIndexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},st);var ct=function(){var t=[1,2];var r=t.splice();return t.length===2&&et(r)&&r.length===0}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ct);var vt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!=="number"){e=W(arguments);if(e.length<2){_(e,this.length-t)}else{e[1]=z.ToInteger(r)}}return c.apply(this,e)}},!vt);var ht=function(){var r=new t(1e5);r[8]="x";r.splice(1,1);return r.indexOf("x")===7}();var pt=function(){var t=256;var r=[];r[t]="a";r.splice(t+1,0,"b");return r[t]==="a"}();P(r,{splice:function splice(t,r){var e=z.ToObject(this);var n=[];var i=z.ToUint32(e.length);var a=z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=arguments.length===0?0:arguments.length===1?i-f:b(w(z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=W(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!ht||!pt);var yt=r.join;var dt;try{dt=Array.prototype.join.call("123",",")!=="1,2,3"}catch(X){dt=true}if(dt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(N(this)?Q(this,""):this,r)}},dt)}var gt=[1,2].join(undefined)!=="1,2";if(gt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(this,r)}},gt)}var wt=function push(t){var r=z.ToObject(this);var e=z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var bt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:function push(t){if(et(this)){return v.apply(this,arguments)}return wt.apply(this,arguments)}},bt);var Tt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:wt},Tt);P(r,{slice:function(t,r){var e=N(this)?Q(this,""):this;return B(e,arguments)}},at);var mt=function(){try{[1,2].sort(null)}catch(t){try{[1,2].sort({})}catch(r){return false}}return true}();var Dt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var St=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();P(r,{sort:function sort(t){if(typeof t==="undefined"){return rt(this)}if(!D(t)){throw new TypeError("Array.prototype.sort callback must be a function")}return rt(this,t)}},mt||!St||!Dt);var xt=!tt({toString:null},"toString");var Ot=tt(function(){},"prototype");var Et=!G("x","0");var jt=function(t){var r=t.constructor;return r&&r.prototype===t};var It={$applicationCache:true,$console:true,$external:true,$frame:true,$frameElement:true,$frames:true,$innerHeight:true,$innerWidth:true,$onmozfullscreenchange:true,$onmozfullscreenerror:true,$outerHeight:true,$outerWidth:true,$pageXOffset:true,$pageYOffset:true,$parent:true,$scrollLeft:true,$scrollTop:true,$scrollX:true,$scrollY:true,$self:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$window:true,$width:true,$height:true,$top:true,$localStorage:true};var Mt=function(){if(typeof window==="undefined"){return false}for(var t in window){try{if(!It["$"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]==="object"){jt(window[t])}}catch(r){return true}}return false}();var Ut=function(t){if(typeof window==="undefined"||!Mt){return jt(t)}try{return jt(t)}catch(r){return false}};var $t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var Ft=$t.length;var Nt=function isArguments(t){return H(t)==="[object Arguments]"};var Ct=function isArguments(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&!et(t)&&D(t.callee)};var kt=Nt(arguments)?Nt:Ct;P(e,{keys:function keys(t){var r=D(t);var e=kt(t);var n=t!==null&&typeof t==="object";var i=n&&N(t);if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var a=[];var f=Ot&&r;if(i&&Et||e){for(var u=0;u<t.length;++u){_(a,o(u))}}if(!e){for(var l in t){if(!(f&&l==="prototype")&&G(t,l)){_(a,o(l))}}}if(xt){var s=Ut(t);for(var c=0;c<Ft;c++){var v=$t[c];if(!(s&&v==="constructor")&&G(t,v)){_(a,v)}}}return a}});var At=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var Rt=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Pt=e.keys;P(e,{keys:function keys(t){if(kt(t)){return Pt(W(t))}else{return Pt(t)}}},!At||Rt);var Jt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var Yt=new Date(-0x55d318d56a724);var zt=new Date(14496624e5);var Zt=Yt.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var Gt;var Ht;var Wt=Yt.getTimezoneOffset();if(Wt<-720){Gt=Yt.toDateString()!=="Tue Jan 02 -45875";Ht=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}else{Gt=Yt.toDateString()!=="Mon Jan 01 -45875";Ht=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}var Bt=d.bind(Date.prototype.getFullYear);var Xt=d.bind(Date.prototype.getMonth);var Lt=d.bind(Date.prototype.getDate);var qt=d.bind(Date.prototype.getUTCFullYear);var Kt=d.bind(Date.prototype.getUTCMonth);var Qt=d.bind(Date.prototype.getUTCDate);var Vt=d.bind(Date.prototype.getUTCDay);var _t=d.bind(Date.prototype.getUTCHours);var tr=d.bind(Date.prototype.getUTCMinutes);var rr=d.bind(Date.prototype.getUTCSeconds);var er=d.bind(Date.prototype.getUTCMilliseconds);var nr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var ir=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ar=function daysInMonth(t,r){return Lt(new Date(r,t,0))};P(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);if(t<0&&Xt(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);var e=Lt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);if(t<0&&Kt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);var e=Qt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e}},Jt);P(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Vt(this);var r=Qt(this);var e=Kt(this);var n=qt(this);var i=_t(this);var a=tr(this);var o=rr(this);return nr[t]+", "+(r<10?"0"+r:r)+" "+ir[e]+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"}},Jt||Zt);P(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n}},Jt||Gt);if(Jt||Ht){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"+(f>0?"-":"+")+(u<10?"0"+u:u)+(l<10?"0"+l:l)};if(R){e.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true})}}var or=-621987552e5;var fr="-000001";var ur=Date.prototype.toISOString&&new Date(or).toISOString().indexOf(fr)===-1;var lr=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var sr=d.bind(Date.prototype.getTime);P(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(sr(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}var t=qt(this);var r=Kt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,Qt(this),_t(this),tr(this),rr(this)];t=(t<0?"-":t>9999?"+":"")+K("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=K("00"+e[n],-2)}return t+"-"+W(e,0,2).join("-")+"T"+W(e,2).join(":")+"."+K("000"+er(this),-3)+"Z"}},ur||lr);var cr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(or).toJSON().indexOf(fr)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!cr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=z.ToPrimitive(r);if(typeof n==="number"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError("toISOString property is not callable")}return i.call(r)}}var vr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var hr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var pr=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(pr||hr||!vr){var yr=Math.pow(2,31)-1;var dr=Y(new Date(1970,0,1,0,0,0,yr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(dr&&s>=7&&l>yr){var p=Math.floor(l/yr)*yr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){P(c,{constructor:r},true)}return c};var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(dr&&n>yr){var i=Math.floor(n/yr)*yr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}P(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;P(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};P(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var gr=l.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(1000000000000000128).toFixed(0)!=="1000000000000000128");var wr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<wr.size){n+=t*wr.data[e];wr.data[e]=n%wr.base;n=Math.floor(n/wr.base)}},divide:function divide(t){var r=wr.size;var e=0;while(--r>=0){e+=wr.data[r];wr.data[r]=Math.floor(e/t);e=e%t*wr.base}},numToString:function numToString(){var t=wr.size;var r="";while(--t>=0){if(r!==""||t===0||wr.data[t]!==0){var e=o(wr.data[t]);if(r===""){r=e}else{r+=K("0000000",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var br=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=u(this);if(Y(e)){return"NaN"}if(e<=-1e21||e>=1e21){return o(e)}n="";if(e<0){n="-";e=-e}i="0";if(e>1e-21){a=wr.log(e*wr.pow(2,69,1))-69;f=a<0?e*wr.pow(2,-a,1):e/wr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){wr.multiply(0,f);l=r;while(l>=7){wr.multiply(1e7,0);l-=7}wr.multiply(wr.pow(10,l,1),0);l=a-1;while(l>=23){wr.divide(1<<23);l-=23}wr.divide(1<<l);wr.multiply(1,1);wr.divide(2);i=wr.numToString()}else{wr.multiply(0,f);wr.multiply(1<<-a,0);i=wr.numToString()+K("0.00000000000000000000",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+K("0.0000000000000000000",0,r-s+2)+i}else{i=n+K(i,0,s-r)+"."+K(i,s-r)}}else{i=n+i}return i};P(l,{toFixed:br},gr);var Tr=function(){try{return 1..toPrecision(undefined)==="1"}catch(t){return true}}();var mr=l.toPrecision;P(l,{toPrecision:function toPrecision(t){return typeof t==="undefined"?mr.call(this):mr.call(this,t)}},Tr);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=typeof/()??/.exec("")[1]==="undefined";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e==="undefined"&&n===0){return[]}if(!M(e)){return Q(this,e,n)}var a=[];var o=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,u,l,s,c;var h=new RegExp(e.source,o+"g");if(!t){u=new RegExp("^"+h.source+"$(?!\\s)",o)}var p=typeof n==="undefined"?r:z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){_(a,K(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]==="undefined"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,W(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test("")){_(a,"")}}else{_(a,K(i,f))}return a.length>p?W(a,0,p):a}})()}else if("0".split(void 0,0).length){f.split=function split(t,r){if(typeof t==="undefined"&&r===0){return[]}return Q(this,t,r)}}var Dr=f.replace;var Sr=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){_(t,e)});return t.length===1&&typeof t[0]==="undefined"}();if(!Sr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\)[*?]/.test(t.source);if(!e||!n){return Dr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;_(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Dr.call(this,t,i)}}}var xr=f.substr;var Or="".substr&&"0b".substr(-1)!=="b";P(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return xr.call(this,e,r)}},Or);var Er="\t\n\x0B\f\r \xa0\u1680\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var jr="\u200b";var Ir="["+Er+"]";var Mr=new RegExp("^"+Ir+Ir+"*");var Ur=new RegExp(Ir+Ir+"*$");var $r=f.trim&&(Er.trim()||!jr.trim());P(f,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return o(this).replace(Mr,"").replace(Ur,"")}},$r);var Fr=d.bind(String.prototype.trim);var Nr=f.lastIndexOf&&"abc\u3042\u3044".lastIndexOf("\u3042\u3044",2)!==-1;P(f,{lastIndexOf:function lastIndexOf(t){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=V(K(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Nr);var Cr=f.lastIndexOf;P(f,{lastIndexOf:function lastIndexOf(t){return Cr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(Er+"08")!==8||parseInt(Er+"0x16")!==22){parseInt=function(t){var r=/^[-+]?0[xX]/;return function parseInt(e,n){if(typeof e==="symbol"){""+e}var i=Fr(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat("-0")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Fr(String(r));var n=t(e);return n===0&&K(e,0,1)==="-"?-0:n}}(parseFloat)}if(String(new RangeError("test"))!=="RangeError: test"){var kr=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var t=this.name;if(typeof t==="undefined"){t="Error"}else if(typeof t!=="string"){t=o(t)}var r=this.message;if(typeof r==="undefined"){r=""}else if(typeof r!=="string"){r=o(r)}if(!t){return r}if(!r){return t}return t+": "+r};Error.prototype.toString=kr}if(R){var Ar=function(t,r){if(tt(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};Ar(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message=""}Ar(Error.prototype,"name")}if(String(/a/gim)!=="/a/gim"){var Rr=function toString(){var t="/"+this.source+"/";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}return t};RegExp.prototype.toString=Rr}});
/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.4/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var L=Math.exp;var F=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype["delete"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||"@@species";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(F(1+t)/(1+t-1))};var Q=function isArguments(e){return g(e)==="[object Arguments]"};var ee=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var te=Q(arguments)?Q:ee;var re={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var ne=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var oe=typeof $==="function"&&typeof $["for"]==="function"&&re.symbol($());var ie=re.symbol($.iterator)?$.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ie="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ae=S.Reflect;var ue=String;var fe=typeof document==="undefined"||!document?null:document.all;var se=fe==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==fe};var ce={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!ce.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(se(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===fe},ToObject:function(e,t){return Object(ce.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return ce.IsCallable(e)},ToInt32:function(e){return ce.ToNumber(e)>>0},ToUint32:function(e){return ce.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=ce.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=ce.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return ce.TypeIsObject(e)&&(typeof e[ie]!=="undefined"||te(e))},GetIterator:function(e){if(te(e)){return new q(e,"value")}var t=ce.GetMethod(e,ie);if(!ce.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=ce.Call(t,e);if(!ce.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=ce.ToObject(e)[t];if(se(r)){return void 0}if(!ce.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=ce.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=ce.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!ce.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ce.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=ce.IteratorNext(e);var r=ce.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ae.construct){return ae.construct(e,t,o)}var i=o.prototype;if(!ce.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=ce.Call(e,a,t);return ce.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!ce.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[J];if(se(n)){return t}if(!ce.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=ce.ToString(e);var i="<"+t;if(r!==""){var a=ce.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!ce.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!=="undefined"){return!!t}return re.regex(e)},ToString:function ToString(e){return ue(e)}};if(s&&oe){var le=function defineWellKnownSymbol(e){if(re.symbol($[e])){return $[e]}var t=$["for"]("Symbol."+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!re.symbol($.search)){var pe=le("search");var ve=String.prototype.search;h(RegExp.prototype,pe,function search(e){return ce.Call(ve,e,[this])});var ye=function search(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,pe);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(ve,t,[ce.ToString(e)])};ne(String.prototype,"search",ye)}if(!re.symbol($.replace)){var he=le("replace");var be=String.prototype.replace;h(RegExp.prototype,he,function replace(e,t){return ce.Call(be,e,[this,t])});var ge=function replace(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,he);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(be,r,[ce.ToString(e),t])};ne(String.prototype,"replace",ge)}if(!re.symbol($.split)){var de=le("split");var me=String.prototype.split;h(RegExp.prototype,de,function split(e,t){return ce.Call(me,e,[this,t])});var Oe=function split(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,de);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(me,r,[ce.ToString(e),t])};ne(String.prototype,"split",Oe)}var we=re.symbol($.match);var je=we&&function(){var e={};e[$.match]=function(){return 42};return"a".match(e)!==42}();if(!we||je){var Se=le("match");var Te=String.prototype.match;h(RegExp.prototype,Se,function match(e){return ce.Call(Te,e,[this])});var Ie=function match(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,Se);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(Te,t,[ce.ToString(e)])};ne(String.prototype,"match",Ie)}}var Ee=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Pe=function(){return this};var Ce=function(e){if(s&&!z(e,J)){m.getter(e,J,Pe)}};var Me=function(e,t){var r=t||function iterator(){return this};h(e,ie,r);if(!e[ie]&&re.symbol(ie)){e[ie]=r}};var xe=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ne=function createDataPropertyOrThrow(e,t,r){xe(e,t,r);if(!ce.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Ae=function(e,t,r,n){if(!ce.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!ce.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;ne(String,"fromCodePoint",function fromCodePoint(e){return ce.Call(Re,this,arguments)})}var _e={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!ce.SameValue(r,ce.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join("")},raw:function raw(e){var t=ce.ToObject(e,"bad callSite");var r=ce.ToObject(t.raw,"bad raw value");var n=r.length;var o=ce.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=ce.ToString(a);s=ce.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=ce.ToString(f);M(i,c);a+=1}return i.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){ne(String,"raw",_e.raw)}b(String,_e);var ke=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Le=Infinity;var Fe={repeat:function repeat(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);if(r<0||r>=Le){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return ke(t,r)},startsWith:function startsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=ce.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(ce.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=ce.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:ce.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(ce.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=ce.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){ne(String.prototype,"includes",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var De=i(function(){return"/a/".startsWith(/a/)});var ze=a(function(){return"abc".startsWith("a",Infinity)===false});if(!De||!ze){ne(String.prototype,"startsWith",Fe.startsWith);ne(String.prototype,"endsWith",Fe.endsWith)}}if(oe){var qe=a(function(){var e=/a/;e[$.match]=false;return"/a/".startsWith(e)});if(!qe){ne(String.prototype,"startsWith",Fe.startsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return"/a/".endsWith(e)});if(!We){ne(String.prototype,"endsWith",Fe.endsWith)}var Ge=a(function(){var e=/a/;e[$.match]=false;return"/a/".includes(e)});if(!Ge){ne(String.prototype,"includes",Fe.includes)}}b(String.prototype,Fe);var He=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Ve=new RegExp("(^["+He+"]+)|(["+He+"]+$)","g");var Be=function trim(){return ce.ToString(ce.RequireObjectCoercible(this)).replace(Ve,"")};var Ue=["\x85","\u200b","\ufffe"].join("");var $e=new RegExp("["+Ue+"]","g");var Je=/^[-+]0x[0-9a-f]+$/i;var Xe=Ue.trim().length!==Ue.length;h(String.prototype,"trim",Be,Xe);var Ke=function(e){return{value:e,done:arguments.length===0}};var Ze=function(e){ce.RequireObjectCoercible(e);this._s=ce.ToString(e);this._i=0};Ze.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ke()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ke(e.substr(t,o))};Me(Ze.prototype);Me(String.prototype,function(){return new Ze(this)});var Ye={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!ce.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(te(e)||ce.GetMethod(e,ie))!=="undefined";var u,f,s;if(a){f=ce.IsConstructor(r)?Object(new r):[];var c=ce.GetIterator(e);var l,p;s=0;while(true){l=ce.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){ce.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=ce.ToObject(e);u=ce.ToLength(y.length);f=ce.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ne(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!ce.IsCallable(t)?new Array(e):ce.Construct(t,[e]);for(var o=0;o<e;++o){Ne(n,o,arguments[o])}n.length=e;return n}};b(Array,Ye);Ce(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=ce.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ke(o)}}this.array=void 0;return Ke()}});Me(q.prototype);var Qe=Array.of===Ye.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Qe){ne(Array,"of",Ye.of)}var et={copyWithin:function copyWithin(e,t){var r=ce.ToObject(this);var n=ce.ToLength(r.length);var o=ce.ToInteger(e);var i=ce.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:ce.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=ce.ToObject(this);var o=ce.ToLength(n.length);t=ce.ToInteger(typeof t==="undefined"?0:t);r=ce.ToInteger(typeof r==="undefined"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,"key")},values:function values(){return new q(this,"value")},entries:function entries(){return new q(this,"entry")}};if(Array.prototype.keys&&!ce.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!ce.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ie]){b(Array.prototype,{values:Array.prototype[ie]});if(re.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var tt=Array.prototype.values;ne(Array.prototype,"values",function values(){return ce.Call(tt,this,arguments)});h(Array.prototype,ie,Array.prototype.values,true)}b(Array.prototype,et);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Me(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Me(Object.getPrototypeOf([].values()))}var rt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var nt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!rt||!nt){ne(Array,"from",Ye.from)}var ot=function(){return a(function(){return Array.from([0],void 0)})}();if(!ot){var it=Array.from;ne(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return ce.Call(it,this,arguments)}else{return t(it,this,e)}})}var at=-(Math.pow(2,32)-1);var ut=function(e,r){var n={length:at};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!ut(Array.prototype.forEach)){var ft=Array.prototype.forEach;ne(Array.prototype,"forEach",function forEach(e){return ce.Call(ft,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.map)){var st=Array.prototype.map;ne(Array.prototype,"map",function map(e){return ce.Call(st,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.filter)){var ct=Array.prototype.filter;ne(Array.prototype,"filter",function filter(e){return ce.Call(ct,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.some)){var lt=Array.prototype.some;ne(Array.prototype,"some",function some(e){return ce.Call(lt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.every)){var pt=Array.prototype.every;ne(Array.prototype,"every",function every(e){return ce.Call(pt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduce)){var vt=Array.prototype.reduce;ne(Array.prototype,"reduce",function reduce(e){return ce.Call(vt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduceRight,true)){var yt=Array.prototype.reduceRight;ne(Array.prototype,"reduceRight",function reduceRight(e){return ce.Call(yt,this.length>=0?this:[],arguments)},true)}var ht=Number("0o10")!==8;var bt=Number("0b10")!==2;var gt=y(Ue,function(e){return Number(e+0+e)===0});if(ht||bt||gt){var dt=Number;var mt=/^0b[01]+$/i;var Ot=/^0o[0-7]+$/i;var wt=mt.test.bind(mt);var jt=Ot.test.bind(Ot);var St=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(re.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(re.primitive(t)){return t}}throw new TypeError("No default value")};var Tt=$e.test.bind($e);var It=Je.test.bind(Je);var Et=function(){var e=function Number(t){var r;if(arguments.length>0){r=re.primitive(t)?t:St(t,"number")}else{r=0}if(typeof r==="string"){r=ce.Call(Be,r);if(wt(r)){r=parseInt(C(r,2),2)}else if(jt(r)){r=parseInt(C(r,2),8)}else if(Tt(r)||It(r)){r=NaN}}var n=this;var o=a(function(){dt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new dt(r)}return dt(r)};return e}();Ee(dt,Et,{});b(Et,{NaN:dt.NaN,MAX_VALUE:dt.MAX_VALUE,MIN_VALUE:dt.MIN_VALUE,NEGATIVE_INFINITY:dt.NEGATIVE_INFINITY,POSITIVE_INFINITY:dt.POSITIVE_INFINITY});Number=Et;m.redefine(S,"Number",Et)}var Pt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Pt,MIN_SAFE_INTEGER:-Pt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&ce.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){ne(Array.prototype,"find",et.find)}if([,1].findIndex(function(){return true})!==0){ne(Array.prototype,"findIndex",et.findIndex)}var Ct=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Mt=function ensureEnumerable(e,t){if(s&&Ct(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var xt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Nt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var At=function(e,t){var r=n(Object(t));var o;if(ce.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Ct(t))}return p(P(r,o||[]),Nt(t),e)};var Rt={assign:function(e,t){var r=ce.ToObject(e,"Cannot convert undefined or null to object");return p(ce.Call(xt,1,arguments),At,r)},is:function is(e,t){return ce.SameValue(e,t)}};var _t=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(_t){ne(Object,"assign",Rt.assign)}b(Object,Rt);if(s){var kt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!ce.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||ce.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,kt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Lt=!i(function(){return Object.keys("foo")});if(!Lt){var Ft=Object.keys;ne(Object,"keys",function keys(e){return Ft(ce.ToObject(e))});n=Object.keys}var Dt=i(function(){return Object.keys(/a/g)});if(Dt){var zt=Object.keys;ne(Object,"keys",function keys(e){if(re.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return zt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var qt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!qt){var Wt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Gt=Object.getOwnPropertyNames;ne(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=ce.ToObject(e);if(g(t)==="[object Window]"){try{return Gt(t)}catch(r){return P([],Wt)}}return Gt(t)})}}if(Object.getOwnPropertyDescriptor){var Ht=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Ht){var Vt=Object.getOwnPropertyDescriptor;ne(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Vt(ce.ToObject(e),t)})}}if(Object.seal){var Bt=!i(function(){return Object.seal("foo")});if(!Bt){var Ut=Object.seal;ne(Object,"seal",function seal(e){if(!ce.TypeIsObject(e)){return e}return Ut(e)})}}if(Object.isSealed){var $t=!i(function(){return Object.isSealed("foo")});if(!$t){var Jt=Object.isSealed;ne(Object,"isSealed",function isSealed(e){if(!ce.TypeIsObject(e)){return true}return Jt(e)})}}if(Object.freeze){var Xt=!i(function(){return Object.freeze("foo")});if(!Xt){var Kt=Object.freeze;ne(Object,"freeze",function freeze(e){if(!ce.TypeIsObject(e)){return e}return Kt(e)})}}if(Object.isFrozen){var Zt=!i(function(){return Object.isFrozen("foo")});if(!Zt){var Yt=Object.isFrozen;ne(Object,"isFrozen",function isFrozen(e){if(!ce.TypeIsObject(e)){return true}return Yt(e)})}}if(Object.preventExtensions){var Qt=!i(function(){return Object.preventExtensions("foo")});if(!Qt){var er=Object.preventExtensions;ne(Object,"preventExtensions",function preventExtensions(e){if(!ce.TypeIsObject(e)){return e}return er(e)})}}if(Object.isExtensible){var tr=!i(function(){return Object.isExtensible("foo")});if(!tr){var rr=Object.isExtensible;ne(Object,"isExtensible",function isExtensible(e){if(!ce.TypeIsObject(e)){return false}return rr(e)})}}if(Object.getPrototypeOf){var nr=!i(function(){return Object.getPrototypeOf("foo")});if(!nr){var or=Object.getPrototypeOf;ne(Object,"getPrototypeOf",function getPrototypeOf(e){return or(ce.ToObject(e))})}}var ir=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ce.IsCallable(e.get)}();if(s&&!ir){var ar=function flags(){if(!ce.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ar)}var ur=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var fr=oe&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var sr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var cr=sr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!sr||!cr){var lr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=ce.RequireObjectCoercible(this);if(re.regex(e)){return t(lr,e)}var r=ue(e.source);var n=ue(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,lr)}if(s&&(!ur||fr)){var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var vr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var yr=function(){return this.source};var hr=ce.IsCallable(vr.get)?vr.get:yr;var br=RegExp;var gr=function(){return function RegExp(e,t){var r=ce.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(re.regex(e)){o=ce.Call(hr,e);i=typeof t==="undefined"?ce.Call(pr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new br(e,t)}}();Ee(br,gr,{$input:true});RegExp=gr;m.redefine(S,"RegExp",gr)}if(s){var dr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(dr),function(e){if(e in RegExp&&!(dr[e]in RegExp)){m.getter(RegExp,dr[e],function get(){return RegExp[e]})}})}Ce(RegExp);var mr=1/Number.EPSILON;var Or=function roundTiesToEven(e){return e+mr-mr};var wr=Math.pow(2,-23);var jr=Math.pow(2,127)*(2-wr);var Sr=Math.pow(2,-126);var Tr=Math.E;var Ir=Math.LOG2E;var Er=Math.LOG10E;var Pr=Number.prototype.clz;delete Number.prototype.clz;var Cr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Y(t-1+D(1-r)*t)}var n=t/2;return Y(n+D(1-r)*n-1)+1/Ir},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=k(t);var n=r*r;var o=Z(t);if(r<1){return o*Y(r+n/(D(n+1)+1))}return o*(Y(r/2+D(1+1/n)*r/2-1)+1/Ir)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(X(t)||t<-1||t>1){return NaN}var r=k(t);return Z(t)*Y(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=L(F(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=ce.ToUint32(t);if(r===0){return 32}return Pr?ce.Call(Pr,r):31-_(F(r+.5)*Ir)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}var r=L(k(t)-1);return(r+1/(r*Tr*Tr))*(Tr/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return L(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return F(e)*Ir},log10:function log10(e){return F(e)*Er},log1p:Y,sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=k(t);if(r<1){var n=Math.expm1(r);return Z(t)*n*(1+1/(n+1))/2}var o=L(r-1);return Z(t)*(o-1/(o*Tr*Tr))*(Tr/2)},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(L(t)+L(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=ce.ToUint32(e);var n=ce.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<Sr){return r*Or(n/Sr/wr)*Sr*wr}var o=(1+wr/Number.EPSILON)*n;var i=o-(o-n);if(i>jr||X(i)){return r*Infinity}return r*i}};var Mr=function withinULPDistance(e,t,r){return k(1-e/t)/Number.EPSILON<(r||8)};b(Math,Cr);h(Math,"sinh",Cr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",Cr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",Cr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Cr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"asinh",Cr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",Cr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",Cr.tanh,Math.tanh(-2e-17)!==-2e-17);
h(Math,"acosh",Cr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",Cr.acosh,!Mr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",Cr.cbrt,!Mr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",Cr.sinh,Math.sinh(-2e-17)!==-2e-17);var xr=Math.expm1(10);h(Math,"expm1",Cr.expm1,xr>22025.465794806718||xr<22025.465794806718);var Nr=Math.round;var Ar=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Rr=mr+1;var _r=2*mr-1;var kr=[Rr,_r].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=_(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Ar||!kr);m.preserveToString(Math.round,Nr);var Lr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Cr.imul;m.preserveToString(Math.imul,Lr)}if(Math.imul.length!==2){ne(Math,"imul",function imul(e,t){return ce.Call(Lr,Math,arguments)})}var Fr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}ce.IsPromise=function(e){if(!ce.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!ce.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(ce.IsCallable(t.resolve)&&ce.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&ce.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=ce.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(ce.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!ce.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!ce.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!ce.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Ae(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=ce.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=ce.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(ce.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!ce.IsPromise(n)){throw new TypeError("not a promise")}var o=ce.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=ce.IsCallable(e)?e:a;var d=ce.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Fr==="function"){b(S,{Promise:Fr});var Dr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var zr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,W)});var qr=i(function(){return S.Promise.call(3,W)});var Wr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(n){return true}return t===r}(S.Promise);var Gr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Hr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Hr.prototype=Promise.prototype;Hr.all=Promise.all;var Vr=a(function(){return!!Hr.all([1,2])});if(!Dr||!zr||!qr||Wr||!Gr||Vr){Promise=Fr;ne(S,"Promise",Fr)}if(Promise.all.length!==1){var Br=Promise.all;ne(Promise,"all",function all(e){return ce.Call(Br,this,arguments)})}if(Promise.race.length!==1){var Ur=Promise.race;ne(Promise,"race",function race(e){return ce.Call(Ur,this,arguments)})}if(Promise.resolve.length!==1){var $r=Promise.resolve;ne(Promise,"resolve",function resolve(e){return ce.Call($r,this,arguments)})}if(Promise.reject.length!==1){var Jr=Promise.reject;ne(Promise,"reject",function reject(e){return ce.Call(Jr,this,arguments)})}Mt(Promise,"all");Mt(Promise,"race");Mt(Promise,"resolve");Mt(Promise,"reject");Ce(Promise)}var Xr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Kr=Xr(["z","a","bb"]);var Zr=Xr(["z",1,"a","3",2]);if(s){var Yr=function fastkey(e,t){if(!t&&!Kr){return null}if(se(e)){return"^"+ce.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Zr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var Qr=function emptyObject(){return Object.create?Object.create(null):{}};var en=function addIterableToMap(e,n,o){if(r(o)||re.string(o)){l(o,function(e){if(!ce.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!se(o)){a=n.set;if(!ce.IsCallable(a)){throw new TypeError("bad map")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!ce.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){ce.IteratorClose(i,true);throw s}}}}};var tn=function addIterableToSet(e,n,o){if(r(o)||re.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!se(o)){a=n.add;if(!ce.IsCallable(a)){throw new TypeError("bad set")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){ce.IteratorClose(i,true);throw s}}}}};var rn={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!ce.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ce.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ke()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ke(n)}}this.i=void 0;return Ke()}};Me(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Ae(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Qr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){en(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Yr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Yr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(ce.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Yr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(ce.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=Yr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(ce.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=G?new G:null;this._size=0;this._storage=Qr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Me(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!ce.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+ce.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Ae(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:Qr()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){tn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new rn.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Yr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Yr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=Yr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=Qr()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);Me(i.prototype,i.prototype.values);var f=function SetIterator(e){this.it=e};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};Me(f.prototype);return i}()};var nn=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(nn){S.Set=rn.Set}if(S.Map||S.Set){var on=a(function(){return new Map([[1,2]]).get(1)===2});if(!on){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var an=new Map;var un=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var fn=an.set(1,2)===an;if(!un||!fn){ne(Map.prototype,"set",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!un){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var sn=new Set;var cn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(sn);var ln=sn.add(1)===sn;if(!cn||!ln){var pn=Set.prototype.add;Set.prototype.add=function add(e){t(pn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,pn)}if(!cn){var vn=Set.prototype.has;Set.prototype.has=function has(e){return t(vn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,vn);var yn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(yn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],yn)}var hn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||bn||!gn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var dn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var mn=Object.setPrototypeOf&&!dn;var On=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||mn||!On){var wn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new wn;if(arguments.length>0){tn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=wn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,wn)}var jn=new S.Map;var Sn=!a(function(){return jn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||jn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof jn.keys().next!=="function"||Sn||!hn){b(S,{Map:rn.Map,Set:rn.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}Me(Object.getPrototypeOf((new S.Map).keys()));Me(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var Tn=S.Set.prototype.has;ne(S.Set.prototype,"has",function has(e){return t(Tn,this,e)})}}b(S,rn);Ce(S.Map);Ce(S.Set)}var In=function throwUnlessTargetIsObject(e){if(!ce.TypeIsObject(e)){throw new TypeError("target must be an object")}};var En={apply:function apply(){return ce.Call(ce.Call,null,arguments)},construct:function construct(e,t){if(!ce.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!ce.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return ce.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){In(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){In(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(En,{ownKeys:function ownKeys(e){In(e);var t=Object.getOwnPropertyNames(e);if(ce.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Pn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(En,{isExtensible:function isExtensible(e){In(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){In(e);return Pn(function(){return Object.preventExtensions(e)})}})}if(s){var Cn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return Cn(o,t,r)}if("value"in n){return n.value}if(n.get){return ce.Call(n.get,r)}return void 0};var Mn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Mn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!ce.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ae.defineProperty(o,r,{value:n})}else{return ae.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(En,{defineProperty:function defineProperty(e,t,r){In(e);return Pn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){In(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){In(e);var r=arguments.length>2?arguments[2]:e;return Cn(e,t,r)},set:function set(e,t,r){In(e);var n=arguments.length>3?arguments[3]:e;return Mn(e,t,r,n)}})}if(Object.getPrototypeOf){var xn=Object.getPrototypeOf;En.getPrototypeOf=function getPrototypeOf(e){In(e);return xn(e)}}if(Object.setPrototypeOf&&En.getPrototypeOf){var Nn=function(e,t){var r=t;while(r){if(e===r){return true}r=En.getPrototypeOf(r)}return false};Object.assign(En,{setPrototypeOf:function setPrototypeOf(e,t){In(e);if(t!==null&&!ce.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ae.getPrototypeOf(e)){return true}if(ae.isExtensible&&!ae.isExtensible(e)){return false}if(Nn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var An=function(e,t){if(!ce.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){ne(S.Reflect,e,t)}}};Object.keys(En).forEach(function(e){An(e,En[e])});var Rn=S.Reflect.getPrototypeOf;if(c&&Rn&&Rn.name!=="getPrototypeOf"){ne(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(Rn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){ne(S.Reflect,"setPrototypeOf",En.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){ne(S.Reflect,"defineProperty",En.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){ne(S.Reflect,"construct",En.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var _n=Date.prototype.toString;var kn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return ce.Call(_n,this)};ne(Date.prototype,"toString",kn)}var Ln={anchor:function anchor(e){return ce.CreateHTML(this,"a","name",e)},big:function big(){return ce.CreateHTML(this,"big","","")},blink:function blink(){return ce.CreateHTML(this,"blink","","")},bold:function bold(){return ce.CreateHTML(this,"b","","")},fixed:function fixed(){return ce.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return ce.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return ce.CreateHTML(this,"font","size",e)},italics:function italics(){return ce.CreateHTML(this,"i","","")},link:function link(e){return ce.CreateHTML(this,"a","href",e)},small:function small(){return ce.CreateHTML(this,"small","","")},strike:function strike(){return ce.CreateHTML(this,"strike","","")},sub:function sub(){return ce.CreateHTML(this,"sub","","")},sup:function sub(){return ce.CreateHTML(this,"sup","","")}};l(Object.keys(Ln),function(e){var r=String.prototype[e];var n=false;if(ce.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){ne(String.prototype,e,Ln[e])}});var Fn=function(){if(!oe){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e($())!=="undefined"){return true}if(e([$()])!=="[null]"){return true}var t={a:$()};t[$()]=true;if(e(t)!=="{}"){return true}return false}();var Dn=a(function(){if(!oe){return true}return JSON.stringify(Object($()))==="{}"&&JSON.stringify([Object($())])==="[{}]"});if(Fn||!Dn){var zn=JSON.stringify;ne(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=ce.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(re.symbol(n)){return Nt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return zn.apply(this,o)})}return S});
/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*!
 * imagesLoaded PACKAGED v4.1.4
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],o=0;o<i.length;o++){var r=i[o],s=n&&n[r];s&&(this.off(e,r),delete n[r]),r.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}("undefined"!=typeof window?window:this,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){if(Array.isArray(e))return e;var t="object"==typeof e&&"number"==typeof e.length;return t?d.call(e):[e]}function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var s=e;return"string"==typeof e&&(s=document.querySelectorAll(e)),s?(this.elements=n(s),this.options=i({},this.options),"function"==typeof t?r=t:i(this.options,t),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(s||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var h=e.jQuery,a=e.console,d=Array.prototype.slice;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&u[t]){for(var i=e.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var u={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(t.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},r.prototype=Object.create(t.prototype),r.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},r.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},o.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(h=t,h.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/dist/FileSaver.js */
(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof module&&(module.exports=g)});
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */
!function(){for(var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();
}else{document.documentElement.setAttribute("data-init", "lacking");}
</script>
<style id="style-normalize" type="text/css">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>
<style id="style-init-screen" type="text/css">@-webkit-keyframes init-loading-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes init-loading-spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes init-loading-spin{0%{-webkit-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}#init-screen{display:none;z-index:500000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;-webkit-animation:init-loading-spin 2s linear infinite;-o-animation:init-loading-spin 2s linear infinite;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>
<style id="style-font" type="text/css">@font-face{font-family:tme-fa-icons;src:url('data:application/octet-stream;base64,d09GRgABAAAAADLAAA8AAAAAWHgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY+IEkIY21hcAAAAdgAAAG8AAAF3rob9jFjdnQgAAADlAAAABMAAAAgBtX/BGZwZ20AAAOoAAAFkAAAC3CKkZBZZ2FzcAAACTgAAAAIAAAACAAAABBnbHlmAAAJQAAAI6gAADv+gJOpzGhlYWQAACzoAAAAMwAAADYY1IZaaGhlYQAALRwAAAAgAAAAJAfCBClobXR4AAAtPAAAAJEAAAFMBfb/0WxvY2EAAC3QAAAAqAAAAKhjiHI5bWF4cAAALngAAAAgAAAAIAFjDA9uYW1lAAAumAAAAY0AAAL94+zEpHBvc3QAADAoAAACHAAAA11cG/YjcHJlcAAAMkQAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZNZgnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4vGF4EMgf9z2KIYg5imAYUZgTJAQDSIQumAHic7dTVbltRAETR7dpNCikzQ8rMzMxt/M39mHnsU1/TfZz5jFpaV7pXJunMDLAZmOqaZjD5y4Tx+uPTyeL5lG2L5zN+L94zG8+ztr7ulXH1fra4bvK9M79xiWW2sNXPbWeFHexkF7vZw172sZ8DHOQQhznCUY5xnBOc5BSnOcNZVjnHeS5wkUtc5gpX/f3r3OAmt7jNHe5yj/s84CGPeMwTnvKM57zgJa94zRve8o73fOAjn/jMF77yje/84Ce/WGPun1zi/2tlXKbp3Xyc44bFyZanSWokJDXOOjXSk/LUSXn+pEwCKTNBaqQqZU5IjX+XMjukTBEp80TKZJEyY6RMGylzR8oEkjKLpEwlKfNJyqSSMrOkTC8pc0zKRJMy26RMOSnzTsrkk7IDpGwDKXtByoaQsiukbA0p+0PKJpGyU6RsFyl7RmosQcrukbKFpOwjKZtJyo6Ssq2k7C0pG0zKLpOy1aTsNymbTsrOk7L9pNwBUi4CKbeBlCtByr0g5XKQckNIuSak3BVSLgwpt4aUq0PK/SHlEpFyk0i5TqTcKVIuFim3i5QrRso9I+WykXLjXOYNzP8BuAPUwHicY2BAAxIQyBz0PwuEARJsA90AeJytVml300YUHXlJnIQsJQstamHExGmwRiZswYAJQbJjIF2crZWgixQ76b7xid/gX/Nk2nPoN35a7xsvJJC053Cak6N3583VzNtlElqS2AvrkZSbL8XU1iaN7DwJ6YZNy1F8KDt7IWWKyd8FURCtltq3HYdERCJQta6wRBD7HlmaZHzoUUbLtqRXTcotPekuW+NBvVXffho6yrE7oaRmM3RoPbIlVRhVokimPVLSpmWo+itJK7y/wsxXzVDCiE4iabwZxtBI3htntMpoNbbjKIpsstwoUiSa4UEUeZTVEufkigkMygfNkPLKpxHlw/yIrNijnFawS7bT/L4vead3OT+xX29RtuRAH8iO7ODsdCVfhFtbYdy0k+0oVBF213dCbNnsVP9mj/KaRgO3KzK90IxgqXyFECs/ocz+IVktnE/5kkejWrKRE0HrZU7sSz6B1uOIKXHNGFnQ3dEJEdT9kjMM9pg+Hvzx3imWCxMCeBzLekclnAgTKWFzNEnaMHJgJWWLKqn1rpg45XVaxFvCfu3a0ZfOaONQd2I8Ww8dWzlRyfFoUqeZTJ3aSc2jKQ2ilHQmeMyvAyg/oklebWM1iZVH0zhmxoREIgIt3EtTQSw7saQpBM2jGb25G6a5di1apMkD9dyj9/TmVri501PaDvSzRn9Wp2I62AvT6WnkL/Fp2uUiRen66Rl+TOJB1gIykS02w5SDB2/9DtLL15YchdcG2O7t8yuofdZE8KQB+xvQHk/VKQlMhZhViFZAYq1rWZbJ1awWqcjUd0OaVr6s0wSKchwXx76Mcf1fMzOWmBK+34nTsyMuPXPtSwjTHHybdT2a16nFcgFxZnlOp1mW7+s0x/IDneZZntfpCEtbp6MsP9RpgeVHOh1jeUELmnTfwZCLMOQCDpAwhKUDQ1hegiEsFQxhuQhDWBZhCMslGMLyYxjCchmGsLysZdXUU0nj2plYBmxCYGKOHrnMReVqKrlUQrtoVGpDnhJulVQUz6p/ZaBePPKGObAWSJfIml8xzpWPRuX41hUtbxo7V8Cx6m8fjvY58VLWi4U/Bf/V1lQlvWLNw5Or8BuGnmwnqjapeHRNl89VPbr+X1RUWAv0G0iFWCjKsmxwZyKEjzqdhmqglUPMbMw8tOt1y5qfw/03MUIWUP34NxQaC9yDTllJWe3grNXX27LcO4NyOBMsSTE38/pW+CIjs9J+kVnKno98HnAFjEpl2GoDrRW82ScxD5neJM8EcVtRNkja2M4EiQ0c84B5850EJmHqqg3kTuGGDfgFYW7BeSdconqjLIfuRezzKKT8W6fiRPaoaIzAs9kbYa/vQspvcQwkNPmlfgxUFaGpGDUV0DRSbqgGX8bZum1Cxg70Iyp2w7Ks4sPHFveVkm0ZhHykiNWjo5/WXqJOqtx+ZhSX752+BcEgNTF/e990cZDKu1rJMkdtA1O3GpVT15pD41WH6uZR9b3j7BM5a5puuiceel/TqtvBxVwssPZtDtJSJhfU9WGFDaLLxaVQ6mU0Se+4BxgWGNDvUIqN/6v62HyeK1WF0XEk307Ut9HnYAz8D9h/R/UD0Pdj6HINLs/3mhOfbvThbJmuohfrp+g3MGutuVm6BtzQdAPiIUetjrjKDXynBnF6pLkc6SHgY90V4gHAJoDF4BPdtYzmUwCj+Yw5PsDnzGHQZA6DLeYw2GbOGsAOcxjsMofBHnMYfMGcdYAvmcMgZA6DiDkMnjAnAHjKHAZfMYfB18xh8A1z7gN8yxwGMXMYJMxhsK/p1jDMLV7QXaC2QVWgA1NPWNzD4lBTZcj+jheG/b1BzP7BIKb+qOn2kPoTLwz1Z4OY+otBTP1V050h9TdeGOrvBjH1D4OY+ky/GMtlBr+MfJcKB5RdbD7n74n3D9vFQLkAAQAB//8AD3icrXsLcFzlleZ//v+++nb37dfte/VotVrdrW5JltuKpO6WJVluPyXbsmOEbGRjO4KVjWPZlsM4QIU4IYGlgCE2yxqKIQkJg2GreKQCTCZb1CZkiswjzOwOmSTATNVWTZLdDUwSMrVDsomD23vOf69assFAqgbk+773P4//nPOdc/5mwNjFl8WjosbaWblmxiOmIlTGYXzb11M7Z2ohAMbZCcZ5iG9prZl4whfwGju05xtttitUdwXYEUgkbQtWga5lC+XBaqJI285qpb8dVEc8Gnm5L5QM/f58yAlB399a7dD0mWAmdAqaMvBmKPKX9TdDwSjod9yhx03FAPcvI6Gk2lV33XoXUtKgL8C6Wa0WSzXbVjhg6JoqIPShCK0FOvOuE48K1V4B1VUQAVevugmP7Fz2CmTzW5/8+ZGP/+Kp7h/8oI4MuOZ7M5B9IvujH2Wf+PnCAjzn8ZK6AieMKRcvXnxWWSWCzGARlPcqtqs21WZzEBFgYIVDAYWzVJIrXBlH+hXGlWNM00GAJmYZ8sKBzTJFVZVppijqDFMVdTIWLa0o5JrdaHusPZGIG1IjFhQGK2mAZEe56kJnR1bTY7ZT7eivFGODBTdma3pHtlCNDVbwmgMHx/aO4R8ffeet5/ZCG6TfuV03IaSJU3oIzKsGO9+5PV+BwU5xqnOQx1aO8fW71yvD9fPn55/fA22PmsaFvfSgwZ8wzPiFvZ2DUMnzJ2hHVDMmHucPsSRrq7UQo4DMAV/AW7CANw/Zru3NIx20bBEpXwukArlxxOPReibaG63/SyQyiftzcBy3k1HuOHgjEgFHnkYfh4VodDJC4138Ff8hv5PlWbrWmm2O6grNEgGNCWGnbFtRm1Z04gzQPPWvkqMWF4eWU8DB267Df+gNe84bBvfRpfNI5Ny5yAmHDh5/PPLuByMlekDS9DsRR73nWHetwBShSO5PqCBQONO4E2wGlSvYZG6gMzeQ09SWFZC0tWION3oOVVXGTbGM+hrAzQj0O25yoN8R8YzzRsaZdzLwhpsGPEm783hAJ9+kq286eDX5pn/VydDjvk7i8EuchU21JJ3DNOqFzeABmywPcNXxhu/wB+3whrqwVw7Cn1j8vPfdDH6O7PR3fDV/Cb85wua/waSit309grZJHHOhHEQ9CA7zTGVCUb0ZvXzc1lrRe5Af+4An0aSL9op0IU9y6vRFtAYGKy7KJGFbQrdg2dXqGAwWilld0zUy9xLqd6A/zeFuy7gzYFmBOwOhZ6NNhZakm8YTI7S1pyM1mM032V26qevXGlzZ8+TKvROlB/BBkO9ACDalB7OZuBnuC5tRcAItpalENNOfhajVH1A2a1HjbHZ4N4r54oWLz4qPoe4jrMo2sonapm5QRQBQ3XycKVxwRRxjQuVCnWc6mrzOZ5FvBiraOmia5FubYRpok8n0ioRTKOQMNbWiszxYWAFZrQ1sB+dDJTFYghzyiBN3oB857ndIAha4Se/+YGUtjAkXXUO2xPE2eoe3TWPeMOXmzNi+j9w1HghvVbSAmu4c6nFac6MgbzXFU2baDr1241+98TfHtU/9t7df+MzU4msmfPYj06Wbw8Gqohda0/FkSyiyvtPGG/FsMKq1pLqmPvndkye/+y+08eYIHEJZpFmJra2Nop/VWuKcCwPvgRhnGlOFps6iIdAEmFVAKh53jblZyBU6nAFdbfX03tGwioZ9oGnEyDSWTQCyFzhoR+s/jdjgWLmc3L2K21zEmXCsM5aDm4g9Ny5v0PZVb+dY9Rcd/sl5eTiPj0nTaeiU+BhhW2qbuzJcUy2Nc2gCrjBkxWCqZiArGgOuwSzjAlDb5L91XfpvfYbpij6ZRIUWYoVcLqC2+UqNLddsMrekY3GZztVl2uQjpl4xjedIM+Uybc/r5viShuHgcgXuwQtpuoMHz8utCe/s8S+Y/7xMaYu2DX1yDrez3lp3cyyKdop+HLcLi878Uh9SKOSlj73cOIUFRVKVKHhaSS9JP452RCcYoJ3w85bz8Ckp9VN4xeZj9atpH4FnPCV4OtiDNIVYCrWwsbauK81VxUlaQnA+riFBisoUsiU0LbQpASCmmRAwg1MNJoH19uQ6WpriUV1jIQjphA5QjosiTfiy1tF+kPJKMTFYpAu6lkx40odnTv7VjYtC/QtTJyGH9HmMnKamGrcaqmaagRsMUwR9WeLmwsQREvIRevSvYa8uVFXo9Sc0w5A8/Rp5+jcxhXLuYAOIx/pbY+ggFp0FV8lNoLNAEQvyDkwBZR9T1ZC6xR0qFgsybix3DJcR7iIGwCsCHHQM0nYKVSBXQZPnqG7KDZiqrn8K524gpN9ghAx42k4GsvF3nohnA0kbnglkC9mrl7h4Db2TommKcVE1QOPRd97K5WJxsKO5nIjHbHtx/og3kK8iWys1he/EkKlqCbFOB6iKQp5Q5Yp6DB0AsjmPvHEFSGsoFraPaVpI2zLc2lmudErjJ/eeQwbKPoRBZulcwhwXYc6i1SdiEpiCF+KrFOIrAzKaHdhQ79tw4MAGuJv4rt8sQQu80jloGnnDfNVJBa+vn1WjSg1d8NHrg44FbTgdJ5+T77yy/gDI5wY7633yTbI7+CdyMDyEL2paDd0BvZjyfIYXH2/H+aqjDfXUisgnk3rFYMePoyZBegWanQpM5hKdlUSU1JnoQH2iG1d90IYADi0JPV2/oxMEeB7apm+aBngFw/ObMjzHzv7dgzyOh48fHZnmO9c8Wv+2RAGwHiP20UNnzx46mvYxyaMixDpZX22lQqQgRDqG4kYcMo92cpypAOo0Ti+iSYXJRGc5l8wvQhPfqpE0SYa7nDwkeQyh26OOlbecqVumoCwJ8+mDm+9/5T4eOyOt+4wk8WjavYTIG+7nD5Li2cWv8zGkMYoz51q2u3Y1JQSwfcumSn9JUxW0CZIWQ5isqKCo8zoGFPybx/lyHD2w4AaCBw7Ap1HIxAaHyZlr1tXG1owMt7h5Ox5QmxF4Iv6vDhaQoTFAYADuYIlnLa7b7RwtiOBDtVK1dbyCMXXxn5azOIIKfLFKaQP9K3HKIMYEQosvhkIWH23TQ9wIpCq9M4WxycnJsQIUYrEJ/bPGuOZohfHVzdmMaAmHm418c7DU3xdoyYPebFktPJtpHu7fefjw4R0VHiNTa06ZUTPe09a1sdTUVNrYtbo3nth11VW7tBa1d/U1a1t71rdG2u1IJNkWDYdbUs0pnnFT+OloWzISsdsjqVpvy9prqrNjed41POfPx2+J7TIXaWP5Wgf5bvToBEvpppQYOXPOJoda4gTQE6TsNK8sAvUSSHBFygfnfM9wL+8aK/Bddv0tZ8SufyKZ7ml7s20iCWdsPpPu4YVaXuur/2M6WX8riReTE21vtPUAnn4iyTxdf0vJ+/QM0pwsUL4D5BmUBQEeXpaU4W6RtExzN1In7eT9qHPpIoUdqAzSrdyHIPo1JNRps1uioCWJyIm2U/JG8oO4aZMXozF8b4RupRd5JJv7Nn8ZeUyxjlrakhJHcwO2gHMUDgGLR0MmS0GrIoMRWos0K81LUnPZYgmkw6sM8HtCoQTaT9y0Wu3f/MZuCYfijhMPhUVQNdL2hY8kMroS/8UvEqqeSfC/xzPV07k3vsqyrL+2ykYnhJjEz45OLIdbu4ncrbrWhImzltU7oqqaXAEdMWiHxPsSdvuF70K6/xf6FejjL13YBvFVP+UXrkwnyelZjBcltoLypQIoEmsoiDUw4C2QFS/I/J6yx5ybWOOqaMad0kJlKo+ElAdLqvRTMqOsgucuM64j3hgHU1H1mIkQ084Oje3eXT1lZwL1nwaD0BZMNfFTcHpv+sf7v6LEo4oZMlRbFNqH9tb60nEN0UkQ0mYawZNpR878eFuD1lWsl/Jb9J5iMbPlDKnkh3raBmS66U1M9Jm5rKUmMel1dKLOcxrVSgf5dJqU4o0g0pJyTlV37x4bytpCATOG8VUT4+m9cPoURiakE34ZMes/wbB0Roun+2p7h9oLSlwzQqZq2eIr+xe2/Rhp5QF8hHn5Hh/FfM9ibs32UrNG+l22ZbrnJ8N+fERAcD6YCp6nuPc2Aq/vWXiMfzKaye/BDfzTLPwe33MT8ns4P/y0uiLBdyZw3qRvNvGZegjF6H+escXvreOnkD7zm7IkADTbJEkU4sdw1jmwzpTj42smHLB82ijenjfx9YsXkccR+B5+I1azGtQk+4maTpnLlsBL75E7O1IPea+mzfPmUwQt00FJoG+nPxN/zruZzZprTljyx2GpXiHdYWBZtcINeB+2xVP16/GT9euDwf00TbqgK5gK7QvCmfp/wPn15WDa3BcM1l/Hy8F9wZQ31nf4Q2IjjrXyG+BnzXnMmqXiTuB5CLa01gINjvb8mesSTwHuSAEtzm8anp+uvwbdprkfhUs0wCNIxH6TP1l/vf6aPDThK0TXI5I+tjj+SX/8wIcaPxWX4y+CqsCiEIiAIzhsKrgfh+6qv+4L4RETPl6/zqMKukki9AA96OseZb3Zk7UKVKxZKt65tpR1J9p1sTGgP5Z4ah+KEzl73R/xEfr+I8H5fchlN/Jr0n0c3fSGkrz+vbhd5m2ZWltThDeKUaKh3WTZXWauS+WomBdMkjGvOCRuT9YfcIZxk0x24/5cT3q8redxe8TpTsLn03b9LIaFo/I0eQ7uxtjQm6rffI4elnTcJfbwX/qRFyG+Vw+SaJdyFIpugk0WXCcnaZFo1323viNAWHZPvk1+ugfjTf2sbcPR5LDT442bhwPj6Z5z9qi9wr8B85Ji51yXb3tISxlpSUtaZEYnFX8ZbHI6C8vk4ll2h5/YdRQbM0CUbSmXHsd5rH5zWz7fBnc/5iA1NLANwyQZ2+5JjiYfQ4mle+BxJA1prT9g+770dv4zTz9RnTPp+JlY4DJKoroOucmyT4fnsGIeFC3H9EtmB+qnGyP6413tPvs4BhIwipskDKakeIg+KKTgbl92JBkkHn1J3c8t+9ia2vBKhMFkGBJtEjrGDIzKE1SeAgTJiDAVRYpKmSGwMlksJor5gUWgjKlXYS0gurS4neaYflXJnaWBUjDKNAVhkWoF1WhHz7uJ2PapE8NHJkulySPD62/qVmLapMq10a997JqvnphQarc8dO3UQ2smYr38pfOWszK6fTs+eBKfHy4j8t2uWNrWnbDx5CNfe+TkxrHVE/EEW4ynxM9H2FhtpAeE2tnGFUH1J4xXChxD5hACLNXbLgOA3WU353rI37Y44SipbwdxwED/mEC0rOmuIzmlGkw7SBzNxZ6NN3519+zXRhV1Uosp3TdtGD68s4eXJo8uzHVtjyXc85gC9MYmRh+euuaRk+vhAG43Tm3RLGW7Clp52Oesq3N7dKVjnW9KxCdWjyFvi/nUs+Ja5CnPxtn+2t4NnVwLrELw76JqDMz1MacMGJoR0I5RVsA1lR/DLEdonLJLQWnOMcSamKlrszLnWWZ3mzcVOjsrnYWynTfVNmQ6aQFxrWtL9SQtgjqsojbxf5lp+qquSF1rVGyk02qZZEEKRkPdlv9ff3LVQ6MTFMas8xSft3fNVbd+vqg1KaF5w7RwBsirUye24UVXDS3oIcj/nz+56mF6qQlUAQ++gGoNytcxFG7P98DWMXMoHIL/6l/Z7p1riv8ko2oiyiru129WsSrmUjO1XdtWc0Pr7miOoWOV9YUQ07WQPmsCisWYDge5puAUAI3NIk6EQACmaQ+BGRaAwOSemV1TH90+vnlDrZBNFOi/nEUlLL96lYx5VZLqB5zDQLFQzGm6KuUX89L6YqxRuaPsCwXYTlJE1EVJt9ycWTo8bereoW7Wv38ewfOzmgI/N42Kn53LatjTxUCv85zbEyg+Y5hTcDddq99M2ysc8/51lABfjZ++8KvSxvUlnpCj7U+mIG3vR8yhXSbXEbaB3cDmatdds4lrhi9Z8hskNo2hkI+RQHWN6fMIUwKGFZiNhDmCNq6BoR1gejCoTzNdD86woB6cPDh33YFr91w99dHJLePr1tp525NylKZkzJtthLplN+ADzhOxjpiN1trRPwb/vhKfqIcMg8Mr3DDqd38o4cM36y9KWa+Tsn7v4/ocj134Vcg2TZsf/ABFKH4tYwrtObZYYxoF3QiQC+PjATwUho5+W8MkQlOOqUDxnlMNjZpsfB8zjJCxZe2afKeTjXeuboqT2XcOlsACB6XROFhWch7AeNy/VsZfx4fO5Aj8EjTVRPjLdtrmTS1NX7Azce6kmjZnnHf+1iuBiG0duzsmQTiZPzfjEoTGAqZ7xqt/nmmai8gXOWb0/sG9z8vyyPNOZjKDf9DlRgmQR93keVlHOU/9RTkfH8W8ieTQzWpsc21DGRM0Xw4soAUWDEDPtMB0oS9I5qeXC0PhMySPyTWjuYFctn9JEgWLp6FSXdz71TeSgzuQBmnXVHPXGqWhIhXkF+H2lQXxVqiSO5OthN9CQQSazmBOhdycwSgoZRJvQ28Yz8SVltDiwd3PUxMLN9De1dWehinH5783RvA9xhpyoHgnWAfGvE3sqtqOFT25rGIoMB4GBa0NAaepg2KYyiwVijQqFKGtopEeUFFYgQCboj0jZ8cCk7U1Q2W3MBBLjMRi0SCKxO0od6gD6Muon6Q35JGLDZS9DEpfLNZTA4aqrmrD0rwHCAO8Cs/Ur4a3J0Lql9WU4RfBJiYySfg+cviqaczLvipt59LuhbjXflPdSuRLUUd/9VV422jRv6SF/NbehYrcQ1p2AZ6jd80L5+kSRwE3WV+OVGTs9GvnU6yLDbJsrZ2aE+iijskqPtuHgTAktgz0r+xtaUaslZRRH6FKlRJrBwO9bK+lef8YXipg7j8GSJjM+GRPmSApRv6n//T4VrH3qqbRaNxoqoxSNMfwD6MV18yPulftrX+xZ7gXeka7vMCPgf2aQ8+N4bPuaKz7lg2LIGjjTT3x4T4jvubPYKL+cFtPTxscwm0DA+yVNaMjbFNt/cE9k+sUpoxgas8Gu1qjhG7GqUu+oAFel8B2gTDcgt+54If2XXv1VVsmVvRkM4m4TnnrYCGLtt5foc4F2rWO/NrIbxENvBHUy0WJBYqEg8hbyklAxoATvupfHMCZ3wAHaASEAFz/Y7pUPh+ZumWK7z65G1KGftgMJro0NbIzrOvbm1sCuhL9tBGKtrof1aLaZkdRjS4zYhzSDTDVw4bldnrPGtubWgKGiH0adR1JuR9VI/qErSgB72HMk0emp2+anr6F7kfTydZ+zdKSO0EdDRuTqaip3xAIjapaLa1aWqg/kmqNQEiXzza3ZFbqId3euezR4Iiqbkj5j7ZEIeTX7X4n9vLvLmKL2mAXILVUp0WPoyLCVJVGQ+/yNlGhjP8PNLq4y9vNy9rPrn+eW36OaPmdX0nTF7EIpu9XPlvW1XMgOiHbSHIL1ji1nsbpBdbAyXtlTRwjSHuCqyJvkjfAVEiMe317oeLEURlNKa/CI7tfVLxLp5qb4tFwUFVYJ3R6/STHqy1Xi1R9RLvvd6lSPIba14rZoo6zwa3w/7L18OGzRwC+N7B52+HD2zYPfA8OP3iIH9kyjkd4Fdwj9x85skUPzfXhQd9cSN96mB+97yjgoYUXvZ7kxYu/UW7mL7Eo+rwKK9byTKWsSWWz6N8VBaZxB5ShgDJZHerscm0J6L1at2fNGPH4CqQNZ+gAGTeaPZVNBB52IJ7nt/uI3N/B0707Do+8vmEH37rpdTLX8eEDd47Xr564Y3aIj+67azM8Q4dwYHjpHbJoOu1/8OkH++lk4s59Y2Lo+tsevG1ukA/N3uHb9f9TbkFebNRET61I/GEuOEtdCkxKcdfISpPptmSn01kdVNF4Y4NjHF1rWnh0cxWZKImsJdKcKPPIkZR5RIoYkcJ7dh665dDOHqV/4jgc2ILXkYz77zgwypGsH1zKst/L+ir6nJVsPdtR2zaC4aQTZC9CR4p0jigDQ6gmexJcUeeXdbS0xY7WslzDdpPF8uryAPX0L+tqoVNFD5QrFi7rbKGXwYnkJGCpwra4XMZe1th6JZcOCL0VgV445HepqL+l5jVdKMHP1VeH89a/WtYaK2/9Z/g4noyFYduzjf6WpSS0FIKDRovrC4aaQ9ZArQ9b1r/K58P0Yhi/4Msl4WPhFbUuzCTBb1OitsjmCVsAn+Qs3eokTJ1FeEQlI1nGXNlfnbS8tcc/sYz4wU8vsbd+lr/UII5u7mncOYBJ+WKc+5jsETe/L03AXCfmN4IlTVnCOYiVSxyWr5h45up7d/Lpu568c7ey4zRcu6yjzk9P3Xvu3im5qb9yaf98ab2AwZIsy0Zrq6nXxkG22zi121ScGiC71IoiZwcZqlAmzUCmvaU5GgkkzaQfoNCjlKimWnxvGhtR5b4r0roYFX59BZLFsvVB5NMRIVAGQ65bJoBsRuaFbLJM/0n3nZCLlZaWYKj+efWy88WezKv+yiG5dKnN23mX2uUJbi5bY+Rc4XgxBrHXGnlYb637gwLPEuXVBmD1ViiIyzgRfl5f9NddvfoB9NDxw0clWD9KV0FbdhMMjzfc+H7uJXEG8fo6Ns4O1q5fU+KCCq16PhXG3JuJcczFw6GwEaLSBXkQwNwF4DgLs1AgHDqA2FToAXEgCDpj+jTudDaDgUmnGsaG9bWx1UOVctJGzBlDf2HJWgZyh1HHkeV53RK5WC6Gc8fr45AzKSByxwlWHShTsxydSgfVLhALUZsXOiS8w0TlVOdJ006bC4ZayA43j7cN9WCqeCgYDTvGJzKnKG0Jn7ou6KSC18Frs8FUk2Jch1frv65/kWLdMMbf2fWfDKac4HFdaYpb8HY9ZDXZhnEylEgHP7t2L6YMcO46M22b111HA113zoFBDJQUpy/WLx6B36K+MxQdmlHBKerm0BIJKqUu68GgoLY0VSpexdChJiDC1WpC9qwK1cQYpS7U0BW0JAzeMrX6P+hRI2Dy4z/hqqmb4gS3jG8GLT77P1Ue5E4wfOFTFoioAS8NYVYZhv9umJapaPV6hct6wHdkHiowcqVYnvUivt5Qa+3vK/X2dBXy2Uy6pclBE4pR4XkwxWHTtq93vH+tv0l2U6pFvbNRePWrv51uBFbBWmgHbw/upXv+0LnRc1AxL/RjLrVgmvx/yP0Fq1KJxarV2A+PHct2HDvWwbvxJIYX60/THfzHrcdGH7shQm/iC2l6E/fXRumtaPU/ybeyx+p34UkVL0LJv9PAUHOomzL1w8q9uZaYoV3SIOoujHBKKii60eKMxhJHXUMgTQW0InVqqErq22AbYN6BHOMkFCMtlpWLDDc/0NM23tYLZ1uGMX5ZrWfPtkQj+chQ61lZiH+gZSiai0Sbz4JhDbeswXd2PSVr8E/twqtr8KXdu690Q2KpI6jHMMuhBjdRdbG9iQslEae6YVhDV7gBdOiHgK4iKtSERkv4yOpAP8ZMpimmNqtSRuUFG50FDD2AeaYRNrasGS0P2LTwuGDncpRJNtZ5Fpev85SVhMY6T3ewBJrtjAFIs8XZi95eSXOXLJkW75wKaXmE7afkst1TsjBDJxP3v3I//kG6Z9R+ce7WnfcfrvHRo6fPnT46CpteTMJZ7yXKMb2XTlHieMpspgUYLz+k3UsJV/LFTWNH7vvT08eHlfWHHtx+69yLSbZMRhHWhDn2SG0oYCC3qE/B0qAKuZqPg+b5XkErlwWmYkKlMkNY2eLmUAqF3OJinmKjrPIhuK1/W/IJ6z8kh5K1D2aK+/UTWqOzkz1fC4xVOgKKKqgjZqKV9nhTGGOgUGnZjiK4Mq8jJFKOMwJ0UxSLdlO/Ymvrtq8H3/UG+nBNcG0e7Vh79xt/yOf37KklDMPYaeyc3LZ1y8hwT671KoP8BApooL9agOqYUm2FATeRptTcdeQGxexmC3pWyw2u5ZSr4l9xsLCKW+DaaeqxVskXZql+XdTggY9NDrcHk331MoTzqZSj3fGlCe3GxJQT6IsGjeBkQOGQO53v+VKSb9E1EVMQ5vKs2/R7axiimWAmiVCh4/MZ1eYrecvvMWx9oa71KppmNkVhBs6G6m+veHkw8amOFi0QFY4pTI7RrikRxSd1jgBaCeytDEHmYSsUN/HTEEyqQVQ6ppY4937ER/nPmMXaWK6W8TvQy1cj+s28wcIlS70LHqQsSoS5rB18abP70ubwv0VMqrRhJALnb2SJXZ76vg7pAPc9++oF2+s8XzLyZUMt/3ajhy35encPGy4n+lIy4Xvvou1JERMJFmTa8zqHldSwlaBa9k6VC63heDzM/3cYttfndDMiKlbIwCN7eV2F8FS61toUNZhCzHltUoKChwg/yah6WVnr8jIXJer+ultoizj14CWn/GfvvEU5uIjTdtnx8nw86K1TlzWF5QsXBhYXGlw+3rLk/5IB/G8+gzZuYUagPa8ByoUaWfiRIuA35I4CrJOMVariLtOCaKD+Ryq3gvWTwSDci1AAfVtQi7zzsmWE4F5Vq/+RPKDe8714vX5SVSVGuXjxa2K/iCyN42qyOkbLkXwt6FIjmt5sRsHC11VB2yANZQl1HL+GWjFC9Em4Vx7Q2oKTeB2+oKkeL3xEkBU015zWlri4VEBrpICIlwZ7Eso2mgSVKs8GLeJN5YsLnmn7Lh7/45KS6ncSg5I/Por8NcaWi7UW27Te2JeyTGPqPg3VS9j2CzJyeznjn1qaGXCrpsq8ro655n7+1zi3WwkBRkGuRl5e3eMyi6L0TvDJcnYwTnM14fWG5Xyh5nXVLya56BmNJRUi25oYoiGRJBGXdaO+Rb1Y9R861mlZYzodsf21K8/wZ1mC8I75Hr9viTsF+fsW5BzxTSO1IFQNz6DJvnC/lPv9L6Ab4KcvfJU6gC94y9NfMP31s7i5XY5RIn6LJqKRxjAKDuOVppiQA65ycUhaEvVeQya8dVuF6uCYKClVFADVGd5FyGt9RTWAAgg50ahiNFm2YkcCarHv3QTW/6Jna0TY0VA0FEpnMkbciKJ0RGSrrMN/XzzKfy7p3saOsq21cUl7FVQ2Dboqxg8D38S4hnxooL2bGRU1qurqAtP1Q1M7xzd3Sd4MKlx9aN7cxtWq/1OQAi25ohrK0s0ilVHwbgmKVNGWD1T/IMmcmd2u68h5MhPsLpW6Mf7ZEUPfceC+0zfhdXy9uTm5cQffujnZrMQFzmZdv+n0HyDOnl33Z4RjOcFoIL338N50IIpBxBEd9+2+7fV+vGGHQ5Y18NCTDw1EwkITYRu/JwZe9fPMI+IfxFUsyjbSqvKhAcwt168pdedsTBbTzZxTnRzRxQyV/if8uggP8y2VcpqWw7iyTmgJOy3GuEu5oK35P5xC0L6GZFag308hopD9/6r3KyoE7rKG5Tqi3D9z8s6TM/3+7mEeeCxiPDanxdWDjxmRxwKIeebmVFVePajGtTl5VaWLcGDdLdMVpbTvxD0n9pWUyvQtew1RfioQFOU/1vU/Lotg4KmyMEz9nnuM2OINTVu8ETPuuUeXPuNZUcFYEmd9rFRbYSxfVUjLiN9dFerqyvd2yKWFBEEB548Fup3m1PWnBQHUERnjyKYur0O1v1pBfvl30u2Hnj4EwydOw/CBOyd23vd4+YefpuUbvHb84elmO9HXD1P3Tq1f48YM5VZ17msH5/d1fPtmWQndeOwTd1EnZNeXbtwsoBRbcbJ29T3T0GbGDO+3J95aen6KxViWDVCHL8i5wsPAxPLfE1FDb55RmQnmCYgrEoijOyX+6KeDoE66Tt5ONjkSgheKBA9LqL6qpqchU0E7QaSYtJ3+irSVimrrmpLJU3ej0gsK6vTRXbdlEXtnb9u17Z9B+Un9m9Hg5rmoE93YF4zCPwZ31H9b/6f6b3cEgzvAgAIYO4IwfMe64Q03nOX3fXzD8Lo7brzrLtiCz85tCkajwb6N0b9LJD738MOfSxTs2x7mj3yGsEgjzzBYB9Xw2hGCYAZOzYWG2uR6nFlvxlJeEZfO732ziNsX84be4ffMGz7/gRmQb1dyTX8Q/dtArU8Hb8Wybmgod53NBlQOilxbg9mPCIstK3sTAzE7O5BMJuTKkvJgwfulBskXM0CBMymXLQrpkSoDMVmJ6aA2QjGG4SJkRk38g5sd61dtYGoQ4St+jHY+U23r4aVWOEjtseoMnDgvfwCEm2+hp6r/X91AK4zYkU3HMVEaxnR3qBfqPzn+/wHPnsOreJxjYGRgYABi1vIsoXh+m68M3MwvgCIMt5YoxkDp2P9f/2exVDAHAbkcDEwgUQAz1Qu/AHicY2BkYGAO+p/FwMBS9v/r/68sFQxAERQQDACh8QbyeJxdT0sVwzAMy49AkAxAkbT3UQiAITGAISmAYQiA9th4ttUs7Q568UeSlVidiwSkB3PUPg+ESd6ZD/+8v7HyrtzwghY89ZB6BcyrYqc6RZhw48YhaA1Wc/v1PQtdeXJ/HppUmFM597nvBVK7D+Z+E8/uQZLBgDyaz3Llvxx02S3c/Hv813JrznryZP4F+6lSfQAAAAAAAAAAUAC2ATABaAGyAfoCJAKwAzYDmgQSBFwExgUyBbQF/AZOBvwHRAe2B/YISgigCPIJGglCCWQJignACgAKQAp2CroLAAtGC4oL8gxcDPINng5iDuYPag/6EF4RIBGGEeQSShKYEyQTbhOyFAoUYhS+FVoVphYoFooXHBeGGFoYnhjGGOwZChlOGXgZrBneGhwaWhqgGtIbLhvyHHQc2B1QHZ4d/wABAAAAUwBtAAYAAAAAAAIAIAAwAHMAAAB2C3AAAAAAeJx1kN9q2zAUh39q0441YxcbjN3tXJWWEcc1lEGvWkLbXZeSu8JUV/6T2VKQlY48w95ifYa9zt6jd/vFESUUYiP5O5/O8ZEE4AP+QWH9nHKsWeEdozXv4A0uIu/Sf488IN9G3sMQPyLv0/+MfICv+BV5iI/4wz+owVtGM/yNrPBZfYm8g/fqW+Rd+svIA/Jd5D18UovI+/S/Ix9gqp4iD3GoniduvvR1WQU5mhxLlmap3C/FUdVWN6IXoXK+k3MpnA2maVySuza0ZlToUZ07292YctFov6k2eWp8VzsrJ0m6qa+NNV4H87Dq1j2WWQiFFN61chX7yNy7mclDUoUwPxuPN/tjAoc5lvCoUaJCgOCI9pjfDGk/BPfMEGaus2pYaDQ0GgtWVP1Kx/ico2BkaQ0zGnKCnHNL09KNuK451721rLqhLfmfht5vzdrmp7Sr3nUfC07YL92afU1r+wrd7/Dh5WwdHrmLjDawanUK3+9acPXqPML7Wq3NaHL6pL+1QHuGMd8t5/8PvPGO3QAAAHicbZLnlpswEIV9DRiwvZtseu89Ib333vvmBWRZYMVC0pHEEufpg8BO/kTncOfTaLgMOtPr97o17P1/baKPACEiDBAjQYohRhhjDevYhu3YwA7sxC7sxh7sxT7sxwEcxCEcxhEcxTEcxwmcxCmcxhmcxTmcxwVcxCVkuIwruIpruI4buIlbuI07uIt7uI8HeIhHeIwneIpneI4XeIlXeI03eIt3eI8P+IhP+Iwv+Ipv+I5N/OiF1hEz9JKxUrtFrDl1lWF9NR9QIikToRaVjUouKxvOmNBjLxnlhgo2DbnM1djLKrNGnGPScSUzItzGv93yPP2bSQSX84z9cqFQdJ56yZRmMhW8mLlJJSaBI0XYPDaZKDUviZmvr6DrNjJMi0WcK1MTM02mqpbZlJtEsNx5SI238jSodJtoS7qv+BpPw67IY9xU+dg5TXjROTWwdGrIOzWhT+uA0jolxqjaZrSOnCF2Nmq16651EYpMm1fakAul9SJQeR5QVYQlk1VkZ8SwoVNFIVjWnKQrlBGdMToftdoZjrs77DajqXKrS02YEFxbbtdWkG0x44JJVUS5aBqKSlJwmhDrmOF2Hv9Wqsy4TNqoKhfmSrrQKuNSL5nvPG6p0s0AkEWkSWVZMy1Kx3ljk03qLuZ14lTmB8gNGmByGrGfjLrhlhJV2f7SaIneNF1ypQNbybBUSgZswQaWEUNngeay1/sD4l/60HicY/DewXAiKGIjI2Nf5AbGnRwMHAzJBRsZWJ02MTAyaIEYm7mYGDkgLD4GMIvNaRfTAaA0J5DN7rSLwQHCZmZw2ajC2BEYscGhI2Ijc4rLRjUQbxdHAwMji0NHckgESEkkEGzmYWLk0drB+L91A0vvRiYGFwAMdiP0AAA=') format('woff')}</style>
<style id="style-core" type="text/css">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{-webkit-transition:none!important;-o-transition:none!important;transition:none!important}:-webkit-full-screen{height:100%;width:100%}:-ms-fullscreen{height:100%;width:100%}:fullscreen{height:100%;width:100%}body::-ms-backdrop{background:0 0}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111;overflow:auto}a{cursor:pointer;color:#68d;text-decoration:none;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}a[disabled],span.link-disabled{color:#aaa;cursor:not-allowed!important;text-decoration:none}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em;resize:vertical}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input[type=range]{-webkit-appearance:none;min-height:1.2em}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;margin-top:-5px;width:33px}input[type=range]:focus::-webkit-slider-runnable-track{background:#222}input[type=range]::-moz-range-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-moz-range-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;width:33px}input[type=range]::-ms-track{background:0 0;border-color:transparent;color:transparent;cursor:pointer;height:10px;width:calc(100% - 1px)}input[type=range]::-ms-fill-lower{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-fill-upper{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:16px;width:33px}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;max-width:100%;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.75em}.error-view>.error{display:inline-block;margin-left:.25em}.error-view>.error-toggle+.error{margin-left:1.5em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){background-color:rgba(0,0,0,.2);display:block;margin:0 0 .25em;overflow-x:auto;padding:.25em}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:400;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) "\00a0\00a0"}[data-icon-after]:after{content:"\00a0\00a0" attr(data-icon-after)}.error-view>.error-toggle:before{content:"\e81a"}.error-view>.error-toggle.enabled:before{content:"\e818"}.error-view>.error:before{content:"\e80d\00a0\00a0"}a.link-external:after{content:"\00a0\e80e"}</style>
<style id="style-core-display" type="text/css">#story{z-index:10;margin:2.5em}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>
<style id="style-core-passage" type="text/css">.passage{line-height:1.75;text-align:left;-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}@media (prefers-reduced-motion:reduce){.passage{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}</style>
<style id="style-core-macro" type="text/css">@-webkit-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@-o-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}.macro-append-insert,.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-prepend-insert,.macro-repeat-insert,.macro-replace-insert,.macro-timed-insert{-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.macro-append-in,.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-prepend-in,.macro-repeat-in,.macro-replace-in,.macro-timed-in{opacity:0}.macro-type-cursor:after{-webkit-animation:cursor-blink 1s infinite;-o-animation:cursor-blink 1s infinite;animation:cursor-blink 1s infinite;content:"\2590";opacity:1}</style>
<style id="style-ui-dialog" type="text/css">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-overlay:not(.open){-webkit-transition:visibility .2s step-end,opacity .2s ease-in;-o-transition:visibility .2s step-end,opacity .2s ease-in;transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:-50%;left:-50%;height:200%;width:200%}#ui-dialog.open{display:block;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog>*{-webkit-box-sizing:border-box;box-sizing:border-box}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:92%;height:calc(100% - 2.1em)}@media (prefers-reduced-motion:reduce){#ui-overlay.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-overlay:not(.open){-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-dialog.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-close{font-family:tme-fa-icons!important;font-style:normal;font-weight:400;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}</style>
<style id="style-ui" type="text/css">#ui-dialog-body.settings [id|=setting-body]>div:first-child{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999;speak:none;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves .datestamp{font-size:75%;margin-left:1em}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-desc],#ui-dialog-body.settings p[id|=setting-desc]{font-size:87.5%;margin:0 0 0 .5em}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:1em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.settings input[type=range][id|=setting-control]{max-width:35vw}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:400;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-dialog-body.saves button[id=saves-export]:before{content:"\e829\00a0"}#ui-dialog-body.saves button[id=saves-import]:before{content:"\e82a\00a0"}#ui-dialog-body.saves button[id=saves-clear]:before{content:"\e827\00a0"}#ui-dialog-body.settings button[id|=setting-control]:after{content:"\00a0\00a0\e830"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:"\00a0\00a0\e831"}</style>
<style id="style-ui-bar" type="text/css">#story{margin-left:20em;-webkit-transition:margin-left .2s ease-in;-o-transition:margin-left .2s ease-in;transition:margin-left .2s ease-in}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;-webkit-transition:left .2s ease-in;-o-transition:left .2s ease-in;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;-webkit-transition:visibility .2s step-end;-o-transition:visibility .2s step-end;transition:visibility .2s step-end}@media (prefers-reduced-motion:reduce){#story{-webkit-transition:margin-left 0s;-o-transition:margin-left 0s;transition:margin-left 0s}#ui-bar{-webkit-transition:left 0s;-o-transition:left 0s;transition:left 0s}}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons!important;font-style:normal;font-weight:400;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-bar-toggle:before{content:"\e81d"}#ui-bar.stowed #ui-bar-toggle:before{content:"\e81e"}#menu-item-saves a:before{content:"\e82b\00a0"}#menu-item-settings a:before{content:"\e82d\00a0"}#menu-item-restart a:before{content:"\e82c\00a0"}#menu-item-share a:before{content:"\e82f\00a0"}</style>
<style id="style-ui-debug" type="text/css">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-toggle{color:#eee;background-color:#222;border:1px solid #444;height:101%;height:calc(100% + 1px);left:-2em;left:calc(-2em - 1px);position:absolute;top:-1px;width:2em}#debug-bar-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-hint{bottom:.175em;font-size:4.5em;opacity:.33;pointer-events:none;position:fixed;right:.6em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:650%;max-height:65vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none;color:#c00}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-hint:after,#debug-bar-toggle:before,#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:400;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#debug-bar-toggle:before{content:"\e838"}#debug-bar-hint:after{content:"\e838\202f\e822"}#debug-bar-watch .watch-delete:before{content:"\e804"}#debug-bar-watch-add:before{content:"\e805"}#debug-bar-watch-all:before{content:"\e83a"}#debug-bar-watch-none:before{content:"\e827"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:"\00a0\00a0\e830"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:"\00a0\00a0\e831"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:"<<" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:"<</" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:"<" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:"</" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>
</head>
<body>
	<div id="init-screen">
		<div id="init-no-js"><noscript>JavaScript must be enabled to play.</noscript></div>
		<div id="init-lacking"><p>Browser lacks capabilities required to play.</p><p>Upgrade or switch to another browser.</p></div>
		<div id="init-loading"><div>Loading&hellip;</div></div>
	</div>
	<!-- UUID://5CAF53F2-B97C-45CA-9E53-CBD50086BDA5// --><tw-storydata name="Spanish Aztec War Ver 1.0.1" startnode="223" creator="Tweego" creator-version="2.1.1+81d1d71" ifid="5CAF53F2-B97C-45CA-9E53-CBD50086BDA5" zoom="1" format="SugarCube" format-version="2.37.0-alpha.5" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">@import url('https://fonts.googleapis.com/css2?family=Langar&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap');
@import url("https://unpkg.com/jquery.nice-number@2.1.0/dist/jquery.nice-number.min.css");
@import url("//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css");
@import url("Twine/style.css");</style><script role="script" id="twine-user-script" type="text/twine-javascript">Save.clear()
Config.passages.nobr = true;
Window.SugarCubeState = State;

var urlPrefix="static/";
let lockId= LoadScreen.lock() 

importScripts([
	'/socket.io/socket.io.js',
	'https://unpkg.com/redux@latest/dist/redux.min.js',
	'https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js',
	`${urlPrefix}resize.js`,
	`${urlPrefix}picker.js`,
	`${urlPrefix}Client.js`,
	"https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.11/jquery.csv.min.js",
	"https://unpkg.com/jquery.nice-number@2.1.0/dist/jquery.nice-number.min.js",
	"https://code.jquery.com/ui/1.12.1/jquery-ui.js"
	]	
)
	.then(function() {
	initTheyr({lockId,callback:LoadScreen.unlock})
	}
);

(function () {
	"use strict";

	$(document).on(":liveupdate", function () {
		$(".macro-live").trigger(":liveupdateinternal");
	});

	Macro.add(['theyr', 'lb'], {
		tags: null,
		handler: function handler() {
			try {
				var content = this.payload[0].contents.trim();
				if (content) {
					var $el = $("<span></span>").addClass("macro-live macro-live-block").wiki(content).appendTo(this.output);
					$el.on(":liveupdateinternal", this.createShadowWrapper(function (ev) {
						$el.empty().wiki(content);
					}));
				}
			} catch (ex) {
				return this.error("bad evaluation: " + (_typeof(ex) === 'object' ? ex.message : ex));
			}
		}
	});

	//creates a historyButton div with a button to open/close it
	//arg[0] = button text
	//arg[1] = historyButton div text
	//arg[2] = historyButton div id
	Macro.add('historyButton', {
    handler: function() {
        let id = this.args[2];
		let wikiText = this.args[1].replaceAll(/\/\*[^\/]*\//gm, '');
		wikiText = wikiText.replaceAll( /<<[^>>]*>>/ig, '');
		wikiText = wikiText.replaceAll( /<[^br>]*>/ig, '');
	
        var output = `<<link "${this.args[0]}">><<toggleclass "#${id}" "hide">><</link>>
				 	<div id="${id}" class="hide">"${wikiText}"</div>`;
					
        $(this.output).wiki(output);
    }
	});
	
	Macro.add('storeSet', {
    handler: function() {
		//saves the key of the value that is being set
		let key = this.args.raw.split(/[ ]+/).join('').split("=")[0]; 

		//TODO: Replace with regex
		//accounts for <<storeSet _key+= val>> acses
		let endings = ['+', '-','*', '/']
		if(endings.includes(key.slice(-1))){
			key = key.slice(0,-1);
		}

		var output = `<<set ${this.args.raw}>>`
		
        $(this.output).wiki(output);
		// console.log("args", this.args);
		// console.log("key:",key);

		//send key of value to client function if not temporary var
		if(key.substring(0, 1) != "_"){
			diffSet(key);
		}
    }
	});


	Macro.add(['discord'], {
		tags: null,
		handler: function handler() {
			try {
				let message = this.payload[0].contents.trim();
				let channel = this.payload[0].arguments;
				$.post("/discordbot", {message, channel}, () => {});
			} catch (e) {
				return e;
			}
		}
	});
})();</script><tw-tag name="Breaks" color="blue"></tw-tag><tw-tag name="Change-Title" color="yellow"></tw-tag><tw-tag name="Coding-Problem" color="red"></tw-tag><tw-tag name="Done" color="green"></tw-tag><tw-tag name="New-Passage" color="purple"></tw-tag><tw-tag name="Text-to-be-updated-by-Ashley" color="orange"></tw-tag><tw-passagedata pid="1" name="A Friendly Invitation" tags="" position="4200,6375" size="100,100">&lt;&lt;theyr&gt;&gt;
Causeway leading into Tenochtitlán, November 8th, 1519

 

Moctezuma invites the Spaniards and their allies into the city, to stay in the palace as his personal guests. 
 

Spaniards, you are intrigued by Moctezuma&#39;s offer. Why has he invited you into the city? What are his motives? Do you trust him? Consult among your faction and decide upon one of the following choices:
 

Option 1: You refuse the invitation and attack the Aztecs. You ask the Tlaxcalans to join you.
 

Option 2: You refuse the invitation and return peacefully to Tlaxcala.
 

Option 3: You accept the invitation and enter the city, taking your Tlaxcalan companions with you.
 

[[Battle on the Causeway: Spaniards Attack]]

[[Spaniards Return to Tlaxcala]]

[[Into Tenochtitlan]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="2" name="A Spanish Victory" tags="Done" position="1875,3625" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve won a victory against the Tlaxcalans, but it was not easy.  They are fierce warriors.  You lost men in battle, and even with your superior weapons, it took three weeks of hard fighting.&lt;br&gt;
&lt;br&gt;
How does this experience shape your opinion of your indigenous opponents? How will you treat the Tlaxcalans? What lessons did this experience teach you?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and debrief on this encounter. Soon you will sit down with the defeated Tlaxcalans to negotiate peace. How might you win them to your side?&lt;br&gt;
&lt;br&gt;
When you have finished discussing and strategizing, [[enter the city of Tlaxcala|Tlaxcalans Negotiate Peace]] to establish peace terms with the Tlaxcalans.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="3" name="A Tlaxcalan Nap" tags="Done Breaks" position="2975,2325" size="100,100">&lt;&lt;theyr&gt;&gt;
For days now, you&#39;ve been worried about events outside your control. It&#39;s clear the Aztecs are preparing for something, but you have no way to know what this is.&lt;br&gt;
&lt;br&gt;
For three nights straight, you haven&#39;t slept a wink. You&#39;ve lain awake worrying and trying to mentally prepare for what might lie ahead. After so many sleepless days, you&#39;re exhausted and you lie down upon your reed mat for the night. As soon as you close your eyes, you slip into a deep sleep. &lt;br&gt;
&lt;br&gt;
You awake to find yourself in &lt;&lt;link &quot;a vaguely familiar place&quot; &quot;Waking up in the library&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=0&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="4" name="A Trap in Cholula" tags="Done" position="1750,4500" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Mal_Share eq &quot;&quot; or ndef $Mal_Share&gt;&gt;
You go to bed satisfied, full of food and a strange Cholulan wine. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for Marina to do something.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You have decided to share the rumor with your Spanish friends. You make your way to their sleeping quarters and quietly rouse them, careful not to wake your Cholulan hosts.&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and share with them what you have learned.&lt;br&gt;
&lt;br&gt;

&lt;&lt;if ndef $Mal_Span or $Mal_Span eq &quot;&quot;&gt;&gt; 
You wait nervously for &lt;&lt;print $Span_Leader&gt;&gt; to make a decision. Does he believe you?
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Mal_Span is &quot;Yes&quot;&gt;&gt;
You have delivered your news, the men believe you, and now you have no choice but to wait and see what happens. What will your new friends do? [[What do the Gods have in store for you|Marina Warns of the Attack]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mal_Span is &quot;No&quot;&gt;&gt;
You have delivered your news, but your friends did not believe you. It seems you have not yet won their trust. You go to sleep, [[wondering what the Gods have in store for you|Marina Warns of the Attack]].
&lt;&lt;/if&gt;&gt;

&lt;&lt;elseif $Mal_Share is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
You are just dozing off for the night when you hear a noise. The slave woman, Marina, has entered your sleeping quarters and is quietly rousing the men. She gathers you round, gesturing that you must be quiet, and delivers some news.&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and hear what she has to say.&lt;br&gt;
&lt;br&gt;
Once you&#39;ve heard what she has to say, discuss this news with the others. Do you all believe her? As the leader of the Spanish Faction, it is up to you to make the call for the entire group, so choose carefully. &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Yes&quot; &quot;Marina Warns of the Attack&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Span=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;No&quot; &quot;Marina Warns of the Attack&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Span=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] isnot $Span_Leader and $users[$userId][&quot;role&quot;] isnot &quot;Marina&quot;&gt;&gt;
You are just dozing off for the night when you hear a noise. The slave woman, Marina, has entered your sleeping quarters and is quietly rousing the men. She gathers you round, gesturing that you must be quiet, and delivers some news.&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and hear what she has to say.&lt;br&gt;
&lt;br&gt;
Once you&#39;ve heard what she has to say, discuss this news with the others. Do you all believe her? &lt;&lt;print $Span_Leader&gt;&gt; must make the call.  Do your best to persuade him, your very lives might depend upon this choice. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Mal_Span or $Mal_Span eq &quot;&quot;&gt;&gt; 
You wait nervously for &lt;&lt;print $Span_Leader&gt;&gt; to make a decision.
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Mal_Span is &quot;Yes&quot;&gt;&gt;
You have decided to [[put your faith in Marina|Marina Warns of the Attack]].
&lt;&lt;elseif $Mal_Span is &quot;No&quot;&gt;&gt;
You have decided you [[do not believe Marina|Marina Warns of the Attack]].
&lt;&lt;/if&gt;&gt;
&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;No&quot; and $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You try to sleep, but your nerves are frayed and you anxiously listen for any noise that might alert you to an attack. &lt;br&gt;
&lt;br&gt;
You finally drift into a fitful sleep in the early hours of the morning, only to be awakened by the most terrifying sounds! You hear drums, screaming, and the unmistakable sound of thousands of men bearing down upon you. You sneak out your sleeping quarters and find a place to hide, watching events as they unfold.&lt;br&gt;
&lt;br&gt;
Fortunately for your Spanish friends, their Tlaxcalan allies have come to their defense. They fight their way out of the city, barely escaping with your lives. Facing the prospect of being enslaved by the Aztecs, &lt;&lt;link &quot;you join them as they flee&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=5&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;No&quot; and $users[$userId][&quot;role&quot;] isnot &quot;Marina&quot;&gt;&gt;
You go to bed satisfied, full of food and a strange Cholulan wine. &lt;br&gt;
&lt;br&gt;
In the early hours of the morning, you are awakened by the most terrifying sounds! You hear drums, screaming, and the unmistakable sound of thousands of men bearing down upon you. You barely have time to stand and grab your sword before you are surrounded by an army of Aztec warriors!&lt;br&gt;
&lt;br&gt;
Thankfully, your Tlaxcalan allies have come to your defense! You fight your way out of the city and [[barely escape with your lives|Into the Mountain Pass]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="5" name="Absent Cortes Leadership Challenge" tags="" position="2675,9050" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader is &quot;Cortes&quot;&gt;&gt;

&lt;&lt;print $Span_Leader&gt;&gt; has led you through months of delicate negotations with &lt;&lt;print $Aztec_Leader&gt;&gt;, but with his departure, it is now time to designate someone you trust as your temporary leader?&lt;br&gt;
&lt;br&gt;
Go to the discussion board and discuss this decision amongst yourselves.  Everybody but Cortes should participate.  You can make the case to become leader yourself, or you can argue in favor of one of your compatriots. &lt;br&gt;
&lt;br&gt;
When you are satisfied with where things stand, vote for your leader.&lt;br&gt;
&lt;br&gt;
Option 1: &lt;&lt;link &quot;Marina&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Mar_Teno = $Sp_Ld_Mar_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should lead your people.&lt;br&gt;
&lt;br&gt;
Option 2: &lt;&lt;link &quot;Alvarado&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Alv_Teno = $Sp_Ld_Alv_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Alvarado&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should be in charge.&lt;br&gt;
&lt;br&gt;
Option 3: &lt;&lt;link &quot;Aguilar&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Agu_Teno = $Sp_Ld_Agu_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aguilar&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is best suited to lead in these difficult times.&lt;br&gt;
&lt;br&gt;
Option 4: &lt;&lt;link &quot;Garrido&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Gar_Teno = $Sp_Ld_Gar_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Garrido&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is your best chance of suriving these strange turns of events.&lt;br&gt;
&lt;br&gt;
Option 5: &lt;&lt;link &quot;Olid&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Oli_Teno = $Sp_Ld_Oli_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Garrido&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; will be your leader.&lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;
With Cortes gone, now is a good time to think about your team structure.  &lt;&lt;print $Span_Leader&gt;&gt; has led you through months of delicate negotations with &lt;&lt;print $Aztec_Leader&gt;&gt;, but with Cortes&#39; departure, it is now time to make other changes?&lt;br&gt;
&lt;br&gt;
Go to the discussion board and discuss this decision amongst yourselves.  Everybody but Cortes should participate.  Perhaps you think &lt;&lt;print $Span_Leader&gt;&gt; has done a fine job, and you advocate for no changes. You can make the case to become leader yourself, or you can argue in favor of one of your compatriots. &lt;br&gt;
&lt;br&gt;
When you are satisfied with where things stand, vote for your leader.&lt;br&gt;
&lt;br&gt;
Option 1: &lt;&lt;link &quot;Marina&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Mar_Teno = $Sp_Ld_Mar_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should lead your people.&lt;br&gt;
&lt;br&gt;
Option 2: &lt;&lt;link &quot;Alvarado&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Alv_Teno = $Sp_Ld_Alv_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Alvarado&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should be in charge.&lt;br&gt;
&lt;br&gt;
Option 3: &lt;&lt;link &quot;Aguilar&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Agu_Teno = $Sp_Ld_Agu_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aguilar&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is best suited to lead in these difficult times.&lt;br&gt;
&lt;br&gt;
Option 4: &lt;&lt;link &quot;Garrido&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Gar_Teno = $Sp_Ld_Gar_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Garrido&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is your best chance of suriving these strange turns of events.&lt;br&gt;
&lt;br&gt;
Option 5: &lt;&lt;link &quot;Olid&quot; &quot;Tenochtitlan Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Oli_Teno = $Sp_Ld_Oli_Teno + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Garrido&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote_Teno = $Sp_Ld_Vote_Teno + 1&gt;&gt;&lt;&lt;/link&gt;&gt; will be your leader.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="6" name="Act 1 Scene 1" tags="Done Breaks" position="2025,1250" size="100,100">&lt;&lt;theyr&gt;&gt;&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
Since arriving at the coast of Veracruz, your companions have been visited by emissaries from a number of nearby villages. In all of these interactions, you have proven your value, translating through the man they call Aguilar, who has in turn been able to convey information to the rest of the team. Through the visitors, you&#39;ve gained important intelligence. Most significantly, you&#39;ve told them many things about the rich and powerful kingdom that lies to the west. They have learned of the land called Mexico and its ruler, Moctezuma, who has made many enemies in the lands that lie between you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot &quot;Marina&quot;&gt;&gt;
Since arriving at the coast of Veracruz, you&#39;ve been visited by emissaries from a number of nearby villages. In all of these interactions, Marina has proven her value, translating for Aguilar, who has in turn been able to convey information to the rest of the team. Through the visitors, you&#39;ve gained important intelligence. Most significantly, you&#39;ve learned many things about the rich and powerful kingdom that lies to the west. This land is called Mexico and its ruler, Moctezuma, has made many enemies in the lands that lie between you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $flags[&quot;gifts&quot;] is &quot;Attack&quot;&gt;&gt;

One day, you hear rumors of a [[delegation approaching|Attack On a Beach in Veracruz]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;No&quot;&gt;&gt;

One day, you hear rumors of a [[delegation approaching|On a Beach in Veracruz: No Gifts]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;Yes&quot;&gt;&gt;

One day, you hear rumors of a [[delegation approaching|On a Beach in Veracruz: Gifts]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;Talk&quot;&gt;&gt;

You wonder what the next day will bring. Return here to find out.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif ndef $flags[&quot;gifts&quot;] or $flags[&quot;gifts&quot;] eq &quot;&quot;&gt;&gt;

You wonder what the next day will bring. Return here to find out.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="7" name="Act 2, Scene 2: Moctezuma&#39;s Arrest" tags="" position="4300,8975" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Moctezuma&#39;s Arrest: Spaniards explain themselves to Tlaxcala]]

[[Moctezuma&#39;s Arrest:  The Aztecs React]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="8" name="Act 3, Scene 1: The Great Encounter" tags="" position="4050,6050" size="100,100">&lt;&lt;theyr&gt;&gt;
Causeway leading into Tenochtitlán, November 8th, 1519

The Spaniards&#39; journey is finally done and with their Tlaxcalan companions at their side, they descend upon the city of Tenochtitlán. As the city comes into view, Cortes and his men can barely believe their eyes. Situated in the middle of Lake Texcoco, Tenochtitlán is a marvel of engineering, connected to the lake&#39;s shores by a series of causeways. As the Spaniards approach, they see an enormous temple rising up from the middle of the city. 
 

An Aztec delegation comes out to meet them. Among them is none other than the Emperor Moctezuma himself. Though he is barefoot, Moctezuma is richly dressed and escorted by his brother, Cuitlahuac, and his Prime Minister, Tlacaelel the Younger. Cortes dismounts his horse and approaches the Emperor to embrace him, sparking horror among the Aztecs, who prevent Cortes from laying hands upon their leader.
 

A ritual then unfolds, with each of the Aztecs bowing to kiss the ground. Each then greets Cortes in turn. When he reaches Moctezuma, Cortes presents the Emperor with a necklace of pearls and glass beads. Moctezuma, in turn, places two necklaces adorned with golden shrimp around the neck of Cortes. 
 

All three factions mingle on the causeway, getting to know each other and formulating their next move. Use this opportunity to get a sense of the opposing side. What do you think they are planning? Who do you trust?
 
[[Act 3, Scene 2: Moctezuma Speaks]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="9" name="Act 3, Scene 2: Moctezuma Speaks" tags="" position="4050,6200" size="100,100">&lt;&lt;theyr&gt;&gt;
Causeway leading into Tenochtitlán, November 8th, 1519

The crowd quiets and it becomes clear that Moctezuma, the huey tlatoani, is about to speak. He delivers an astonishing address, in which he announces the Aztecs&#39; next move. 
 

[[A Friendly Invitation]]

[[Moctezuma Respectfully Asks the Spaniards and their Allies to Leave]]

[[Aztecs Attack: Battle on the Causeway!]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="10" name="Act 3: The Great Encounter" tags="" position="4050,5775" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Secret Information Drop Moctezuma and Tlacaelel the Younger]]

[[Act 3, Scene 1: The Great Encounter]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="11" name="Act 4, Scene 1: The Aztecs Give the visitors a Tour of Tenochtitlan" tags="" position="4300,8825" size="100,100">&lt;&lt;theyr&gt;&gt;
Tenochtitlán, November 1519
 

Together, the Aztecs, the Spaniards and the Tlaxcalans enter the city of Tenochtitlán. The streets are lined with curious Aztec citizens, watching as the strangers pass. Moctezuma takes the strangers into his palace and makes them comfortable as his guests.
 

Later, the Aztecs take the Spaniards and Tlaxcalans out, showing them the wonders of the city. Years later, Bernal Diaz would recall everything that they saw and experienced in those first days in Tenochtitlán. 
Read his account here:
HOW DO WE ADD DIAZ&#39;S ACCOUNT?  LINK TO A GOOGLE BOOK VERSION?

 
Spaniards and Tlaxcalans, based on everything you&#39;ve just read, what would you like to ask the Aztecs? Go to the Go to the main discussion board, where each of you must post at least one question to your hosts.
Aztecs, you must respond to all questions in order to advance to the next stage of the game. This must be complete by 11:59 pm DAY 14.
Remember, your journey is far from over, and this is a rare opportunity for everybody to gather information about the other factions. What you ask--or answer--now could make all the difference between life or death, glory or sacrifice, later.

 
[[Act 2, Scene 2: Moctezuma&#39;s Arrest]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="12" name="Act 4: Tenochtitlan" tags="" position="4300,8675" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Act 4, Scene 1: The Aztecs Give the visitors a Tour of Tenochtitlan]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="13" name="After the Feast" tags="" position="2300,8300" size="100,100">&lt;&lt;theyr&gt;&gt;
After an eventful evening full of food, pulque and heated debate about your documents, you go back to your quarters and fall into the kind of deep sleep that only comes from over-indulging [[in so many delicious things|Waking up in the Library on a Full Belly]]. &lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="14" name="After the Riot Leader" tags="" position="2450,10875" size="100,100">&lt;&lt;theyr&gt;&gt;
Your new leader is &lt;&lt;print $New_Aztec_Leader&gt;&gt;.&lt;br&gt;
&lt;br&gt;
Now that your leader has been chosen, it&#39;s time to confront [[the bigger question at hand|Aztecs Plot Against the Spanish]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="15" name="After the Riot Vote" tags="" position="2450,10750" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Moc_Riot_Vote isnot 5&gt;&gt;
You have cast your vote, but others are less decisive. You wait for the rest of the council to make their choice.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;else&gt;&gt;

&lt;&lt;if $MocRiot_Moc &gt;=$MocRiot_Tla and $MocRiot_Moc &gt;=$MocRiot_Cua and $MocRiot_Moc &gt;=$MocRiot_Cac and $MocRiot_Moc &gt;=$MocRiot_AzP and $MocRiot_Moc &gt;=$MocRiot_Poc&gt;&gt;
&lt;&lt;if $MocRiot_Moc is 5 or $MocRiot_Tla is 5 or $MocRiot_Cua is 5 or $MocRiot_Cac is 5 or $MocRiot_AzP is 5 or $MocRiot_Poc is 5&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Moctezuma&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Moctezuma&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $MocRiot_Tla &gt;=$MocRiot_Moc and $MocRiot_Tla &gt;=$MocRiot_Cua and $MocRiot_Tla &gt;=$MocRiot_Cac and $MocRiot_Tla &gt;=$MocRiot_AzP and $MocRiot_Tla &gt;=$MocRiot_Poc&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Tlacaelel&quot;&gt;&gt;
&lt;&lt;if $MocRiot_Moc is 5 or $MocRiot_Tla is 5 or $MocRiot_Cua is 5 or $MocRiot_Cac is 5 or $MocRiot_AzP is 5 or $MocRiot_Poc is 5&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Tlacaelel&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Tlacaelel&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $MocRiot_Cua &gt;=$MocRiot_Moc and $MocRiot_Cua &gt;=$MocRiot_Tla and $MocRiot_Cua &gt;=$MocRiot_Cac and $MocRiot_Cua &gt;=$MocRiot_AzP and $MocRiot_Cua &gt;=$MocRiot_Poc&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Cuauhtemoc&quot;&gt;&gt;
&lt;&lt;if $MocRiot_Moc is 5 or $MocRiot_Tla is 5 or $MocRiot_Cua is 5 or $MocRiot_Cac is 5 or $MocRiot_AzP is 5 or $MocRiot_Poc is 5&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Cuauhtemoc&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Cuauhtemoc&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $MocRiot_Cac &gt;=$MocRiot_Moc and $MocRiot_Cac &gt;=$MocRiot_Tla and $MocRiot_Cac &gt;=$MocRiot_Cua and $MocRiot_Cac &gt;=$MocRiot_AzP and $MocRiot_Cac &gt;=$MocRiot_Poc&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Cacamatzin&quot;&gt;&gt;
&lt;&lt;if $MocRiot_Moc is 5 or $MocRiot_Tla is 5 or $MocRiot_Cua is 5 or $MocRiot_Cac is 5 or $MocRiot_AzP is 5 or $MocRiot_Poc is 5&gt;&gt;
 The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Cacamatzin&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Cacamatzin&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $MocRiot_AzP &gt;=$MocRiot_Moc and $MocRiot_AzP &gt;=$MocRiot_Tla and $MocRiot_AzP &gt;=$MocRiot_Cua and $MocRiot_AzP &gt;=$MocRiot_Cac and $MocRiot_AzP &gt;=$MocRiot_Poc&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Aztec_Priest&quot;&gt;&gt;
&lt;&lt;if $MocRiot_Moc is 5 or $MocRiot_Tla is 5 or $MocRiot_Cua is 5 or $MocRiot_Cac is 5 or $MocRiot_AzP is 5 or $MocRiot_Poc is 5&gt;&gt;
 The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Aztec_Priest&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Aztec Priest&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $MocRiot_Poc &gt;=$MocRiot_Moc and $MocRiot_Poc &gt;=$MocRiot_Tla and $MocRiot_Poc &gt;=$MocRiot_Cua and $MocRiot_Poc &gt;=$MocRiot_Cac and $MocRiot_Poc &gt;=$MocRiot_AzP&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Pochteca&quot;&gt;&gt;
&lt;&lt;if $MocRiot_Moc is 5 or $MocRiot_Tla is 5 or $MocRiot_Cua is 5 or $MocRiot_Cac is 5 or $MocRiot_AzP is 5 or $MocRiot_Poc is 5&gt;&gt;
 The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Pochteca&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The votes have been cast, click through to find out who your &lt;&lt;link &quot;next leader is&quot; &quot;After the Riot Leader&quot;&gt;&gt;&lt;&lt;storeSet $New_Aztec_Leader=&quot;Pochteca&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="16" name="Aguilar Among the Maya" tags="Done" position="1925,50" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Start &lt;=10&gt;&gt;

You must wait for all the team members to gather for gameplay to begin.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Start &gt;=5&gt;&gt;
It&#39;s been eight years since you were shipwrecked on the way to Santo Domingo; eight years that you&#39;ve been living as a slave among the Maya. All this time, you&#39;ve remained loyal to your vows as a Franciscan Friar, refusing to take a wife and fully embrace the Mayan culture. After all these years, however, you have become fluent in the Yucatec Maya language. &lt;br&gt;
&lt;br&gt;
This morning began like any other, but things take a turn when you overhear some rather interesting news. As you sweep the entrance to the temple, you overhear a conversation between two of the most important men in the village. &lt;br&gt;
&lt;br&gt;
[[Here is what they said|Maya Gossip]]:&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="17" name="Aguilar Answers" tags="" position="2350,250" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;No&quot; and $Aguilar_2 is &quot;No&quot; and $Aguilar_3 is &quot;No&quot;&gt;&gt;
You have not yet answered any questions correctly.  Please [[return and try again|Aguilar Quest]] or [[start over|Spaniards Quest Instructions 2]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have been freed from your long captivity! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered questions correctly.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot;&gt;&gt;
You have answered question 1 correctly! The Gossip came from the great city of Tulum! Please [[return and answer another question|Aguilar Quest]] or [[start over|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_2 is &quot;Yes&quot;&gt;&gt;
You have answered question 2 correctly! The Maya saw a house floating on water filled with men! Please [[return and answer another question|Aguilar Quest]] or [[start over|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
You have answered question 3 correctly! The strangers fired rocks into the sea and then fled! Please [[return and answer another question|Aguilar Quest]] or [[start over|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Marina&quot;&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;No&quot; and $Aguilar_2 is &quot;No&quot; and $Aguilar_3 is &quot;No&quot;&gt;&gt;
You have not yet answered any questions correctly.  Please [[return and try again|Aguilar Quest]] or [[start over|Spaniards Quest Instructions 2]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have freed Aguilar! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered questions correctly.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot;&gt;&gt;
You have answered question 1 correctly! The Gossip came from the great city of Tulum! Please [[return and answer another question|Aguilar Quest]] or [[start over|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_2 is &quot;Yes&quot;&gt;&gt;
You have answered question 2 correctly! The Maya saw a house floating on water filled with men! Please [[return and answer another question|Aguilar Quest]] or [[start over|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
You have answered question 3 correctly! The strangers fired rocks into the sea and then fled! Please [[return and answer another question|Aguilar Quest]] or [[start over|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;No&quot; and $Aguilar_2 is &quot;No&quot; and $Aguilar_3 is &quot;No&quot;&gt;&gt;
You have not yet answered any questions correctly.  Please [[return and try again|Aguilar Quest]] or [[start over and talk to Marina|Spaniards Quest Instructions 2]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have freed Aguilar! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered questions correctly.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot;&gt;&gt;
You have answered question 1 correctly! The Gossip came from the great city of Tulum! Please [[return and answer another question|Aguilar Quest]] or [[start over and talk to Marina|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_2 is &quot;Yes&quot;&gt;&gt;
You have answered question 2 correctly! The Maya saw a house floating on water filled with men! Please [[return and answer another question|Aguilar Quest]] or [[start over and talk to Marina|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
You have answered question 3 correctly! The strangers fired rocks into the sea and then fled! Please [[return and answer another question|Aguilar Quest]] or [[start over and talk to Marina|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Alvarado&quot; or &quot;Olid&quot; or &quot;Garrido&quot;&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;No&quot; and $Aguilar_2 is &quot;No&quot; and $Aguilar_3 is &quot;No&quot;&gt;&gt;
You have not yet answered any questions correctly.  Please [[return and try again|Aguilar Quest]] or [[start over and talk to Marina|Spaniards Quest Instructions 2]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have freed Aguilar! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered questions correctly.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot;&gt;&gt;
You have answered question 1 correctly! The Gossip came from the great city of Tulum! Please [[return and answer another question|Aguilar Quest]] or [[start over and talk to Marina|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_2 is &quot;Yes&quot;&gt;&gt;
You have answered question 2 correctly! The Maya saw a house floating on water filled with men! Please [[return and answer another question|Aguilar Quest]] or [[start over and talk to Marina|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
You have answered question 3 correctly! The strangers fired rocks into the sea and then fled! Please [[return and answer another question|Aguilar Quest]] or [[start over and talk to Marina|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="18" name="Aguilar Quest" tags="" position="2300,450" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
&lt;&lt;if ndef $Aguilar_1 or $Aguilar_1 eq &quot;&quot;&gt;&gt;
You must wait for Cortes to begin the quest.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have been freed from your long captivity! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt;&lt;i&gt; Jo&#39;oljeak, táan te&#39; k&#39;íiwiko&#39; tu&#39;ux tin k&#39;ajóoltaj u juntúul máak Tulum. Ku beetik jump&#39;éel k&#39;iino&#39;ob, táan paakat le k&#39;áak&#39;náabo&#39; ka tu yilaj jump&#39;éel nuxi&#39; naj chíikpajal ichil le ja&#39;o&#39;. Le najo&#39; Náats&#39; Amal ka&#39;atéen asab yéetel xiibo&#39;obo&#39; le kaajo&#39; múuch&#39;o&#39;ob utia&#39;al in wil le najo&#39;. Ka le najo&#39; Náats&#39; páajchajo&#39;obij wil táan Chuup yéetel wíiniko&#39;ob yéetel yoot&#39;el n wíinkilil yéetel ya&#39;ab tso&#39;otsel. Xiibo&#39;obo&#39; Tulum ma&#39; sabían tu&#39;ux venía le naja&#39;, ba&#39;ale&#39; tu yilo&#39;ob toop. Tu beetajo&#39;ob juum ka menta&#39;abij tunicho&#39;ob ti&#39; le k&#39;áak&#39;náabo&#39;. Le najo&#39; sunaj ka lanchajal.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt;&lt;i&gt; Ba&#39;ax ts&#39;o&#39;ok u yilik le najo&#39; ti&#39; uláak&#39; ba&#39;ali&#39;. Yojlo&#39;ob tu&#39;ux tali&#39;.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt;&lt;i&gt; lol Jach jela&#39;an. In wa&#39;alike&#39; u K&#39;a&#39;abeta Jach yila&#39;al.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt;&lt;i&gt; K wíiniko&#39;ob yan u bino&#39;ob ja&#39; pa&#39;atik. Wa le najo&#39; k&#39;uchul yóok&#39;ol le ja&#39; ti&#39; leti&#39;ob ko&#39;on jóok&#39;ol.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Aguilar, though you have been captive among the Maya for years, recently, you&#39;ve heard exciting news and now is your chance to escape.  A band of Spaniards have arrived and are going to interview you for information about this news you&#39;ve heard. If you can answer their questions, they will free you from your captivity, and you can join their expedition.  But beware, every wrong answer you give them will hurt them, while the correct answer will make your team stronger.&lt;br&gt;
&lt;br&gt;
When you have finished answering their questions on the discord discussion board, you may [[continue to find out if you are free|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Marina&quot;&gt;&gt;
&lt;&lt;if ndef $Aguilar_1 or $Aguilar_1 eq &quot;&quot;&gt;&gt;
You must wait for Cortes to begin the quest.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have freed Aguilar from his long captivity! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
To “unlock” Aguilar&#39;s character, you must interview him about some gossip he overheard. Interview him to find the answers to the following questions:&lt;br&gt; 
&lt;br&gt;
&lt;&lt;if $Aguilar_1 is &quot;No&quot; or $Aguilar_1 eq &quot;&quot; or ndef $Aguilar_1&gt;&gt;

&lt;b&gt;Where did the gossip come from?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
The land of Chuup.&lt;br&gt;
&lt;br&gt;
Their friend Náats&#39; Amal.&lt;br&gt;
&lt;br&gt;
The great coastal city of Tulum.&lt;br&gt;
&lt;br&gt;
The priest in the temple.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 1. The gossip came from the great coastal city of Tulum.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_2 is &quot;No&quot; or $Aguilar_2 eq &quot;&quot; or ndef $Aguilar_2&gt;&gt;
&lt;b&gt;What did the Maya see?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
A long line of men on horseback.&lt;br&gt;
&lt;br&gt;
A House Floating on the Water filled with men.&lt;br&gt;
&lt;br&gt;
A rowdy group of strangers in the market.&lt;br&gt;
&lt;br&gt;
Messengers from the Aztec Emperor.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 2. The Maya saw a house floating on water filled with men.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_3 is &quot;No&quot; or $Aguilar_3 eq &quot;&quot; or ndef $Aguilar_3&gt;&gt;
&lt;b&gt;How did the interaction between the groups go?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
The strangers fired rocks into the sea and fled.&lt;br&gt;
&lt;br&gt;
The strangers came ashore and asked for food.&lt;br&gt;
&lt;br&gt;
[[The strangers came ashore and attacked|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
[[The strangers were carried away by a giant caiman|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 3. The strangers fired rocks into the sea and fled.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
To “unlock” Aguilar&#39;s character, you must interview him about some gossip he overheard. &lt;b&gt; As the leader, note that ONLY YOUR answers will work to unlock the characters.&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
Interview Aguilar to find the answers to the following questions:&lt;br&gt; 
&lt;br&gt;
&lt;&lt;if $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have freed Aguilar from his long captivity! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Aguilar_1 is &quot;No&quot; or $Aguilar_1 eq &quot;&quot; or ndef $Aguilar_1&gt;&gt;

&lt;b&gt;Where did the gossip come from?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;The land of Chuup&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Their friend Náats&#39; Amal&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;The great coastal city of Tulum&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_1=&quot;Yes&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=2&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;The priest in the temple&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot;&gt;&gt;
You have answered Question 1. The gossip came from the great coastal city of Tulum.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_2 is &quot;No&quot; or $Aguilar_2 eq &quot;&quot; or ndef $Aguilar_2&gt;&gt;
&lt;b&gt;What did the Maya see?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;A long line of men on horseback&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;A House Floating on the Water filled with men&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_2=&quot;Yes&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=2&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;A rowdy group of strangers in the market&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Messengers from the Aztec Emperor&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 2. The Maya saw a house floating on water filled with men.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_3 is &quot;No&quot; or $Aguilar_3 eq &quot;&quot; or ndef $Aguilar_3&gt;&gt;
&lt;b&gt;How did the interaction between the groups go?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;The strangers fired rocks into the sea and fled&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=2&gt;&gt;&lt;&lt;storeSet $Aguilar_3=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;The strangers came ashore and asked for food&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_3=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;The strangers came ashore and attacked&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_3=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;The strangers were carried away by a giant caiman&quot; &quot;Aguilar Answers&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_3=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 3. The strangers fired rocks into the sea and fled.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Alvarado&quot; or &quot;Olid&quot; or &quot;Garrido&quot;&gt;&gt;
&lt;&lt;if ndef $Aguilar_1 or $Aguilar_1 eq &quot;&quot;&gt;&gt;
You must wait for Cortes to begin the quest.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Aguilar_1 is &quot;Yes&quot; and $Aguilar_2 is &quot;Yes&quot; and $Aguilar_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have freed Aguilar from his long captivity! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
To “unlock” Aguilar&#39;s character, you must interview him about some gossip he overheard. Interview him to find the answers to the following questions:&lt;br&gt; 
&lt;br&gt;

&lt;&lt;if $Aguilar_1 is &quot;No&quot; or $Aguilar_1 eq &quot;&quot; or ndef $Aguilar_1&gt;&gt;

&lt;b&gt;Where did the gossip come from?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
The land of Chuup.&lt;br&gt;
&lt;br&gt;
Their friend Náats&#39; Amal.&lt;br&gt;
&lt;br&gt;
The great coastal city of Tulum.&lt;br&gt;
&lt;br&gt;
The priest in the temple.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 1. The gossip came from the great coastal city of Tulum.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Aguilar_2 is &quot;No&quot; or $Aguilar_2 eq &quot;&quot; or ndef $Aguilar_2&gt;&gt;
&lt;b&gt;What did the Maya see?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
A long line of men on horseback.&lt;br&gt;
&lt;br&gt;
A House Floating on the Water filled with men.&lt;br&gt;
&lt;br&gt;
A rowdy group of strangers in the market.&lt;br&gt;
&lt;br&gt;
Messengers from the Aztec Emperor.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 2. The Maya saw a house floating on water filled with men.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Aguilar_3 is &quot;No&quot; or $Aguilar_3 eq &quot;&quot; or ndef $Aguilar_3&gt;&gt;
&lt;b&gt;How did the interaction between the groups go?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
The strangers fired rocks into the sea and fled.&lt;br&gt;
&lt;br&gt;
The strangers came ashore and asked for food.&lt;br&gt;
&lt;br&gt;
The strangers came ashore and attacked.&lt;br&gt;
&lt;br&gt;
The strangers were carried away by a giant caiman.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Aguilar Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 3. The strangers fired rocks into the sea and fled.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="19" name="Aguilar Receives a Letter" tags="Done Breaks" position="1375,575" size="100,100">&lt;&lt;theyr&gt;&gt;
Since hearing the rumor of the strangers on the coast, you have been quietly plotting your escape. Unfortunately, the opportunity to flee has not yet presented itself. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Letter or $Letter eq &quot;&quot;&gt;&gt;

You continue to bide your time and wait for your opening.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Letter is &quot;sent&quot;&gt;&gt;

A day after you first hear the rumor, you are approached by the Mayan lord who has been your master these long years. He tells you that a pair of messengers have arrived from the coast, bearing beautiful gifts. A group of strangers have come who desire your release and they have paid him handsomely. Your master informs you that you are free and hands you a letter. It reads: &lt;br&gt;
&lt;br&gt;
“Gentlemen and brothers, here in Cozumel I have learnt that you are captives in the hands of a Cacique, and I pray you that you come here to Cozumel at once, and for this purpose I have sent a ship with soldiers, in case you have need of them, and a ransom to be paid to those Indians with whom you are living. The ship will wait eight days for you. Come in all haste, and you will be welcomed and protected. I am here at this Island with five hundred soldiers and eleven ships, in which I go on, please God, to a town called Tabasco or Potonchan.”&lt;br&gt;
&lt;br&gt;
You are elated at the message and set out in search of your former companion, Gonzalo Guerrero. Together, you were the sole survivors of the wreck that left you here among the Maya, but unlike you, Guerrero has adopted this new land and forsaken his one true God. Unlike you, Guerrero has not lived out these long years as a slave.&lt;br&gt;
&lt;br&gt;
When you find him, you share the letter. Guerrero reads it and, much to your dismay, he refuses to leave. “Brother Aguilar,” he says to you, “I am married and have three children and the Indians look on me as a Cacique and captain in wartime,--You go and God be with you, but I have my face tattooed and my ears pierced, what would the Spaniards say should they see me in this guise?”&lt;br&gt;
&lt;br&gt;
You inform Guerrero that God will never forgive him and warn him that he will be punished for his sins. And then you &lt;&lt;link &quot;head for the coast&quot; &quot;Spaniards arrive at Yucatan&quot;&gt;&gt;&lt;&lt;storeSet $L_Received=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="20" name="Aguilar&#39;s Contribution" tags="" position="2300,7800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Here you will find links to each entry of the Spanish guidebook, along with a special section written by your Tlaxcalan guests. You must read each entry and evaluate their descriptions. Are they accurate in their portrayals? &lt;br&gt;
&lt;br&gt;
To aid you in this task, go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán. You may also want to revisit other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
Marina&#39;s introduction is:  &lt;&lt;print &quot;$Ma_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Marina&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cortes&#39; entry is:  &lt;&lt;print &quot;$Co_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Cortes&#39; contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Alvarado&#39;s entry is:  &lt;&lt;print &quot;$Al_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Alvarado&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Aguilar&#39;s entry is:  &lt;&lt;print &quot;$Ag_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Olid&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Aguilar&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Olid&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Aguilar&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Olid&#39;s entry is:  &lt;&lt;print &quot;$Ol_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Garrido&#39;s entry is:  &lt;&lt;print &quot;$Ga_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Tlaxcalan&#39;s Insider&#39;s Guide is:  &lt;&lt;print &quot;$Tl_IG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot; OR &quot;Tlaxcalans&quot;&gt;&gt;
Here you will find links to each recipe in the Aztec cookbook. You must read each recipe and judge them for accuracy. Have they properly sourced their ingredients or are there items here that can&#39;t be found in Tenochtitlán?  &lt;br&gt;
&lt;br&gt;

To aid you in this task, you may want to revisit Bernal Diaz&#39; account of Tenochtitlán. You may also want to read his account of the Aztec feast, visit the Codex Mendoza, and review other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;

Moctezuma&#39;s recipe is:  &lt;&lt;print &quot;$Moc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Moctezuma&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Tlacaelel&#39;s entry is:  &lt;&lt;print &quot;$Tlc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Tlacaelel&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cuauhtemoc&#39;s entry is:  &lt;&lt;print &quot;$Cu_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Cuauhtemoc&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cacamatzin&#39;s entry is:  &lt;&lt;print &quot;$Ca_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Olid&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Olid&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
The Aztec Priest&#39;s entry is:  &lt;&lt;print &quot;$AP_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="21" name="Alvarado&#39;s Contribution" tags="" position="2300,7675" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Here you will find links to each entry of the Spanish guidebook, along with a special section written by your Tlaxcalan guests. You must read each entry and evaluate their descriptions. Are they accurate in their portrayals? &lt;br&gt;
&lt;br&gt;
To aid you in this task, go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán. You may also want to revisit other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
Marina&#39;s introduction is:  &lt;&lt;print &quot;$Ma_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Marina&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cortes&#39; entry is:  &lt;&lt;print &quot;$Co_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Cortes&#39; contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Alvarado&#39;s entry is:  &lt;&lt;print &quot;$Al_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Aguilar&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Alvarado&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Aguilar&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Alvarado&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Aguilar&#39;s entry is:  &lt;&lt;print &quot;$Ag_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Olid&#39;s entry is:  &lt;&lt;print &quot;$Ol_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Garrido&#39;s entry is:  &lt;&lt;print &quot;$Ga_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Tlaxcalan&#39;s Insider&#39;s Guide is:  &lt;&lt;print &quot;$Tl_IG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot; OR &quot;Tlaxcalans&quot;&gt;&gt;
Here you will find links to each recipe in the Aztec cookbook. You must read each recipe and judge them for accuracy. Have they properly sourced their ingredients or are there items here that can&#39;t be found in Tenochtitlán?  &lt;br&gt;
&lt;br&gt;

To aid you in this task, you may want to revisit Bernal Diaz&#39; account of Tenochtitlán. You may also want to read his account of the Aztec feast, visit the Codex Mendoza, and review other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;

Moctezuma&#39;s recipe is:  &lt;&lt;print &quot;$Moc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Moctezuma&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Tlacaelel&#39;s entry is:  &lt;&lt;print &quot;$Tlc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Tlacaelel&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cuauhtemoc&#39;s entry is:  &lt;&lt;print &quot;$Cu_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Aguilar&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Aguilar&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Cacamatzin&#39;s entry is:  &lt;&lt;print &quot;$Ca_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Aztec Priest&#39;s entry is:  &lt;&lt;print &quot;$AP_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="22" name="An Unexpected Loss for Tlaxcala" tags="Done" position="2050,3625" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You are fierce and savvy warriors, having defended yourselves against the Aztec Empire for decades. And yet these foreigners have bested you on the battlefield! Perhaps you can use their strength to your advantage. &lt;br&gt;
&lt;br&gt;
Forming an alliance with the Spaniards is the wisest option, but will you do so in good faith? Do you trust these strangers to help you confront your Aztec enemy or might you be able to manipulate them? Perhaps you&#39;ve already made alliances elsewhere.  &lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and discuss your strategy. Then make your choice: will you make a truthful alliance with the Spaniards or will you deceive them?&lt;br&gt;
&lt;br&gt;
Prepare yourself, the Spaniards are [[entering your city|Tlaxcalans Negotiate Peace]] ready to negotiate your new relationship.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Leader isnot $users[$userId][&quot;role&quot;]&gt;&gt;
You are fierce and savvy warriors, having defended yourselves against the Aztec Empire for decades. And yet these foreigners have bested you on the battlefield! Perhaps you can use their strength to your advantage. &lt;br&gt;
&lt;br&gt;
Forming an alliance with the Spaniards seems like the wisest option, but will you do so in good faith? Do you trust these strangers to help you confront your Aztec enemy or might you be able to manipulate them? Perhaps you&#39;ve already made alliances elsewhere. &lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and discuss your strategy. When you&#39;ve made your decision, &lt;&lt;print $Tlax_Leader&gt;&gt; will make his decision.&lt;br&gt;
&lt;br&gt;
Prepare yourself, the Spaniards are [[entering your city|Tlaxcalans Negotiate Peace]] ready to negotiate your new relationship.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="23" name="Angry" tags="Done" position="950,300" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve lost a wisdom point! Your wisdom is now &lt;&lt;print $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;. &lt;br&gt;
&lt;br&gt;
A ship full of bearded men has been seen off the coast of Tulum. &lt;br&gt;
&lt;br&gt;
After all these years among the Maya, you should have a better grasp of their language. You might want to brush up on your translation skills, because they&#39;re going to be key to your survival very soon! Your fortunes are about to change. &lt;br&gt;
&lt;br&gt;
Translation: &lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;Yesterday, I was in the park where I met a man from Tulum. A few days ago, he was looking out to sea and saw a big house appear in the water. The house came closer and closer and the men of the city gathered to see the house. When the house got close they could see that it was full of men with pale skin and lots of hair. Tulum&#39;s men didn&#39;t know where this house came from, but they saw trouble. They made noise and fired rocks into the sea. The house turned back and disappeared.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Did they see the house another time? Do they know where it came from?&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;No. It is strange. I think we should keep watch.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Our men will go to the water to wait. If the house arrives on our water we will make them leave.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Now it is time to [[head to the coast |Aguilar Receives a Letter]]. You pack up and flee the village alone.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="24" name="Assignments Summary" tags="" position="4500,400" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Check Player and Team Status and Location|Control: Player Status]]&lt;br&gt;
[[Check the Status of Holds and Votes|Control: Votes]]&lt;br&gt;
[[Return to the Dashboard|Dashboard]]&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="25" name="Attack On a Beach in Veracruz" tags="Done Breaks" position="2775,1700" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
Though you have been expecting a visit from the notorious Mexica, you were not prepared for them to launch a surprise attack. Fortunately, you are prepared when a band of warriors bears down upon you at the beach. You have your weapons and your dogs at your side. They have clearly underestimated your strength.&lt;br&gt;
&lt;br&gt;
After a short and ferocious battle, you force the attackers to retreat but it has cost you. You had the greater numbers this time and they were clearly unprepared for your weapons, but you might not be so lucky when you meet again.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $TL_Attacks is &quot;No&quot;&gt;&gt;
You watch the Aztecs flee into the mountains. Turning to face the rest of your companions, you wonder how this attack [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Aztecs&quot;&gt;&gt;
You watch the Aztecs flee into the mountains. Turning to face the rest of your companions, you wonder how this attack [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Spanish&quot;&gt;&gt;
You watch the Aztecs flee into the mountains. Turning to face the rest of your companions, you wonder how this attack [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;

You watch the Aztecs flee into the mountains. Turning to face the rest of your companions, you wonder how this attack [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot;&gt;&gt;
You watch the Aztecs flee into the mountains, and you stand awkwardly on the beach, wondering what lies ahead.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalan team to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
For many moons now, you have heard stories of the strange men traveling along the coast. You have heard that they are powerful warriors who rode upon giant deer to defeat an army at Tlaxcala. Now you will finally meet them face to face. You disagree with Moctezuma&#39;s strategy and have decided that the best way to deal with these unwanted strangers is to carry out a surprise attack. You are mighty Aztec warriors and this small band of foreigners doesn&#39;t stand a chance! &lt;br&gt;
&lt;br&gt;
As you launch your attack, however, you quickly discover the strength of the foreigners&#39; weapons. They shoot fire into the air and the noise is so powerful that many of you are unable to hear. They have strange beasts under their control, who chase down your men and tear at your flesh. &lt;br&gt;
&lt;br&gt;
You were not prepared to confront such a powerful force, who have you outnumbered and succeed in fighting off your attack. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $TL_Attacks is &quot;No&quot;&gt;&gt;

You are forced to retreat, hanging your heads in shame and strategizing for your next encounter. You &lt;&lt;link &quot;flee back towards the mountains&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt; and wonder how you will explain this to Moctezuma.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Aztecs&quot;&gt;&gt;

You are forced to retreat, hanging your heads in shame and strategizing for your next encounter. You [[flee back towards the mountains|Tlaxcalans Attack Aztecs on return journey]] and wonder how you will explain this to Moctezuma.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Spanish&quot;&gt;&gt;

You are forced to retreat, hanging your heads in shame and strategizing for your next encounter. You &lt;&lt;link &quot;flee back towards the mountains&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt; and wonder how you will explain this to Moctezuma.v
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;

You are forced to retreat, hanging your heads in shame and strategizing for your next encounter. You &lt;&lt;link &quot;flee back towards the mountains&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt; and wonder how you will explain this to Moctezuma.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot;&gt;&gt;

As a group, you pull back briefly, wondering what choices you have.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalan team to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Your spies have been busy keeping watch over events along the coast and they have many stories to tell. It seems a delegation of Mexica went in search of the strangers who arrived by sea and fell upon them in a surprise attack. The strangers made a formidable enemy, however, and wielded weapons like your men had never seen. They shot fire into the air that made a noise so powerful that your men were left unable to hear. They had strange beasts under their control, who tore at the flesh of the Mexica enemy.&lt;br&gt;
&lt;br&gt;
After the skirmish was done and the Mexica retreated back to Tenochtitlán, the strangers asked many more questions of the local people. Your spies believe they are determined to head inland towards the capital.&lt;br&gt;
&lt;br&gt;
[[You will continue to observe these developments closely|Tlaxcalans Observe the Ship Burning]] as you consider your next move. Given all that you have learned so far, what do you make of these events? What might the arrival of these strangers mean for your people?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="26" name="Azcapotzalco" tags="Done Breaks" position="2525,550" size="100,100">The many things you gather in preparation for your journey will undoubtedly be a great weight to carry. In the place of the ants you will find a way to lessen your burden.&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Azcapotzalco_Ans_A&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Azcapotzalco 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_A&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Azcapotzalco 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Azcapotzalco_Ans_T&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Azcapotzalco 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_T&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Azcapotzalco 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="27" name="Azcapotzalco 2" tags="Done Breaks" position="2675,550" size="100,100">&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;print $Azcapotzalco_Ans_A&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Azcapotzalco_Ans_A and $Azcapotzalco_Ans_A isnot 0 and $Azcapotzalco_Ans_A isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Azcapotzalco_Ans_A = $Azcapotzalco_Ans_A.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Azcapotzalco_Ans_A or $Azcapotzalco_Ans_A eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Azcapotzalco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Azcapotzalco_Ans_A is &quot;azcapotzalco&quot; and $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
You have found the correct answer. You now have slaves to carry your burden for you. &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_A = $Quest_Points_A + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Azcapotzalco_Ans_A is &quot;azcapotzalco&quot; and $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
You have found the correct answer. You now have slaves to carry your burden for you. &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Azcapotzalco_Ans_A isnot &quot;azcapotzalco&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Azcapotzalco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;print $Azcapotzalco_Ans_T&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Azcapotzalco_Ans_T and $Azcapotzalco_Ans_T isnot 0 and $Azcapotzalco_Ans_T isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Azcapotzalco_Ans_T = $Azcapotzalco_Ans_T.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Azcapotzalco_Ans_T or $Azcapotzalco_Ans_T eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Azcapotzalco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Azcapotzalco_Ans_T is &quot;azcapotzalco&quot; and $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
You have found the correct answer. You now have slaves to carry your burden for you. &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_T = $Quest_Points_T + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Azcapotzalco_Ans_T is &quot;azcapotzalco&quot; and $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
You have found the correct answer. You now have slaves to carry your burden for you. &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Azcapotzalco_Ans_T isnot &quot;azcapotzalco&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Azcapotzalco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="28" name="Aztec Leader Dies and Aztecs Choose a Leader Riot" tags="" position="2375,10625" size="100,100">&lt;&lt;theyr&gt;&gt;
Overcome by grief, you gather for a council meeting. Now is not the time for mourning; that must wait. The first task at hand is to elect a new leader, but who among you is capable of leading your people in this difficult moment? Who do you trust? &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Aztec_Leader is &quot;Moctezuma&quot;&gt;&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Aztec_Leader is &quot;Tlacaelel&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;


&lt;&lt;elseif $Aztec_Leader is &quot;Cuauhtemoc&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;


&lt;&lt;elseif $Aztec_Leader is &quot;Cacamatzin&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;


&lt;&lt;elseif $Aztec_Leader is &quot;Aztec_Priest&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Aztec_Leader is &quot;Pochteca&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="29" name="Aztec Leader Gives a Speech" tags="" position="2725,9925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
After days of eerie quiet, the Mexica resume their assault on the palace. You are hungry and outnumbered. Desperate to bring the siege to an end so you can make your escape, you decide to deploy the best weapon you have at your disposal: &lt;&lt;print $Aztec_Leader&gt;&gt;.&lt;br&gt;
&lt;br&gt;
You take him to the roof of the palace and demand that he bring a stop to the assault. &lt;&lt;print $Aztec_Leader&gt;&gt; steps to the edge of the roof and the volley of rocks and arrows comes to a halt. He speaks to his people, pleading with them to put down their weapons. They are no match for your weapons, he tells them, and this can only end in tragedy. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Riot_Vote_sum &lt; 4&gt;&gt;
You observe warily, trying to gauge the crowd&#39;s response.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Aztecs to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $Riot_sum &gt;= 0&gt;&gt;
You observe warily, trying to gauge [[the crowd&#39;s response|Aztecs Riot]]! &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Riot_sum &lt; 0&gt;&gt;
You observe warily, trying to gauge [[the crowd&#39;s response|Aztec Mob Recedes]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
After days of eerie quiet, your people resume their assault on the palace. The Spaniards are hungry and outnumbered. Desperate to bring the siege to an end so they can make their escape, they order you to speak to your people.&lt;br&gt;
&lt;br&gt;
They take you to the roof of the palace and demand that you bring a stop to the assault. As you step to the edge of the roof, the volley of rocks and arrows comes to a halt. You speak to your people, pleading with them to put down their weapons. They are no match for the Spanish weapons, you tell them. This can only end in tragedy. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Riot_Vote_sum &lt; 4&gt;&gt;
You observe the crowd warily and await their response.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Aztecs to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $Riot_sum &gt;=0&gt;&gt;
You observe the crowd warily and [[await their response|Aztecs Riot]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Riot_sum &lt;0&gt;&gt;
You observe the crowd warily and [[await their response|Aztec Mob Recedes]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
Once the city has been adequately prepared for battle, you resume your attack on the palace. The Spaniards have been barricaded inside for days with &lt;&lt;print $Aztec_Leader&gt;&gt; as their prisoner. You have lost faith in your leader, whose decisions are what brought you to this point.&lt;br&gt;
&lt;br&gt;
In the midst of your assault, &lt;&lt;print $Aztec_Leader&gt;&gt; appears on the roof of the palace, demanding to be heard. You put down your weapon as you wait to hear what he has to say. He pleads with you to put down your weapons. They are no match for the Spanish weapons, he tells you. This can only end in tragedy. &lt;br&gt;
&lt;br&gt;
Is he right? Will this inevitably end in disaster for your people or are you convinced that victory is just around the corner?&lt;br&gt;
&lt;br&gt;
Each member of the council will cast their individual vote.&lt;br&gt;
&lt;br&gt;
You have two choices:&lt;br&gt;
&lt;br&gt;
Option 1: Listen to &lt;&lt;print $Aztec_Leader&gt;&gt; and attempt to calm the mob that surrounds you. Now is not the time to continue this fight and it&#39;s sure to bring &lt;&lt;link &quot;disaster for your people&quot; &quot;Aztecs Decide About The Riot&quot;&gt;&gt;&lt;&lt;storeSet $Riot = $Riot + -1&gt;&gt;&lt;&lt;storeSet $Riot_Vote = $Riot_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
Option 2: Oppose &lt;&lt;print $Aztec_Leader&gt;&gt;, who is clearly weak and no longer represents the will of the people. You egg the people on and assure them that &lt;&lt;link &quot;victory is yours to be taken&quot; &quot;Aztecs Decide About The Riot&quot;&gt;&gt;&lt;&lt;storeSet $Riot = $Riot + 1&gt;&gt;&lt;&lt;storeSet $Riot_Vote = $Riot_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Riot_Vote_sum &lt; 4&gt;&gt;
You wonder what is happening in Tenochtitlan.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Aztecs to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $Riot_sum &gt;0&gt;&gt;
You wonder what is [[happening in Tenochtitlan|Aztecs Riot]]! &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Riot_sum &lt;0&gt;&gt;
You wonder what is [[happening in Tenochtitlan|Aztec Mob Recedes]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="30" name="Aztec Leader Lives and Aztecs Choose a Leader Riot" tags="" position="2525,10625" size="100,100">&lt;&lt;theyr&gt;&gt;
You gather for a council meeting and decide to elect a new leader. Who among you is capable of leading your people in this difficult moment? Who do you trust? &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Aztec_Leader is &quot;Moctezuma&quot;&gt;&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Aztec_Leader is &quot;Tlacaelel&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;


&lt;&lt;elseif $Aztec_Leader is &quot;Cuauhtemoc&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;


&lt;&lt;elseif $Aztec_Leader is &quot;Cacamatzin&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;


&lt;&lt;elseif $Aztec_Leader is &quot;Aztec_Priest&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Pochteca&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Poc = $MocRiot_Poc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Aztec_Leader is &quot;Pochteca&quot;&gt;&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Moc = $MocRiot_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Tla = $MocRiot_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cua = $MocRiot_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cacamatzin&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_Cac = $MocRiot_Cac + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aztec_Priest&quot; &quot;After the Riot Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocRiot_AzP = $MocRiot_AzP + 1&gt;&gt;&lt;&lt;storeSet $Moc_Riot_Vote = $Moc_Riot_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="31" name="Aztec Leader Makes a Choice" tags="Done" position="2375,3400" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;] and $users[$userId][&quot;role&quot;] is &quot;Moctezuma&quot;&gt;&gt;
After a tense council meeting, all has been resolved and you shall continue to lead your people. You now face an important decision: how will you deal with the foreigners who make their way to your city? 
You have the power to make this decision alone (you are the Mexica Emperor, after all!) or you can go to the Aztec discussion board and consult with your council. When your mind is made up, what have you decided?&lt;br&gt;
&lt;br&gt;
Will you &lt;&lt;link &quot;go on the offensive&quot; &quot;Making Plans for Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Cholula_Attack=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; or is it best to &lt;&lt;link &quot;watch and wait&quot; &quot;Making Plans for Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Cholula_Attack=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aztec_Leader is $users[$userId][&quot;role&quot;] and $users[$userId][&quot;role&quot;] isnot &quot;Moctezuma&quot;&gt;&gt;
After a tense council meeting, all has been resolved and you shall assume the mantle of leadership. This role is not to be taken lightly and you immediately face an important decision: how will you deal with the foreigners who make their way to your city? &lt;br&gt;
&lt;br&gt;
You have the power to make this decision alone (you are the Mexica Emperor, after all!) or you can go to the Aztec discussion board and consult with your council. When your mind is made up, what have you decided?&lt;br&gt;
&lt;br&gt;
Will you &lt;&lt;link &quot;go on the offensive&quot; &quot;Making Plans for Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Cholula_Attack=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; or is it best to &lt;&lt;link &quot;watch and wait&quot; &quot;Making Plans for Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Cholula_Attack=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aztec_Leader isnot $users[$userId][&quot;role&quot;]&gt;&gt;
After a tense council meeting, all has been resolved and &lt;&lt;print $Aztec_Leader&gt;&gt; will lead your people. He now faces a great challenge, for he must decide how to deal with the foreigners who make their way to your city.&lt;br&gt;
&lt;br&gt;
What will he choose? [[Making Plans for Cholula]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="32" name="Aztec Leader taken prisoner" tags="" position="2650,9550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
A mob has quickly gathered and filled the streets, eager to take revenge for your actions in the plaza. You make your way to the palace and barricade yourselves inside. The mob assaults the palace with a flurry of stones, arrows, and javelins, but your men are able to fend them off. You are safe, for now.&lt;br&gt;
&lt;br&gt;
As you consider your next move, &lt;&lt;print $Span_Leader&gt;&gt; suggests that your first step should be to deal with &lt;&lt;print $Aztec_Leader&gt;&gt;, who is currently somewhere in the plaza, surely plotting his revenge. &lt;&lt;print $Span_Leader&gt;&gt; proposes a bold plan: you will take &lt;&lt;print $Aztec_Leader&gt;&gt; prisoner.&lt;br&gt;
&lt;br&gt;
Your men spread out through the palace and succeed in locating &lt;&lt;print $Aztec_Leader&gt;&gt;. You put him in shackles and inform him that he is now your prisoner. If he wants to remain alive, he will do your bidding. &lt;br&gt;
&lt;br&gt;
For days, the assault on the palace continues. When it finally stops, so does the supply of food into the palace.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
Things become eerily calm and you wonder [[what is happening outside|Cortes Returns Victorious]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot; and $Cortes_Dead is &quot;No&quot;&gt;&gt;
Things become eerily calm and you wonder [[what is happening outside|Cortes Returns Weakened]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot; and $Cortes_Dead is &quot;Yes&quot;&gt;&gt;
Things become eerily calm and you wonder [[what is happening outside|Cortes Doesn&#39;t Return]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Betray&quot;&gt;&gt;
Things become eerily calm and you wonder [[what is happening outside|Cortes Doesn&#39;t Return]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif ndef $Tlax_Alliance or $Tlax_Alliance eq &quot;&quot;&gt;&gt;
Things are eerily calm and you wait.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalans to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You made your way to the palace, but your enemies followed close behind. The palace is the most secure place in the city, and you are now locked inside with a band of well-armed Spaniards.&lt;br&gt;
&lt;br&gt;
You make your way towards your private quarters, formulating a plan of escape. You hope they will be occupied fighting off the mob outside, but much to your dismay, they have sent men to track you down and put you in shackles. You find yourself a prisoner to the Spaniards, who inform you that you must now do their bidding if you want to live. What have you done to so displease the Gods? You are the mighty Aztec Emperor! This indignity shall never be forgiven. &lt;br&gt;
&lt;br&gt;
The assault on the palace lasts for days, but the Spaniards are well-armed and defend their position. When it finally stops, the city becomes eerily quiet. Food stops flowing into the palace and it&#39;s clear your people are trying to starve out the enemy, and you with them.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
You are confident that [[they will prepare the city for war|Cortes Returns Victorious]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot; and $Cortes_Dead is &quot;No&quot;&gt;&gt;
You are confident that [[they will prepare the city for war|Cortes Returns Weakened]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot; and $Cortes_Dead is &quot;Yes&quot;&gt;&gt;
You are confident that [[they will prepare the city for war|Cortes Doesn&#39;t Return]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Betray&quot;&gt;&gt;
You are confident that [[they will prepare the city for war|Cortes Doesn&#39;t Return]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif ndef $Tlax_Alliance or $Tlax_Alliance eq &quot;&quot;&gt;&gt;
Things are eerily calm and you wait.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalans to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;else&gt;&gt;
The mob has chased your enemies to the palace and have maintained their assault for hours. To everyone&#39;s frustration, the Spaniards have effectively barricaded themselves inside, along with &lt;&lt;print $Aztec_Leader&gt;&gt;. &lt;br&gt;
&lt;br&gt;
The assault continues for days, to no avail. There has been no word from &lt;&lt;print $Aztec_Leader&gt;&gt; since the attack and people fear the worst. Finally, a rumor escapes the palace: word has it that the Spaniards have taken &lt;&lt;print $Aztec_Leader&gt;&gt; hostage. You are dismayed at this news and shocked that a leader so powerful could fall victim so easily.&lt;br&gt;
&lt;br&gt;
The assault on the palace proves futile and the city&#39;s nobles convince the people to lay down their arms, for now. You must save your energy for the battle that is soon to come. You begin to prepare the city for battle, building new walls, blocking access to canals, and laying traps. You cut off supplies to the palace, hoping to starve out the enemy and punish this king who has failed you so.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
[[You prepare for war|Cortes Returns Victorious]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot; and $Cortes_Dead is &quot;No&quot;&gt;&gt;
[[You prepare for war|Cortes Returns Weakened]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot; and $Cortes_Dead is &quot;Yes&quot;&gt;&gt;
[[You prepare for war|Cortes Doesn&#39;t Return]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Betray&quot;&gt;&gt;
[[You prepare for war|Cortes Doesn&#39;t Return]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif ndef $Tlax_Alliance or $Tlax_Alliance eq &quot;&quot;&gt;&gt;
Things are eerily calm as you begin preparations for war.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for The Tlaxcalans to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="33" name="Aztec Leader will make an invitation" tags="" position="2150,6250" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You have spent many moons thinking about these strangers and what their presence could mean. They march upon your city at this very moment, accompanied by thousands of your enemies, and it is now time to decide how you will deal with them. You have weighed all your options, you have considered the omens carefully, and you have decided that the best course of action is to invite the strangers into your city.&lt;br&gt;&lt;br&gt;

You gather a welcoming party and get ready to &lt;&lt;link &quot;meet the strangers face-to-face&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=5&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have spent many moons thinking about these strangers and what their presence could mean. They march upon your city at this very moment, accompanied by thousands of your enemies, and you wonder how &lt;&lt;print $Aztec_Leader&gt;&gt; will deal with them. &lt;br&gt;&lt;br&gt;

He makes his announcement, telling you that he has weighed all the options and considered the omens carefully. The best course of action, he declares, is to invite the strangers into your city.&lt;br&gt;&lt;br&gt;

As &lt;&lt;print $Aztec_Leader&gt;&gt; gathers a welcoming party and gets ready to &lt;&lt;link &quot;meet the strangers face-to-face&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=5&gt;&gt;&lt;&lt;/link&gt;&gt;, you contemplate this decision. Is it the right choice?&lt;br&gt;&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="34" name="Aztec Leadership Challenge Again" tags="" position="2450,6800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You have made your case to the council and retire from the council chamber, confident that they will trust in your infinite wisdom. &lt;br&gt;
&lt;br&gt;
[[You await their decision|Aztec Leadership Results]].

&lt;&lt;else&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; has made his case, but do you agree with him? Is he the leader your people need right now? &lt;br&gt;
&lt;br&gt;

He leaves the chamber and each member of the council votes. When it is your turn, you make your choice.  Should &lt;&lt;print $Aztec_Leader&gt;&gt; remain in power? Or should one of the other elegible nobels take over?  Vote for your leader below.&lt;br&gt;
&lt;br&gt;

Option 1: &lt;&lt;link &quot;Moctezuma&quot; &quot;Aztec Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Moc = $Az_Ld_Moc + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Az_Ld_Vote = $Az_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should lead your people.&lt;br&gt;
&lt;br&gt;
Option 2: &lt;&lt;link &quot;Tlacaelel&quot; &quot;Aztec Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Tla = $Az_Ld_Tla + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Az_Ld_Vote = $Az_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should be in charge.&lt;br&gt;
&lt;br&gt;
Option 3: &lt;&lt;link &quot;Cuauhtemoc&quot; &quot;Aztec Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Cua = $Az_Ld_Cua + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Az_Ld_Vote = $Az_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is best suited to lead in these difficult times.&lt;br&gt;
&lt;br&gt;
Option 4: &lt;&lt;link &quot;Cacamatzin&quot; &quot;Aztec Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Cac = $Az_Ld_Cac + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Az_Ld_Vote = $Az_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is your best chance of suriving these strange turns of events.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="35" name="Aztec Leadership Results" tags="" position="2450,6925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;] and $Az_Ld_Vote isnot 4&gt;&gt;
You wait nervously for your advisors to deliberate.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Aztec_Leader isnot $users[$userId][&quot;role&quot;] and $Az_Ld_Vote isnot 4&gt;&gt;
When everyone has voted, you will deliver the news to &lt;&lt;print $Aztec_Leader&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Az_Ld_Vote is 4&gt;&gt;

&lt;&lt;if $Az_Ld_Moc &gt;=$Az_Ld_Tla and $Az_Ld_Moc &gt;=$Az_Ld_Cua and $Az_Ld_Moc &gt;=$Az_Ld_Cac&gt;&gt;
&lt;&lt;if $Az_Ld_Moc is 4 or $Az_Ld_Tla is 4 or $Az_Ld_Cua is 4 or $Az_Ld_Cac is 4&gt;&gt;
The council has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;New Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Moctezuma&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The council has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;New Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Moctezuma&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Az_Ld_Tla &gt;=$Az_Ld_Moc and $Az_Ld_Tla &gt;=$Az_Ld_Cua and $Az_Ld_Tla &gt;=$Az_Ld_Cac&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Tlacaelel&quot;&gt;&gt;
&lt;&lt;if $Az_Ld_Moc is 4 or $Az_Ld_Tla is 4 or $Az_Ld_Cua is 4 or $Az_Ld_Cac is 4&gt;&gt;
The council has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;New Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Tlacaelel&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The council has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;New Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Tlacaelel&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Az_Ld_Cua &gt;=$Az_Ld_Moc and $Az_Ld_Cua &gt;=$Az_Ld_Tla and $Az_Ld_Cua &gt;=$Az_Ld_Cac&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Cuauhtemoc&quot;&gt;&gt;
&lt;&lt;if $Az_Ld_Moc is 4 or $Az_Ld_Tla is 4 or $Az_Ld_Cua is 4 or $Az_Ld_Cac is 4&gt;&gt;
The council has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;New Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Cuauhtemoc&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The council has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;New Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Cuauhtemoc&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Az_Ld_Cac &gt;=$Az_Ld_Moc and $Az_Ld_Cac &gt;=$Az_Ld_Tla and $Az_Ld_Cac &gt;=$Az_Ld_Cua&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Cacamatzin&quot;&gt;&gt;
&lt;&lt;if $Az_Ld_Moc is 4 or $Az_Ld_Tla is 4 or $Az_Ld_Cua is 4 or $Az_Ld_Cac is 4&gt;&gt;
The council has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;New Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Cacamatzin&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The council has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;New Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Cacamatzin&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="36" name="Aztec Mob Recedes" tags="" position="3000,10200" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
It appears that the crowd has listened to their leader and have retreated back to their homes. All is calm... for now.&lt;br&gt;
&lt;br&gt;
If not for &lt;&lt;print $Aztec_Leader&gt;&gt;, the scene outside may have turned into a riot. He has proven to be a useful prisoner thus far, but has his usefulness run its course? Go to the Spanish discussion board and contemplate the value of continuing to keep &lt;&lt;print $Aztec_Leader&gt;&gt; as your prisoner. What are the benefits of keeping him alive? What are the potential costs? You have two choices: keep him in shackles or dispose of him…for good.&lt;br&gt;
&lt;br&gt;
After consulting with your compatriots, you have decided to:&lt;br&gt;
&lt;br&gt;
OPTION 1: Keep &lt;&lt;print $Aztec_Leader&gt;&gt; &lt;&lt;link &quot;alive as your prisoner&quot; &quot;Spaniards Keep Aztec Leader Alive&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Dead=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
OPTION 2: Send &lt;&lt;print $Aztec_Leader&gt;&gt; &lt;&lt;link &quot;to meet his Gods&quot; &quot;Spaniards Kill Aztec Leader&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Dead=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
It appears that the crowd has listened to their leader and have retreated back to their homes. All is calm…for now. 

If not for &lt;&lt;print $Aztec_Leader&gt;&gt;, the scene outside may have turned into a riot. He has proven to be a useful prisoner thus far, but has his usefulness run its course? Go to the Spanish discussion board and contemplate the value of continuing to keep &lt;&lt;print $Aztec_Leader&gt;&gt; as your prisoner. What are the benefits of keeping him alive? What are the potential costs? You have two choices: keep him in shackles or dispose of him…for good.

&lt;&lt;if ndef $Az_Ld_Dead or $Az_Ld_Dead eq &quot;&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; will input your decision. Once you have made your choice, you may carry on.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has decided what [[to do with the Aztec Leader|Spaniards Keep Aztec Leader Alive]]
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has decided what [[to do with the Aztec Leader|Spaniards Kill Aztec Leader]]
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
Your people have chosen to listen to your words. You are heartened by their continued faith in you, but are not convinced that retreat was the best option. 
&lt;&lt;if ndef $Az_Ld_Dead or $Az_Ld_Dead eq &quot;&quot;&gt;&gt;
As your captors lead you back into the palace, you wonder at your own fate and that of your people.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
[[As your captors lead you back into the palace, you wonder at your own fate and that of your people|Spaniards Keep Aztec Leader Alive]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
[[As your captors lead you back into the palace, you wonder at your own fate and that of your people|Spaniards Kill Aztec Leader]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;else&gt;&gt;
By a majority vote, you have decided that &lt;&lt;print $Aztec_Leader&gt;&gt; is wise and you trust his judgment. You join your compatriots in an effort to calm the crowd, telling them to retreat to their homes and save their fight for another day.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Az_Ld_Dead or $Az_Ld_Dead eq &quot;&quot;&gt;&gt;
As the mob retreats and quiet returns to the city, you watch the Spaniards lead &lt;&lt;print $Aztec_Leader&gt;&gt; back inside the palace and wonder what lies ahead for your once-powerful leader.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
As the mob retreats and quiet returns to the city, you watch the Spaniards lead &lt;&lt;print $Aztec_Leader&gt;&gt; back inside the palace and [[wonder what lies ahead for your once-powerful leader|Spaniards Keep Aztec Leader Alive]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
As the mob retreats and quiet returns to the city, you watch the Spaniards lead &lt;&lt;print $Aztec_Leader&gt;&gt; back inside the palace and [[wonder what lies ahead for your once-powerful leader|Spaniards Kill Aztec Leader]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The silence is driving you crazy, why hasn&#39;t your spy returned news!&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Az_Ld_Dead or $Az_Ld_Dead eq &quot;&quot;&gt;&gt;
You wait impatiently for news of any sort.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
You send another spy out, [[hoping for news|Spaniards Keep Aztec Leader Alive]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
You send another spy out, [[hoping for news|Spaniards Kill Aztec Leader]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="37" name="Aztecs Accept Peace Treaty" tags="" position="4675,13525" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The Mexica have listened to reason and agreed with your wisdom! You will set aside your hatred in the interest of peace. As you reflect on this moment, you cannot help but wonder how different your world will be [[from this moment on|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The Tlaxcalans have convinced you that peace is your best way forward. You agree to set aside your hatred and unite against any enemies that might come your way. As you reflect on this moment, you cannot help but wonder how different your world will be [[from this moment on|The End]].
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="38" name="Aztecs Attack: Battle on the Causeway!" tags="" position="3925,6375" size="100,100">&lt;&lt;theyr&gt;&gt;
Causeway leading into Tenochtitlán, November 8th, 1519

Hostilities have broken out, and the Aztecs nearly overwhelm the smaller Spanish force. As they battle on the causeway, it&#39;s up to the Tlaxcalans to decide who they will support. 
 

Tlaxcalans, whose side are you really on? You have have 2 choices: 
 

Option 1: Support the Spaniards and defend them against your sworn enemies, the Aztecs.
 

Option 2: Turn against your Spanish companions and help drive them out of the city of Tenochtitlán.


[[Battle on the Causeway: Tlaxcala sides with Spaniards]]

[[Battle on the Causeway: Tlaxcala sides with Aztecs]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="39" name="Aztecs Decide About The Riot" tags="" position="2875,10050" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Riot_Vote isnot 5&gt;&gt;
You wait while the rest of your team casts their vote. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;else&gt;&gt;

&lt;&lt;if $Riot &gt;0&gt;&gt;
You have decided [[to fight|Aztecs Riot]]! &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Riot &lt;0&gt;&gt;
You have decided now is not the time to fight. You gather the council together and [[retreat, for now|Aztec Mob Recedes]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="40" name="Aztecs Decide Whether to Make an Exchange" tags="" position="2950,11125" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Hostage_Exch or $Hostage_Exch eq &quot;&quot;&gt;&gt;
You wait for the Aztecs to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Hostage_Exch is &quot;Yes&quot;&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
It seems your people still value your life and have secured your release. The Spaniards honor their word and you join your compatriots to watch your enemies retreat from the city.&lt;br&gt;
&lt;br&gt;
Though you are grateful to be alive, you cannot help but wonder if your people made the right decision. That is a question for later, however. In your absence, your people elected a new leader, &lt;&lt;print $New_Aztec_Leader&gt;&gt;, and now you must help him restore order to your city.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have decided that &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s life is worth more to you than taking your revenge on the evil Spaniards.&lt;br&gt;
&lt;br&gt;
As promised, the Spaniards release their hostage. You honor your word and watch as they leave your city with their lives. As the people of Tenochtitlán cheer their departure, you cannot help but wonder if you made the right choice. That is a question for later, however. For now, it is time to [[restore order to your city|Smallpox in Tenochtitlán]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
God has smiled upon you this day, for the Mexica have accepted your offer. Warily, you hand over your hostage, suspicious of their intentions. They are true to their word, however, and stand watch as you finally take leave of the city. &lt;br&gt;
&lt;br&gt;
This long chapter has now come to an end and you [[wonder what comes next|Spaniards Decide Whether to Retreat to Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Finally, news! It seems that the Spaniards [[have made it out of Tenochtitlan|Spaniards Decide Whether to Retreat to Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;elseif $Hostage_Exch is &quot;No&quot;&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
It seems your luck has run out. Your people have decided that you are no longer of value to them and thus you are now worthless to your captors too.&lt;br&gt;
&lt;br&gt;
As you feel the knife in your back, you cry out to your attacker. Do you not deserve a more dignified death than this?! As you slip into darkness, you wonder one last time how your gods could have [[forsaken you so|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; has proven himself weak and there is little benefit in keeping him alive. You would rather finish off these Spaniards once and for all. After weeks without food, they are surely weakened and now is the time to act. &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s life is a price you are willing to pay.&lt;br&gt;
&lt;br&gt;
You ask your gods for forgiveness and debate your next move. Unable to reach a decision, the members of the council debate into the quietest hours of the night. With the city asleep beyond the chamber walls, a young boy comes rushing into the room. He has just seen the foreigners sneaking out of the palace, carrying all their worldly goods, their pockets loaded with gold and treasures!&lt;br&gt;
&lt;br&gt;
You and the other members of the council spring into action. The streets ring out with your war cries as the residents of the city flood the streets, determined to prevent your enemies from [[making their escape|Noche Triste]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The Mexica have rejected your offer! It seems your hostage is no longer of value-neither to you nor his own people. You finish him off, once and for all, asking god&#39;s forgiveness for your crimes.&lt;br&gt;
&lt;br&gt;
Once the deed is done, you decide that your best chance of escape is to leave by cover of night. You will need to be quick and silent, so you decide carefully what is worth taking. After all this time coveting Moctezuma&#39;s treasure, however, you can&#39;t help but fill your pockets with all the gold and valuables you can find. You hope they won&#39;t weigh you down [[as you make your escape|Noche Triste]]!&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
[[Finally, news|Noche Triste]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="41" name="Aztecs Gather Intelligence in Cholula" tags="Done" position="2475,5225" size="100,100">&lt;&lt;theyr&gt;&gt;
Your Cholulan allies send word that the foreigners have entered their city. They have plied them with food and wine, treating the strangers as honored guests. All is going according to plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Mal_Share or $Mal_Share eq &quot;&quot;&gt;&gt;
You wait for news from Cholula.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for Marina to do something.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;No&quot;&gt;&gt;
For many days, your spies report back from Cholula. The strangers have told many tales. It seems they have their own Tlatoani who sent them from a far away land, across the water. The Cholulans have been gracious hosts, playing their role even as the foreigners insulted your Gods and expressed horror at their demands. &lt;br&gt;
&lt;br&gt;
The strangers asked many questions--questions about your great city and the treasures they might find here.They seem uninterested in your great stores of Quetzal feathers and your piles of fine cloth. There is something else they seek, but your spies can make little sense of this. Your Cholulan friends took every opportunity to warn them against the journey, which would be treacherous and offer little reward. Despite these efforts, it seems the strangers are determined to pay you a visit. You prepare for their arrival and &lt;&lt;link &quot;wonder what may come to pass&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Span is &quot;No&quot;&gt;&gt;
For many days, your spies report back from Cholula. The strangers have told many tales. It seems they have their own Tlatoani who sent them from a far away land, across the water. The Cholulans have been gracious hosts, playing their role even as the foreigners insulted your Gods and expressed horror at their demands. &lt;br&gt;
&lt;br&gt;
The strangers asked many questions--questions about your great city and the treasures they might find here.They seem uninterested in your great stores of Quetzal feathers and your piles of fine cloth. There is something else they seek, but your spies can make little sense of this. Your Cholulan friends took every opportunity to warn them against the journey, which would be treacherous and offer little reward. Despite these efforts, it seems the strangers are determined to pay you a visit. You prepare for their arrival and &lt;&lt;link &quot;wonder what may come to pass&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Span_Cho_Att is &quot;Yes&quot;&gt;&gt;
The next morning, you wait for news from Cholula when a spy comes running across the causeway. It seems the strangers have launched an attack, though it&#39;s unclear why.&lt;br&gt;
&lt;br&gt;
You listen closely as your spy recounts the bloody tale. Before your men could arrive in the city, the strangers gathered all of the city&#39;s nobles and killed everyone in sight. Their Tlaxcalan friends joined them in sacking the city. They left Cholula a smoldering ruin as they headed toward the mountain pass that will bring them to your door.&lt;br&gt;
&lt;br&gt;
You question what you have done to so anger the Gods that they would bring this upon you. You prepare for the strangers&#39; arrival and &lt;&lt;link &quot;wonder what may come to pass&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Span_Cho_Att is &quot;No&quot;&gt;&gt;
For many days, your spies report back from Cholula. The strangers have told many tales. It seems they have their own Tlatoani who sent them from a far away land, across the water. The Cholulans have been gracious hosts, playing their role even as the foreigners insulted your Gods and expressed horror at their demands. &lt;br&gt;
&lt;br&gt;
The strangers asked many questions--questions about your great city and the treasures they might find here.They seem uninterested in your great stores of Quetzal feathers and your piles of fine cloth. There is something else they seek, but your spies can make little sense of this. Your Cholulan friends took every opportunity to warn them against the journey, which would be treacherous and offer little reward. Despite these efforts, it seems the strangers are determined to pay you a visit. You prepare for their arrival and &lt;&lt;link &quot;wonder what may come to pass&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="42" name="Aztecs Hold a Council" tags="" position="2450,6650" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You have left your guests under the watchful eye of your most trusted guards and must now face your council. The city is buzzing and, though no one would dare question you, you know that many are uneasy at your decision to allow the strangers--and your Tlaxcalan enemies!--into the city. &lt;br&gt;&lt;br&gt;

You must put a stop to any discontent before things get out of hand. You call a council meeting and gather your closest advisors.&lt;br&gt;&lt;br&gt;

Go to the Aztec discussion board and explain to your council why you chose to allow the Spaniards into your city. This decision must not be taken lightly! In fact, it&#39;s the kind of choice that may very well go down in the history books. Consider all you know at this point and weigh your words carefully. You must convince your people that your decision was sound.&lt;br&gt;&lt;br&gt;

When you are satisfied you have made your case, [[you may continue|Aztec Leadership Challenge Again]]. But don&#39;t rush! Your future and the future of your people hinges on this moment!&lt;br&gt;&lt;br&gt;

&lt;&lt;elseif $users[$userId][&quot;role&quot;] is &quot;Pochteca&quot;&gt;&gt;
You have been put in charge of watching over your Tlaxcalan guests. As you prepare to take them to the market at Tlatelolco, you receive word that &lt;&lt;print $Aztec_Leader&gt;&gt; has called a council meeting. Given the unease that has settled over the city, you suspect he will be addressing the presence of the foreigners in the city.&lt;br&gt;&lt;br&gt;

Though you won&#39;t be able to attend the meeting, your network of informants will relay any news that becomes available. You remain focused on the task at hand: [[keeping a watchful eye on the Tlaxcalans|Tlaxcalans Visit Tlatelolco]].&lt;br&gt;&lt;br&gt;

&lt;&lt;else&gt;&gt;
The city has been buzzing since the strangers arrived. You have heard rumblings among the people, many of whom are questioning &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s decision to welcome these foreigners as guests. And the Tlaxcalans with them! There are even those among you who question his ability to lead.&lt;br&gt;&lt;br&gt;

You receive word that &lt;&lt;print $Aztec_Leader&gt;&gt; has called a council meeting. You are not surprised and you suspect he will try to calm the unease that has gripped the city. &lt;br&gt;&lt;br&gt;

Go to the Aztec discussion board and hear what he has to say. Consider his words carefully. Is this the person to lead you through these uncertain times?&lt;br&gt;&lt;br&gt;

When you are satisfied you have heard everything &lt;&lt;print $Aztec_Leader&gt;&gt; has to say, [[you may continue|Aztec Leadership Challenge Again]]. But don&#39;t rush! Your future and the future of your people hinges on this moment!&lt;br&gt;&lt;br&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="43" name="Aztecs Hold a Council Meeting" tags="Done" position="2375,2975" size="100,100">Tlacaelel&#39;s Statement: &lt;&lt;print $Tlac_Statement&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cuauhtemoc&#39;s Statement: &lt;&lt;print $Cuauh_Statement&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cacamatzin&#39;s Statement: &lt;&lt;print $Cac_Statement&gt;&gt;&lt;br&gt;
&lt;br&gt;
Pochteca&#39;s Statement:  &lt;&lt;print $Poch_Statement&gt;&gt;&lt;br&gt;
&lt;br&gt;
Aztec Priest&#39;s Statement:  &lt;&lt;print $AzPr_Statement&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
Your counselors&#39; statements will appear linked above when they have prepared them. After you review all of the statements, please adjourn to the Aztec discussion board  to question your advisors more closely about their experiences and their positions.&lt;br&gt;
&lt;br&gt;
When you have finished talking to them, you may formulate your proclamation and place the link here.&lt;br&gt;
&lt;br&gt;
&lt;&lt;textbox &quot;$Moc_Proc&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
You [[advance with care and caution|Moctezuma Makes his Proclamation]], knowing that your people need you to be the best possible leader in this moment of strange uncertainty.  You know, too, that rulership isn&#39;t infallible.  You shudder, thinking back on the fate of your Uncle Tizoc, who died of that &quot;mysterious illness&quot; when you were in your twentieth year. You hope your fate will not be his. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlacaelel&quot; or &quot;Cuauhtemoc&quot; or &quot;Cacamatzin&quot; or &quot;Pochteca&quot; or &quot;Aztec_Priest&quot;&gt;&gt;
Now that you have presented your statement, review the statements of your fellow counselors, linked above  Once you have done that, adjourn to the Aztec discussion board. Be prepared to answer Moctezuma&#39;s questions and debate with your fellows. Remember, the very fate of the Mexica is in your hands.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Moc_Proc or $Moc_Proc eq &quot;&quot;&gt;&gt;
When Moctezuma has come to a decision, you may continue on to read his proclamation.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for Moctezuma to come to a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
When Moctezuma has come to a decision, you may continue on to [[read his proclamation|Moctezuma Makes his Proclamation]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="44" name="Aztecs Lay a Trap in Cholula" tags="Done" position="2625,5225" size="100,100">&lt;&lt;theyr&gt;&gt;
Your Cholulan allies send word that the foreigners have entered their city. They have plied them with food and wine, treating the strangers as honored guests. All is going according to plan.&lt;br&gt;
&lt;br&gt;
You compose a small band of warriors and send them off to that sacred city, where they will surround the sleeping band of foreigners just as the sun wins its battle with the night. With the aid of the Cholulans, they will gather the men and transport them back to Tenochtitlán to be sacrificed. Huitzilopochtli demands it.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Mal_Share or $Mal_Share eq &quot;&quot;&gt;&gt;
You wait for news from Cholula.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for Marina to do something.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;No&quot;&gt;&gt;
You wait anxiously for news from Cholula, when a spy comes running across the causeway. Your men succeeded in catching the strangers off guard and a ferocious battle ensued. Just when your men were on the brink of victory, Tlaxcalan forces stormed Cholula and came to the strangers&#39; defense. &lt;br&gt;
&lt;br&gt;
Your warriors cut down many Tlaxcalan soldiers and brought them back to satisfy the demands of Huitzilopochtli. The strangers have escaped however, and you are left to contemplate &lt;&lt;link &quot;what may next come to pass&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Span is &quot;No&quot;&gt;&gt;
You wait anxiously for news from Cholula, when a spy comes running across the causeway. Your men succeeded in catching the strangers off guard and a ferocious battle ensued. Just when your men were on the brink of victory, Tlaxcalan forces stormed Cholula and came to the strangers&#39; defense. &lt;br&gt;
&lt;br&gt;
Your warriors cut down many Tlaxcalan soldiers and brought them back to satisfy the demands of Huitzilopochtli. The strangers have escaped however, and you are left to contemplate &lt;&lt;link &quot;what may next come to pass&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Span_Cho_Att is &quot;No&quot;&gt;&gt;
You wait anxiously for news from Cholula, when a spy comes running across the causeway. Your men succeeded in catching the strangers off guard and a ferocious battle ensued. Just when your men were on the brink of victory, Tlaxcalan forces stormed Cholula and came to the strangers&#39; defense. &lt;br&gt;
&lt;br&gt;
Your warriors cut down many Tlaxcalan soldiers and brought them back to satisfy the demands of Huitzilopochtli. The strangers have escaped however, and you are left to contemplate &lt;&lt;link &quot;what may next come to pass&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Span_Cho_Att is &quot;Yes&quot;&gt;&gt;
You wait anxiously for news from Cholula, when a spy comes running across the causeway. It seems the foreigners learned of your plans and exacted revenge on Cholula. &lt;br&gt;
&lt;br&gt;
You listen closely as your spy recounts the bloody tale. Before your men could arrive in the city, the strangers gathered all of the city&#39;s nobles and killed everyone in sight. Their Tlaxcalan friends joined them in sacking the city. Your men approached to the sounds of screaming and the scent of smoke lingering in the air, but your enemies had already fled the city.&lt;br&gt;
&lt;br&gt;
Your men have wisely decided not to give chase, for the strangers travel with thousands of enemy forces. The gods are angry and you are left to contemplate &lt;&lt;link &quot;what may next come to pass&quot; &quot;Into the Mountain Pass&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="45" name="Aztecs Plot Against the Spanish" tags="" position="2450,11000" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Hostage or $Hostage eq &quot;&quot;&gt;&gt;
Having settled the matter of leadership, it is now time to confront the enemies within your gates. For weeks, the people of Tenochtitlán have been preparing for a battle like nothing the city has ever seen before. You are confident in your advantage over the foreigners, given your knowledge of the city streets and your access to vital resources. Your enemies have been weakened over the past weeks, as the people of the city have denied them food.&lt;br&gt;
&lt;br&gt;
Your deliberations last late into the night. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Hostage is &quot;Yes&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $New_Aztec_Leader&gt;&gt;
Having settled the matter of leadership, it is now time to confront the enemies within your gates. For weeks, the people of Tenochtitlán have been preparing for a battle like nothing the city has ever seen before. You are confident in your advantage over the foreigners, given your knowledge of the city streets and your access to vital resources. Your enemies have been weakened over the past weeks, as the people of the city have denied them food.&lt;br&gt;
&lt;br&gt;
As the members of the council weigh the options before you, a messenger enters the chamber with a surprising announcement. The Spaniards would like to make an exchange: they will release &lt;&lt;print $Aztec_Leader&gt;&gt; on the condition that they be allowed to leave the city unharmed. Does your former leader&#39;s life still have value to you? Or would you rather have vengeance on your enemies?&lt;br&gt;
&lt;br&gt;
Go to the Aztec discussion board and consider their offer. You may want to consult with the Spaniards before you make your decision.&lt;br&gt;
&lt;br&gt;
When you have made your choice, you must enter your team&#39;s decision and carry on.&lt;br&gt;
&lt;br&gt; 
Option 1: Accept the Spaniard&#39;s offer, welcome &lt;&lt;print $Aztec_Leader&gt;&gt; back, and &lt;&lt;link &quot;allow the Spaniards to leave peacefully&quot; &quot;Aztecs Decide Whether to Make an Exchange&quot;&gt;&gt;&lt;&lt;storeSet $Hostage_Exch=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
Option 2: Refuse the deal. &lt;&lt;print $Aztec_Leader&gt;&gt; has proven an ineffective leader, and these Spaniards &lt;&lt;link &quot;must be dealt with once and for all&quot; &quot;Aztecs Decide Whether to Make an Exchange&quot;&gt;&gt;&lt;&lt;storeSet $Hostage_Exch=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Dead=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;
Having settled the matter of leadership, it is now time to confront the enemies within your gates. For weeks, the people of Tenochtitlán have been preparing for a battle like nothing the city has ever seen before. You are confident in your advantage over the foreigners, given your knowledge of the city streets and your access to vital resources. Your enemies have been weakened over the past weeks, as the people of the city have denied them food.&lt;br&gt;
&lt;br&gt;
As the members of the council weigh the options before you, a messenger enters the chamber with a surprising announcement. The Spaniards would like to make an exchange: they will release &lt;&lt;print $Aztec_Leader&gt;&gt; on the condition that they be allowed to leave the city unharmed. Does your former leader&#39;s life still have value to you? Or would you rather have vengeance on your enemies?&lt;br&gt;
&lt;br&gt;
Go to the Aztec discussion board and consider their offer. You may want to consult with the Spaniards before you make your decision.&lt;br&gt;
&lt;br&gt;
Option 1: Accept the Spaniard&#39;s offer, welcome &lt;&lt;print $Aztec_Leader&gt;&gt; back, and allow the Spaniards to leave peacefully.&lt;br&gt;
&lt;br&gt;
Option 2: Refuse the deal. &lt;&lt;print $Aztec_Leader&gt;&gt; has proven an ineffective leader, and these Spaniards must be dealt with once and for all. &lt;br&gt;
&lt;br&gt;
When you have made your choice, &lt;&lt;print $New_Aztec_Leader&gt;&gt; must enter your decision. When this is done, [[you may carry on to learn your fate|Aztecs Decide Whether to Make an Exchange]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Hostage is &quot;No&quot;&gt;&gt;
Having settled the matter of leadership, it is now time to confront the enemies within your gates. For weeks, the people of Tenochtitlán have been preparing for a battle like nothing the city has ever seen before. You are confident in your advantage over the foreigners, given your knowledge of the city streets and your access to vital resources. Your enemies have been weakened over the past weeks, as the people of the city have denied them food.&lt;br&gt;
&lt;br&gt;
Unable to reach a decision, the members of the council debate into the quietest hours of the night. With the city asleep beyond the chamber walls, a young boy comes rushing into the room. He has just seen the foreigners sneaking out of the palace, carrying all their worldly goods, their pockets loaded with gold and treasures!&lt;br&gt;
&lt;br&gt;
You and the other members of the council spring into action. The streets ring out with your war cries as the residents of the city flood the streets, determined to [[prevent your enemies from making their escape|Noche Triste]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="46" name="Aztecs Prepare for a Council Meeting" tags="Done" position="2375,2825" size="100,100">&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
You wake to the buzz of people talking. You haven&#39;t even opened your eyes when you catch the scent of tortillas cooking over an open fire and you know you&#39;re back in Tenochtitlán!&lt;br&gt;
&lt;br&gt;
You get up from your sleeping mat and excitedly make your way outside, where someone informs you that you&#39;ve called a council meeting tonight. The strangers are on their way to Tenochtitlán and you must decide how to deal with them. To guide you in your decision, you seek the counsel of all those who have been party to recent events.&lt;br&gt;
&lt;br&gt;
[[Continue to the Council Meeting|Aztecs Hold a Council Meeting]].  All of your counselors will offer prepared statements, and then you may discuss their positions with them before declaring your intentions.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlacaelel&quot; or &quot;Cuauhtemoc&quot; or &quot;Cacamatzin&quot; or &quot;Pochteca&quot; or &quot;Aztec_Priest&quot;&gt;&gt;
You wake to the buzz of people talking. You haven&#39;t even opened your eyes when you catch the scent of tortillas cooking over an open fire and you know you&#39;re back in Tenochtitlán!&lt;br&gt;
&lt;br&gt;
You get up from your sleeping mat and excitedly make your way outside, where you learn that there is to be a council meeting tonight. It&#39;s a good thing you asked, because you&#39;re expected to participate. The strangers are on their way to Tenochtitlán and the Emperor Moctezuma must decide how to deal with them. To guide his decision, he has sought the counsel of all those who have been party to recent events.&lt;br&gt;
&lt;br&gt;
In order to prepare for the meeting, you must write a formal statement that you will present to the emperor. In your statement, you must recount your observations so far and your interpretation of all that has come to pass. Finally, you must advise the emperor on the best course of action in dealing with the strangers. &lt;br&gt;
&lt;br&gt;
Go to your site and start a new page titled “Council Meeting.” Prepare your statement here.&lt;br&gt;
&lt;br&gt;
Once you have composed your statement, you must paste the link below to share with the rest of the Mexica Council. Make sure you&#39;ve set it so that everyone with the link can read it. Once you&#39;ve done this, you may [[continue to the meeting|Aztecs Hold a Council Meeting]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlacaelel&quot;&gt;&gt;
&lt;&lt;textbox &quot;$Tlac_Statement&quot; &quot;&quot;&gt;&gt;
&lt;&lt;case &quot;Cuauhtemoc&quot;&gt;&gt;
&lt;&lt;textbox &quot;$Cuauh_Statement&quot; &quot;&quot;&gt;&gt;
&lt;&lt;case &quot;Cacamatzin&quot;&gt;&gt;
&lt;&lt;textbox &quot;$Cac_Statement&quot; &quot;&quot;&gt;&gt;
&lt;&lt;case &quot;Pochteca&quot;&gt;&gt;
&lt;&lt;textbox &quot;$Poch_Statement&quot; &quot;&quot;&gt;&gt;
&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
&lt;&lt;textbox &quot;$AzPr_Statement&quot; &quot;&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="47" name="Aztecs Refuse Peace Treaty and Attack Tlaxcala" tags="" position="3925,12650" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The Mexica have launched an attack! You gather your wits and your weapons, facing off once more against your hated enemy. What treachery!&lt;br&gt;
&lt;br&gt;
Your two sides are evenly matched, as usual, [[but only one can claim victory|Victory Decision Aztecs Versus Tlaxcalans]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Your hatred of Tlaxcala outweighs any benefit of making peace. Besides, Tlaxcala has been weakened by their battle with the Spaniards and can&#39;t possibly defeat you now!&lt;br&gt;
&lt;br&gt;
You launch your attack but much to your surprise, your two sides are as evenly matched as ever. Only one side can [[claim victory though|Victory Decision Aztecs Versus Tlaxcalans]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="48" name="Aztecs Refuse Peace Treaty and Attack Tlaxcala Aztec Victory" tags="" position="4025,13550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Mexica had the Gods on their side and it is they who won this quick and bloody war. As you are finally taken captive, you prepare to meet your end, grateful that you will at least be taken to the temple and [[offered up to the Gods|The End]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Tlaxcalans, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="49" name="Aztecs Refuse Peace Treaty and Attack Tlaxcala Tlaxcalan Victory" tags="" position="3875,13075" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Mexica, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Tlaxcalans had the Gods on their side and it is they who won this quick and bloody war. As you are finally taken captive, you prepare to meet your end, grateful that you will at least be taken to the temple and [[offered up to the Gods|The End]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="50" name="Aztecs Return to Tenochtitlan to report" tags="Done Breaks" position="2725,1200" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
&lt;&lt;if ndef $TL_Attacks or $TL_Attacks eq &quot;&quot;&gt;&gt;
You wait in the palace for your men to return from the coast.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;
Your men have finally returned from the coast and you anxiously await their report. &lt;br&gt;
&lt;br&gt;
Go to the Aztec discussion board to hear what transpired. What do you make of this news?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Your men have finally returned from the coast and you anxiously await their report. &lt;br&gt;
&lt;br&gt;
Go to the Aztec discussion board to hear what transpired. What do you make of this news?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
&lt;&lt;if ndef $TL_Attacks or $TL_Attacks eq &quot;&quot;&gt;&gt;
You wait for the men to return from the coast.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;
The delegation has returned from the coast and Moctezuma is eager to hear their report.&lt;br&gt;
&lt;br&gt;
Go to the Aztec discussion board to hear what transpired. What does Moctezuma make of this news?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The delegation has returned from the coast and Moctezuma is eager to hear their report.&lt;br&gt;
&lt;br&gt;
Go to the Aztec discussion board &lt;/a&gt; to hear what transpired. What does Moctezuma make of this news?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlacaelel&quot; OR &quot;Cuauhtemoc&quot; OR &quot;Cacamatzin&quot; OR &quot;Pochteca&quot;&gt;&gt;
You return to Tenochtitlán, where Moctezuma awaits your report. &lt;br&gt;
&lt;br&gt;
Go to the Aztec discussion board to inform him of all that transpired on your journey. How do you think he will respond to the news?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

When your satisfied with your discussion, [[head home|The Spaniards Head Inland]] for a well-deserved and much needed rest.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="51" name="Aztecs Riot" tags="" position="2800,10200" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
It appears that the crowd has lost faith in their leader. Despite his pleas, the crowd below has begun to riot, hurling stones towards the rooftop. You watch &lt;&lt;print $Aztec_Leader&gt;&gt; fall to his knees as he is struck in the head.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; is gravely wounded, but alive. Given his inability to calm the crowd below, you wonder if his usefulness has run its course. Go to the Spanish discussion board and contemplate the value of continuing to keep &lt;&lt;print $Aztec_Leader&gt;&gt; as your prisoner. What are the benefits of saving his life? What are the potential costs? You have two choices: keep him alive and in shackles or dispose of him…for good.&lt;br&gt;
&lt;br&gt;
After consulting with your compatriots, you have decided to:&lt;br&gt;
&lt;br&gt;
OPTION 1: Keep &lt;&lt;print $Aztec_Leader&gt;&gt; &lt;&lt;link &quot;alive as your prisoner&quot; &quot;Spaniards Keep Aztec Leader Alive Riot&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Dead=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
OPTION 2: Send &lt;&lt;print $Aztec_Leader&gt;&gt;&lt;&lt;link &quot;to meet his Gods&quot; &quot;Spaniards Kill Aztec Leader Riot&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Dead=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
It appears that the crowd has lost faith in their leader. Despite his pleas, the crowd below has begun to riot, hurling stones towards the rooftop. You watch &lt;&lt;print $Aztec_Leader&gt;&gt; fall to his knees as he is struck in the head.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; is gravely wounded, but alive. Given his inability to calm the crowd below, you wonder if his usefulness has run its course. Go to the Spanish discussion board and contemplate the value of continuing to keep &lt;&lt;print $Aztec_Leader&gt;&gt; as your prisoner. What are the benefits of saving his life? What are the potential costs? You have two choices: keep him alive and in shackles or dispose of him... for good.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Az_Ld_Dead or $Az_Ld_Dead eq &quot;&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; will input your decision. Once you have made your choice, you may carry on.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has decided what [[to do with the Aztec Leader|Spaniards Keep Aztec Leader Alive Riot]]
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has decided what [[to do with the Aztec Leader|Spaniards Kill Aztec Leader Riot]]
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
Your people have little interest in what you say. It is clear that they have lost faith in you. Violence erupts from below and your captors attempt to shield you as they usher you back into the palace below, but to no avail. You are struck by a series of rocks, one of which knocks you to your knees.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Az_Ld_Dead or $Az_Ld_Dead eq &quot;&quot;&gt;&gt;
As you fall to the ground, you wonder if the gods have forsaken you once and for all. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
[[As you fall to the ground, you wonder if the gods have forsaken you once and for all|Spaniards Keep Aztec Leader Alive Riot]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
[[As you fall to the ground, you wonder if the gods have forsaken you once and for all|Spaniards Kill Aztec Leader Riot]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;else&gt;&gt;
By a majority vote, you have decided that you no longer have faith in &lt;&lt;print $Aztec_Leader&gt;&gt;. You join your compatriots as they unleash their anger on the leader who has failed you so. You watch the Spaniards as they attempt to shield him, but just as they drag him from your line of sight, you see &lt;&lt;print $Aztec_Leader&gt;&gt;fall to the ground, struck by one of the many stones hurled by the people below.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Az_Ld_Dead or $Az_Ld_Dead eq &quot;&quot;&gt;&gt;
Chaos unfolds around you and you wonder what lies ahead for your once-powerful leader.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
Chaos unfolds around you and you [[wonder what lies ahead for your once-powerful leader|Spaniards Keep Aztec Leader Alive Riot]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
Chaos unfolds around you and you [[wonder what lies ahead for your once-powerful leader|Spaniards Kill Aztec Leader Riot]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The silence is driving you crazy, why hasn&#39;t your spy returned news!&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Az_Ld_Dead or $Az_Ld_Dead eq &quot;&quot;&gt;&gt;
You wait impatiently for news of any sort.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
You send another spy out, [[hoping for news|Spaniards Keep Aztec Leader Alive Riot]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
You send another spy out, [[hoping for news|Spaniards Kill Aztec Leader Riot]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="52" name="Aztecs and Tlaxcalans Join Forces" tags="" position="2250,12525" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
The news in Tlaxcala has left your companions bitter and the mood is dark. The Spanish forces must face the Mexica alone. You heard that the city has been devastated by disease, but will this be enough to assure a Spanish victory?&lt;br&gt;
&lt;br&gt;
As you near Tenochtitlán, you set up camp for the night, preparing to attack by dark. When all is ready, the Spaniards launch their attack, cutting off the causeways and trapping the Mexica inside the city. It seems the Mexica were prepared, however, and you did not have the element of surprise! Even worse: Tlaxcalan soldiers fight at their side! This is not the battle you had prepared for.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you could have imagined. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs and Tlaxcalans versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You leave Tlaxcala disappointed and unsure of the future. You have no choice but to face the Mexica alone. You heard that the city has been devastated by disease, but will this be enough to assure your victory?&lt;br&gt;
&lt;br&gt;
As you near Tenochtitlán, you set up camp for the night, preparing to attack by dark. When all is ready, you launch your attack, cutting off the causeways and trapping the Mexica inside the city. It seems the Mexica were prepared, however, and you did not have the element of surprise! Even worse: Tlaxcalan soldiers fight at their side! This is not the battle you had prepared for.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve ever experienced. The stakes are high and this will be a fight to the death for both sides.The residents of the city-young, old, man, woman-all join the fray, luring your men into traps and fighting with makeshift weapons. Many others, however, fall victim to your superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs and Tlaxcalans versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You make your way to Tenochtitlán and prepare the city for battle. The Spaniards launch their attack by night, clearly hoping to catch the Mexica by surprise. The surprise is on them, however, for you together you mount a quick and powerful defense. You watch with satisfaction their look of dismay when they realize that you are fighting alongside the Mexica.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve seen before. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs and Tlaxcalans versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
With your Tlaxcalan allies at your side, you prepare the city for battle. The Spaniards launch their attack by night, clearly hoping to catch you by surprise. The surprise is on them, however, for you mount a quick and powerful defense. You watch with satisfaction their look of dismay when they see the Tlaxcalans at your side.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve seen before. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs and Tlaxcalans versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="53" name="Back to the Library Yet Again" tags="" position="2300,8675" size="100,100">&lt;&lt;theyr&gt;&gt;
Your plan worked! It&#39;s only been two days since you last woke up in the library, but you convinced your history teacher to let you start the assignment early. Since you&#39;re now an ‘A&#39; student, she didn&#39;t seem surprised that you would want to get ahead.&lt;br&gt;
&lt;br&gt;
Assignment in hand, you make a beeline for the library. You head for the top floor, round the corner, and there&#39;s the door! Eager to get back to Tenochtitlán, you slip inside and flop out in the chair. You close your eyes and [[fall into a deep sleep|Waking up 6 months later]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="54" name="Battle Outcome Aztecs Versus Spaniards" tags="" position="2850,11650" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Aztec_Points eq &quot;&quot; or ndef $Final_Aztec_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
Both &lt;&lt;print $Span_Leader&gt;&gt; and &lt;&lt;print $New_Aztec_Leader&gt;&gt; must join.
&lt;&lt;elseif $Final_Spanish_Points &gt;=$Final_Aztec_Points&gt;&gt;
[[Finally, the haze of war clears|Spaniards Fight the Aztecs Alone Spanish Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &gt;$Final_Spanish_Points&gt;&gt;
[[Finally, the haze of war clears|Spaniards Fight the Aztecs Alone Aztec Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="55" name="Battle Outcome Aztecs Versus Spaniards 2" tags="" position="3725,14100" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Aztec_Points eq &quot;&quot; or ndef $Final_Aztec_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
Both &lt;&lt;print $Span_Leader&gt;&gt; and &lt;&lt;print $New_Aztec_Leader&gt;&gt; must join.
&lt;&lt;elseif $Final_Spanish_Points &gt;=$Final_Aztec_Points&gt;&gt;
[[Finally, the haze of war clears|Spaniards Defeat Tlaxcalans and Fight Aztecs Alone Spanish Victory]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &gt;$Final_Spanish_Points&gt;&gt;
[[Finally, the haze of war clears|Spaniards Defeat Tlaxcalans and Fight Aztecs Alone Aztec Victory]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="56" name="Battle Outcome Aztecs Versus Spaniards 3" tags="" position="3200,12250" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Aztec_Points eq &quot;&quot; or ndef $Final_Aztec_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
Both &lt;&lt;print $Span_Leader&gt;&gt; and &lt;&lt;print $New_Aztec_Leader&gt;&gt; must join.
&lt;&lt;elseif $Final_Spanish_Points &gt;=$Final_Aztec_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Does Nothing Spaniards Fight Aztecs Alone Spanish Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &gt;$Final_Spanish_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Does Nothing Spaniards Fight Aztecs Alone Aztec Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="57" name="Battle Outcome Aztecs Versus Spaniards and Tlaxcalans" tags="" position="4600,12750" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Aztec_Points eq &quot;&quot; or ndef $Final_Aztec_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
All leaders must click through before you can continue.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
You wipe the sweat of battle from your eyes, squinting to judge &lt;&lt;link &quot;where victory lies&quot; &quot;Battle Outcome Aztecs Versus Spaniards and Tlaxcalans 2&quot;&gt;&gt;&lt;&lt;storeSet $Final_Span_Tlax_Points= $Final_Tlaxcalan_Points+$Final_Spanish_Points&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;. 
&lt;&lt;else&gt;&gt;
You wipe the sweat of battle from your eyes, squinting to judge where [[victory lies|Battle Outcome Aztecs Versus Spaniards and Tlaxcalans 2]].
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="58" name="Battle Outcome Aztecs Versus Spaniards and Tlaxcalans 2" tags="" position="4550,13125" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Final_Span_Tlax_Points or $Final_Span_Tlax_Points eq &quot;&quot;&gt;&gt;
You continue to wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Span_Leader&gt;&gt; to join you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Span_Tlax_Points &gt;= $Final_Aztec_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcalans and Spaniards Fight Aztecs Spanish and Tlaxcalan Victory]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Span_Tlax_Points &lt; $Final_Aztec_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcalans and Spaniards Fight Aztecs Aztec Victory]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="59" name="Battle Outcome Aztecs Versus Tlaxcalans" tags="" position="3925,12925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Tlaxcalan_Points eq &quot;&quot; or ndef $Final_Tlaxcalan_Points or $Final_Aztec_Points eq &quot;&quot; or ndef $Final_Aztec_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for both &lt;&lt;print $New_Aztec_Leader&gt;&gt; and &lt;&lt;print $Tlax_Leader&gt;&gt; to join.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &gt;=$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Aztecs Refuse Peace Treaty and Attack Tlaxcala Aztec Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &lt;$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Aztecs Refuse Peace Treaty and Attack Tlaxcala Tlaxcalan Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="60" name="Battle Outcome Aztecs Versus Tlaxcalans 2" tags="" position="3325,13050" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Tlaxcalan_Points eq &quot;&quot; or ndef $Final_Tlaxcalan_Points or $Final_Aztec_Points eq &quot;&quot; or ndef $Final_Aztec_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for both &lt;&lt;print $New_Aztec_Leader&gt;&gt; and &lt;&lt;print $Tlax_Leader&gt;&gt; to join.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &gt;=$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Attacks Aztecs Aztec Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &lt;$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Attacks Aztecs Tlaxcalan Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="61" name="Battle Outcome Aztecs Versus Tlaxcalans 3" tags="" position="3175,13025" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Tlaxcalan_Points eq &quot;&quot; or ndef $Final_Tlaxcalan_Points or $Final_Aztec_Points eq &quot;&quot; or ndef $Final_Aztec_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for both &lt;&lt;print $New_Aztec_Leader&gt;&gt; and &lt;&lt;print $Tlax_Leader&gt;&gt; to join.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &gt;=$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Does Nothing Aztecs Refuse Peace Treaty and Attack Tlaxcala Aztec Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Aztec_Points &lt;$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Does Nothing Aztecs Refuse Peace Treaty and Attack Tlaxcala Tlaxcalan Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="62" name="Battle Outcome Aztecs and Tlaxcalans versus Spaniards" tags="" position="2250,12875" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Aztec_Points eq &quot;&quot; or ndef $Final_Aztec_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
All leaders must click through before you can continue.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
You wipe the sweat of battle from your eyes, squinting to judge &lt;&lt;link &quot;where victory lies&quot; &quot;Battle Outcome Aztecs and Tlaxcalans versus Spaniards 2&quot;&gt;&gt;&lt;&lt;storeSet $Final_Az_Tlax_Points= $Final_Tlaxcalan_Points+$Final_Aztec_Points&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;. 
&lt;&lt;else&gt;&gt;
You wipe the sweat of battle from your eyes, squinting to judge where [[victory lies|Battle Outcome Aztecs and Tlaxcalans versus Spaniards 2]].
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="63" name="Battle Outcome Aztecs and Tlaxcalans versus Spaniards 2" tags="" position="2250,13050" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Final_Az_Tlax_Points or $Final_Az_Tlax_Points eq &quot;&quot;&gt;&gt;
You continue to wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to join you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Az_Tlax_Points &gt;= $Final_Spanish_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Sides with the Aztecs Aztec and Tlaxcalan Victory]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Az_Tlax_Points &lt; $Final_Spanish_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Sides with the Aztecs Spanish Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="64" name="Battle Outcome Spaniards Versus Tlaxcalans" tags="" position="2450,12200" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot; or &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Final_Tlaxcalan_Points eq &quot;&quot; or ndef $Final_Tlaxcalan_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for both &lt;&lt;print $Span_Leader&gt;&gt; and &lt;&lt;print $Tlax_Leader&gt;&gt; to join.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Spanish_Points &gt;=$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Attacks the Spaniards Spanish Victory]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Spanish_Points &lt;$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Attacks the Spaniards Tlaxcalan Victory]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Final_Tlaxcalan_Points eq &quot;&quot; or ndef $Final_Tlaxcalan_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for news.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for both &lt;&lt;print $Span_Leader&gt;&gt; and &lt;&lt;print $Tlax_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Spanish_Points &gt;=$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, news reaches you from Tlaxcala|Spaniards Defeat Tlaxcalans and Fight Aztecs Alone]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Spanish_Points &lt;$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, news reaches you from Tlaxcala|Tlaxcala Attacks the Spaniards Tlaxcalan Victory]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="65" name="Battle Outcome Spaniards Versus Tlaxcalans 2" tags="" position="2675,13050" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Tlaxcalan_Points eq &quot;&quot; or ndef $Final_Tlaxcalan_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for the haze of war to clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for both &lt;&lt;print $Span_Leader&gt;&gt; and &lt;&lt;print $Tlax_Leader&gt;&gt; to join.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Spanish_Points &gt;=$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Does Nothing Spaniards Refuse Peace Treaty and Attack Tlaxcala Spanish Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Spanish_Points &lt;$Final_Tlaxcalan_Points&gt;&gt;
[[Finally, the haze of war clears|Tlaxcala Does Nothing Spaniards Refuse Peace Treaty and Attack Tlaxcala Tlaxcalan Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="66" name="Battle on the Causeway: Spaniards Attack" tags="" position="4200,6800" size="100,100">&lt;&lt;theyr&gt;&gt;
Double-click this passage to edit it.


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="67" name="Battle on the Causeway: Tlaxcala sides with Aztecs" tags="" position="3725,6550" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Game Over: Aztecs Win the Battle on the Causeway]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="68" name="Battle on the Causeway: Tlaxcala sides with Spaniards" tags="" position="3925,6550" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Spaniards Return to Tlaxcala]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="69" name="Burning the Ships" tags="Done Breaks" position="1450,1800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Mutiny_Voted isnot 5&gt;&gt;

The members of the faction are still mulling over their decisions. Return here when everybody has voted.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Mutiny_Voted is 5 and $Mutiny &gt;=-5 and $Mutiny &lt;=2&gt;&gt;

The Members of the faction have chosen [[not to mutiny|Burning the Ships: No Mutiny]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mutiny_Voted is 5 and $Mutiny &lt;=-6&gt;&gt;

The rabblerouser [[chickened out|Burning the Ships: Failed Mutiny]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mutiny_Voted is 5 and $Mutiny &gt;=3&gt;&gt;

[[There is a mutiny|Burning the Ships: Mutiny]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="70" name="Burning the Ships: Failed Mutiny" tags="Done Breaks" position="1575,1950" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader isnot $users[$userId][&quot;role&quot;]&gt;&gt;
After the first encounter with the fabled Mexica, the group has questioned the wisdom of moving forward. Not only would such an expedition be illegal, it&#39;s clear that great danger lies ahead with little promise of reward. Nonetheless, the coup has failed and it is clear that you will continue your perilous journey inward.&lt;br&gt;
&lt;br&gt;
After all the turmoil that surrounded this decision, things proceed to get worse: &lt;&lt;print $Span_Leader&gt;&gt; learned that a coup was in the works and would do anything to prevent it. In a bid to force the group inland, &lt;&lt;print $Span_Leader&gt;&gt; has beached the your ships! Though not destroyed, fixing them would require many weeks of repair, assuming you could even find the necessary materials. &lt;br&gt;
&lt;br&gt;
All of these events have been a blow to team morale. Head to the Spanish discussion board to hear what &lt;&lt;print $Span_Leader&gt;&gt; has to say about this. After what has happened, can you still trust &lt;&lt;print $Span_Leader&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
It turns out that your bold decision was unnecessary. Despite the best efforts of some of your crew, the leader of the mutiny backed out at the last minute and the coup failed. Already demoralized, they are now even more so having seen what you did to the ships.&lt;br&gt;
&lt;br&gt;
Head to the Spanish discussion board &lt;/a&gt; and explain yourself. How can you rebuild their trust after what you have done? &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

All of this turmoil surrounding the mutiny has caused shifts in loyalty.  Has &lt;&lt;print $Span_Leader&gt;&gt; retained enough of everybody&#39;s trust to remain in charge?  [[Continue on|Leadership After the Mutiny]] to find out.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="71" name="Burning the Ships: Mutiny" tags="Done Breaks" position="1325,1950" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader isnot $users[$userId][&quot;role&quot;]&gt;&gt;
After the first encounter with the fabled Mexica, the group has questioned the wisdom of moving forward. Not only would such an expedition be illegal, it&#39;s clear that great danger lies ahead with little promise of reward.&lt;br&gt;
&lt;br&gt;
This decision was difficult, but it turns out to have been in vain. &lt;&lt;print $Span_Leader&gt;&gt; has learned of the coup and will do anything to prevent it. In a bid to force the group inland, &lt;&lt;print $Span_Leader&gt;&gt; has beached your ships! Though not destroyed, fixing them would require many weeks of repair, assuming you could even find the necessary materials. &lt;br&gt;
&lt;br&gt;
There is little choice now but to forge onward. Head to the Spanish discussion board to hear what &lt;&lt;print $Span_Leader&gt;&gt; has to say about this. After what has happened, can you still trust &lt;&lt;print $Span_Leader&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
Your bold decision has paid off! It turns out that your crew had, in fact, turned against you! When they saw what you did to the ships, you could see the horror on their faces. You have left them with no choice but to forge onward, but you must now face an angry crew. &lt;br&gt;
&lt;br&gt;
Head to the Spanish discussion board and explain yourself. How can you rebuild their trust after what you have done?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

All of this turmoil surrounding the mutiny has caused shifts in loyalty.  Has &lt;&lt;print $Span_Leader&gt;&gt; retained enough of everybody&#39;s trust to remain in charge?  [[Continue on|Leadership After the Mutiny]] to find out.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="72" name="Burning the Ships: No Mutiny" tags="Done Breaks" position="1450,1950" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader isnot $users[$userId][&quot;role&quot;]&gt;&gt;
After the first encounter with the fabled Mexica, the group is wary of the journey that lies ahead, but the potential for glory is too great to resist. &lt;br&gt;
&lt;br&gt;
You have decided to forge onward, but it turns out that &lt;&lt;print $Span_Leader&gt;&gt;  learned of the coup and made a drastic decision: in a bid to prevent a mutiny, &lt;&lt;print $Span_Leader&gt;&gt; has beached your ships! Despite your decision not to return to Cuba, this discovery has a significant impact on team morale.&lt;br&gt;
&lt;br&gt;
Head to the Spanish discussion board to hear what &lt;&lt;print $Span_Leader&gt;&gt; has to say about this. After what has happened, can you still trust &lt;&lt;print $Span_Leader&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
It turns out that your bold decision may not have been the best course of action! Rumors of a mutiny were unfounded and your crew were shocked when they saw what you had done to the ships. Despite their desire to keep moving forward, this discovery has a significant impact on team morale.&lt;br&gt;
&lt;br&gt;

Head to the Spanish discussion board and explain yourself. How can you rebuild their trust after what you have done?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

All of this turmoil surrounding the mutiny has caused shifts in loyalty.  Have you retained enough of everybody&#39;s trust to remain in charge?  [[Continue on|Leadership After the Mutiny]] to find out.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="73" name="Chapultepec" tags="Done Breaks" position="2525,675" size="100,100">The preparations for your journey have left you tired, and you stop to rest beside a spring. Out of the corner of your eye, you spy a tasty treat hopping through the grass beside you. You reach for your stash of tortillas!&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;

&lt;&lt;if $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;

This city is &lt;&lt;textbox &quot;$Chapultepec_Ans_A&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;link &quot;Submit your answer&quot; &quot;Chapultepec 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;

&lt;&lt;print $Quest_Leader_A&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Chapultepec 2]] &lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;

This city is &lt;&lt;textbox &quot;$Chapultepec_Ans_T&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;link &quot;Submit your answer&quot; &quot;Chapultepec 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;

&lt;&lt;print $Quest_Leader_T&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Chapultepec 2]] &lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="74" name="Chapultepec 2" tags="Done Breaks" position="2675,675" size="100,100">&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;print $Chapultepec_Ans_A&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Chapultepec_Ans_A and $Chapultepec_Ans_A isnot 0 and $Chapultepec_Ans_A isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Chapultepec_Ans_A = $Chapultepec_Ans_A.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if ndef $Chapultepec_Ans_A or $Chapultepec_Ans_A eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Chapultepec]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Chapultepec_Ans_A is &quot;chapultepec&quot; and $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You have filled two gourds with water for your journey!  &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_A = $Quest_Points_A + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Chapultepec_Ans_A is &quot;chapultepec&quot; and $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You have filled two gourds with water for your journey!  &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Chapultepec_Ans_A isnot &quot;chapultepec&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Chapultepec]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].
&lt;&lt;/if&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;print $Chapultepec_Ans_T&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Chapultepec_Ans_T and $Chapultepec_Ans_T isnot 0 and $Chapultepec_Ans_T isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Chapultepec_Ans_T = $Chapultepec_Ans_T.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if ndef $Chapultepec_Ans_T or $Chapultepec_Ans_T eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Chapultepec]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Chapultepec_Ans_T is &quot;chapultepec&quot; and $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You have filled two gourds with water for your journey!  &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_T = $Quest_Points_T + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Chapultepec_Ans_T is &quot;chapultepec&quot; and $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You have filled two gourds with water for your journey!  &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Chapultepec_Ans_T isnot &quot;chapultepec&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Chapultepec]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="75" name="Character Identification" tags="Done" position="4025,1200" size="100,100">&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
You open your eyes and find yourself on a ship. The boom you heard was the sound of cannon fire and you startle as another shot tears through the sky. &lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Hernán Cortés: Spaniard, soldier, and adventurer, off to seek your fortune in a foreign land. The ship upon which you stand is one of 11 under your command and you have just set sail from Cuba against the wishes of the island&#39;s Governor, Diego Velazquez. You have just embarked on what may just be your greatest adventure yet and you are eager to escape the clutches of the governor. Before you continue, however, you must complete a task. &lt;br&gt;
&lt;br/&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;

&lt;&lt;case &quot;Marina&quot;&gt;&gt;
You open your eyes and find yourself staring through an open door at the night sky. The noise you heard was the distant rumble of thunder. &lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are a Nahua girl of just 16 years. Born in Coatzacoalcos, you were sold into slavery and have been living as a slave among the Chontal Maya for many moons now. &lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task. &lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. 
&lt;br&gt;
&lt;&lt;case &quot;Alvarado&quot;&gt;&gt;
You open your eyes and find yourself on a ship. The boom you heard was the sound of cannon fire and you startle as another shot tears through the sky. &lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Pedro de Alvarado: Spaniard, soldier, and adventurer, off to seek your fortune in a foreign land. The ship upon which you stand is one of 11 under the command of Hernán Cortés, who has set sail from Cuba against the wishes of the island&#39;s Governor, Diego Velazquez. Cortés has convinced you to join him on what may just be your greatest adventure yet and you are eager to escape the clutches of the governor. Before you continue, however, you must complete a task. &lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
You open your eyes and find yourself staring through an open door at the night sky. The noise you heard was the distant rumble of thunder. &lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Gerónimo de Aguilar: Spaniard, priest, and a slave among the Mayan people now for eight long years.&lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for God to reveal his plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Garrido&quot;&gt;&gt;
You open your eyes and find yourself on a ship. The boom you heard was the sound of cannon fire and you startle as another shot tears through the sky.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Juan Garrido: an African and one of the few free black men in the New World. You are also a soldier and adventurer, off to seek your fortune in a foreign land. The ship upon which you stand is one of 11 under the command of Hernán Cortés, who has set sail from Cuba against the wishes of the island&#39;s Governor, Diego Velazquez. Cortés has convinced you to join him on what may just be your greatest adventure yet and you are eager to escape the clutches of the governor. Before you continue, however, you must complete a task. &lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Olid&quot;&gt;&gt;
You open your eyes and find yourself on a ship. The boom you heard was the sound of cannon fire and you startle as another shot tears through the sky.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Cristóbal de Olid: Spaniard, soldier, and adventurer, off to seek your fortune in a foreign land. The ship upon which you stand is one of 11 under the command of Hernán Cortés, who has set sail from Cuba against the wishes of the island&#39;s Governor (and your good friend), Diego Velazquez. Cortés has convinced you to join him on what may just be your greatest adventure yet and you are eager to escape the clutches of the governor. Before you continue, however, you must complete a task. &lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Moctezuma II: ruler of the mighty Aztec Empire, a vast territory whose lands stretch from sea to sea. &lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
 &lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlacaelel&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder. &lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Tlacaelel Xocoyotl: the 4th Aztec cihuacóatl, Interior Minister of the mighty Aztec Empire, a vast territory whose lands stretch from sea to sea. &lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cuauhtemoc&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Cuauhtémoc: nephew of the Aztec Emperor, Moctezuma II, and a powerful warrior. &lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cacamatzin&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Cacamatzín: huey tlatoani of Texcoco, junior member of the Aztec Triple Alliance.&lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are a powerful Mexica priest. Your role is central to the survival of the Aztec Empire, for it is up to you to commune with the Gods and make sure their needs are met. If the Gods are not happy, the world will fall into chaos.&lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Pochteca&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are a pochteca, a central figure in Mexica society. You are a trader and a spy, travelling long distances throughout the empire to carry information back to Tenochtitlán.&lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt; 
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Xicotencatl_Elder&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Xicotencatl the Elder, the wizened leader of the Tlaxcalan confederation. You have long held power, but you know your days will soon come to an end and you fear what may come to pass in your absence. &lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt; 
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Xicotencatl_Younger&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Xicotencatl the Younger, bold warrior and heir to the Tlaxcalan throne. Your father has long ruled over your people, but it is clear that his days are numbered and you eagerly await your opportunity to take his place.&lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Maxixcatl&quot;&gt;&gt;
You open your eyes and find yourself staring out a window at the night sky. The noise you heard was the distant rumble of thunder.&lt;br&gt;
&lt;br&gt;
You are momentarily disoriented, but this passes quickly as you realize that you somehow know exactly where--and who--you are. You are Maxixcatl, a lesser king of the Tlaxcalan confederation. For years, you have bowed to the will of Xicotencatl the Elder, but as the aged ruler nears his end, you wait for your opportunity to claim power for yourself.&lt;br&gt;
&lt;br&gt;
You lie on your mat upon the floor listening to the thunder, unsettled by a very clear sense that something is about to happen. For now, you have no choice but to wait for the Gods to reveal their plan. In the meantime, you must complete a small task.&lt;br&gt;
&lt;br&gt;
Use the counter below to develop your character. You have 20 points, which you may distribute however you choose between qualities: strength, loyalty, and wisdom. These qualities will be important in the days to come, so choose wisely. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;
 &lt;div id=&quot;statsPicker&quot;&gt;&lt;/div&gt;&lt;br&gt;
 &lt;&lt;print statPickerInit()&gt;&gt;&lt;br&gt;
&lt;div  class=&quot;show&quot;&gt;&lt;br&gt;
You need to assign points to your character to continue. &lt;br&gt;
&lt;/div&gt;

&lt;div class=&quot;hide&quot;&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Are you ready to &lt;&lt;link &quot;begin your journey&quot; &quot;The Aztec Legend of Quetzalcoatl&quot;&gt;&gt;&lt;&lt;storeSet $Start = $Start + 1&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Moctezuma&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Leader_A=&quot;Pochteca&quot;&gt;&gt;&lt;&lt;storeSet $A_Q_Heart=&quot;no&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;? &lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Are you ready to &lt;&lt;link &quot;begin your journey&quot; &quot;The Tlaxcalan Legend of Quetzalcoatl&quot;&gt;&gt;&lt;&lt;storeSet $Start = $Start + 1&gt;&gt;&lt;&lt;storeSet $Tlax_Leader=&quot;Xicotencatl_Elder&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Leader_T=&quot;Xicotencatl_Younger&quot;&gt;&gt;&lt;&lt;storeSet $T_Q_Heart=&quot;no&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Alvarado&quot; OR &quot;Garrido&quot; OR &quot;Olid&quot;&gt;&gt;&lt;br&gt;
Are you ready to &lt;&lt;link &quot;begin your journey&quot; &quot;Cortes&#39; Men leave Santiago&quot;&gt;&gt;&lt;&lt;storeSet $Start = $Start + 1&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
Are you ready to &lt;&lt;link &quot;begin your journey&quot; &quot;Cortes Leaves Santiago&quot;&gt;&gt;&lt;&lt;storeSet $Start = $Start + 1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
Are you ready to &lt;&lt;link &quot;begin your journey&quot; &quot;Marina in Slavery&quot;&gt;&gt;&lt;&lt;storeSet $Start = $Start + 1&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
Are you ready to &lt;&lt;link &quot;begin your journey&quot; &quot;Aguilar Among the Maya&quot;&gt;&gt;&lt;&lt;storeSet $Start = $Start + 1&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="76" name="Cholula" tags="Done Breaks" position="2925,525" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve made it to Cholula!&lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_A is $users[$userId][&quot;role&quot;] and $T_Q_Heart is &quot;no&quot;&gt;&gt;

Congratulations! You have beaten the Tlaxcalans and you may claim Quetzalcoatl&#39;s heart, which will increase your teams&#39;s strength by 5!&lt;br&gt;
&lt;br&gt;

&lt;&lt;link &quot;Claim Quetzalcoatl&#39;s Heart&quot; &quot;End of Quest&quot;&gt;&gt;&lt;&lt;storeSet $A_Q_Heart = &quot;yes&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Quest_Leader_A is $users[$userId][&quot;role&quot;] and $T_Q_Heart is &quot;yes&quot;&gt;&gt;

Too bad! The Tlaxcalans beat you to Cholula and they have Quetzalcoatl&#39;s heart.  You are at a disadvantage now because the Tlaxcalan&#39;s strength has increased by 5!&lt;br&gt;
&lt;br&gt;

This is the [[end of your quest|End of Quest]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;] and $T_Q_Heart is &quot;no&quot;&gt;&gt;

Congratulations! You have beaten the Tlaxcalans. But only &lt;&lt;print $Quest_Leader_A&gt;&gt; can claim Quetzalcoatl&#39;s heart. Let&#39;s hope he does it before the Tlaxcalans arrive, because this prize will increase your teams&#39;s strength by 5!&lt;br&gt;
&lt;br&gt;

This is the [[end of your quest|End of Quest]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;] and $T_Q_Heart is &quot;yes&quot;&gt;&gt;

Too bad! The Tlaxcalans beat you to Cholula and they have Quetzalcoatl&#39;s heart.  You are at a disadvantage now because the Tlaxcalan&#39;s strength has increased by 5!&lt;br&gt;
&lt;br&gt;

This is the [[end of your quest|End of Quest]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_T is $users[$userId][&quot;role&quot;] and $A_Q_Heart is &quot;no&quot;&gt;&gt;

Congratulations! You have beaten the Mexica and you may claim Quetzalcoatl&#39;s heart, which will increase your teams&#39;s strength by 5!&lt;br&gt;
&lt;br&gt;

&lt;&lt;link &quot;Claim Quetzalcoatl&#39;s Heart&quot; &quot;End of Quest&quot;&gt;&gt;&lt;&lt;storeSet $T_Q_Heart = &quot;yes&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Quest_Leader_T is $users[$userId][&quot;role&quot;] and $A_Q_Heart is &quot;yes&quot;&gt;&gt;

Too bad! The Mexica beat you to Cholula and they have Quetzalcoatl&#39;s heart.  You are at a disadvantage now because the Mexica&#39;s strength has increased by 5!&lt;br&gt;
&lt;br&gt;

This is the [[end of your quest|End of Quest]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Quest_Leader_T isnot $users[$userId][&quot;role&quot;] and $A_Q_Heart is &quot;no&quot;&gt;&gt;

Congratulations! You have beaten the Mexica. But only &lt;&lt;print $Quest_Leader_T&gt;&gt; can claim Quetzalcoatl&#39;s heart. Let&#39;s hope he does it before the Mexica arrive, because this prize will increase your teams&#39;s strength by 5!&lt;br&gt;
&lt;br&gt;

This is the [[end of your quest|End of Quest]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;] and $A_Q_Heart is &quot;yes&quot;&gt;&gt;

Too bad! The Mexica beat you to Cholula and they have Quetzalcoatl&#39;s heart.  You are at a disadvantage now because the Mexica&#39;s strength has increased by 5!&lt;br&gt;
&lt;br&gt;

This is the [[end of your quest|End of Quest]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="77" name="Cholula Makes an Invitation" tags="Done" position="2000,4000" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
A group of nobles from the city of Cholula has come to bid you welcome. One of them makes a long speech, expressing his honor at hosting such esteemed guests. They invite you into the city, but there is one catch: your Tlaxcalan friends may not enter.&lt;br&gt;
&lt;br&gt;
As you pack up camp and [[prepare to enter the city|Spaniards Enter Cholula]], your allies stay behind, watching closely.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
A group of nobles from the city of Cholula has come to bid the strangers welcome. The most powerful among them makes a speech, expressing his honor at hosting such esteemed guests. They invite your Spanish friends into the city, but there is one catch: you and your men may not enter. &lt;br&gt;
&lt;br&gt;
As your allies pack up camp and prepare to enter the city of your enemy, [[you remain behind|Tlaxcalans Wait Outside and Send Spies]], wondering what this could mean.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="78" name="Cholula New Spanish Leader" tags="" position="2100,5225" size="100,100">&lt;&lt;theyr&gt;&gt;
After much angry debate , you finally determine that &lt;&lt;print $Span_Leader&gt;&gt; has the greatest loyalty of his men, and you [[move forward under his leadership|Into the Mountain Pass]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="79" name="Cholula Spanish Leadership Challenge" tags="" position="1875,4950" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You have made your decisions and led your people through a complicated situation, but do they still believe in your leadership? &lt;br&gt;
&lt;br&gt;
[[You await their decision|Cholula Spanish Leadership Results]].

&lt;&lt;else&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has led you through a complex situation, but do you agree with him? Is he the leader your people need right now? &lt;br&gt;
&lt;br&gt;

He leaves the group to debate and each member of the group must vote. When it is your turn, you make your choice.  Should &lt;&lt;print $Span_Leader&gt;&gt; remain in power? Or should one of the other elegible conquistadors take over?  Vote for your leader below.&lt;br&gt;
&lt;br&gt;

Option 1: &lt;&lt;link &quot;Cortes&quot; &quot;Cholula Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Cor = $Sp_Ld_Cor + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cortes&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should lead your people.&lt;br&gt;
&lt;br&gt;
Option 2: &lt;&lt;link &quot;Alvarado&quot; &quot;Cholula Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Alv = $Sp_Ld_Alv + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Alvarado&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should be in charge.&lt;br&gt;
&lt;br&gt;
Option 3: &lt;&lt;link &quot;Aguilar&quot; &quot;Cholula Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Agu = $Sp_Ld_Agu + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aguilar&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is best suited to lead in these difficult times.&lt;br&gt;
&lt;br&gt;
Option 4: &lt;&lt;link &quot;Garrido&quot; &quot;Cholula Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Gar = $Sp_Ld_Gar + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Garrido&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is your best chance of suriving these strange turns of events.&lt;br&gt;
&lt;br&gt;
Option 4: &lt;&lt;link &quot;Olid&quot; &quot;Cholula Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Oli = $Sp_Ld_Oli + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Olid&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is your choice.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="80" name="Cholula Spanish Leadership Results" tags="" position="2100,5100" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;] and $Sp_Ld_Vote isnot 5&gt;&gt;
You wait nervously for your team to deliberate.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Span_Leader isnot $users[$userId][&quot;role&quot;] and $Sp_Ld_Vote isnot 5&gt;&gt;
When everyone has voted, you will deliver the news to &lt;&lt;print $Span_Leader&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Sp_Ld_Vote is 5&gt;&gt;
You have chosen a leader. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Sp_Ld_Cor &gt;= $Sp_Ld_Alv and $Sp_Ld_Cor &gt;= $Sp_Ld_Agu and $Sp_Ld_Cor &gt;= $Sp_Ld_Gar and $Sp_Ld_Cor &gt;= $Sp_Ld_Olid and $Sp_Ld_Cor is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Cor &gt;= $Sp_Ld_Alv and $Sp_Ld_Cor &gt;= $Sp_Ld_Agu and $Sp_Ld_Cor &gt;= $Sp_Ld_Gar and $Sp_Ld_Cor &gt;= $Sp_Ld_Olid and $Sp_Ld_Cor isnot 5&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Alv &gt;=$Sp_Ld_Cor and $Sp_Ld_Alv &gt;=$Sp_Ld_Agu and $Sp_Ld_Alv &gt;=$Sp_Ld_Gar and $Sp_Ld_Alv &gt;=$Sp_Ld_Olid and $Sp_Ld_Alv is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Alv &gt;=$Sp_Ld_Cor and $Sp_Ld_Alv &gt;=$Sp_Ld_Agu and $Sp_Ld_Alv &gt;=$Sp_Ld_Gar and $Sp_Ld_Alv &gt;=$Sp_Ld_Olid and $Sp_Ld_Alv isnot 5&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Agu &gt;=$Sp_Ld_Cor and $Sp_Ld_Agu &gt;=$Sp_Ld_Alv and $Sp_Ld_Agu &gt;=$Sp_Ld_Gar and $Sp_Ld_Agu &gt;=$Sp_Ld_Olid and $Sp_Ld_Agu is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Agu &gt;=$Sp_Ld_Cor and $Sp_Ld_Agu &gt;=$Sp_Ld_Alv and $Sp_Ld_Agu &gt;=$Sp_Ld_Gar and $Sp_Ld_Agu &gt;=$Sp_Ld_Olid and $Sp_Ld_Agu isnot 5&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Gar &gt;=$Sp_Ld_Cor and $Sp_Ld_Gar &gt;=$Sp_Ld_Alv and $Sp_Ld_Gar &gt;=$Sp_Ld_Agu and $Sp_Ld_Gar &gt;=$Sp_Ld_Olid and $Sp_Ld_Gar is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Gar &gt;=$Sp_Ld_Cor and $Sp_Ld_Gar &gt;=$Sp_Ld_Alv and $Sp_Ld_Gar &gt;=$Sp_Ld_Agu and $Sp_Ld_Gar &gt;=$Sp_Ld_Olid and $Sp_Ld_Gar isnot 5&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Olid &gt;=$Sp_Ld_Cor and $Sp_Ld_Olid &gt;=$Sp_Ld_Alv and $Sp_Ld_Olid &gt;=$Sp_Ld_Agu and $Sp_Ld_Olid &gt;=$Sp_Ld_Gar and $Sp_Ld_Olid is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Sp_Ld_Olid &gt;=$Sp_Ld_Cor and $Sp_Ld_Olid &gt;=$Sp_Ld_Alv and $Sp_Ld_Olid &gt;=$Sp_Ld_Agu and $Sp_Ld_Olid &gt;=$Sp_Ld_Gar and $Sp_Ld_Olid isnot 5&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Cholula New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="81" name="Cholulans Attack" tags="Done" position="1600,4800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You try to sleep, but your nerves are frayed and you anxiously listen for any noise that might alert you to an attack. &lt;br&gt;
&lt;br&gt;
You finally drift into a fitful sleep in the early hours of the morning, only to be awakened by the most terrifying sounds! You hear drums, screaming, and the unmistakable sound of thousands of men bearing down upon you. You sneak out your sleeping quarters and find a place to hide, watching events as they unfold.&lt;br&gt;
&lt;br&gt;
Fortunately for your Spanish friends, their Tlaxcalan allies have come to their defense. They fight their way out of the city and you join them as they flee, [[barely escaping with your lives|Cholula Spanish Leadership Challenge]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot &quot;Marina&quot;&gt;&gt;
You try to sleep, but your nerves are frayed and you anxiously listen for any noise that might alert you to an attack. &lt;br&gt;
&lt;br&gt;
You finally drift into a fitful sleep in the early hours of the morning, only to be awakened by the most terrifying sounds! You hear drums, screaming, and the unmistakable sound of thousands of men bearing down upon you. You barely have time to stand and grab your sword before you are surrounded by an army of Aztec warriors!&lt;br&gt;
&lt;br&gt;
Thankfully, your Tlaxcalan allies have come to your defense! You fight your way out of the city and [[barely escape with your lives|Cholula Spanish Leadership Challenge]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="82" name="Cholulans Don&#39;t Attack" tags="Done" position="2150,4750" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You try to sleep, but your nerves are frayed and you anxiously listen for any noise that might alert you to an attack. &lt;br&gt;
&lt;br&gt;
Despite your fears of a trap, the next day proceeds much as the last. It seems the rumor was unfounded and your Cholulan hosts treat you as esteemed visitors. You pass a pleasant stay in the city before [[carrying on with your journey|Cholula Spanish Leadership Challenge]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot &quot;Marina&quot;&gt;&gt;
You go to bed satisfied, full of food and a strange Cholulan wine. 

The next day proceeds much as the last. It seems you were right and the rumor was unfounded. Your Cholulan hosts are generous and treat you as esteemed visitors. You pass a pleasant stay in the city before [[carrying on with your journey|Cholula Spanish Leadership Challenge]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="83" name="Control: Change Passage" tags="" position="3525,400" size="100,100">&lt;b&gt;CHANGE THE LOCATION OF PLAYERS&lt;/b&gt;&lt;br&gt;

&lt;b&gt;Spaniards&lt;/b&gt;&lt;br&gt;
Cortes&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Cortes&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Cortes&#39;]][&#39;passage&#39;]&quot; $users[$lookup[&#39;Cortes&#39;]][&#39;passage&#39;] &quot;The Library&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Alvarado&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Garrido&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Garrido&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Garrido&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Alvarado&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Alvarado&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Olid&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Olid&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Olid&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Aguilar&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Aguilar&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Aguilar&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Marina&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Marina&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Marina&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Aztecs&lt;/b&gt;&lt;br&gt;
Moctezuma&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Moctezuma&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Moctezuma&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Tlacaelel&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Tlacaelel&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Tlacaelel&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cuauhtemoc&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Cuauhtemoc&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Cuauhtemoc&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cacamatzin&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Cacamatzin&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Cacamatzin&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Aztec_Priest&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Aztec_Priest&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt; 
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Aztec_Priest&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Pochteca&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Pochteca&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Pochteca&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Tlaxcalans&lt;/b&gt;&lt;br&gt;
Xicotencatl_Elder&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Xicotencatl_Elder&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Xicotencatl_Elder&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Xicotencatl_Younger&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Xicotencatl_Younger&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Xicotencatl_Younger&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Maxixcatl&lt;br&gt;
Current Location: &lt;&lt;print $users[$lookup[&#39;Maxixcatl&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
New Location: &lt;&lt;textbox &quot;$users[$lookup[&#39;Maxixcatl&#39;]][&#39;passage&#39;]&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
[[Check Player and Team Status and Location|Control: Player Status]]&lt;br&gt;
[[Check the Status of Holds and Votes|Control: Votes]]&lt;br&gt;
[[Return to the Dashboard|Dashboard]]&lt;br&gt;</tw-passagedata><tw-passagedata pid="84" name="Control: Player Status" tags="" position="4275,375" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;b&gt;CURRENT STATUS OF TEAMS AND PLAYERS&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Current Team Leader and Strength&lt;/b&gt;&lt;br&gt;
Spaniards&lt;br&gt;
Leader &lt;&lt;print $Span_Leader&gt;&gt;   Strength &lt;&lt;print $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt; &lt;br&gt;
Aztecs&lt;br&gt;  
Leader &lt;&lt;print $Aztec_Leader&gt;&gt;   Strength &lt;&lt;print $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt; &lt;br&gt;
Tlaxcalans&lt;br&gt;
Leader &lt;&lt;print $Tlax_Leader&gt;&gt;   Strength &lt;&lt;print $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt; &lt;br&gt;
&lt;br&gt;
&lt;b&gt;Player Location and Stats &lt;/b&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Spaniards&lt;/b&gt;&lt;br&gt;
Cortes&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&quot;Cortes&quot;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Alvarado&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Alvarado&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Garrido&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Garrido&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Olid&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Olid&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Aguilar&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Aguilar&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Marina&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Marina&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Marina&#39;s Boyfriend: &lt;&lt;print $Mal_Boy&gt;&gt;
&lt;br&gt;
&lt;b&gt;Aztecs&lt;/b&gt;&lt;br&gt;
Moctezuma&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Moctezuma&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Tlacaelel&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Tlacaelel&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Cuauhtemoc&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Cuauhtemoc&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Cacamatzin&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Cacamatzin&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Aztec_Priest&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Aztec_Priest&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Pochteca&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Pochteca&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Tlaxcalans&lt;/b&gt;&lt;br&gt;
Xicotencatl_Elder&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Xicotencatl_Elder&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Xicotencatl_Younger&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Xicotencatl_Younger&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Maxixcatl&lt;br&gt;
Location: &lt;&lt;print $users[$lookup[&#39;Maxixcatl&#39;]][&#39;passage&#39;]&gt;&gt;&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;   Wisdom: &lt;&lt;print $users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;   Loyalty: &lt;&lt;print $users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
[[Check the Status of Holds and Votes|Control: Votes]]&lt;br&gt;
[[Change Player Location|Control: Change Passage]]&lt;br&gt;
[[Return to the Dashboard|Dashboard]]&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="85" name="Control: Votes" tags="" position="4075,225" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;b&gt;STATUS OF VOTES AND HOLDS&lt;/b&gt;&lt;br&gt;
&lt;b&gt; Act 1&lt;/b&gt;&lt;br&gt;
&lt;b&gt;Start:&lt;/b&gt;  &lt;i&gt;This holds players after the Character Page at the beginning of the game. Players cannot continue until all 15 have set their Character Statistics and joined the game.&lt;/i&gt;&lt;br&gt;
Number of Votes Cast:  &lt;&lt;print $Start&gt;&gt; out of 15 votes.&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $Start eq &quot;15&quot;&gt;&gt; Yes &lt;&lt;else&gt;&gt; No&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;
Players who have already cast a vote: &lt;&lt;if $Start eq &quot;&quot; or ndef $Start&gt;&gt; Nobody has voted yet. &lt;&lt;else&gt;&gt;&lt;&lt;script&gt;&gt;$(output).append(showCounterRoles(&quot;Start_ctr&quot;));&lt;&lt;/script&gt;&gt;&lt;&lt;/if&gt;&gt;
&lt;br&gt;

&lt;b&gt;Cuba Voted:&lt;/b&gt;  &lt;i&gt;This holds players until all three of Cortes&#39; men have decided why they are continuing on from Cuba and into the unknown.&lt;/i&gt;&lt;br&gt;
Number of Votes Cast:  &lt;&lt;print $Cuba_Voted&gt;&gt; out of 3 votes.&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $Cuba_Voted eq &quot;3&quot;&gt;&gt; Yes &lt;&lt;else&gt;&gt; No&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;
Players who have already cast a vote: &lt;&lt;if $Cuba_Voted eq &quot;&quot; or ndef $Cuba_Voted&gt;&gt; Nobody has voted yet. &lt;&lt;else&gt;&gt;&lt;&lt;script&gt;&gt;$(output).append(showCounterRoles(&quot;Cuba_Voted_ctr&quot;));&lt;&lt;/script&gt;&gt;&lt;&lt;/if&gt;&gt;
&lt;br&gt;

&lt;b&gt;Letter Sent:&lt;/b&gt;  &lt;i&gt;This holds Aguilar until the Spaniards have arrived at Yucatan and Cortes has sent his letter to Aguilar.&lt;/i&gt;&lt;br&gt;
Letter is currently set to: &lt;&lt;print $Letter&gt;&gt;&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $Letter eq &quot;sent&quot;&gt;&gt; Yes &lt;&lt;else&gt;&gt; No&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;

&lt;b&gt;Letter Received:&lt;/b&gt;  &lt;i&gt;This holds Spaniards until Aguilar has recieved the letter sent by Cortes.&lt;/i&gt;&lt;br&gt;
Letter received is currently set to:  &lt;&lt;print $L_Received&gt;&gt;.&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $L_Received eq &quot;Yes&quot;&gt;&gt; Yes &lt;&lt;else&gt;&gt; No&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;

&lt;b&gt;Spaniards Meet Malinche:&lt;/b&gt; &lt;i&gt;This holds Spaniards until Malinche has submitted her introduction link.&lt;/i&gt;&lt;br&gt;
Malinche&#39;s story is currently set to:  &lt;&lt;print $Mal_Story&gt;&gt;.&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $Mal_Story eq &quot;&quot; or ndef $Mal_Story&gt;&gt; No &lt;&lt;else&gt;&gt; Yes&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;

&lt;b&gt;Tlaxcalans at the Time of the Omens:&lt;/b&gt; &lt;i&gt;This holds Aztecs and Tlaxcalans until Tlaxcalans decide how to play the remainder of Act 1, allying with the Aztecs, spying on the Spaniards, or having a long nap.&lt;/i&gt;&lt;br&gt;
Tlaxcalan Omens is currently set to:  &lt;&lt;print $Tl_Omens&gt;&gt;.&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $Tl_Omens eq &quot;&quot; or ndef $Tl_Omens&gt;&gt; No &lt;&lt;else&gt;&gt; Yes&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;

&lt;b&gt;Aztecs meet the Spaniards:&lt;/b&gt; &lt;i&gt;This holds players until the Aztecs decide how to approach the Spaniards on the beach, with gifts, emptyhanded, or aggressively.&lt;/i&gt;&lt;br&gt;
Gifts is currently set to:  &lt;&lt;print $flags[&quot;gifts&quot;]&gt;&gt;.&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $flags[&quot;gifts&quot;] eq &quot;&quot; or ndef $flags[&quot;gifts&quot;]&gt;&gt; No &lt;&lt;else&gt;&gt; Yes&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;

&lt;b&gt;The Mutiny:&lt;/b&gt; &lt;i&gt;Tallies the number of votes that have been cast and whether for or against the Mutiny. Players are held until all 5 Spaniards have voted on whether or not to mutiny.&lt;/i&gt;&lt;br&gt;
Mutiny Status: &lt;&lt;print $Mutiny&gt;&gt;. &lt;i&gt;If the total is greater than 3, there is a mutiny and a new leader.  If the total is less than -6, the leader of the mutiny chickened out. Otherwise, gameplay continues with the current leader in place.&lt;/i&gt;
Number of Votes Cast:  &lt;&lt;print $Mutiny_Voted&gt;&gt; out of 5 votes.&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $Mutiny_Voted eq &quot;5&quot;&gt;&gt; Yes &lt;&lt;else&gt;&gt; No&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;
Players who have already cast a vote: &lt;&lt;if $Mutiny eq &quot;&quot; or ndef $Mutiny&gt;&gt; Nobody has voted yet. &lt;&lt;else&gt;&gt;&lt;&lt;script&gt;&gt;$(output).append(showCounterRoles(&quot;Mutiny_Voted_ctr&quot;));&lt;&lt;/script&gt;&gt;&lt;&lt;/if&gt;&gt;
&lt;br&gt;

&lt;b&gt;Tlaxcalans Attack in Veracruz:&lt;/b&gt; &lt;i&gt;If the Tlaxcalans decide to spy on the Aztecs and the Spaniards, this holds everybody until Tlaxcalans decide whether to attack the Spaniards, the Aztecs, or nobody.&lt;/i&gt;&lt;br&gt;
Tlaxcalans Attack is currently set to:  &lt;&lt;print $TL_Attacks&gt;&gt;.&lt;br&gt;
Has the hold been cleared? &lt;b&gt;&lt;&lt;if $TL_Attacks eq &quot;&quot; or ndef $TL_Attacks&gt;&gt; No &lt;&lt;else&gt;&gt; Yes&lt;&lt;/if&gt;&gt;&lt;/b&gt;&lt;br&gt;
&lt;br&gt;

&lt;b&gt; Act 2&lt;/b&gt;&lt;br&gt;

&lt;b&gt; Act 3&lt;/b&gt;&lt;br&gt;

&lt;b&gt; Act 4&lt;/b&gt;&lt;br&gt;

[[Check Player and Team Status and Location|Control: Player Status]]&lt;br&gt;
[[Change Player Location|Control: Change Passage]]&lt;br&gt;
[[Return to the Dashboard|Dashboard]]&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="86" name="Cortes Attacks Narvaez" tags="" position="2175,9675" size="100,100">&lt;&lt;theyr&gt;&gt;
You have received word that the enemy camp lies just ahead. The time has come to make your move.&lt;br&gt;
&lt;br&gt;
You wait until midnight to launch your attack, hoping to catch the enemy forces asleep. Unfortunately, they have been alerted to your presence! A long and bloody battle ensues. Both sides suffer significant losses, but in the end, you manage to achieve a narrow victory. Narváez and his men retreat to the coast. &lt;br&gt;
&lt;br&gt;
You are alive, but you are weakened. You have lost many men, but you gather those who remain and prepare for the journey .&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;back to Tenochtitlán&quot; &quot;Cortes Returns Victorious&quot;&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]-=5&gt;&gt;&lt;&lt;storeSet $Cortes_Dead=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="87" name="Cortes Beaches Ships" tags="" position="2025,1750" size="100,100">&lt;&lt;theyr&gt;&gt;
You have made your case to the men, but can you really trust them? Now is not the time for inaction; the risk is too high and the reward too great!&lt;br&gt;
&lt;br&gt;
You weigh your options and decide that the best course of action is the boldest: retreat cannot be an option! You will beach the ships so that your crew has no choice but to forge onward. Though not destroyed, fixing the ships would require many weeks of repair, assuming they could even find the necessary materials. &lt;br&gt;
&lt;br&gt;
Even if your men have turned against you, there&#39;s [[no going back|Mutiny Outcome]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="88" name="Cortes Doesn&#39;t Return" tags="" position="2500,9800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
Things have now been quiet for days. Eerily quiet. As you look at your dwindling food supplies, you wonder what is going on outside the palace. &lt;br&gt;
&lt;br&gt;
As you struggle to maintain your forces, you wish you had more manpower and wonder why Cortes has [[not yet returned from the coast|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
You have now spent many moons as a prisoner of the Spanish and you can only imagine what is happening outside the walls of the palace. With Cortes gone, a much smaller Spanish force remains and you wonder if he and his Tlaxcalan allies will return. You know the route to the coast well and it&#39;s clear that he should have returned by now. &lt;br&gt;
&lt;br&gt;
[[You hope this will work to your advantage|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
With the Spaniards barricaded inside the palace, your people have been quietly preparing the city for battle. With Cortes gone, a much smaller Spanish force remains. Messengers have made their way to the city in recent days, reporting on his demise. It seems Cortes was defeated at the coast and neither he nor his Tlaxcalan allies will be returning. &lt;br&gt;
&lt;br&gt;
This turn of events gives you hope as you [[continue your preparations|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Ever since your return home, your spies have been keeping a close watch on events in Tenochtitlán. It seems things have grown increasingly tense in the capital since you left the city with Cortés.&lt;br&gt;
&lt;br&gt; 
It all began with a massacre. While you were away at the coast, the remaining Spaniards cut down the Mexica&#39;s most powerful warriors in the middle of a religious festival! The residents of the city recovered quickly from their horror and chased down the Spaniards, who retreated from the plaza and barricaded themselves in the palace. They were not alone in the palace, however, for &lt;&lt;print $Aztec_Leader&gt;&gt; had taken shelter there too. In a shocking move, the Spaniards were able to take him prisoner! To think, the all-powerful Mexica emperor is now nothing more than a captive to the invaders!&lt;br&gt;
&lt;br&gt;
Just today, you received yet another piece of news: Cortés has been killed at the coast! As you suspected, his forces were not strong enough to survive the battle alone. It seems rumors have been circulating in Tenochtitlán. The Mexica have received word of Cortés&#39; death, but the Spaniards have been cut off from this information and wonder about the fate of their former leader.&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and discuss the events that have unfolded since you left the city. How do they make you feel about the Spaniards? About the Mexica? Does this change anything?&lt;br&gt;
&lt;br&gt;
Once you have discussed the present situation, [[you may move forward|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="89" name="Cortes Gets Sent to Cuba" tags="" position="1900,14500" size="100,100">&lt;&lt;theyr&gt;&gt;
You arrive in Cuba, where you are taken before Governor Velazquez, your sworn enemy. Velazquez declares that you acted outside of his authority, reminding you that he only granted permission for you to explore the coast. You defend your actions as perfectly legal! Upon arriving in Veracruz, you tell him, you and your men established a formal settlement. When the town council of Veracruz appointed you military leader, they imbued you with the authority to carry out further exploration. You were not disobeying Velazquez because you were no longer acting under his authority!&lt;br&gt;
&lt;br&gt;
You watch Velazquez grow increasingly angry at your words. When you have made your case, he finds you guilty of violating the orders of the Crown. He sentences you to a lifetime of hard labor, to be served at sea.&lt;br&gt;
&lt;br&gt;
As you are thrown in chains into the hold of another ship, you wonder why &lt;&lt;link &quot;God has forsaken you&quot; &quot;The End&quot;&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]=0&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]=0&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]=0&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="90" name="Cortes Leadership Check" tags="Done" position="1525,300" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
&lt;&lt;if $Cuba_Voted isnot 3&gt;&gt;
You wait nervously to see how your men respond.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Cuba_Voted is 3 and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &lt; 1&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]=0&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]=0&gt;&gt;

Cortes, you have lost the confidence of your men. They don&#39;t trust your leadership, and they have mutinied!  You are no longer their leader. Worse yet, the mutiny wiped out all your strength and wisdom points, too! &lt;br&gt;
&lt;br&gt;
Click through to [[find out who your men are placing their trust in|New Leader]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuba_Voted is 3 and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] is 1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=2&gt;&gt;

Your Loyalty remains high enough, but barely, and you will continue to lead. But be careful how you handle your men, if your Loyalty drops to zero, you will face a mutiny! &lt;br&gt;
&lt;br&gt;
For now, you may [[continue on your journey|Spaniards Send a Letter]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuba_Voted is 3 and $Cuba_Voted is 3 and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt; 1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=2&gt;&gt;

Your Loyalty points remain high enough that you will continue to lead. But be thoughtful in how you lead your men. If they lose faith in you and your loyalty points drop to zero, you could be facing a mutiny!&lt;br&gt;
&lt;br&gt;
For now, you may [[continue on your journey|Spaniards Send a Letter]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Olid&quot; OR &quot;Alvarado&quot; OR &quot;Garrido&quot;&gt;&gt;
&lt;&lt;if $Cuba_Voted isnot 3&gt;&gt;
You wait nervously to see how the other men respond.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Cuba_Voted is 3 and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &lt; 1&gt;&gt;

Cortes has lost your confidence, and you mutiny against him! You band together and take control of the ship. One amongst you will rise to the top and lead the group. &lt;br&gt;
&lt;br&gt;
Click through to find out which of you has the most loyalty and who will  [[become your new leader |New Leader]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuba_Voted is 3 and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] is 1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=2&gt;&gt;

Though the decision was contentious, Cortes still has enough Loyalty points to remain in control of your group-but just barely! Though some of you still have faith in him, his loyalty points are close to zero. If they reach zero, he will face a mutiny, and one of you will rise to the top! Will you support him, bolstering his leadership as you move forward, or will you begin to plot against him?&lt;br&gt;
&lt;br&gt;
For now, you may [[continue on your journey|Spaniards Send a Letter]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuba_Voted is 3 and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt; 1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=2&gt;&gt;

Though the decision was contentious, Cortes is still in control! Note, though, if Cortes&#39; Loyalty Points reach zero, he will face a mutiny, and one of you will rise to the top! As you move forward, will you continue to support him, bolstering his leadership, or will you begin to plot against him?&lt;br&gt;
&lt;br&gt;
For now, you may [[continue on your journey|Spaniards Send a Letter]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="91" name="Cortes Leaves Santiago" tags="Done" position="2200,50" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Start &lt;=10&gt;&gt;

You must wait for all the team members to gather for gameplay to begin.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Start &gt;=5&gt;&gt;
&lt;&lt;audio &quot;Gulls_and_waves__5min_&quot; play&gt;&gt;
November 18th, 1519. Just off the shore of Cuba.&lt;br&gt;
&lt;br&gt;
You stand on the deck of the ship watching the city of Santiago de Cuba recede towards the horizon. The wind has caught the sails, and the ship creaks as it begins to heel. You can barely hear Velázquez yelling into the wind, yelling at you to turn around and come back.&lt;br&gt;
&lt;br&gt;
Velázquez is mad, and he hasn&#39;t yet discovered that, under your orders, the men have raided the city&#39;s main storehouse, stealing all the provisions they could carry. You hope they will last you through the uncertain adventures ahead.&lt;br&gt;
&lt;br&gt;
As the governor&#39;s rowboat rapidly loses ground, you cup your hands to your mouth, shouting back to Velázquez, &quot;Forgive me, Your Worship, for this and similar things have to be done rather than thought about!&quot;&lt;br&gt;
&lt;br&gt;
You forge onward, dreaming of the riches that surely await you! [[Without risk, there can be no reward|Spaniards Quest Instructions 1]]!
&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="92" name="Cortes Proposes a meeting with Narvaez" tags="" position="2025,9675" size="100,100">&lt;&lt;theyr&gt;&gt;
You have received word that the enemy camp lies just ahead. The time has come to make your move. You send a messenger to make contact with Narváez. You propose a meeting.&lt;br&gt;
&lt;br&gt;
The messenger returns with Narváez&#39; reply: He will meet you on the condition that you come unarmed. You agree to his terms and tuck a dagger in your boot as you make your way toward camp. You are wary, but Narváez has given his word that you will not be harmed.&lt;br&gt;
&lt;br&gt;
As soon as you step into the large clearing at the center of camp, you know you made a mistake. Hundreds of his men surround you, while your own are nowhere to be found. Narváez places you under arrest and puts you in shackles. You are chained to a stake in the middle of camp, a spectacle for all of these men who came to rob you of your glory.&lt;br&gt;
&lt;br&gt;
The next day, you are thrown on a boat and [[sent to Cuba|Cortes Waits]]. &lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="93" name="Cortes Returns Victorious" tags="" position="2175,9800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Cortes&quot;&gt;&gt;
After many days on the road, you receive word from a messenger that there has been an uprising back in Tenochtitlán. You ready your now fortified army for the battle that lies ahead. &lt;br&gt;
&lt;br&gt;
It seems that things have descended into chaos during your absence. Your companions launched an unprovoked attack that left many of the city&#39;s warriors dead and they are now barricaded inside the palace, with &lt;&lt;print $Aztec_Leader&gt;&gt; as their prisoner. Outside the palace, the Mexica have been preparing for war and have cut off all food supplies to your men.&lt;br&gt;
&lt;br&gt;
While you were achieving victory on the coast, your compatriots allowed the situation to get out of hand. Despite his failures in your absence, &lt;&lt;print $Span_Leader&gt;&gt; remains in charge, for better for worse. &lt;br&gt;
&lt;br&gt;
It seems the one good thing the rest of your men did in your absence was to take &lt;&lt;print $Aztec_Leader&gt;&gt; prisoner. [[You must now use him to your advantage|Aztec Leader gives a speech]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Things have now been quiet for days. Eerily quiet. As you look at your dwindling food supplies, you wonder what is going on outside the palace.&lt;br&gt;
&lt;br&gt;
It&#39;s late at night when you hear a commotion outside and are relieved to find that Cortes has returned from the coast with a much larger force than he took with him. Not only was he able to defeat Velazquez&#39; forces, but he won them over to your side and claimed their weapons.&lt;br&gt;
&lt;br&gt;
When you recount the events that transpired during his absence, Cortes is livid.  Now that he is no longer in charge, however, there is little he can do. On the other hand, he is pleased  to learn the news that &lt;&lt;print $Aztec_Leader&gt;&gt; is now your hostage. [[You must now use him to your advantage|Aztec Leader gives a speech]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
You have now spent many moons as a prisoner of the Spanish and you can only imagine what is happening outside the walls of the palace. Things take a turn for the worse when Cortes returns from the coast with a much larger army behind him than he had when he left. It seems he has brought back many men and you wonder what kind of weapons they have with them.&lt;br&gt;
&lt;br&gt;
This new turn of events makes you nervous and you [[wonder what is in store for you|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
With the Spaniards barricaded inside the palace, your people have been quietly preparing the city for battle. To your dismay, Cortes returns in the midst of your preparations and forces his way into the city with a much larger army behind him than he had when he left. It seems he has brought back many men and you wonder what kind of weapons they have with them.&lt;br&gt;
&lt;br&gt;
The people are restless and this new turn of events [[makes you nervous|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Ever since your return home, your spies have been keeping a close watch on events in Tenochtitlán. It seems things have grown increasingly tense in the capital since you left the city with Cortés.&lt;br&gt; 
&lt;br&gt;
It all began with a massacre. While you were away at the coast, the remaining Spaniards cut down the Mexica&#39;s most powerful warriors in the middle of a religious festival! The residents of the city recovered quickly from their horror and chased down the Spaniards, who retreated from the plaza and barricaded themselves in the palace. They were not alone in the palace, however, for &lt;&lt;print $Aztec_Leader&gt;&gt; had taken shelter there too. In a shocking move, the Spaniards were able to take him prisoner! To think, the all-powerful Mexica emperor is now nothing more than a captive to the invaders!&lt;br&gt; 
&lt;br&gt;
This was the situation when Cortés and his newly-fortified army returned to the city. The spies claim that he was livid at this turn of events, though you suspect he may benefit greatly from &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s imprisonment.&lt;br&gt; 
&lt;br&gt;
Go to the Tlaxcalan discussion board and discuss the events that have unfolded since you left the city. How do they make you feel about the Spaniards? About the Mexica? Does this change anything?&lt;br&gt; 
&lt;br&gt;
Once you have discussed the present situation, [[you may move forward|Aztec Leader Gives a Speech]].&lt;br&gt; 
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="94" name="Cortes Returns Weakened" tags="" position="2350,9800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Cortes&quot;&gt;&gt;
After many days on the road, you receive word from a messenger that there has been an uprising back in Tenochtitlán. You curse your luck and ready your now weakened army for the battle that lies ahead. &lt;br&gt;
&lt;br&gt;
It seems that things have descended into chaos during your absence. Your companions launched an unprovoked attack that left many of the city&#39;s warriors dead and they are now barricaded inside the palace, with &lt;&lt;print $Aztec_Leader&gt;&gt; as their prisoner. Outside the palace, the Mexica have been preparing for war and have cut off all food supplies to your men.&lt;br&gt;
&lt;br&gt;
You gather your men and force your way through the city and into the palace with little resistance. Once inside you angrily confront the rest of the Spanish forces, wondering how they could have let things go so horribly wrong. While you were barely escaping the coast with your life, your compatriots allowed the situation to get out of hand. Despite his failures in your absence, &lt;&lt;print $Span_Leader&gt;&gt; remains in charge, for better for worse.&lt;br&gt;
&lt;br&gt;
It seems the one good thing the rest of your men did in your absence was to take &lt;&lt;print $Aztec_Leader&gt;&gt; prisoner. [[You must now use him to your advantage|Aztec Leader gives a speech]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Things have now been quiet for days. Eerily quiet. As you look at your dwindling food supplies, you wonder what is going on outside the palace.&lt;br&gt;
&lt;br&gt;
It&#39;s late at night when you hear a commotion outside and are relieved to find that Cortes has returned from the coast, though you are dismayed when you realize that he has brought with him a much smaller force than that with which he left. &lt;br&gt;
&lt;br&gt;
When you recount the events that transpired during his absence, Cortes is livid.  Now that he is no longer in charge, however, there is little he can do. On the other hand, he is pleased to learn the news that &lt;&lt;print $Aztec_Leader&gt;&gt; is now your hostage. [[You must now use him to your advantage|Aztec Leader gives a speech]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
You have now spent many moons as a prisoner of the Spanish and you can only imagine what is happening outside the walls of the palace. Things take a turn for the worse when Cortes returns from the coast, though you note that he is accompanied by a much smaller army than he took with him when he left.&lt;br&gt;
&lt;br&gt;
This new turn of events makes you nervous and you wonder [[what is in store for you|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
With the Spaniards barricaded inside the palace, your people have been quietly preparing the city for battle. To your dismay, Cortes returns in the midst of your preparations and forces his way into the city, though you note that he is accompanied by a much smaller army than he took with him when he left.&lt;br&gt;
&lt;br&gt;
The people are restless and this new turn of events [[makes you nervous|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Ever since your return home, your spies have been keeping a close watch on events in Tenochtitlán. It seems things have grown increasingly tense in the capital since you left the city with Cortés.&lt;br&gt;
&lt;br&gt; 
It all began with a massacre. While you were away at the coast, the remaining Spaniards cut down the Mexica&#39;s most powerful warriors in the middle of a religious festival! The residents of the city recovered quickly from their horror and chased down the Spaniards, who retreated from the plaza and barricaded themselves in the palace. They were not alone in the palace, however, for &lt;&lt;print $Aztec_Leader&gt;&gt; had taken shelter there too. In a shocking move, the Spaniards were able to take him prisoner! To think, the all-powerful Mexica emperor is now nothing more than a captive to the invaders!&lt;br&gt;
&lt;br&gt;
Just today, you received yet another piece of news: Cortés has returned from the coast! It seems he survived the battle alone, much to your surprise, though his forces have been greatly weakened. The spies claim that he was livid at the events that unfolded in his absence, though you suspect he may benefit greatly from &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s imprisonment.&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and discuss the events that have unfolded since you left the city. How do they make you feel about the Spaniards? About the Mexica? Does this change anything?&lt;br&gt;
&lt;br&gt;
Once you have discussed the present situation, [[you may move forward|Aztec Leader gives a speech]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="95" name="Cortes Waits" tags="" position="2025,9800" size="100,100">&lt;&lt;theyr&gt;&gt;
You suffer through the journey in the hold of the boat, wondering what awaits you [[back on the island|Cortes Gets Sent to Cuba]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="96" name="Cortes gets called to the coast" tags="" position="2300,8925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; gathers you together and this is what he says:&lt;br&gt;
&lt;br&gt;
&lt;i&gt;&quot;I have just this moment received the information that an armament of eighteen vessels, with a great number of soldiers and horses, has arrived in the harbor where you landed. Pictures of the whole armament have been transmitted to me. This, no doubt, is no news to you, and...though I may have felt hurt that you wished to keep all this a secret from me, yet, on the other hand, I am delighted at the arrival of your brothers, with whom you can now return to Spain; which thus removes all difficulties at once.”&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
You try to hide your surprise as this is, indeed, news to you! You express your joy to &lt;&lt;print $Aztec_Leader&gt;&gt;, assuring him how happy you will be to reunite with your countrymen. You know immediately, however, that this cannot be good news. It is undoubtedly Velazquez, out to secure your arrest.&lt;br&gt;
&lt;br&gt;
After &lt;&lt;print $Aztec_Leader&gt;&gt; makes his departure, you quietly confer with the others. It is clear that you must go to the coast. Judging from &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s description, Velazquez has sent a sizable force to secure your return to Cuba. You will take an army of your indigenous allies on a journey to the coast, among them the Tlaxcalan leaders. &lt;br&gt;
&lt;br&gt;
You gather your allies and [[prepare for your journey|Cortes takes Tlaxcalans to the coast]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Alvarado&quot; OR &quot;Aguilar&quot; OR &quot;Olid&quot; OR &quot;Garrido&quot;&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; gathers you together and this is what he says:&lt;br&gt;
&lt;br&gt;
&lt;i&gt;&quot;I have just this moment received the information that an armament of eighteen vessels, with a great number of soldiers and horses, has arrived in the harbor where you landed. Pictures of the whole armament have been transmitted to me. This, no doubt, is no news to you, and...though I may have felt hurt that you wished to keep all this a secret from me, yet, on the other hand, I am delighted at the arrival of your brothers, with whom you can now return to Spain; which thus removes all difficulties at once.”&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
You listen to Cortes express his joy to &lt;&lt;print $Aztec_Leader&gt;&gt;, assuring him how happy you will all be to reunite with your countrymen. You know immediately, however, that this cannot be good news. It is undoubtedly Velazquez, out to secure Cortes&#39; arrest.&lt;br&gt;
&lt;br&gt;
After &lt;&lt;print $Aztec_Leader&gt;&gt; makes his departure, you quietly confer. It is clear that Cortes must go to the coast. Judging from &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s description, Velazquez has sent a sizable force to secure his return to Cuba. He will take an army of your indigenous allies on a journey to the coast, among them the Tlaxcalan leaders.&lt;br&gt; 
&lt;br&gt;
[[You prepare for Cortes&#39; departure|Absent Cortes Leadership Challenge]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; gathers you together and this is what he says:&lt;br&gt;
&lt;br&gt;
&lt;i&gt;&quot;I have just this moment received the information that an armament of eighteen vessels, with a great number of soldiers and horses, has arrived in the harbor where you landed. Pictures of the whole armament have been transmitted to me. This, no doubt, is no news to you, and...though I may have felt hurt that you wished to keep all this a secret from me, yet, on the other hand, I am delighted at the arrival of your brothers, with whom you can now return to Spain; which thus removes all difficulties at once.”&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
You listen to Cortes express his joy to &lt;&lt;print $Aztec_Leader&gt;&gt;, assuring him how happy he and his men will be to reunite with their countrymen. You sense something is not right, however.&lt;br&gt;
&lt;br&gt;
After &lt;&lt;print $Aztec_Leader&gt;&gt; makes his departure, Cortes gathers everyone together and expresses his concern. He suspects this army has arrived to arrest him, though it&#39;s not clear to you what for. Cortes will go to the coast and he will take an army of indigenous allies on the journey, among them the Tlaxcalan leaders. &lt;br&gt;
&lt;br&gt;
[[Everyone prepares for Cortes&#39; departure|Absent Cortes Leadership Challenge]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Xicotencatl_Elder&quot; OR &quot;Xicotencatl_Younger&quot; OR &quot;Maxixcatl&quot;&gt;&gt;
A messenger approaches you with a request from Cortes. It seems an army of Spaniards have arrived on the coast and he must go to meet them. Cortes requests your discretion, for the army that awaits him are not his friends as he would have the Aztecs believe. He suspects that they mean him harm and he requests that you accompany him at the head of an allied army. You must prepare to do battle when you arrive.&lt;br&gt;
&lt;br&gt;
You wonder at this turn of events, but decide it is in your interest to concede to this request. This is your ticket out of the city and--you hope--home to Tlaxcala.&lt;br&gt;
&lt;br&gt;
[[You prepare for your journey|Tlaxcalans go with Cortes to the coast]].&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
Your spies have informed you that another army of foreigners have arrived at the shore and they seek the one who calls himself Cortes. Your spies have determined that these new Spaniards are not friends of your guests, but you suspect it is best to keep that information to yourself. You visit their lodgings and relay the following message:&lt;br&gt;
&lt;br&gt;
&lt;i&gt;&quot;I have just this moment received the information that an armament of eighteen vessels, with a great number of soldiers and horses, has arrived in the harbor where you landed. Pictures of the whole armament have been transmitted to me. This, no doubt, is no news to you, and...though I may have felt hurt that you wished to keep all this a secret from me, yet, on the other hand, I am delighted at the arrival of your brothers, with whom you can now return to Spain; which thus removes all difficulties at once.”&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
You watch Cortes&#39; face as he listens to your words. He maintains his composure, but you are sure you detect a flash of concern as he expresses his joy at this most welcome news.&lt;br&gt;
&lt;br&gt;
You take your leave, curious at this [[turn of events|Toxcatl]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Your spies have informed &lt;&lt;print $Aztec_Leader&gt;&gt; that another army of foreigners have arrived at the shore and they seek the one who calls himself Cortes. The spies have determined that these new Spaniards are not friends of your guests, but &lt;&lt;print $Aztec_Leader&gt;&gt; decides to keep that information to himself. He visits their lodgings and relays the following message:&lt;br&gt;
&lt;br&gt;
&lt;i&gt;&quot;I have just this moment received the information that an armament of eighteen vessels, with a great number of soldiers and horses, has arrived in the harbor where you landed. Pictures of the whole armament have been transmitted to me. This, no doubt, is no news to you, and...though I may have felt hurt that you wished to keep all this a secret from me, yet, on the other hand, I am delighted at the arrival of your brothers, with whom you can now return to Spain; which thus removes all difficulties at once.”&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; shares this information with his council afterwards. Though the Spaniards expressed joy at the news, &lt;&lt;print $Aztec_Leader&gt;&gt; suspects they are worried about what awaits them on the coast.&lt;br&gt;
&lt;br&gt;
You wonder at what is [[about to unfold|Toxcatl]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="97" name="Cortes takes Tlaxcalans to the coast" tags="" position="2425,9175" size="100,100">&lt;&lt;theyr&gt;&gt;
Your journey is long and arduous, but at least it is familiar this time. Along the way, you prepare your allies for what you might encounter. Your Tlaxcalan friends listen closely and you can&#39;t help but wonder at their allegiance. As you prepare to face Velazquez&#39; forces, you are completely at the mercy of your native allies. You do everything in your power to win them over, but is it enough?&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
You pack up camp and, with your allies, prepare for the [[next phase of your journey|Tlaxcalans agree to fight]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot;&gt;&gt;
You pack up camp and prepare for the [[next phase of your journey|Tlaxcalans announce their departure]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Betray&quot;&gt;&gt;
You pack up camp and prepare for the [[next phase of your journey|Tlaxcalans leave Cortes to fend for himself]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You fall into a troubled sleep, wondering what the next morning will bring.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalans to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="98" name="Cortes&#39; Contribution" tags="" position="2300,7550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Here you will find links to each entry of the Spanish guidebook, along with a special section written by your Tlaxcalan guests. You must read each entry and evaluate their descriptions. Are they accurate in their portrayals? &lt;br&gt;
&lt;br&gt;
To aid you in this task, go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán. You may also want to revisit other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
Marina&#39;s introduction is:  &lt;&lt;print &quot;$Ma_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Marina&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cortes&#39; entry is:  &lt;&lt;print &quot;$Co_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Alvarado&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cortes&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Alvarado&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cortes&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Alvarado&#39;s entry is:  &lt;&lt;print &quot;$Al_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Aguilar&#39;s entry is:  &lt;&lt;print &quot;$Ag_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Olid&#39;s entry is:  &lt;&lt;print &quot;$Ol_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Garrido&#39;s entry is:  &lt;&lt;print &quot;$Ga_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Tlaxcalan&#39;s Insider&#39;s Guide is:  &lt;&lt;print &quot;$Tl_IG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot; OR &quot;Tlaxcalans&quot;&gt;&gt;
Here you will find links to each recipe in the Aztec cookbook. You must read each recipe and judge them for accuracy. Have they properly sourced their ingredients or are there items here that can&#39;t be found in Tenochtitlán?  &lt;br&gt;
&lt;br&gt;

To aid you in this task, you may want to revisit Bernal Diaz&#39; account of Tenochtitlán. You may also want to read his account of the Aztec feast, visit the Codex Mendoza, and review other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;

Moctezuma&#39;s recipe is:  &lt;&lt;print &quot;$Moc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Moctezuma&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Tlacaelel&#39;s entry is:  &lt;&lt;print &quot;$Tlc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Alvarado&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Alvarado&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Cuauhtemoc&#39;s entry is:  &lt;&lt;print &quot;$Cu_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cacamatzin&#39;s entry is:  &lt;&lt;print &quot;$Ca_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Aztec Priest&#39;s entry is:  &lt;&lt;print &quot;$AP_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="99" name="Cortes&#39; Men leave Santiago" tags="Done" position="2050,50" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Start &lt;=10&gt;&gt;
You must wait for all the team members to gather for gameplay to begin.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Start &gt;=5&gt;&gt;
&lt;&lt;audio &quot;Gulls_and_waves__5min_&quot; play&gt;&gt;
November 18th, 1519.  Just off the shore of Cuba. &lt;br&gt;
&lt;br&gt;
You stand on the deck of the ship watching the city of Santiago de Cuba recede towards the horizon.  The wind has caught the sails, and the ship creaks as it begins to heel.  You can barely hear Velázquez yelling into the wind, yelling at Cortés to turn around and come back.

Velázquez is mad, and he hasn&#39;t yet discovered that, under Cortés&#39; orders, you and the other men have raided the city&#39;s main storehouse, stealing all the provisions you hoped would last you through the uncertain adventures ahead.

You watch as Cortés cups his hands to his mouth, shouting back to the governor &quot;Forgive me, Your Worship, for this and similar things have to be done rather than thought about!&quot;

You cast your doubts aside, as Cortés assures you of the riches that undoubtedly lie ahead. [[Without risk, there can be no reward|Spaniards Quest Instructions 1]]!
&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="100" name="Cuauhnahuac" tags="Done Breaks" position="2525,425" size="100,100">You descend the mountains into the place near the trees, in search of something tropical and sweet. This place is lush and green. No wonder it&#39;s been so coveted by Mexica leaders!&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Cuauhnahuac_Ans_A&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Cuauhnahuac 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_A&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Cuauhnahuac 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Cuauhnahuac_Ans_T&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Cuauhnahuac 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_T&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Cuauhnahuac 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="101" name="Cuauhnahuac 2" tags="Done Breaks" position="2675,425" size="100,100">&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;print $Cuauhnahuac_Ans_A&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Cuauhnahuac_Ans_A and $Cuauhnahuac_Ans_A isnot 0 and $Cuauhnahuac_Ans_A isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Cuauhnahuac_Ans_A = $Cuauhnahuac_Ans_A.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Cuauhnahuac_Ans_A or $Cuauhnahuac_Ans_A eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Cuauhnahuac]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Cuauhnahuac_Ans_A is &quot;cuauhnahuac&quot; and $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of fruit for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_A = $Quest_Points_A + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuauhnahuac_Ans_A is &quot;cuauhnahuac&quot; and $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of fruit for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuauhnahuac_Ans_A isnot &quot;cuauhnahuac&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Cuauhnahuac]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;print $Cuauhnahuac_Ans_T&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Cuauhnahuac_Ans_T and $Cuauhnahuac_Ans_T isnot 0 and $Cuauhnahuac_Ans_T isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Cuauhnahuac_Ans_T = $Cuauhnahuac_Ans_T.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Cuauhnahuac_Ans_T or $Cuauhnahuac_Ans_T eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Cuauhnahuac]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuauhnahuac_Ans_T is &quot;cuauhnahuac&quot; and $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of fruit for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_T = $Quest_Points_T + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuauhnahuac_Ans_T is &quot;cuauhnahuac&quot; and $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of fruit for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuauhnahuac_Ans_T isnot &quot;cuauhnahuac&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Cuauhnahuac]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="102" name="Dashboard" tags="" position="4175,550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;b&gt; THE SPANISH AZTEC WAR DASHBOARD&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
[[Check Player and Team Status and Location|Control: Player Status]]&lt;br&gt;
[[Check the Status of Holds and Votes|Control: Votes]]&lt;br&gt;
[[Change Player Location|Control: Change Passage]]&lt;br&gt;
[[Status of the Quest]]&lt;br&gt;
[[Student Submissions|Assignments Summary]]&lt;br&gt;
[[Set the Start Conditions|Game Setup]]&lt;br&gt;
[[test equations]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="103" name="Debating the Omens" tags="" position="2000,5900" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
&lt;&lt;if ndef $Omens or $Omens eq &quot;&quot;&gt;&gt;
You wait for the Priest to prepare his presentation.&lt;br&gt;&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;else&gt;&gt;
You can find the link to the Priest&#39;s presentation here:  &lt;&lt;print $Omens&gt;&gt;&lt;br&gt;
&lt;br&gt;
Now that the priest has shared his work, go to the Aztec discussion board. Explain your interpretation and hear what your people have to say. Do they agree with you?&lt;br&gt;
&lt;br&gt;
When you have come to an understanding with the rest of your counselors, you may [[decide how to deal with the strangers|Aztec Leader will make an invitation]]. &lt;br&gt;&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
&lt;&lt;if ndef $Omens or $Omens eq &quot;&quot;&gt;&gt;
You did not enter your link.  [[Return to the previous page and complete your assignment|Discussing the Omens]]&lt;br&gt;&lt;br&gt;
&lt;&lt;else&gt;&gt;
Now that you have completed your task,  go to the Aztec discussion board. Explain your interpretation and hear what your people have to say. Do they agree with you?&lt;br&gt;
&lt;br&gt;
When you have come to an understanding with the rest of Moctezuma&#39;s counselors, you may [[decide how to deal with the strangers|Aztec Leader will make an invitation]]. &lt;br&gt;&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlacaelel&quot; OR &quot;Cuauhtemoc&quot; OR &quot;Cacamatzin&quot; OR &quot;Pochteca&quot;&gt;&gt;
&lt;&lt;if ndef $Omens or $Omens eq &quot;&quot;&gt;&gt;
You wait in front of the temple, anxious to hear the news. Moctezuma is present, but he seems to be waiting on the priest.
&lt;br&gt;&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;else&gt;&gt;
Moctezuma stands before the temple, a priest at his side. He tells you that many moons ago, there was a series of omens--omens that may help to explain these strange events that have fallen upon you. He asks the priest to interpret the omens, and this what the priest tells you: &lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Omens&gt;&gt; &lt;br&gt; Note: Copy and paste the link to read about the Omens.&lt;br&gt;
&lt;br&gt;
When you have heard what the priest has to say, go to the Aztec discussion board. Share your thoughts with Moctezuma and the priest. Do you agree with their interpretation?&lt;br&gt;
&lt;br&gt;
When you have come to an understanding, you may [[decide how to deal with the strangers|Aztec Leader will make an invitation]]. &lt;br&gt;&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="104" name="Discuss these options with your men" tags="Done Breaks" position="2450,1150" size="100,100">&lt;&lt;theyr&gt;&gt;
You have discussed these options with your men, and together you have decided you will:&lt;br&gt;
&lt;br&gt;
1.  &lt;&lt;link &quot;Attack&quot; &quot;Attack On a Beach in Veracruz&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;Attack&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
2.  &lt;&lt;link &quot;Approach cautiously without the gifts&quot; &quot;On a Beach in Veracruz: No Gifts&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
3. &lt;&lt;link &quot;Approach with the gifts&quot; &quot;On a Beach in Veracruz: Gifts&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlacaelel&quot;&gt;&gt;
You have discussed these options with your men, and together you have decided you will:&lt;br&gt;
&lt;br&gt;
1.  &lt;&lt;link &quot;Attack&quot; &quot;Attack On a Beach in Veracruz&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;Attack&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
2.  &lt;&lt;link &quot;Approach cautiously without the gifts&quot; &quot;On a Beach in Veracruz: No Gifts&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
 3. &lt;&lt;link &quot;Approach with the gifts&quot; &quot;On a Beach in Veracruz: Gifts&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cuauhtemoc&quot; OR &quot;Cacamatzin&quot; OR &quot;Pochteca&quot;&gt;&gt;

&lt;&lt;if $flags[&quot;gifts&quot;] is &quot;Attack&quot;&gt;&gt;

You have discussed it and together decided you will attack. You are wary of the strangers and believes the course of action is to catch them off guard. These pale men will surely be overwhelmed by a [[show of Aztec force|Attack On a Beach in Veracruz]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;No&quot;&gt;&gt;
You have discussed it and together decided you question Moctezuma&#39;s decision to offer gifts.  You will approach the strangers and inquire about their intentions, but you will not offer the gifts. You [[approach the strangers|On a Beach in Veracruz: No Gifts]] with empty hands and nervous hearts.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;Yes&quot;&gt;&gt;
You have discussed it and together decided to follow Moctezuma&#39;s directions. You will offer the gifts and gather as much information as you can about the pale men and their intentions. You [[approach the strangers|On a Beach in Veracruz: Gifts]] with the gifts Moctezuma provided you with.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $flags[&quot;gifts&quot;] eq &quot;&quot; or ndef $flags[&quot;gifts&quot;]&gt;&gt;
Tlacaelel has not yet entered your decision.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="105" name="Discussing the Omens" tags="" position="2150,5900" size="100,100">You wake to find yourself exactly where you hoped: back in Tenochtitlán! An army of over 10,000 men is headed towards your city, led by your Tlaxcalan enemies and their foreign friends.&lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
You have decided that now is the time to revisit the omens. You hope they might provide some hint of what&#39;s to come.&lt;br&gt;
&lt;br&gt;
Meet with the priest and review your previous interpretation. What do these signs mean? What do they portend for the future? When you are satisfied that you understand what the signs are telling you, have the priest share your conclusions with the rest of your team.&lt;br&gt;
&lt;br&gt;
The priest will be asked to share his web page. Only he can share this information. When you are ready, [[gather the rest of your advisors|Debating the Omens]].&lt;br&gt;&lt;br&gt;

&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
Moctezuma has decided that it&#39;s time to revisit the omens. He hopes they might provide some hint of what&#39;s to come.&lt;br&gt;
&lt;br&gt;
Meet with Moctezuma and review your previous interpretation.  What do these signs mean? What do they portend for the future? When you are satisfied that you understand what the signs are telling you, share your conclusions with the rest of your team. You are the only one who can complete this task.&lt;br&gt;
&lt;br&gt;
Enter a link to your strike in the box below. Make sure you&#39;ve set it so that everyone with the link can read it.&lt;br&gt;
&lt;br&gt;
Interpretation of the Omens:  &lt;&lt;textbox &quot;$Omens&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Once you have entered the link, you may [[gather with Moctezuma and the rest of his advisors|Debating the Omens]].&lt;br&gt;&lt;br&gt;

&lt;&lt;case &quot;Tlacaelel&quot; OR &quot;Cuauhtemoc&quot; OR &quot;Cacamatzin&quot; OR &quot;Pochteca&quot;&gt;&gt;
Your nerves are frayed, wondering what lies ahead, but Moctezuma has informed you that he has important news! [[He gathers a group of his closest advisors|Debating the Omens]] to the Templo Mayor.&lt;br&gt;&lt;br&gt;

&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="106" name="End of Quest" tags="Done Breaks" position="2925,675" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Now that your quest is complete, &lt;&lt;link &quot;you return home exhausted&quot; &quot;News from the land of the Olmeca Xicalanca&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;. After all that excitement, you hope to get some rest in the coming days.&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Now that your quest is complete, &lt;&lt;link &quot;you return home exhausted&quot; &quot;Rumors from the Coast&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;. After all that excitement, you hope to get some rest in the coming days.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="107" name="Everyone Gathers for a Feast" tags="" position="2300,7300" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Feast &lt;=12&gt;&gt;
It is rude to start eating before all the guests have arrived! You&#39;ll just have to wait, no matter how hungry you are!&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;else&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
You sit down at the table, ready to indulge in the greatest dishes ever prepared in the Aztec Empire! As you await the first course, your guests present you with a request. It seems that while you have been preparing your cookbook, they have been busy with a project of their own. Your guests have created a travel guide to your great city! They ask if you are willing to read a draft of their account and make sure they got the details correct. &lt;br&gt;
&lt;br&gt;
It seems that the Tlaxcalans have aided in this project, and they are clearly offended at the suggestion that they may have gotten anything wrong. Nevertheless, they remain quiet as you accept the request and look over their documents.&lt;br&gt;
&lt;br&gt;
As you go to work on your task, you offer your guests a copy of your cookbook so that they too might remember this great event. Everyone gathers round the book, while Marina translates the pages. Much to your horror, they seem to be judging your recipes!&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;

&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Malinche&quot;&gt;&gt;
You sit down at the table, excited at the culinary wonders that are undoubtedly coming your way! &lt;br&gt;
&lt;br&gt;
As everyone awaits the first course, the Spaniards take the opportunity to enlist the help of your hosts. They present the Aztecs with a draft of the guidebook and ask them to look over the details. The Tlaxcalans appear annoyed at this suggestion, though they remain quiet.&lt;br&gt;
&lt;br&gt;
Your Aztec hosts grant your request and, in exchange, offer you a copy of a cookbook. It seems they have chosen to commemorate this event by recording tonight&#39;s recipes. You sense your Spanish companions breathe a sigh of relief as you begin to translate the recipes. You are amused, as they are clearly afraid of the dishes coming their way. You pour over the recipes, amazed at the wealth of local ingredients that they have found. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You sit down at the table, nervous about the “exotic” dishes that are surely coming your way. &lt;br&gt;
&lt;br&gt;
As you await the first course, you take the opportunity to enlist the help of your hosts. You present them with a draft of your guidebook and ask them to look over the details. You wouldn&#39;t want to get anything wrong! The Tlaxcalans appear annoyed at this suggestion, though they remain quiet.&lt;br&gt;
&lt;br&gt;
Your Aztec hosts grant your request and, in exchange, offer you a copy of a cookbook. It seems they have chosen to commemorate this event by recording tonight&#39;s recipes. You breathe a sigh of relief as Marina begins translating the recipes. You look out for items that you might want to avoid, but you also pay close attention to the local ingredients that they are using.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You sit down at the table, excited at the culinary wonders that are undoubtedly coming your way! &lt;br&gt;
&lt;br&gt;
As everyone awaits the first course, the Spaniards take the opportunity to enlist the help of your hosts. They present the Aztecs with a draft of the guidebook and ask them to look over the details. You are offended at the suggestion that you may have gotten any of the details wrong, but you stay quiet in an effort to keep the peace.&lt;br&gt;
&lt;br&gt;
Your Aztec hosts agree and, in exchange, offer you a copy of a cookbook. It seems they have chosen to commemorate this event by recording tonight&#39;s recipes. As Marina translates the recipes to your Spanish companions, you read over her shoulder, watching out for any local ingredients that you might have missed on your trip to the market today.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;
[[Continue on to the next page|Judging the Feast Documents]] to review the contributions and vote on their accuracy.
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="108" name="Faction Identification" tags="Coding-Problem" position="3875,1125" size="100,100">&lt;&lt;theyr&gt;&gt;
Welcome to the Spanish Aztec War! 
&lt;&lt;storeSet $charCreated=&quot;true&quot;&gt;&gt;
You are part of the &lt;&lt;print $users[$userId][&quot;faction&quot;]&gt;&gt;

Let me tell you a bit about your people: 
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot; &gt;&gt;
 You are the mighty Aztec Empire! You are conquerors of central Mexico, who have claimed vast stretches of territory and stricken fear into the hearts of your enemies--the delicious hearts of your enemies! It is now spring of 1519, and you&#39;ve received word that a group of strange men have landed on your shores. Reports indicate that these men do not come from neighboring states that remain to be conquered, but have instead arrived from the sea, traveling on small islands made of wood. They bring with them giant deer, like nothing seen before, and a group of Mayan slaves. You are curious about these visitors and send a delegation to investigate. What is their purpose here? 
 
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You are bold and noble Spaniards! You have set forth into the unknown to claim new lands for the Holy Roman Emperor, Charles V, and new converts to the Catholic faith. It is spring of 1519, and you have made your way up the coast of what appears to be an enormous landmass, into unknown territory. You have unfurled your flag, loudly proclaimed the requerimiento for all to hear, and have succeeded in establishing communication with the natives. And what they have said draws your attention. They tell you of a great city that lies to the west, a city full of gold and countless wonders. You can barely contain your excitement. And yet, there&#39;s one small problem: the King has only granted his permission to explore the coast and not to venture inland. You already left Cuba against the orders of the Governor, Diego Velazquez, who revoked his own permission shortly before you left. Will you risk violating the orders of the crown to pursue what may be little more than a rumor?

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
 You are indomitable Tlaxcalan warriors! For generations, you have fought back against the Aztecs and maintained your independence. It is now spring of 1519, and you&#39;ve received word that a group of strange men have landed on the shores to the east. Reports indicate that these men arrived from the sea, traveling on small islands made of wood. They bring with them giant deer, like nothing seen before, and a group of Mayan slaves. It is clear that they are no friends of yours, but are they friends of your enemies? When you hear that they plan to advance towards the Aztec capital of Tenochtitlán, you prepare yourself for battle, as it seems likely they will cross through your territory--a territory you have defended valiantly until now.
 
&lt;&lt;/switch&gt;&gt;

&lt;&lt;if $users[$userId][&quot;faction&quot;] is &quot;Aztecs&quot;&gt;&gt;
is Aztec
&lt;&lt;if ndef $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;] or $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;] eq &quot;&quot;&gt;&gt;
Aztec Strength Undefined
&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]=random(10,15)&gt;&gt;
 
&lt;&lt;/if&gt;&gt;
Your faction&#39;s starting strength is: &lt;&lt;print $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;] &gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $users[$userId][&quot;faction&quot;] is &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if ndef $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]  &gt;&gt;
&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]=random(10,15)&gt;&gt;
&lt;&lt;/if&gt;&gt;
Your faction&#39;s starting strength is: &lt;&lt;print $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;] &gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $users[$userId][&quot;faction&quot;] is &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if  ndef  $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;] &gt;&gt;
&lt;&lt;storeSet $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]=random(10,15)&gt;&gt;
&lt;&lt;/if&gt;&gt;
Your faction&#39;s starting strength is: &lt;&lt;print $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;] &gt;&gt;
&lt;&lt;/if&gt;&gt;

Now let&#39;s [[learn about your role|The Library]]!


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="109" name="Game Over: Aztecs Win La Noche Triste" tags="" position="4475,9850" size="100,100">&lt;&lt;theyr&gt;&gt;
Double-click this passage to edit it.


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="110" name="Game Over: Aztecs Win the Battle on the Causeway" tags="" position="3725,6700" size="100,100">&lt;&lt;theyr&gt;&gt;
Double-click this passage to edit it.


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="111" name="Game Setup" tags="" position="3725,725" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Check Player and Team Status and Location|Control: Player Status]]&lt;br&gt;
[[Check the Status of Holds and Votes|Control: Votes]]&lt;br&gt;
[[Return to the Dashboard|Dashboard]]&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="112" name="Garrido&#39;s Contribution" tags="" position="2300,8050" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Here you will find links to each entry of the Spanish guidebook, along with a special section written by your Tlaxcalan guests. You must read each entry and evaluate their descriptions. Are they accurate in their portrayals? &lt;br&gt;
&lt;br&gt;
To aid you in this task, go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán. You may also want to revisit other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
Marina&#39;s introduction is:  &lt;&lt;print &quot;$Ma_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Marina&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cortes&#39; entry is:  &lt;&lt;print &quot;$Co_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Cortes&#39; contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Alvarado&#39;s entry is:  &lt;&lt;print &quot;$Al_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Alvarado&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Aguilar&#39;s entry is:  &lt;&lt;print &quot;$Ag_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Aguilar&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Olid&#39;s entry is:  &lt;&lt;print &quot;$Ol_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Olid&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Garrido&#39;s entry is:  &lt;&lt;print &quot;$Ga_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Tlaxcalan&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Garrido&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Tlaxcalan&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Garrido&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
The Tlaxcalan&#39;s Insider&#39;s Guide is:  &lt;&lt;print &quot;$Tl_IG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="113" name="Generic New Spanish Leader" tags="" position="2800,5225" size="100,100">&lt;&lt;theyr&gt;&gt;
After much angry debate , you finally determine that &lt;&lt;print $Span_Leader&gt;&gt; has the greatest loyalty of his men, and you [[move forward under his leadership|Into the Mountain Pass]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="114" name="Generic Spanish Leadership Results" tags="" position="2800,5100" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;] and $Sp_Ld_Vote isnot 5&gt;&gt;
You wait nervously for your team to deliberate.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Span_Leader isnot $users[$userId][&quot;role&quot;] and $Sp_Ld_Vote isnot 5&gt;&gt;
When everyone has voted, you will deliver the news to &lt;&lt;print $Span_Leader&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Sp_Ld_Vote is 5&gt;&gt;

&lt;&lt;if $Sp_Ld_Cor &gt;=$Sp_Ld_Alv and $Sp_Ld_Cor &gt;=$Sp_Ld_Agu and $Sp_Ld_Cor &gt;=$Sp_Ld_Gar&gt;&gt;
&lt;&lt;if $Sp_Ld_Cor is 5 or $Sp_Ld_Alv is 5 or $Sp_Ld_Agu is 5 or $Sp_Ld_Gar is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Generic New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=3&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Generic New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Sp_Ld_Alv &gt;=$Sp_Ld_Cor and $Sp_Ld_Alv &gt;=$Sp_Ld_Agu and $Sp_Ld_Alv &gt;=$Sp_Ld_Gar&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;
&lt;&lt;if $Sp_Ld_Cor is 5 or $Sp_Ld_Alv is 5 or $Sp_Ld_Agu is 5 or $Sp_Ld_Gar is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Generic New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=3&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Generic New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Sp_Ld_Agu &gt;=$Sp_Ld_Cor and $Sp_Ld_Agu &gt;=$Sp_Ld_Alv and $Sp_Ld_Agu &gt;=$Sp_Ld_Gar&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;
&lt;&lt;if $Sp_Ld_Cor is 5 or $Sp_Ld_Alv is 5 or $Sp_Ld_Agu is 5 or $Sp_Ld_Gar is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Generic New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=3&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Generic New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Sp_Ld_Gar &gt;=$Sp_Ld_Cor and $Sp_Ld_Gar &gt;=$Sp_Ld_Alv and $Sp_Ld_Gar &gt;=$Sp_Ld_Agu&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;
&lt;&lt;if $Sp_Ld_Cor is 5 or $Sp_Ld_Alv is 5 or $Sp_Ld_Agu is 5 or $Sp_Ld_Gar is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Generic New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=3&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Generic New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="115" name="Happy" tags="Done" position="1075,300" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve gained a wisdom point! Your wisdom is now &lt;&lt;print $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;.&lt;br&gt;
&lt;br&gt;
A ship full of bearded men has been seen off the coast of Tulum. &lt;br&gt;
&lt;br&gt;
After eight years, you thought this day would never come! You can barely contain your excitement as you prepare for your escape.&lt;br&gt;
&lt;br&gt;
Translation: &lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;Yesterday, I was in the park where I met a man from Tulum. A few days ago, he was looking out to sea and saw a big house appear in the water. The house came closer and closer and the men of the city gathered to see the house. When the house got close they could see that it was full of men with pale skin and lots of hair. Tulum&#39;s men didn&#39;t know where this house came from, but they saw trouble. They made noise and fired rocks into the sea. The house turned back and disappeared.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Did they see the house another time? Do they know where it came from?&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;No. It is strange. I think we should keep watch.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Our men will go to the water to wait. If the house arrives on our water we will make them leave.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Now it is time to [[head to the coast |Aguilar Receives a Letter]]. You pack up and flee the village alone.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="116" name="Into Tenochtitlan" tags="" position="4375,6525" size="100,100">&lt;&lt;theyr&gt;&gt;
Double-click this passage to edit it.


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="117" name="Into the City" tags="" position="2300,6525" size="100,100">&lt;&lt;theyr&gt;&gt;
Together you make your way down the long causeway and enter the city of Tenochtitlán. As you look at the faces of the strangers in your midst you cannot help but wonder what this visit has in store for you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
It is now time to play the role of gracious hosts... just as soon as you deal with the Tlaxcalans in your presence. You place them under the supervision of Pochteca, who takes them to their quarters on the far side of the city.&lt;br&gt;
&lt;br&gt;
With the Tlaxcalans dispatched, you show the guests to their quarters, which have been prepared ahead of time to the highest of standards. They take in their surroundings, clearly impressed by all that has been laid out before them. You suggest that they rest a while, for there will be a great feast this evening, and you take your leave. The guards outside the door keep a close watch as you [[make your way to the palace|Aztecs Hold a Council]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] is &quot;Pochteca&quot;&gt;&gt;
It is now time to play the role of gracious hosts...just as soon as you deal with the Tlaxcalans in your presence. &lt;&lt;print $Aztec_Leader&gt;&gt; places them under your supervision, and instructs you to take them to their quarters on the far side of the city.&lt;br&gt;
&lt;br&gt;
As you leave with the Tlaxcalans, &lt;&lt;print $Aztec_Leader&gt;&gt; shows the guests to their quarters, which have been prepared ahead of time to the highest of standards. They take in their surroundings, clearly impressed by all that has been laid out before them. He suggests that they rest a while, for there will be a great feast this evening, and takes his leave. The guards outside the door keep a close watch as &lt;&lt;print $Aztec_Leader&gt;&gt; makes [[makes his way to the palace|Aztecs Hold a Council]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
It is now time to play the role of gracious hosts...just as soon as you deal with the Tlaxcalans in your presence. &lt;&lt;print $Aztec_Leader&gt;&gt; places them under the supervision of Pochteca, who takes them to their quarters on the far side of the city.&lt;br&gt;
&lt;br&gt;
With the Tlaxcalans dispatched, &lt;&lt;print $Aztec_Leader&gt;&gt; shows the guests to their quarters, which have been prepared ahead of time to the highest of standards. They take in their surroundings, clearly impressed by all that has been laid out before them. He suggests that they rest a while, for there will be a great feast this evening, and takes his leave. The guards outside the door keep a close watch as &lt;&lt;print $Aztec_Leader&gt;&gt; [[makes his way to the palace|Aztecs Hold a Council]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; himself escorts you to your quarters, an impressive space filled with sumptuous decor. You can&#39;t help but be impressed. You try to hide your amazement as you marvel at the wonders that surround you. &lt;&lt;print $Aztec_Leader&gt;&gt; suggests you rest a while, for there will be a great feast this evening. He then takes his leave, though you have no doubt that many eyes remain upon you.&lt;br&gt;
&lt;br&gt;
As you settle into your new lodgings, you are careful to place your weapons in the most strategic locations. Your hosts have been gracious so far, but you must [[remain on guard at all times|Spaniards Tour Tenochtitlan]].&lt;br&gt;&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
It is your first time in this great city, which you hope to explore to its fullest. You are not surprised when &lt;&lt;print $Aztec_Leader&gt;&gt; separates you from the Spaniards. As he escorts them to their quarters, you are placed in the care of an Aztec pochteca, who leads you to your own quarters on the other side of the city.&lt;br&gt;&lt;br&gt;

Your lodgings are sparse, but you have what you need. The pochteca allows you time to settle in before he offers to escort you to the market. You have heard many things about the great market at Tlatelolco but have never before been able to visit. You happily accept his offer and [[wonder what you will find|Tlaxcalans Visit Tlatelolco]]. &lt;br&gt;&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="118" name="Into the Mountain Pass" tags="Done" position="2300,5425" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
With the events of Cholula behind you, you now enter the mountain pass at the foot of a great volcano. Your guides tell you the name of this fiery mountain, Popocatépetl, and warn you of its danger. You watch smoke billow overhead as you make your way through the treacherous pass, at the head of any army 10,000 men strong. You will soon reach your destination and lay eyes on the great city of which you have heard so much.&lt;br&gt;
&lt;br&gt;
Your journey has been complicated so far, and it makes you think about what lies ahead. How do you feel heading down into the Valley of Mexico? How do you feel about your allies the Tlaxcalans? &lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and share your thoughts with your companions. &lt;br&gt;
&lt;br&gt;
When you are ready, you bed down for the night. Your guides tell you that you are close to the city and you wonder if this will be the last time you &lt;&lt;link &quot;make camp before your arrival&quot; &quot;Waking up in the library 3&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=0&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
With the events of Cholula behind you, you now enter the pass at the foot of the great fire mountain, Popocatépetl. You share tales of the mountain with your Spanish friends, who gaze in awe at the clouds of smoke that billow overhead. Tenochtitlán waits on the other side of the mountain and you will soon reach your destination, leading an army of 10,000 men.&lt;br&gt;
&lt;br&gt;
You&#39;ve thrown your lot in with the Spaniards, or have you? How have the events that unfolded at Cholula impacted your relationship with the Spaniards? Who holds the upper hand in this alliance you&#39;ve made?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and share your thoughts with your companions.&lt;br&gt;
&lt;br&gt;
When you are ready, you bed down for the night. You are close to the city and this may be the last time you &lt;&lt;link &quot;make camp before your arrival&quot; &quot;Waking up in the library 3&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=0&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
With the events of Cholula behind them, the allied forces head through the pass at the foot of the great smoking mountain, Popocatépetl. Your spies report an army of close to 10,000 men. It will not be long before they reach your shores.&lt;br&gt;
&lt;br&gt;
This army is nothing compared to your own, which is the most powerful force in all of history. Tlaxcala is a tiny city state compared to your massive empire and the foreigners are few in number. And yet, the events that have occurred so far may give you pause. How do you feel about their arrival? Is there any reason for concern?&lt;br&gt;
&lt;br&gt;
Go to the Aztec discussion board and share your thoughts with your companions.&lt;br&gt;
&lt;br&gt;
When you are ready, you bed down for the night. Your enemies are close and &lt;&lt;link &quot;you await their arrival&quot; &quot;Waking up in the library 3&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=0&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="119" name="Judging the Feast Documents" tags="" position="2300,7425" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Pochteca&quot;&gt;&gt;
Here you will find links to each recipe in the Aztec cookbook. You must read each recipe and judge them for accuracy. Have they properly sourced their ingredients or are there items here that can&#39;t be found in Tenochtitlán?  &lt;br&gt;
&lt;br&gt;
To aid you in this task, you may want to revisit Bernal Diaz&#39; account of Tenochtitlán. You may also want to read his account of the Aztec feast, visit the Codex Mendoza, and review other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
As you evaluate their work, they are also evaluating yours. Keep an eye on your points to see how you did&lt;br&gt;
&lt;br&gt;
Moctezuma&#39;s recipe is:  &lt;&lt;print &quot;$Moc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Cortes&#39; Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Cortes&#39; Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Tlacaelel&#39;s entry is:  &lt;&lt;print &quot;$Tlc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cuauhtemoc&#39;s entry is:  &lt;&lt;print &quot;$Cu_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cacamatzin&#39;s entry is:  &lt;&lt;print &quot;$Ca_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Aztec Priest&#39;s entry is:  &lt;&lt;print &quot;$AP_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Here you will find links to each entry of the Spanish guidebook, along with a special section written by your Tlaxcalan guests. You must read each entry and evaluate their descriptions. Are they accurate in their portrayals? &lt;br&gt;
&lt;br&gt;
To aid you in this task, go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán. You may also want to revisit other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
As you evaluate their work, they are also evaluating yours. Keep an eye on your points to see how you did&lt;br&gt;
&lt;br&gt;
Marina&#39;s introduction is:  &lt;&lt;print &quot;$Ma_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does she &lt;&lt;link &quot;PASS&quot; &quot;Cortes&#39; Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Cortes&#39; Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Cortes&#39; entry is:  &lt;&lt;print &quot;$Co_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Alvarado&#39;s entry is:  &lt;&lt;print &quot;$Al_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Aguilar&#39;s entry is:  &lt;&lt;print &quot;$Ag_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Olid&#39;s entry is:  &lt;&lt;print &quot;$Ol_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Garrido&#39;s entry is:  &lt;&lt;print &quot;$Ga_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Tlaxcalan&#39;s Insider&#39;s Guide is:  &lt;&lt;print &quot;$Tl_IG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot; OR &quot;Tlaxcalans&quot;&gt;&gt;
Here you will find links to each recipe in the Aztec cookbook. You must read each recipe and judge them for accuracy. Have they properly sourced their ingredients or are there items here that can&#39;t be found in Tenochtitlán?  &lt;br&gt;
&lt;br&gt;
To aid you in this task, you may want to revisit Bernal Diaz&#39; account of Tenochtitlán. You may also want to read his account of the Aztec feast, visit the Codex Mendoza, and review other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
As you evaluate their work, they are also evaluating yours. Keep an eye on your points to see how you did&lt;br&gt;
&lt;br&gt;
Moctezuma&#39;s recipe is:  &lt;&lt;print &quot;$Moc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Cortes&#39; Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Cortes&#39; Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Tlacaelel&#39;s entry is:  &lt;&lt;print &quot;$Tlc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cuauhtemoc&#39;s entry is:  &lt;&lt;print &quot;$Cu_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Cacamatzin&#39;s entry is:  &lt;&lt;print &quot;$Ca_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Aztec Priest&#39;s entry is:  &lt;&lt;print &quot;$AP_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="120" name="La Noche Triste" tags="" position="4300,9550" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Tlaxcalans Respond to La Noche Triste]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="121" name="Leadership After the Mutiny" tags="Done Breaks" position="1475,2125" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;=$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Olid&quot;&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;

&lt;&lt;/if&gt;&gt;

Your leader is: &lt;&lt;print$Span_Leader&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $TL_Attacks is &quot;No&quot;&gt;&gt;
You come together, putting the turmoil of the last few days behind you, and you [[gather yourselves for the journey ahead|The Spaniards Head Inland]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Aztecs&quot;&gt;&gt;

You come together, putting the turmoil of the last few days behind you, and you [[gather yourselves for the journey ahead|The Spaniards Head Inland]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Spanish&quot;&gt;&gt;

With this challenge passed, you thought the worst was over, however fate has [[other ideas|Tlaxcalans attack Cortes in Veracruz]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;

You come together, putting the turmoil of the last few days behind you, and you [[gather yourselves for the journey ahead|The Spaniards Head Inland]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $TL_Attacks eq &quot;&quot; or ndef $TL_Attacks&gt;&gt;

You stand awkwardly on the beach, wondering what lies ahead.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalan team to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="122" name="Making Plans for Cholula" tags="Done" position="2550,5100" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Cholula_Attack or $Cholula_Attack eq &quot;&quot;&gt;&gt;

You wait for &lt;&lt;print $Aztec_Leader&gt;&gt; to make a decision about how to approach the Spaniards, either in consultation with you, or alone.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Cholula_Attack is &quot;Yes&quot;&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; has decided that the best course of action is to go on the offensive! These strangers are a threat and they must be dealt with. &lt;br&gt;
&lt;br&gt;
Luckily for you, an opportunity has presented itself. Your spies have informed you that the strangers have made friends with your Tlaxcalan enemies and together they are headed for the city of Cholula. It was not so long ago that the Cholulans were friends of Tlaxcala, but there is now bad blood between them, for Cholula has sworn allegiance to you. It&#39;s time to put this new friendship to use.&lt;br&gt;
&lt;br&gt;
You send word to Cholula, telling them of the strangers who have befriended their Tlaxcalan foe. Together, &lt;&lt;link &quot;you lay plans for a trap&quot; &quot;Aztecs Lay a Trap in Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=4&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cholula_Attack is &quot;No&quot;&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; has decided that the best course of action is to be patient! You have not yet gathered sufficient information about the strangers.&lt;br&gt;
&lt;br&gt;
Luckily for you, an opportunity has presented itself. Your spies have informed you that the strangers have made friends with your Tlaxcalan enemies and together they are headed for the city of Cholula. It was not so long ago that the Cholulans were friends of Tlaxcala, but there is now bad blood between them, for Cholula has sworn allegiance to you. It&#39;s time to put this new friendship to use.&lt;br&gt;
&lt;br&gt;
You send word to Cholula, telling them of the strangers who have befriended their Tlaxcalan foe. &lt;&lt;link &quot;You enlist their help to gain intelligence&quot; &quot;Aztecs Gather Intelligence in Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=4&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="123" name="Malinalco" tags="Done Breaks" position="2525,300" size="100,100">To seek approval from the Gods, you must enter the mouth of the serpent. There, under the watchful eye of the eagles, you shall let your own blood in sacrifice.&lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Malinalco_Ans_A&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Malinalco 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_A&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Malinalco 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Malinalco_Ans_T&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Malinalco 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_T&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Malinalco 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="124" name="Malinalco 2" tags="Done Breaks" position="2675,300" size="100,100">&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;print $Malinalco_Ans_A&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Malinalco_Ans_A&gt;&gt;
&lt;&lt;storeSet $Malinalco_Ans_A = $Malinalco_Ans_A.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Malinalco_Ans_A or $Malinalco_Ans_A eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Malinalco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Malinalco_Ans_A is &quot;malinalco&quot; and $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! The Gods have given their blessing for your journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_A = $Quest_Points_A + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinalco_Ans_A is &quot;malinalco&quot; and $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! The Gods have given their blessing for your journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinalco_Ans_A isnot &quot;malinalco&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Malinalco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;print $Malinalco_Ans_T&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Malinalco_Ans_T&gt;&gt;
&lt;&lt;storeSet $Malinalco_Ans_T = $Malinalco_Ans_T.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Malinalco_Ans_T or $Malinalco_Ans_T eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Malinalco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinalco_Ans_T is &quot;malinalco&quot; and $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! The Gods have given their blessing for your journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_T = $Quest_Points_T + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinalco_Ans_T is &quot;malinalco&quot; and $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! The Gods have given their blessing for your journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinalco_Ans_T isnot &quot;malinalco&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Malinalco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="125" name="Malinche Answers" tags="" position="1800,275" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;No&quot; and $Malinche_2 is &quot;No&quot; and $Malinche_3 is &quot;No&quot;&gt;&gt;
You have not yet answered any questions correctly.  Please [[return and try again|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have recruited Marina! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. Remember what you learned here, as it might help you on your journey!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot;&gt;&gt;
You have answered question 1 correctly! Cholula has changed alliances! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_2 is &quot;Yes&quot;&gt;&gt;
You have answered question 2 correctly! The trader fears that the Aztecs will soon conquer Maya territory! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_3 is &quot;Yes&quot;&gt;&gt;
You have answered question 3 correctly! Tlaxcala might prove a valuable ally in the adventures to come! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Marina&quot;&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;No&quot; and $Malinche_2 is &quot;No&quot; and $Malinche_3 is &quot;No&quot;&gt;&gt;
You have not yet answered any questions correctly.  Please [[return and try again|Malinche Quest]] or [[start over|Spaniards Quest Instructions 2]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have earned the trust of the Spaniards! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. Remember what you learned here, as it might help you on your journey!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot;&gt;&gt;
You have answered question 1 correctly! Cholula has changed alliances! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_2 is &quot;Yes&quot;&gt;&gt;
You have answered question 2 correctly! The trader fears that the Aztecs will soon conquer Maya territory! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_3 is &quot;Yes&quot;&gt;&gt;
You have answered question 3 correctly! Tlaxcala might prove a valuable ally in the adventures to come! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;No&quot; and $Malinche_2 is &quot;No&quot; and $Malinche_3 is &quot;No&quot;&gt;&gt;
You have not yet answered any questions correctly.  Please [[return and try again|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have recruited Marina! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. Remember what you learned here, as it might help you on your journey!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot;&gt;&gt;
You have answered question 1 correctly! Cholula has changed alliances! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_2 is &quot;Yes&quot;&gt;&gt;
You have answered question 2 correctly! The trader fears that the Aztecs will soon conquer Maya territory! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_3 is &quot;Yes&quot;&gt;&gt;
You have answered question 3 correctly! Tlaxcala might prove a valuable ally in the adventures to come! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Alvarado&quot; or &quot;Olid&quot; or &quot;Garrido&quot;&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;No&quot; and $Malinche_2 is &quot;No&quot; and $Malinche_3 is &quot;No&quot;&gt;&gt;
You have not yet answered any questions correctly.  Please [[return and try again|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have recruited Marina! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. Remember what you learned here, as it might help you on your journey!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot;&gt;&gt;
You have answered question 1 correctly! Cholula has changed alliances! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_2 is &quot;Yes&quot;&gt;&gt;
You have answered question 2 correctly! The trader fears that the Aztecs will soon conquer Maya territory! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_3 is &quot;Yes&quot;&gt;&gt;
You have answered question 3 correctly! Tlaxcala might prove a valuable ally in the adventures to come! Please [[return and answer another question|Malinche Quest]] or [[start over and talk to Aguilar|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="126" name="Malinche Quest" tags="" position="1800,475" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
&lt;&lt;if ndef $Malinche_1 or $Malinche_1 eq &quot;&quot;&gt;&gt;
You must wait for Cortes to begin the quest.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have recruited Marina! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
To “unlock” Marina&#39;s character, you must interview her about some gossip she overheard. Interview her to find the answers to the following questions:&lt;br&gt; 
&lt;br&gt;

&lt;&lt;if $Malinche_1 is &quot;No&quot; or ndef $Malinche_1 or $Malinche_1 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Why has power shifted in the land of the mountains?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
Cholula has changed alliances.&lt;br&gt;
&lt;br&gt;
Tlaxcala and Cholula fought a battle against the Mexica.&lt;br&gt;
&lt;br&gt;
The Mexica and the Cholulans fought a battle against Tlaxcala.&lt;br&gt;
&lt;br&gt;
Tlaxcala invaded Cholula, angering the Mexica.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Malinche Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 1 correctly. Power has shifted in the land of the mountains because Choulula has changed alliances.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_2 is &quot;No&quot; or ndef $Malinche_2 or $Malinche_2 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Why is the trader worried?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
He can no longer trade with Cholula.&lt;br&gt;
&lt;br&gt;
He fears the war will spill over into Maya territory.&lt;br&gt;
&lt;br&gt;
He fears the Aztecs will soon conquer Maya territory.&lt;br&gt;
&lt;br&gt;
He fears he will lose his supply of cacao.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Malinche Answers]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;
You have answered Question 2 correctly. The trader fears that the Aztecs will soon conquor Maya territory.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Malinche_3 is &quot;No&quot; or ndef $Malinche_3 or $Malinche_3 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Given this information, who might make a valuable ally for the Spanish?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
Tlaxcala&lt;br&gt;
&lt;br&gt;
Cholula&lt;br&gt;
&lt;br&gt;
Both&lt;br&gt;
&lt;br&gt;
Neither&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Malinche Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 3 correctly. Tlaxcala might make a valuable ally.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Marina&quot;&gt;&gt;
&lt;&lt;if ndef $Malinche_1 or $Malinche_1 eq &quot;&quot;&gt;&gt;
You must wait for Cortes to begin the quest.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have been recruited by the Spaniards! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;b&gt;Trader:&lt;/b&gt;&lt;i&gt; Yaan ba&#39;atelil lu&#39;um le witso&#39;obo&#39;. U páajtalil táan u k&#39;éexel yéetel ku beta&#39;al túumben bix u bisikuba&#39;ob.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Merchant:&lt;/b&gt;&lt;i&gt; Máakalmáak u jaajil le ba&#39;atelil&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Trader:&lt;/b&gt;&lt;i&gt; U kaajil Cholula, otrora etail Tlaxcala, Bejla&#39;e&#39; u jach etail le mexicas.Tlaxcala chokoj Ba&#39;ale&#39; xan ti&#39; teme ti&#39; u páajtalil mexica.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Merchant:&lt;/b&gt;&lt;i&gt; Le mexicas ku ku k&#39;a&#39;ankach yéetel Amal ujo&#39;. Séeb Tlaxcala yaan k&#39;áate&#39; kaajo&#39; paach le kaambalil yo&#39;osal azteca.Le asab u yetailo&#39;ob Cholulan le ku xu&#39;ulsik.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Trader:&lt;/b&gt;&lt;i&gt; Le mexicas ken tijik u k&#39;aab Amal ka&#39;atéen asab lu&#39;um. Séeb u comerán le lu&#39;umo&#39; yéetel in lu&#39;um xan. K&#39;a&#39;abet wáaj k je&#39;ela&#39;.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Marina, you have been gifted to these strange men. Now is your chance to prove your worth. Go to the Discord discussion board, answer their questions, and demonstrate your gift for languages. When you are ready, you may [[see if you have gained their trust|Malinche Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
To “unlock” Marina&#39;s character, you must interview her about some gossip she overheard. &lt;b&gt; As the leader, note that ONLY YOUR answers will work to unlock the characters.&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
Interview her to find the answers to the following questions:&lt;br&gt; 
&lt;br&gt;
&lt;&lt;if $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have recruited Marina! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinche_1 is &quot;No&quot; or ndef $Malinche_1 or $Malinche_1 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Why has power shifted in the land of the mountains?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cholula has changed alliances&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_1=&quot;Yes&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=2&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlaxcala and Cholula fought a battle against the Mexica&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;The Mexica and the Cholulans fought a battle against Tlaxcala&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlaxcala invaded Cholula, angering the Mexica&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 1 correctly. Power has shifted in the land of the mountains because Choulula has changed alliances.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
 
&lt;&lt;if $Malinche_2 is &quot;No&quot; or ndef $Malinche_2 or $Malinche_2 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Why is the trader worried?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;He can no longer trade with Cholula&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;He fears the war will spill over into Maya territory&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;He fears the Aztecs will soon conquer Maya territory&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_2=&quot;Yes&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=2&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;He fears he will lose his supply of cacao&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 2 correctly. The trader fears that the Aztecs will soon conquor Maya territory.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Malinche_3 is &quot;No&quot; or ndef $Malinche_3 or $Malinche_3 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Given this information, who might make a valuable ally for the Spanish?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlaxcala&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=2&gt;&gt;&lt;&lt;storeSet $Malinche_3=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cholula&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_3=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Both&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_3=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Neither&quot; &quot;Malinche Answers&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_3=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 3 correctly. Tlaxcala might make a valuable ally.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Alvarado&quot; or &quot;Olid&quot; or &quot;Garrido&quot;&gt;&gt;
&lt;&lt;if ndef $Malinche_1 or $Malinche_1 eq &quot;&quot;&gt;&gt;
You must wait for Cortes to begin the quest.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Malinche_1 is &quot;Yes&quot; and $Malinche_2 is &quot;Yes&quot; and $Malinche_3 is &quot;Yes&quot;&gt;&gt;
Congratulations! You have recruited Marina! &lt;&lt;link &quot;You may now continue&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
To “unlock” Marina&#39;s character, you must interview her about some gossip she overheard. Interview her to find the answers to the following questions:&lt;br&gt; 
&lt;br&gt;
&lt;&lt;if $Malinche_1 is &quot;No&quot; or ndef $Malinche_1 or $Malinche_1 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Why has power shifted in the land of the mountains?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
Cholula has changed alliances.&lt;br&gt;
&lt;br&gt;
Tlaxcala and Cholula fought a battle against the Mexica.&lt;br&gt;
&lt;br&gt;
The Mexica and the Cholulans fought a battle against Tlaxcala.&lt;br&gt;
&lt;br&gt;
Tlaxcala invaded Cholula, angering the Mexica.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Malinche Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 1 correctly. Power has shifted in the land of the mountains because Choulula has changed alliances.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_2 is &quot;No&quot; or ndef $Malinche_2 or $Malinche_2 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Why is the trader worried?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
He can no longer trade with Cholula.&lt;br&gt;
&lt;br&gt;
He fears the war will spill over into Maya territory.&lt;br&gt;
&lt;br&gt;
He fears the Aztecs will soon conquer Maya territory.&lt;br&gt;
&lt;br&gt;
He fears he will lose his supply of cacao.&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Malinche Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 2 correctly. The trader fears that the Aztecs will soon conquor Maya territory.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $Malinche_3 is &quot;No&quot; or ndef $Malinche_3 or $Malinche_3 eq &quot;&quot;&gt;&gt;
&lt;b&gt;Given this information, who might make a valuable ally for the Spanish?&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
Tlaxcala&lt;br&gt;
&lt;br&gt;
Cholula&lt;br&gt;
&lt;br&gt;
Both&lt;br&gt;
&lt;br&gt;
Neither&lt;br&gt;
&lt;br&gt;
Check and see if [[Cortes answered the questions correctly|Malinche Answers]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have answered Question 3 correctly. Tlaxcala might make a valuable ally.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="127" name="Marina Hears a Real Rumor" tags="Done" position="1900,4300" size="100,100">&lt;&lt;theyr&gt;&gt;
You follow the wizened old woman around the corner, into a cramped alleyway. She informs you--and you alone--that the Spaniards have walked into a trap. The leaders of the city are planning an ambush and there is an Aztec army hidden nearby. &lt;br&gt;
&lt;br&gt;
Do you believe this woman or not? What will you do with the information? &lt;br&gt;
&lt;br&gt;
You have two choices, &lt;&lt;link &quot;you can share the information&quot; &quot;Marina responds to the attack&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Share=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; with your Spanish friends or you &lt;&lt;link &quot;can remain quiet&quot; &quot;Marina responds to the attack&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Share=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;, leaving their fate in the hands of the Cholulans.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="128" name="Marina Hears a Rumor" tags="Done" position="2025,4300" size="100,100">&lt;&lt;theyr&gt;&gt;
You follow the wizened old woman around the corner, into a cramped alleyway. She informs you--and you alone--that the Spaniards have walked into a trap. The leaders of the city are planning an ambush and there is an Aztec army hidden nearby. &lt;br&gt;
&lt;br&gt;
Do you believe this woman or not? What will you do with the information? &lt;br&gt;
&lt;br&gt;
You have two choices, &lt;&lt;link &quot;you can share the information&quot; &quot;Marina responds to the rumor&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Share=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; with your Spanish friends or you &lt;&lt;link &quot;can remain quiet&quot; &quot;Marina responds to the rumor&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Share=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;, leaving their fate in the hands of the Cholulans.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="129" name="Marina Tells Her Story" tags="Done Breaks" position="1375,975" size="100,100">The village is in a state of chaos and you hear that the Chontal elders have been trying to decide what they should do about these powerful foreigners. It is clear to everyone that they cannot risk losing hundreds more men in battle and there is little doubt that, even if the strange men leave, they will return again in the future. Not only would the Chontal people be vulnerable to the strangers, but the devastating losses would also weaken them in the face of their traditional enemies. The chiefs send a messenger to offer peace. &lt;br&gt;
&lt;br&gt;
Marina, you&#39;ve been writing your story and this is your chance to make yourself heard. Now that your story is assembled, you may enter the link for it here.  It will be shared with those you will meet in the coming days, so be sure it is complete, and be sure you&#39;ve represented yourself well.&lt;br&gt;
&lt;br&gt;
Put the link to your story here: &lt;br&gt;
&lt;br&gt;
&lt;&lt;textbox &quot;$Mal_Story&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
You only have one chance to tell your story. If you click through without completing your task, there will be a price to pay.&lt;br&gt;
&lt;br&gt;
Now that you&#39;ve augmented the historical record, [[you can move forward|Spaniards Meet Marina]].&lt;br&gt;
&lt;br&gt;</tw-passagedata><tw-passagedata pid="130" name="Marina Warns of No Attack" tags="Done" position="2150,4625" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Mal_Span is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
A mysterious woman has informed you that the Aztecs have laid a trap in Cholula. Given everything you know about them, you have all chosen to believe the rumor. You are now trapped within the city walls at the mercy of your hosts, and your allies wait outside. What is your best course of action?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and decide what you will do next. You have two options:&lt;br&gt;
&lt;br&gt;
Do you remain quiet,&lt;&lt;link &quot;concealing this knowledge from your hosts and waiting to see what unfolds&quot; &quot;Cholulans Don&#39;t Attack&quot;&gt;&gt;&lt;&lt;storeSet $Span_Cho_Att=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Or do you launch a preemptive attack, &lt;&lt;link &quot;laying siege to the Cholulans who laid the trap&quot; &quot;Spaniards Attack&quot;&gt;&gt;&lt;&lt;storeSet $Span_Cho_Att=&quot;Yes&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5)&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Span is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] isnot $Span_Leader&gt;&gt;
A mysterious woman has informed you that the Aztecs have laid a trap in Cholula. Given everything you know about them, you have all chosen to believe the rumor. You are now trapped within the city walls at the mercy of your hosts, and your allies wait outside. What is your best course of action?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and decide what you will do next. You have two options, and you must convince &lt;&lt;print $Span_Leader&gt;&gt; to do what you think is best.&lt;br&gt;
&lt;br&gt;
Do you remain quiet concealing this knowledge from your hosts and waiting to see what unfolds?&lt;br&gt;
&lt;br&gt;
Or do you launch a preemptive attack, laying siege to the Cholulans who laid the trap?&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Span_Cho_Att eq &quot;&quot; or ndef $Span_Cho_Att&gt;&gt;
You must wait for &lt;&lt;print $Span_Leader&gt;&gt; to announce his decision.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Span_Cho_Att is &quot;Yes&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has decided that you will [[go on the offensive|Spaniards Attack]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Span_Cho_Att is &quot;No&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has decided that you will [[wait and see what happens|Cholulans Don&#39;t Attack]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;elseif $Mal_Span is &quot;No&quot;&gt;&gt;
A mysterious woman has informed you that the Aztecs have laid a trap in Cholula. Given everything you know about them, you have all chosen not to believe the rumor. &lt;br&gt;
&lt;br&gt;
You go to bed hopeful that you have [[read the situation correctly|Cholulans Don&#39;t Attack]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="131" name="Marina Warns of the Attack" tags="Done" position="1675,4650" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Mal_Span is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
A mysterious woman has informed you that the Aztecs have laid a trap in Cholula. Given everything you know about them, you have all chosen to believe the rumor. You are now trapped within the city walls at the mercy of your hosts, and your allies wait outside. What is your best course of action?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and decide what you will do next. You have two options:&lt;br&gt;
&lt;br&gt;
Do you remain quiet, &lt;&lt;link &quot;concealing this knowledge from your hosts and waiting to see what unfolds&quot; &quot;Cholulans Attack&quot;&gt;&gt;&lt;&lt;storeSet $Span_Cho_Att=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=5)&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Or do you launch a preemptive attack, &lt;&lt;link &quot;laying siege to the Cholulans who laid the trap&quot; &quot;Spaniards Attack&quot;&gt;&gt;&lt;&lt;storeSet $Span_Cho_Att=&quot;Yes&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5)&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Span is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] isnot $Span_Leader&gt;&gt;
A mysterious woman has informed you that the Aztecs have laid a trap in Cholula. Given everything you know about them, you have all chosen to believe the rumor. You are now trapped within the city walls at the mercy of your hosts, and your allies wait outside. What is your best course of action?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and decide what you will do next. You have two options, and you must convince &lt;&lt;print $Span_Leader&gt;&gt; to do what you think is best.&lt;br&gt;
&lt;br&gt;
Do you remain quiet concealing this knowledge from your hosts and waiting to see what unfolds?&lt;br&gt;
&lt;br&gt;
Or do you launch a preemptive attack, laying siege to the Cholulans who laid the trap?&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Span_Cho_Att eq &quot;&quot; or ndef $Span_Cho_Att&gt;&gt;
You must wait for &lt;&lt;print $Span_Leader&gt;&gt; to announce his decision.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Span_Cho_Att is &quot;Yes&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has decided that you will [[go on the offensive|Spaniards Attack]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Span_Cho_Att is &quot;No&quot;&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has decided that you will [[wait and see what happens|Cholulans Attack]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;elseif $Mal_Span is &quot;No&quot;&gt;&gt;
A mysterious woman has informed you that the Aztecs have laid a trap in Cholula. Given everything you know about them, you have all chosen not to believe the rumor. &lt;br&gt;
&lt;br&gt;
You go to bed hopeful that you have [[read the situation correctly|Cholulans Attack]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="132" name="Marina in Slavery" tags="Done" position="2350,50" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Start &lt;=10&gt;&gt;
You must wait for all the team members to gather for gameplay to begin.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Start &gt;=5&gt;&gt;

You have been living as a slave among the Chontal Maya for many years now, but you have never forgotten your past life. Born into a noble Nahua family, you were taught many valuable lessons and were respected in your community for your wit and intelligence even at a young age. Among the many things you have acquired in your years as a slave is a facility with the Mayan language, so different from the Nahuatl with which you were raised.&lt;br&gt;
&lt;br&gt;
Today, like every other day, you rose before the sun to begin your chores. As you set to work grinding your corn, however, you find a crack in your metate and set off for the market to purchase a new one. While you were in the market, you overheard a conversation between a local merchant and a trader from Yucatan. Here is what they said:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Trader:&lt;/b&gt;&lt;i&gt; Yaan ba&#39;atelil lu&#39;um le witso&#39;obo&#39;. U páajtalil táan u k&#39;éexel yéetel ku beta&#39;al túumben bix u bisikuba&#39;ob.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Merchant:&lt;/b&gt;&lt;i&gt; Máakalmáak u jaajil le ba&#39;atelil&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Trader:&lt;/b&gt;&lt;i&gt; U kaajil Cholula, otrora etail Tlaxcala, Bejla&#39;e&#39; u jach etail le mexicas.Tlaxcala chokoj Ba&#39;ale&#39; xan ti&#39; teme ti&#39; u páajtalil mexica.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Merchant:&lt;/b&gt;&lt;i&gt; Le mexicas ku ku k&#39;a&#39;ankach yéetel Amal ujo&#39;. Séeb Tlaxcala yaan k&#39;áate&#39; kaajo&#39; paach le kaambalil yo&#39;osal azteca.Le asab u yetailo&#39;ob Cholulan le ku xu&#39;ulsik.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Trader:&lt;/b&gt;&lt;i&gt; Le mexicas ken tijik u k&#39;aab Amal ka&#39;atéen asab lu&#39;um. Séeb u comerán le lu&#39;umo&#39; yéetel in lu&#39;um xan. K&#39;a&#39;abet wáaj k je&#39;ela&#39;.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Once you have figured out what they said, you may continue. But [[make note of this information, because it could be important later on|Spaniards Quest Instructions 1]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="133" name="Marina responds to the attack" tags="Done" position="1850,4400" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Mal_Share is &quot;No&quot;&gt;&gt;
You have decided to keep this information to yourself. You go to bed, wondering &lt;&lt;link &quot;what the Gods have in store for you&quot; &quot;A Trap in Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:-3,&quot;Loyalty&quot;:-3,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mal_Share is &quot;Yes&quot;&gt;&gt;
You have decided to share the rumor with your Spanish friends. You make your way to their sleeping quarters &lt;&lt;link &quot;and quietly rouse them&quot; &quot;A Trap in Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:3,&quot;Loyalty&quot;:3,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;, careful not to wake your Cholulan hosts.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="134" name="Marina responds to the rumor" tags="Done" position="2050,4400" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Mal_Share is &quot;No&quot;&gt;&gt;
You have decided to keep this information to yourself. You go to bed, wondering &lt;&lt;link &quot;what the Gods have in store for you&quot; &quot;No Trap in Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:3,&quot;Loyalty&quot;:-3,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mal_Share is &quot;Yes&quot;&gt;&gt;
You have decided to share the rumor with your Spanish friends. You make your way to their sleeping quarters &lt;&lt;link &quot;and quietly rouse them&quot; &quot;No Trap in Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:-3,&quot;Loyalty&quot;:3,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;,  careful not to wake your Cholulan hosts.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="135" name="Marina the Independent Woman" tags="Done" position="1975,2950" size="100,100">&lt;&lt;theyr&gt;&gt;
You would rather go it alone than subject yourself to the whims and desires of such brutish men. You worry about what might come next, but you are confident that your wits have gotten you this far.&lt;br&gt;
&lt;br&gt;
You rise from your sleeping mat to build a fire. Soon, the rest of camp begins to stir.  You help the other women pack up so that you can [[continue your journey|On the way to Puebla]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="136" name="Marina&#39;s Boyfriend" tags="Done" position="1750,2950" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
Having made your decision, you quietly make your way to &lt;&lt;print $Mal_Boy&gt;&gt;. He wakes with a start, but calms when he realizes it&#39;s you.&lt;br&gt;
&lt;br&gt;
You make your way back to your own bed just before the sun rises. You hope you&#39;ve made the right choice. You help the other women pack up camp and prepare to [[continue your journey|On the way to Puebla]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Are you back in the library? No, you hear the snoring of the other men nearby.  You shift, wondering what woke you.  You experience a moment of brief panic, and then you realize that it is Marina, lying next to you.&lt;br&gt;
&lt;br&gt;
You can&#39;t believe your luck!&lt;br&gt;
&lt;br&gt;
Morning comes too soon, and you reluctantly pack up camp to [[continue your journey|On the way to Puebla]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="137" name="Marina&#39;s Choice" tags="Done" position="1975,2825" size="100,100">&lt;&lt;theyr&gt;&gt;
You wake to the sound of snoring and open your eyes to find you are back at camp. You feel the hard ground beneath you and look up at the stars. You&#39;ve never seen a night so clear. The horses rest nearby and the men sleep in the open, scattered around the site. As you lay in the dark, you reflect upon the events that have brought you here and you ponder your situation...Marina&#39;s that is.&lt;br&gt;
&lt;br&gt;
So far, you&#39;ve made smart decisions. Your language skills have made you invaluable to these foreigners and you are already starting to understand their strange tongue. Once you can communicate with them directly, your worth will only increase. Not only have they made it clear how important you are to the team, they have each indicated their...personal appreciation of you...some more aggressively than others. Though their affections are worrisome, and even outright frightening, you wonder if this might work to your advantage. Would it be to your benefit to form a relationship with one of these men? If so, which one? Or are you better off fending for yourself? &lt;br&gt;
&lt;br&gt;
You lie awake for hours, weighing this question carefully. Shortly before the sun rises, you make your choice:&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cortes&quot; &quot;Marina&#39;s Boyfriend&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Boy=&quot;Cortes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Alvarado&quot; &quot;Marina&#39;s Boyfriend&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Boy=&quot;Alvarado&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Aguilar&quot; &quot;Marina&#39;s Boyfriend&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Boy=&quot;Aguilar&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Garrido&quot; &quot;Marina&#39;s Boyfriend&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Boy=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Olid&quot; &quot;Marina&#39;s Boyfriend&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Boy=&quot;Olid&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;You are going to go it alone&quot; &quot;Marina the Independent Woman&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Boy=&quot;alone&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="138" name="Master Spanish Faction Leadership Test All" tags="" position="3725,1200" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;=$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Cortes&quot;&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Olid&quot;&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;

&lt;&lt;/if&gt;&gt;




Your new leader is: &lt;&lt;print$Span_Leader&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="139" name="Maya Gossip" tags="Done" position="1925,175" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;Jo&#39;oljeak, táan te&#39; k&#39;íiwiko&#39; tu&#39;ux tin k&#39;ajóoltaj u juntúul máak Tulum. Ku beetik jump&#39;éel k&#39;iino&#39;ob, táan paakat le k&#39;áak&#39;náabo&#39; ka tu yilaj jump&#39;éel nuxi&#39; naj chíikpajal ichil le ja&#39;o&#39;. Le najo&#39; Náats&#39; Amal ka&#39;atéen asab yéetel xiibo&#39;obo&#39; le kaajo&#39; múuch&#39;o&#39;ob utia&#39;al in wil le najo&#39;. Ka le najo&#39; Náats&#39; páajchajo&#39;obij wil táan Chuup yéetel wíiniko&#39;ob yéetel yoot&#39;el n wíinkilil yéetel ya&#39;ab tso&#39;otsel. Xiibo&#39;obo&#39; Tulum ma&#39; sabían tu&#39;ux venía le naja&#39;, ba&#39;ale&#39; tu yilo&#39;ob toop. Tu beetajo&#39;ob juum ka menta&#39;abij tunicho&#39;ob ti&#39; le k&#39;áak&#39;náabo&#39;. Le najo&#39; sunaj ka lanchajal. &lt;/i&gt; &lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Ba&#39;ax ts&#39;o&#39;ok u yilik le najo&#39; ti&#39; uláak&#39; ba&#39;ali&#39;. Yojlo&#39;ob tu&#39;ux tali&#39;.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;lol Jach jela&#39;an. In wa&#39;alike&#39; u K&#39;a&#39;abeta Jach yila&#39;al.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;K wíiniko&#39;ob yan u bino&#39;ob ja&#39; pa&#39;atik. Wa le najo&#39; k&#39;uchul yóok&#39;ol le ja&#39; ti&#39; leti&#39;ob ko&#39;on jóok&#39;ol.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Once you have figured out what they said, [[you may continue|Spaniards Quest Instructions 1]].
&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="140" name="Maya Gossip Response" tags="Done" position="1150,175" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve mulled over what you heard while sweeping the temple steps.  How are you feeling right now? &lt;br&gt;
&lt;br&gt;
This exchange &lt;&lt;link &quot;makes you really angry&quot; &quot;Angry&quot;&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;
You can&#39;t believe how &lt;&lt;link &quot;happy this makes you&quot; &quot;Happy&quot;&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+=1&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;
What they said is leaving you feeling &lt;&lt;link &quot;very scared&quot; &quot;Scared&quot;&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;
These rumors &lt;&lt;link &quot;make you sad&quot; &quot;Sad&quot;&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="141" name="Moctezuma Confidence Vote" tags="Done" position="2375,3250" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Moc_Mut_Vote isnot 5&gt;&gt;
You wait while your fellow counselors cast their vote.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $MocMut_Moc is 5&gt;&gt;&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Moctezuma&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Mut=&quot;Unanimous&quot;&gt;&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $MocMut_Tla is 5&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;storeSet $Aztec Leader=&quot;Tlacaelel&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Mut=&quot;Unanimous&quot;&gt;&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $MocMut_Cua is 5&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=5&gt;&gt;&lt;&lt;storeSet $Aztec Leader=&quot;Cuauhtemoc&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Mut=&quot;Unanimous&quot;&gt;&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $MocMut_Moc &gt;=3&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Moctezuma&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Mut=&quot;Win&quot;&gt;&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $MocMut_Tla &gt;=3&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Tlacaelel&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Mut=&quot;Win&quot;&gt;&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $MocMut_Cua &gt;=3&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Cuauhtemoc&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Mut=&quot;Win&quot;&gt;&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $MocMut_Moc &lt;=2 and $MocMut_Tla &lt;=2 and $MocMut_Cua &lt;=2&gt;&gt;&lt;&lt;storeSet $Aztec_Leader=&quot;Moctezuma&quot;&gt;&gt;&lt;&lt;storeSet $Aztec_Mut=&quot;Draw&quot;&gt;&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
&lt;&lt;if $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;

You enter the chamber, where your council awaits. They have considered your proclamation and all are in agreement with it. &lt;br&gt;
&lt;br&gt;
Your people have great faith in you! Not only do you maintain your place as their trusted leader, you also earn 5 loyalty points.&lt;br&gt;
&lt;br&gt;
Your faction is clearly united and in unity there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You enter the chamber, where your council awaits. They have considered your proclamation and have voted in favor, though not all are in agreement.&lt;br&gt;
&lt;br&gt;
You will continue to lead your people, though you do not have the loyalty of everyone. You have gained 1 loyalty point for every team member who supports you.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Draw&quot;&gt;&gt;
You enter the chamber, where your council awaits. They have considered your proclamation and have voted against it.&lt;br&gt; 
&lt;br&gt;
You have lost the faith of your people! You&#39;re in luck, however, for no-one else has earned their loyalty. You will continue to lead, but your position is tenuous.&lt;br&gt;
&lt;br&gt;
There is dissent in your ranks. Your team has lost 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader isnot &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You enter the chamber, where your council awaits. They have considered your proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
You have lost the faith of your people! They have put their trust in &lt;&lt;print $Aztec_Leader&gt;&gt; instead.&lt;br&gt;
&lt;br&gt;
Though your people have turned against you, they are united in their decision. In unity, there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader isnot &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You enter the chamber, where your council awaits. They have considered your proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
You have lost the faith of your people! They have put their trust in &lt;&lt;print $Aztec_Leader&gt;&gt; instead, but not all are in agreement. Your loyalty points will indicate where you stand.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlacaelel&quot;&gt;&gt;
&lt;&lt;if $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and all are in agreement with it.&lt;br&gt;
&lt;br&gt;
You must have great faith in Moctezuma&#39;s leadership! Your faction is clearly united and in unity there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted in favor, but not all are in agreement.&lt;br&gt;
&lt;br&gt;
Moctezuma will continue to lead, though it is possible that some would rather look to you. If so, your loyalty points will reflect this.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Draw&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it.&lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people, but there is no clear leader to take his place and he remains in power. Though some would rather look to you, it is not yet a majority. Your loyalty points will indicate where you stand.&lt;br&gt;
&lt;br&gt;
There is dissent in your ranks. Your team has lost 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Tlacaelel&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! They have put their trust in you instead, and have done so unanimously. You have gained 5 loyalty points.&lt;br&gt;
&lt;br&gt;
Though your people have overthrown their emperor, they are united in this decision. In unity, there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Tlacaelel&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! They have put their trust in you instead, but not all are in agreement. Your loyalty points will indicate where you stand.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Cuauhtemoc&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! You have put your trust in &lt;&lt;print $Azted_Leader&gt;&gt; instead.&lt;br&gt;
&lt;br&gt;
Though you have overthrown your emperor, you are united in this decision. In unity, there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Cuauhtemoc&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! They have put their trust &lt;&lt;print $Aztec_Leader&gt;&gt; instead, but not all are in agreement. Your loyalty points will indicate where you stand.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Cuauhtemoc&quot;&gt;&gt;
&lt;&lt;if $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and all are in agreement with it.&lt;br&gt;
&lt;br&gt;
You must have great faith in Moctezuma&#39;s leadership! Your faction is clearly united and in unity there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted in favor, but not all are in agreement.&lt;br&gt;
&lt;br&gt;
Moctezuma will continue to lead, though it is possible that some would rather look to you. If so, your loyalty points will reflect this.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Draw&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it.&lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people, but there is no clear leader to take his place and he remains in power. Though some would rather look to you, it is not yet a majority. Your loyalty points will indicate where you stand.&lt;br&gt;
&lt;br&gt;
There is dissent in your ranks. Your team has lost 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Cuauhtemoc&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! They have put their trust in you instead, and have done so unanimously. You have gained 5 loyalty points.&lt;br&gt;
&lt;br&gt;
Though your people have overthrown their emperor, they are united in this decision. In unity, there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Cuauhtemoc&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! They have put their trust in you instead, but not all are in agreement. Your loyalty points will indicate where you stand.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Tlacaelel&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! You have put your trust in &lt;&lt;print $Aztec_Leader&gt;&gt; instead. &lt;br&gt;
&lt;br&gt;
Though you have overthrown your emperor, you are united in this decision. In unity, there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Tlacaelel&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! They have put their trust &lt;&lt;print $Aztec_Leader&gt;&gt; instead, but not all are in agreement. Your loyalty points will indicate where you stand.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztec_Priest&quot; or &quot;Cacamatzin&quot; or &quot;Pochteca&quot;&gt;&gt;
&lt;&lt;if $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and all are in agreement with it.&lt;br&gt;
&lt;br&gt;
You must have great faith in Moctezuma&#39;s leadership! Your faction is clearly united and in unity there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted in favor, but not all are in agreement.&lt;br&gt;
&lt;br&gt;
Moctezuma will continue to lead, though some of you may wish otherwise.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader is &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Draw&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it.&lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people, but there is no clear leader to take his place. He maintains his position, for now.&lt;br&gt;
&lt;br&gt;
There is dissent in your ranks. Your team has lost 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader isnot &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Unanimous&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! You have put your trust in &lt;&lt;print $Aztec_Leader&gt;&gt; instead.&lt;br&gt;
&lt;br&gt;
Though you have overthrown your emperor, you are united in this decision. In unity, there is strength. Your team has gained 5 strength points.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5 and $Aztec_Leader isnot &quot;Moctezuma&quot; and $Aztec_Mut is &quot;Win&quot;&gt;&gt;
You invite Moctezuma into the chamber, where the council awaits. You have considered his proclamation and have voted against it. &lt;br&gt;
&lt;br&gt;
Moctezuma has lost the faith of his people! You have put your trust in &lt;&lt;print $Aztec_Leader&gt;&gt; instead, but not all are in agreement. &lt;&lt;print $Aztec_Leader&gt;&gt; will take power...for now.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;

With this decided, how will you [[engage with the strangers|Aztec Leader Makes a Choice]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="142" name="Moctezuma Makes his Proclamation" tags="Done" position="2375,3125" size="100,100">&lt;&lt;theyr&gt;&gt;
You may read Moctezuma&#39;s Proclamation here:  &lt;&lt;print $Moc_Proc&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlacaelel&quot; or &quot;Cuauhtemoc&quot; or &quot;Cacamatzin&quot; or &quot;Aztec_Priest&quot; or &quot;Pochteca&quot;&gt;&gt;
You read Moctezuma&#39;s Proclamation, and you gather together in Council, this time without Moctezuma present. &lt;br&gt;
&lt;br&gt;
The arrival of the strangers and mysterious omens have left everybody unsettled. How should you proceed? Does Moctezuma&#39;s Proclamation inspire confidence, or is it time to choose a new leader? In this strange new world, who will you follow?&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Moctezuma&quot; &quot;Moctezuma Confidence Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocMut_Moc = $MocMut_Moc + 1&gt;&gt;&lt;&lt;storeSet $Moc_Mut_Vote = $Moc_Mut_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Moctezuma&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; retains your loyalty, you trust his leadership. &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Tlacaelel&quot; &quot;Moctezuma Confidence Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocMut_Tla = $MocMut_Tla + 1&gt;&gt;&lt;&lt;storeSet $Moc_Mut_Vote = $Moc_Mut_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; has shown great leadership. You vote for him. &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Cuauhtemoc&quot; &quot;Moctezuma Confidence Vote&quot;&gt;&gt;&lt;&lt;storeSet $MocMut_Cua = $MocMut_Cua + 1&gt;&gt;&lt;&lt;storeSet $Moc_Mut_Vote = $Moc_Mut_Vote + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; is clearly the one to lead you through these strange times. 

&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
&lt;&lt;if $Moc_Mut_Vote isnot 5&gt;&gt;
You wait, on edge, wondering what the reception of your proclamation will be. You know that your counselors are meeting without you, but about what?&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for your team members to all vote.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Moc_Mut_Vote is 5&gt;&gt;
After meeting without you, your counselors call you [[into the chamber|Moctezuma Confidence Vote]].
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="143" name="Moctezuma Respectfully Asks the Spaniards and their Allies to Leave" tags="" position="4050,6375" size="100,100">&lt;&lt;theyr&gt;&gt;
Causeway leading into Tenochtitlán, November 8th, 1519

 

The Emperor Moctezuma has respectfully greeted his visitors, presenting them with lavish gifts. As the end of their meeting approaches, he asks the Spaniards to kindly leave his city and take their Tlaxcalan friends with them. 
 

Spaniards, you must decide how to respond and post your decision to the Go to the main discussion board. You have 2 choices:
 

Option 1: Attack the Aztecs and ask your Tlaxcalan allies to join you.
 

Option 2: Return to Tlaxcala.

[[Battle on the Causeway: Spaniards Attack]] 

[[Spaniards Return to Tlaxcala]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="144" name="Moctezuma&#39;s Arrest:  The Aztecs React" tags="" position="4400,9125" size="100,100">&lt;&lt;theyr&gt;&gt;
[[The Festival of Toxcatl]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="145" name="Moctezuma&#39;s Arrest: Spaniards explain themselves to Tlaxcala" tags="" position="4200,9125" size="100,100">&lt;&lt;theyr&gt;&gt;
[[The Festival of Toxcatl]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="146" name="Mutiny Outcome" tags="" position="1925,1875" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
&lt;&lt;if $Mutiny_Voted &lt;4&gt;&gt;
You must wait until all the Spaniards have decided where their loyalties lie.&lt;br&gt;
&lt;br&gt; 
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Mutiny_Voted &gt;=4&gt;&gt;
&lt;&lt;if $Mut_Cor &gt;=2&gt;&gt;
It seems you have retained the faith of your men…for now. Perhaps you were a little impulsive when you decided to beach the ships. You hope that doesn&#39;t come back to hurt you later, but you cannot let that distract you. You wait for the rest of the crew to learn their fate as you [[begin planning your next steps|Spaniards Cannot Go Back]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mut_Olid &gt;2&gt;&gt;
It seems your efforts have failed. There has been a mutiny! Olid has taken control of the men. You choke back your anger and take some small satisfaction in the horror that surely awaits the others when they &lt;&lt;link &quot;learn what you&#39;ve done&quot; &quot;Spaniards Cannot Go Back&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Olid&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Olid&quot;&gt;&gt;
&lt;&lt;if $Mutiny_Voted &lt;4&gt;&gt;
You must wait until all the Spaniards have decided where their loyalties lie. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Mutiny_Voted &gt;=4&gt;&gt;
&lt;&lt;if $Mut_Cor &gt;=2&gt;&gt;
Your efforts have failed and the men have remained loyal to Cortés. You curse your luck and await your next opportunity. Surely the others will see him for [[the fool he is eventually|Spaniards Cannot Go Back]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mut_Olid &gt;2&gt;&gt;
You have convinced the men to mutiny! You watch in glee as Cortés learns the news and the look on his face is everything you hoped for. You begin plotting your next steps, eager to claim the rewards that &lt;&lt;link &quot;await you in Tenochtitlán&quot; &quot;Spaniards Cannot Go Back&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Olid&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt; 
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Marina&quot; or &quot;Aguilar&quot; or &quot;Garrido&quot; or &quot;Alvarado&quot;&gt;&gt;
&lt;&lt;if $Mutiny_Voted &lt;4&gt;&gt;
You must wait until all the Spaniards have decided where their loyalties lie.&lt;br&gt;
&lt;br&gt; 
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Mutiny_Voted &gt;=4&gt;&gt;
&lt;&lt;if $Mut_Cor &gt;=2&gt;&gt;
You have remained loyal to Cortés. Despite his flaws, your team has chosen to leave him in charge. You hope you won&#39;t come to [[regret your decision|Spaniards Cannot Go Back]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mut_Olid &gt;2&gt;&gt;
You have voted to mutiny! Cortés is livid at the turn of events, while Olid seems giddy. You wonder if Cortes will &lt;&lt;link &quot;part ways with the crew or concede to Olid&#39;s authority&quot; &quot;Spaniards Cannot Go Back&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Olid&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt; 
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="147" name="Mutiny Vote" tags="" position="1775,1750" size="100,100">&lt;&lt;theyr&gt;&gt;
You have heard what Cortés and Olid had to say and now it is time to decide: which do you trust to lead you to glory?&lt;br&gt;
&lt;br&gt;

Vote &lt;&lt;link &quot;Cortes&quot; &quot;Mutiny Outcome&quot;&gt;&gt;&lt;&lt;storeSet $Mut_Cor = $Mut_Cor + 1&gt;&gt;&lt;&lt;storeSet $Mutiny_Voted = $Mutiny_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
Vote &lt;&lt;link &quot;Olid&quot; &quot;Mutiny Outcome&quot;&gt;&gt;&lt;&lt;storeSet $Mut_Olid = $Mut_Olid + 1&gt;&gt;&lt;&lt;storeSet $Mutiny_Voted = $Mutiny_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="148" name="Mutiny in Veracruz" tags="Done Breaks" position="1525,1675" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Olid&quot;&gt;&gt;

Olid, you&#39;ve talked to the men, and you&#39;ve done your best to convince them to mutiny.  But how do you feel about it?  Are you going to go through with your plans?&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Yes&quot; &quot;Burning the Ships&quot;&gt;&gt;&lt;&lt;storeSet $Mutiny_Voted = $Mutiny_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;No&quot; &quot;Burning the Ships&quot;&gt;&gt;&lt;&lt;storeSet $Mutiny = $Mutiny + -10&gt;&gt;&lt;&lt;storeSet $Mutiny_Voted = $Mutiny_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Marina&quot; or &quot;Alvarado&quot; or &quot;Aguilar&quot; or &quot;Garrido&quot;&gt;&gt;
Olid has tried to convince you to mutiny, but it is a risky path. Will you join him in his bid for power and control?&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Yes&quot; &quot;Burning the Ships&quot;&gt;&gt;&lt;&lt;storeSet $Mutiny = $Mutiny + 1&gt;&gt;&lt;&lt;storeSet $Mutiny_Voted = $Mutiny_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;No&quot; &quot;Burning the Ships&quot;&gt;&gt;&lt;&lt;storeSet $Mutiny_Voted = $Mutiny_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="149" name="Name Not Recognized" tags="" position="4450,1200" size="100,100">/* &lt;&lt;for _i, _name range $users&gt;&gt;
	&lt;&lt;if  _name.role==&quot;Cuauhtemoc&quot;&gt;&gt;
	&lt;&lt;storeSet _CuauhtemocId=_i&gt;&gt;
		&lt;&lt;storeSet $users[_CuauhtemocId][&quot;stats&quot;][&quot;strength&quot;]+=2&gt;&gt;
	&lt;&lt;/if&gt;&gt;
	&lt;&lt;/for&gt;&gt; */


&lt;&lt;theyr&gt;&gt;
Name not recognized. Make sure the spelling on your character&#39;s name matches your role. &lt;br&gt;

&lt;u&gt; Roles &lt;/u&gt; &lt;br&gt;
Marina &lt;br&gt;
Alvarado &lt;br&gt;
Aguilar &lt;br&gt; 
Garrido &lt;br&gt;
Olid &lt;br&gt; 
Moctezuma &lt;br&gt;
Tlacaelel &lt;br&gt;
Cuauhtemoc &lt;br&gt; 
Aztec_Priest &lt;br&gt;
Cacamatzin &lt;br&gt;
Pochteca &lt;br&gt;
Xicotencatl_Elder &lt;br&gt;
Xicotencatl_Younger &lt;br&gt;
Maxixcatl

&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="150" name="New Aztec Leader" tags="" position="2450,7050" size="100,100">&lt;&lt;theyr&gt;&gt;
After much angry debate in the Council Room, you finally determine that &lt;&lt;print $Aztec_Leader&gt;&gt; has the greatest loyalty of his men, and you [[move forward under his leadership|Set up for the Feast]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="151" name="New Leader" tags="Done Breaks" position="1625,425" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=2&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Olid&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=2&gt;&gt;

&lt;&lt;elseif $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] and $users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;] &gt;= $users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=2&gt;&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
Cortes, you have lost all your points.  Your score is now:&lt;br&gt;
&lt;br&gt;
Strength: &lt;&lt;print $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;&lt;br&gt;
Loyalty: &lt;&lt;print $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
Wisdom: &lt;&lt;print $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;
The men have mutinied against you, and the man with the greatest loyalty is now leading your expedition. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Olid&quot; OR &quot;Alvarado&quot; OR &quot;Garrido&quot;&gt;&gt;
Cortes has lost all your loyalty, and you have mutinied against him. The man among you who has gathered the greatest loyalty will now lead you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

Your new leader is: &lt;&lt;print$Span_Leader&gt;&gt;&lt;br&gt;
&lt;br&gt;
Together, under his leadership, you may [[now continue|Spaniards Send a Letter]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="152" name="News from the land of the Olmeca Xicalanca" tags="Done Breaks" position="2850,800" size="100,100">&lt;&lt;theyr&gt;&gt;
You return from your journey to find the city buzzing with news. One of your spies has just returned from the coast, where a band of strangers recently arrived from across the sea. The strangers are pale in skin and covered in hair. &lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
Moctezuma, you order your men--Tlacaelel Xocoyotl, Cuauhtémoc, Cacamatzin, and the Pochteca--to the coast to learn more. Meanwhile, you and the priest [[adjourn to the palace|the Omens]]. He tells you he has other news for you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
Moctezuma orders the men--Tlacaelel Xocoyotl, Cuauhtémoc, Cacamatzin, and the Pochteca--to the coast to learn more. Meanwhile, you and he [[return to the palace|the Omens]]. You have important news for him. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlacaelel&quot; OR &quot;Cuauhtemoc&quot; OR &quot;Cacamatzin&quot; OR &quot;Pochteca&quot;&gt;&gt;
Moctezuma &lt;&lt;link &quot;orders you to the coast&quot; &quot;The Land of the Olmeca Xicalanca&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=3&gt;&gt;&lt;&lt;/link&gt;&gt; to learn more. You prepare for the journey as he returns to the palace with his priest.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="153" name="No Library Door Once Again" tags="" position="2300,8550" size="100,100">&lt;&lt;theyr&gt;&gt;
After a full day of classes, you head back to the library. You&#39;re pretty sure you know how this whole thing works by now and, since your history teacher didn&#39;t give you any new assignments, you don&#39;t expect to find the door. You round the corner in the library and, as expected, the door isn&#39;t there. &lt;br&gt;
&lt;br&gt;
Even though you knew this was going to happen, you can&#39;t help but feel disappointed. Tenochtitlán is unlike anything you&#39;ve ever imagined and you&#39;re dying to get back there. You go online and find your history syllabus, wondering when your next assignment is due. Much to your dismay, it&#39;s two weeks until you&#39;ll get your next assignment. You&#39;ve never been so eager to get homework in your life! &lt;br&gt;
&lt;br&gt;
You trudge home wondering how you can possibly wait so long. Maybe if you tell your professor you want to get a headstart, she&#39;ll give you the assignment early.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="154" name="No Trap in Cholula" tags="Done" position="2150,4500" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Mal_Share eq &quot;&quot; or ndef $Mal_Share&gt;&gt;
You go to bed satisfied, full of food and a strange Cholulan wine. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for Marina to do something.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You have decided to share the rumor with your Spanish friends. You make your way to their sleeping quarters and quietly rouse them, careful not to wake your Cholulan hosts.&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and share with them what you have learned.&lt;br&gt;
&lt;br&gt;
What do they make of the news? &lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Mal_Span or $Mal_Span eq &quot;&quot;&gt;&gt; 
You wait nervously for &lt;&lt;print $Span_Leader&gt;&gt; to make a decision. Does he believe you?
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Mal_Span is &quot;Yes&quot;&gt;&gt;
You have delivered your news, the men believe you, and now you have no choice but to wait and see what happens. What will your new friends do? [[What do the Gods have in store for you|Marina Warns of No Attack]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mal_Span is &quot;No&quot;&gt;&gt;
You have delivered your news, but your friends did not believe you. It seems you have not yet won their trust. You go to sleep, [[wondering what the Gods have in store for you|Marina Warns of No Attack]].
&lt;&lt;/if&gt;&gt;

&lt;&lt;elseif $Mal_Share is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
You are just dozing off for the night when you hear a noise. The slave woman, Marina, has entered your sleeping quarters and is quietly rousing the men. She gathers you round, gesturing that you must be quiet, and delivers some news.&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and hear what she has to say.&lt;br&gt;
&lt;br&gt;
Once you&#39;ve heard what she has to say, discuss this news with the others. Do you all believe her? As the leader of the Spanish Faction, it is up to you to make the call for the entire group, so choose carefully. &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Yes&quot; &quot;Marina Warns of No Attack&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Span=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;No&quot; &quot;Marina Warns of No Attack&quot;&gt;&gt;&lt;&lt;storeSet $Mal_Span=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;Yes&quot; and $users[$userId][&quot;role&quot;] isnot $Span_Leader and $users[$userId][&quot;role&quot;] isnot &quot;Marina&quot;&gt;&gt;
You are just dozing off for the night when you hear a noise. The slave woman, Marina, has entered your sleeping quarters and is quietly rousing the men. She gathers you round, gesturing that you must be quiet, and delivers some news.&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and hear what she has to say.&lt;br&gt;
&lt;br&gt;
Once you&#39;ve heard what she has to say, discuss this news with the others. Do you all believe her? &lt;&lt;print $Span_Leader&gt;&gt; must make the call.  Do your best to persuade him, your very lives might depend upon this choice. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Mal_Span or $Mal_Span eq &quot;&quot;&gt;&gt; 
You wait nervously for &lt;&lt;print $Span_Leader&gt;&gt; to make a decision.
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Mal_Span is &quot;Yes&quot;&gt;&gt;
You have decided to [[put your faith in Marina|Marina Warns of No Attack]].
&lt;&lt;elseif $Mal_Span is &quot;No&quot;&gt;&gt;
You have decided you [[do not believe Marina|Marina Warns of No Attack]].
&lt;&lt;/if&gt;&gt;
&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;No&quot; and $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You try to sleep, but your nerves are frayed and you anxiously listen for any noise that might alert you to an attack.&lt;br&gt; 
&lt;br&gt;
Despite your fears of a trap, the next day proceeds much as the last. It seems the rumor was unfounded and your Cholulan hosts treat you as esteemed visitors. You pass a pleasant stay in the city before  [[carrying on with your journey|Cholula Spanish Leadership Challenge]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Share is &quot;No&quot; and $users[$userId][&quot;role&quot;] isnot &quot;Marina&quot;&gt;&gt;
You go to bed satisfied, full of food and a strange Cholulan wine. 

Your Cholulan hosts are generous and treat you as esteemed visitors. You pass a pleasant stay in the city before [[carrying on with your journey|Cholula Spanish Leadership Challenge]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="155" name="Noche Triste" tags="" position="2450,11125" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
The time has come for you to make your escape. As you gather your final supplies, you thank God for the spy who kept you informed about the Mexica&#39;s many preparations for battle. You know that only one causeway to the mainland remains and that parts have been destroyed, leaving it impassible. When you learned this, your men gathered wood and built a portable bridge, which you now take with you. &lt;br&gt;
&lt;br&gt;
As quietly as any army that has gone before, you make your way out of the palace through the eerie darkness towards the last remaining causeway. It is all for naught, however! You have been spotted and you watch the lake that surrounds you fill with canoes. Mexica warriors descend upon you from all sides! As you approach the first break in the causeway, your men put down the portable bridge and you are able to cross, but others are not so lucky. The bridge collapses under the weight of so many men and you carry bits of wood in a feeble attempt to cross the next break in the causeway. Chaos surrounds you as men and horses plummet into the depths of Lake Texcoco.&lt;br&gt;
&lt;br&gt;
Somehow, you make it out alive, but not all are so lucky. You scramble your way to shore and run for your life, desperate to &lt;br&gt;&lt;&lt;link &quot;escape the carnage that lays behind you&quot; &quot;Spaniards Decide Whether to Retreat to Tlaxcala&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]*=.5&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The time has come for you to make your escape. As you gather your final supplies, you thank God for the spy who kept you informed about the Mexica&#39;s many preparations for battle. You know that only one causeway to the mainland remains and that parts have been destroyed, leaving it impassible. When you learned this, your men gathered wood and built a portable bridge, which you now take with you. &lt;br&gt;
&lt;br&gt;
As quietly as any army that has gone before, you make your way out of the palace through the eerie darkness towards the last remaining causeway. It is all for naught, however! You have been spotted and you watch the lake that surrounds you fill with canoes. Mexica warriors descend upon you from all sides! As you approach the first break in the causeway, your men put down the portable bridge and you are able to cross, but others are not so lucky. The bridge collapses under the weight of so many men and you carry bits of wood in a feeble attempt to cross the next break in the causeway. Chaos surrounds you as men and horses plummet into the depths of Lake Texcoco.&lt;br&gt;
&lt;br&gt;
Somehow, you make it out alive, but not all are so lucky. You scramble your way to shore and run for your life, desperate to [[escape the carnage that lays behind you|Spaniards Decide Whether to Retreat to Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The whole city flies into action and you watch the chaos that unfolds before you. It seems there have been spies in your midst, for the strangers carry with them a makeshift bridge. Many moons ago, the residents of the city cut off all but one causeway that connects your island city to the shore. This last remaining causeway was itself made unpassable by long broken stretches, but the Spaniards are prepared. You see them lay down their sad little bridge at the first break in the causeway, only to be shot down by the warriors that have flooded into the lake in their canoes.&lt;br&gt;
&lt;br&gt;
As you run into the fray, cutting down your enemies, you watch as men and horses plummet into the depths of Lake Texcoco. Blinded by the chaos of war, you are vaguely aware that some of the Spaniards have made it down the causeway. Out of the corner of your eye, you watch them scramble to shore, but you must fight where you are and cannot give chase.&lt;br&gt;
&lt;br&gt;
When the battle is finally done, you survey the scene before you. You wonder how many escaped with their lives. Given the carnage that surrounds you, it cannot have been many. Weary from battle, you thank the gods for your life and [[hope that this tragic chapter is finally done|Spaniards Decide How to Proceed]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
It has been many moons since you left Tenochtitlán, grateful to return to your own lands, your own people. Nonetheless, you have kept close watch on events from afar, aided by an extensive network of spies.&lt;br&gt;
&lt;br&gt;
On this morning, you receive a shocking report. It seems the Spaniards attempted to flee the city... and paid an enormous price. According to your spies, the dead far outnumber the living, who have been spotted in the mountains high above the city. &lt;br&gt;
&lt;br&gt;
You wonder if they will [[eventually make their way back to Tlaxcala|Spaniards Decide How to Proceed]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="156" name="Offer to Bargain or Not" tags="" position="2950,10925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Hostage or $Hostage eq &quot;&quot;&gt;&gt;
It seems &lt;&lt;print $Span_Leader&gt;&gt; has not yet made his decision. Wait here until the choice has been made.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Hostage is &quot;Yes&quot;&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You have decided that your best chance of survival is to offer up &lt;&lt;print $Aztec_Leader&gt;&gt; in exchange for free passage out of the city. You have presented your deal to the Mexica and [[anxiously await their decision|Aztecs Decide Whether to Make an Exchange]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
It seems you may yet escape with your life! Your captors have decided that you are their best ticket out of Tenochtitlán and have offered to return you to your people in exchange for free passage out of the city.&lt;br&gt;
&lt;br&gt;
Now you must wait to see if your people still value your life... or if they would [[rather take their revenge|Aztecs Decide Whether to Make an Exchange]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Your messenger arrives [[empty-handed|Aztecs Decide Whether to Make an Exchange]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;elseif $Hostage is &quot;No&quot;&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You have decided that &lt;&lt;print $Aztec_Leader&gt;&gt; is nothing more than a burden at this point and it is time to dispose of him. As you drive the knife into the once-powerful Mexica leader, you wonder if you will pay for your crime in the afterlife.&lt;br&gt;
&lt;br&gt;
Once the deed is done, you decide that your best chance of escape is to leave by cover of night. You will need to be quick and silent, so you decide carefully what is worth taking. After all this time coveting Moctezuma&#39;s treasure, however, you can&#39;t help but fill your pockets with all the gold and valuables you can find. You hope they won&#39;t weigh you down as you &lt;&lt;link &quot;make your escape&quot; &quot;Noche Triste&quot;&gt;&gt;&lt;&lt;storeSet $Noche=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
It seems your luck has run out. Your captors have decided that you are no longer of value to them and their best chance of escape is to flee by night.&lt;br&gt;
&lt;br&gt;
As you feel the knife in your back, you cry out to your attacker. Do you not deserve a more dignified death than this?! As you slip into darkness, you wonder one last time how your gods could have [[forsaken you so|The End]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You&#39;ve just received a shocking report from Tenochtitlán: &lt;&lt;print $Aztec_Leader&gt;&gt; is dead! You can hardly believe the news! It seems there was a riot among the citizens of Tenochtitlán. The Spaniards sent the captive &lt;&lt;print $Aztec_Leader&gt;&gt; out to calm the crowd but they turned on him! He struck in the head with a rock. Your spies report that he was still alive when the strangers carried him back into the palace and no one has seen the body. However, shortly thereafter, the Spaniards sent a messenger out to the roof to inform the residents of the city that their Emperor was dead.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; was your enemy, but he was the most powerful man in the world. Will the Gods forgive the Spaniards for this crime? Only [[time will tell|Noche Triste]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="157" name="Olid&#39;s Contribution" tags="" position="2300,7925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Here you will find links to each entry of the Spanish guidebook, along with a special section written by your Tlaxcalan guests. You must read each entry and evaluate their descriptions. Are they accurate in their portrayals? &lt;br&gt;
&lt;br&gt;
To aid you in this task, go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán. You may also want to revisit other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
Marina&#39;s introduction is:  &lt;&lt;print &quot;$Ma_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Marina&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cortes&#39; entry is:  &lt;&lt;print &quot;$Co_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Cortes&#39; contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Alvarado&#39;s entry is:  &lt;&lt;print &quot;$Al_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Alvarado&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Aguilar&#39;s entry is:  &lt;&lt;print &quot;$Ag_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Aguilar&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Olid&#39;s entry is:  &lt;&lt;print &quot;$Ol_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;Garrido&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Olid&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;Garrido&#39;s Contribution&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Olid&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
Garrido&#39;s entry is:  &lt;&lt;print &quot;$Ga_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
The Tlaxcalan&#39;s Insider&#39;s Guide is:  &lt;&lt;print &quot;$Tl_IG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot; OR &quot;Tlaxcalans&quot;&gt;&gt;
Here you will find links to each recipe in the Aztec cookbook. You must read each recipe and judge them for accuracy. Have they properly sourced their ingredients or are there items here that can&#39;t be found in Tenochtitlán?  &lt;br&gt;
&lt;br&gt;

To aid you in this task, you may want to revisit Bernal Diaz&#39; account of Tenochtitlán. You may also want to read his account of the Aztec feast, visit the Codex Mendoza, and review other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
Moctezuma&#39;s recipe is:  &lt;&lt;print &quot;$Moc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Moctezuma&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Tlacaelel&#39;s entry is:  &lt;&lt;print &quot;$Tlc_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Tlacaelel&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cuauhtemoc&#39;s entry is:  &lt;&lt;print &quot;$Cu_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Cuauhtemoc&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cacamatzin&#39;s entry is:  &lt;&lt;print &quot;$Ca_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Cacamatzin&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
The Aztec Priest&#39;s entry is:  &lt;&lt;print &quot;$AP_Rec&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Does he &lt;&lt;link &quot;PASS&quot; &quot;After the Feast&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;After the Feast&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:-2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="158" name="On The Way to Veracruz" tags="" position="2100,1125" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
It is clear to your compatriots that your language skills are quite valuable, especially with the discovery of the slave woman, Marina. As you make your way up the coast, the Maya language gives way to Nahuatl and thus begins your three-way translation: Marina translates the Nahuatl into Mayan and you, in turn, translate the Mayan into Spanish.&lt;br&gt;
&lt;br&gt;
You reach the end or your journey up the coast, landing at a site that you decide to name Villa Rica de Vera Cruz—[[the Rich Village of the True Cross|Act 1 Scene 1]]. &lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Marina&quot;&gt;&gt;
It is clear to your new masters that your language skills are quite valuable, especially with the addition of the strange foreigner who speaks the Mayan tongue. As you make your way up the coast, the Maya language gives way to Nahuatl. Being surrounded by your own mother tongue brings you a strange comfort, but you remain on your guard, engaging in a three-way translation: you translate the Nahuatl into Mayan and Aguilar the priest, in turn, translates the Mayan into the foreigner&#39;s tongue: a language they call Castilian, or Spanish.&lt;br&gt;
&lt;br&gt;
You reach the end or your journey up the coast, landing at a site that your companions decide to name Villa Rica de Vera Cruz—[[the Rich Village of the True Cross|Act 1 Scene 1]]. &lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Cortes&quot; or &quot;Alvarado&quot; or &quot;Garrido&quot; or &quot;Olid&quot;&gt;&gt;
It is clear that the new members of your expedition possess an invaluable skill: language. As you make your way up the coast, the language that has only begun to sound familiar gives way to something entirely new. Aguilar informs you that you have left Maya territory and are now surrounded by a language called Nahuatl. Thus begins a three-way process of translation: Marina translates the Nahuatl into Mayan and the priest Aguilar, in turn, translates the Mayan into Spanish. &lt;br&gt;
&lt;br&gt;
You reach the end or your journey up the coast, landing at a site that you decide to name Villa Rica de Vera Cruz—[[the Rich Village of the True Cross|Act 1 Scene 1]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="159" name="On a Beach in Veracruz: Gifts" tags="Done Breaks" position="2475,1525" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
Your curiosity about these frightful Mexica is finally satisfied when a delegation arrives at the village. They tell you that they come in the name of the great Emperor, Moctezuma, and each man bows to kiss the earth. After welcoming you to their territory, they present you with a bounty of gifts: mountains of beautiful cotton cloth, plumes of feathers more brilliant and colorful than any you&#39;ve seen before...and gold. Countless trinkets of gold glisten before you in the sunlight.&lt;br&gt;
&lt;br&gt;

After presenting their gifts, the men deliver a message on behalf of their prince, Moctezuma. Their leader, they claim, “was pleased that such valiant men, as he had heard they were, should come to his country,” for Moctezuma had heard reports of your battle in Tabasco. However, the men assure you that there is no need for a meeting between your two sides. In fact, they tell you the journey to Mexico is treacherous and you would best head back the way you came.&lt;br&gt;
&lt;br&gt;

&lt;&lt;print $Span_Leader&gt;&gt; responds to the men. He tells them that you&#39;ve traveled many miles to meet their great and powerful prince and you have no fear of the journey that lies ahead. He gives the men gifts of beads and linen shirts to take back and asks that they convey his request for a meeting.&lt;br&gt;
&lt;br&gt;

Go to the main discussion board and get to know these strange men. What might you want to ask them, given how much you&#39;ve heard about them? In addition to getting to know each other on the Go to the main discussion board, you may want to talk and strategize within your faction.&lt;br&gt;
&lt;br&gt;

&lt;&lt;if $TL_Attacks is &quot;No&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you watch the Aztecs head home. Turning to face the rest of your companions, you wonder how this meeting [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $TL_Attacks is &quot;Spanish&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you watch the Aztecs head home. Turning to face the rest of your companions, you wonder how this meeting [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you watch the Aztecs head home. Turning to face the rest of your companions, you wonder how this meeting [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot;&gt;&gt;

You stand awkwardly on the beach, wondering what lies ahead.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalans to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
For many moons now, you have heard stories of the strange men traveling along the coast. You have heard that they are powerful warriors who rode upon giant deer to defeat an army at Tlaxcala. Now you will finally meet them face to face. &lt;br&gt;
&lt;br&gt;
You first lay eyes upon the strangers at the beach, and they are precisely as you have heard: they are dirty and hair grows from their faces. At sea behind them is the biggest canoe you have ever seen. They speak to each other in a strange language, but their message is given to you by a woman who speaks your own tongue. They ask who you are and from whence you came. You tell the strangers that you come from Mexico and you have been sent by the great Moctezuma. You come bearing gifts. &lt;br&gt;
&lt;br&gt;
The strangers watch in fascination as you lay the gifts at their feet: bolts of cloth, a head fan made of the finest quetzal feathers, and countless trinkets of yellow metal. It is these last items that seem to draw the strangers&#39; attention. You then deliver Moctezuma&#39;s message, advising the strangers not to make the journey inland. It is known that they want to meet your leader in person, but such a meeting is not necessary, you tell them. The road is long and dangerous. The strangers refuse your warning, however, and ask you to deliver their request to Moctezuma. They present you with gifts of beads and fine cloth to take back upon your return. &lt;br&gt;
&lt;br&gt;
Go to the main discussion board and get to know these strange men. What might you want to ask them, given how much you&#39;ve heard about them? In addition to getting to know each other on the Go to the main discussion board, you may want to talk and strategize within your faction.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $TL_Attacks is &quot;No&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you gather your delegation together and &lt;&lt;link &quot;head home&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $TL_Attacks is &quot;Aztecs&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you gather your delegateion together and [[head home|Tlaxcalans Attack Aztecs on return journey]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Spanish&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you gather your delegation together and &lt;&lt;link &quot;head home&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you gather your delegation together and &lt;&lt;link &quot;head home&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot;&gt;&gt;
You stand awkwardly on the beach, wondering what lies ahead.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalan team to make a decision.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Your spies have been busy keeping watch over events along the coast and they have many stories to tell. It seems a delegation of Mexica went in search of the strangers who arrived by sea and warned them not to make the journey to Tennochtitlán. The Mexica plied the strange men with gifts, laying at their feet a small mountain of treasures, from coveted cotton cloth to the finest quetzal plumes. The foreigners appeared very impressed, but paid little heed to the Mexica&#39;s warnings. They have requested a meeting with the Emperor Moctezuma. The local people have informed your spies that the leader of the foreigners seems determined to make the journey inland.&lt;br&gt;
&lt;br&gt;
You will continue to observe these developments closely as you consider your next move. Given all that you have learned so far, what do you make of these events? What might the arrival of these strangers mean for your people?&lt;br&gt;
&lt;br&gt;
[[Tlaxcalans Observe the Ship Burning]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="160" name="On a Beach in Veracruz: No Gifts" tags="Done Breaks" position="2025,1425" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;

Your curiosity about these frightful Mexica is finally satisfied when a delegation arrives at the village. They tell you that they come in the name of the great Emperor, Moctezuma, and each man bows to kiss the earth. After welcoming you to their territory, the men deliver a message on behalf of their prince, Moctezuma. Their leader, they claim, “was pleased that such valiant men, as he had heard they were, should come to his country,” for Moctezuma has heard reports of your battle in Tabasco. However, they assure you that there is no need for a meeting between your two sides. In fact, they tell you the journey to Mexico is treacherous and you would best head back the way you came.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Span_Leader&gt;&gt; responds to the men. He tells them that you&#39;ve traveled many miles to meet their great and powerful prince and you have no fear of the journey that lies ahead. He gives the men gifts of beads and linen shirts to take back and asks that they convey his request for a meeting.&lt;br&gt;
&lt;br&gt;
Go to the Go to the main discussion board and get to know these strange men. What might you want to ask them, given how much you&#39;ve heard about them? In addition to getting to know each other on the main discussion board, you may want to talk and strategize within your faction.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $TL_Attacks is &quot;No&quot;&gt;&gt;
Once you&#39;ve completed your meeting, you watch the Aztecs head home. Turning to face the rest of your companions, you wonder how this meeting [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Aztecs&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you watch the Aztecs head home. Turning to face the rest of your companions, you wonder how this meeting [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Spanish&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you watch the Aztecs head home. Turning to face the rest of your companions, you wonder how this meeting [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you watch the Aztecs head home. Turning to face the rest of your companions, you wonder how this meeting [[will impact their enthusiasm for this trip|To Mutiny or Not]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot;&gt;&gt;

You stand awkwardly on the beach, wondering what lies ahead.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalan team to make a decision.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
For many moons now, you have heard stories of the strange men traveling along the coast. You have heard that they are powerful warriors who rode upon giant deer to defeat an army at Tlaxcala. Now you will finally meet them face to face. &lt;br&gt;
&lt;br&gt;
You first lay eyes upon the strangers at the beach, and they are precisely as you have heard: they are dirty and hair grows from their faces. At sea behind them is the biggest canoe you have ever seen. They speak to each other in a strange language, but their message is given to you by a woman who speaks your own tongue. They ask who you are and from whence you came. You tell the strangers that you come from Mexico and you have been sent by the great Moctezuma. &lt;br&gt;
&lt;br&gt;
Having decided not to deliver Moctezuma&#39;s gifts, you simply deliver his message, advising the strangers not to make the journey inland. It is known that they want to meet your leader in person, but such a meeting is not necessary, you tell them. The road is long and dangerous. The strangers refuse your warning, however, and ask you to deliver their request to Moctezuma. They present you with gifts of beads and fine cloth to take back upon your return. &lt;br&gt;
&lt;br&gt;
Go to the Go to the main discussion board and get to know these strange men. What might you want to ask them, given how much you&#39;ve heard about them? In addition to getting to know each other on the main discussion board, you may want to talk and strategize within your faction.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $TL_Attacks is &quot;No&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you gather your delegation together and &lt;&lt;link &quot;head home&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Aztecs&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you gather your delegateion together and [[head home|Tlaxcalans Attack Aztecs on return journey]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_Attacks is &quot;Spanish&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you gather your delegation together and &lt;&lt;link &quot;head home&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot; and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;

Once you&#39;ve completed your meeting, you gather your delegation together and &lt;&lt;link &quot;head home&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif ndef $TL_Attacks or $TL_Attacks eq &quot;&quot;&gt;&gt;

You stand awkwardly on the beach, wondering what lies ahead.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalan team to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Your spies have been busy keeping watch over events along the coast and they have many stories to tell. It seems a delegation of Mexica went in search of the strangers who arrived by sea and warned them not to make the journey to Tennochtitlán. The foreigners paid little heed to the Mexica&#39;s warnings and have requested a meeting with the Emperor Moctezuma. The local people have informed your spies that the leader of the foreigners seems determined to make the journey inland.&lt;br&gt;
&lt;br&gt;
You will [[continue to observe these developments closely|Tlaxcalans Observe the Ship Burning]] as you consider your next move. Given all that you have learned so far, what do you make of these events? What might the arrival of these strangers mean for your people?&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="161" name="On the Causeway" tags="" position="2300,6375" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Causeway &lt;=12&gt;&gt;
You must wait for all players to gather before you can continue.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;else&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You head down the causeway with a welcoming party of a thousand men. The lowest among you go first, greeting the strangers one by one. When the ritual is complete, you step forward and the sea of men parts before you.&lt;br&gt;
&lt;br&gt;
One of the strangers steps out before the rest. He tells you his name is &lt;&lt;print $Span_Leader&gt;&gt; and attempts to embrace you. He is stopped by your escorts, who would never allow such an insult to occur. This is clearly their leader and he should know better. It seems that &lt;&lt;print $Span_Leader&gt;&gt; quickly realizes his mistake, for he steps back. Your companions then take their turn to greet the foreigners, bowing to kiss the earth. Two hundred of the city&#39;s most important nobles then follow.&lt;br&gt;
&lt;br&gt;
When all have finally made their greeting, you step forward. &lt;&lt;print $Span_Leader&gt;&gt; once again approaches you, this time with an offering. You allow him to place a necklace upon you, a necklace of the finest materials that you have never before seen. You offer your own necklace in turn, placing a chain of golden crabs upon the most important of the foreigners. &lt;br&gt;
&lt;br&gt;
When the ceremony is finally complete, you turn toward the city, signalling the strange men to accompany you. You order that their army, however, must stay on shore. Only the foreigners may enter. When they object, you allow one small concession: they may bring with them the Tlaxcalan leaders, but no more.&lt;br&gt;
&lt;br&gt;
[[As you head toward the city|Into the City]], you take the opportunity to learn more about these strangers who have reached your gates. Go to the main discussion board and get to know each other. Each member of your team must ask the Spaniards ONE question. You may want to meet beforehand on the Aztec discussion board to decide what information would be most valuable to you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You head down the causeway with a welcoming party of a thousand men. The lowest among you go first, greeting the strangers one by one. When the ritual is complete, &lt;&lt;print $Aztec_Leader&gt;&gt; steps forward and the sea of men parts before him.&lt;br&gt;
&lt;br&gt;
One of the strangers steps out before the rest. He says his name is &lt;&lt;print $Span_Leader&gt;&gt; and attempts to embrace &lt;&lt;print $Aztec_Leader&gt;&gt;. He is stopped by your ruler&#39;s escorts, who would never allow such an insult to occur. This is clearly the foreigner&#39;s leader and he should know better. It seems that he quickly realizes his mistake, for he steps back. &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s companions then take their turn to greet the foreigners, bowing to kiss the earth. Two hundred of the city&#39;s most important nobles then follow.&lt;br&gt;
&lt;br&gt;
When all have finally made their greeting, &lt;&lt;print $Aztec_Leader&gt;&gt; steps forward. &lt;&lt;print $Span_Leader&gt;&gt; once again approaches him, this time with an offering. &lt;&lt;print $Aztec_Leader&gt;&gt; allows him to place a necklace upon him, a necklace of the finest materials that you have never before seen. He then offers his own necklace in turn, placing a chain of golden crabs upon &lt;&lt;print $Span_Leader&gt;&gt;. &lt;br&gt;
&lt;br&gt;
When the ceremony is finally complete, you turn toward the city, signalling the strange men to accompany you. &lt;&lt;print $Aztec_Leader&gt;&gt; orders that their army stay on shore. Only the foreigners may enter. When they object, he allows one small concession: they may bring with them the Tlaxcalan leaders, but no more.&lt;br&gt;
&lt;br&gt;
[[As you head toward the city|Into the City]], you take the opportunity to learn more about these strangers who have reached your gates. Go to the main discussion board and get to know each other. Each member of your team must ask the Spaniards ONE question. You may want to meet beforehand on the Aztec discussion board to decide what information would be most valuable to you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You approach the magnificent city that rises out of the lake before you. You find yourself on a long causeway that leads away from the shore, so wide that 8 men can ride side-by-side. &lt;br&gt;
&lt;br&gt;
You wonder at the marvel that surrounds you, but you are also wary. What if you have walked into an ambush? All of your men have gathered on the causeway, and you look into the depths of the lake that stretches out before you on both sides. You are hyper-aware of just how vulnerable you are, especially given that there must be a thousand Aztecs heading towards you.&lt;br&gt;
&lt;br&gt;
You are relieved to see that these men who approach are all dressed in finery and have a solemn mood about them. This is not a war party. The sea of men parts, making way for an imposing figure carried on a litter. He steps down with the aid of two men. This must be him: the great Emperor &lt;&lt;print $Aztec_Leader&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You approach &lt;&lt;print $Aztec_Leader&gt;&gt; with open arms, but are stopped by his two companions. You do not need your translators to know that you are not to touch the Emperor. You step back respectfully.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s two companions step towards you. Each of them, in turn, bends to touch his hand to the earth and then kisses it. A procession of men follow them in this act, each greeting you in turn. Finally, the only one left is &lt;&lt;print $Aztec_Leader&gt;&gt; himself. You step towards him with an offering, a necklace of pearls and glass beads, which you place upon his neck. &lt;&lt;print $Aztec_Leader&gt;&gt; returns the gesture, placing his own necklace around your neck, this one made of delicate gold crabs. &lt;br&gt;
&lt;br&gt;
When the ceremony is finally complete, the men turn and lead you toward the city. As you mobilize your forces, &lt;&lt;print $Aztec_Leader&gt;&gt; commands you to leave your indigenous army on shore. You and your men alone may enter. You object to this demand, well aware of how vulnerable you will be inside the city. They refuse your request, with one small concession: you may bring the Tlaxcalan leaders, but no more.&lt;br&gt;
&lt;br&gt;
[[As you make your way toward the city|Into the City]], this is your opportunity to gather vital information. Go to the main discussion board and get to know each other. Each member of your team must ask the Aztecs ONE question. You may want to meet beforehand on the Spanish discussion board to decide what information would be most valuable to you.&lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;
You watch &lt;&lt;print $Span_Leader&gt;&gt; approach &lt;&lt;print $Aztec_Leader&gt;&gt; with open arms, but he is stopped by the Emperor&#39;s two companions. You do not need your translators to know that he is not to touch the Emperor. &lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s two companions then step forward. Each of them, in turn, bends to touch his hand to the earth and then kisses it. A procession of men follow them in this act, each greeting &lt;&lt;print $Span_Leader&gt;&gt; in turn. Finally, the only one left is &lt;&lt;print $Aztec_Leader&gt;&gt; himself. You watch &lt;&lt;print $Span_Leader&gt;&gt; step towards him with an offering: a necklace of pearls and glass beads, which &lt;&lt;print $Span_Leader&gt;&gt; places upon his neck. &lt;&lt;print $Aztec_Leader&gt;&gt; returns the gesture, placing his own necklace around &lt;&lt;print $Span_Leader&gt;&gt;&#39;s neck, this one made of delicate gold crabs. &lt;br&gt;
&lt;br&gt;
When the ceremony is finally complete, the men turn and lead you toward the city. As you mobilize your forces, &lt;&lt;print $Aztec_Leader&gt;&gt; commands you to leave your indigenous army on shore. You and your men alone may enter. You object to this demand, well aware of how vulnerable you will be inside the city. They refuse your request, with one small concession: you may bring the Tlaxcalan leaders, but no more.&lt;br&gt;
&lt;br&gt;
[[As you make your way toward the city|Into the City]], this is your opportunity to gather vital information. Go to the main discussion board and get to know each other. Each member of your team must ask the Aztecs ONE question. You may want to meet beforehand on the Spanish discussion board to decide what information would be most valuable to you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You approach the magnificent city that rises out of the lake before you. You find yourself on a long causeway that leads away from the shore, wide enough to accommodate many of your men.&lt;br&gt;
&lt;br&gt;
You gaze warily upon the city before you. What if you have walked into an ambush? All of your men have gathered on the causeway, and you look into the depths of the lake that stretches out on both sides. You are hyper-aware of just how vulnerable you are, especially given that there must be a thousand Aztecs heading towards you.&lt;br&gt;
&lt;br&gt;
This is not a war party, however. These are the city&#39;s nobles, coming to meet their esteemed guests. Among them is &lt;&lt;print $Aztec_Leader&gt;&gt; himself, attired in his finest clothing and a powerful sight to behold.&lt;br&gt;
&lt;br&gt;
You watch &lt;&lt;print $Span_Leader&gt;&gt; approach &lt;&lt;print $Aztec_Leader&gt;&gt; with open arms, but he is stopped by the Emperor&#39;s two companions. Only a fool would try to touch the Emperor and you make note of this error.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s two companions then step forward. Each of them, in turn, bends to touch his hand to the earth and then kisses it. A procession of men follow them in this act, each greeting &lt;&lt;print $Span_Leader&gt;&gt; in turn. Finally, the only one left is &lt;&lt;print $Aztec_Leader&gt;&gt; himself. You watch &lt;&lt;print $Span_Leader&gt;&gt; step towards him with an offering: a necklace of pearls and glass beads, which &lt;&lt;print $Span_Leader&gt;&gt; places upon his neck. &lt;&lt;print $Aztec_Leader&gt;&gt; returns the gesture, placing his own necklace around &lt;&lt;print $Span_Leader&gt;&gt;&#39;s neck, this one made of delicate gold crabs. The men then turn and lead you toward the city.&lt;br&gt;
&lt;br&gt;
When the ceremony is finally complete, &lt;&lt;print $Aztec_Leader&gt;&gt; invites your Spanish friends into the city, but demands that your army stay behind on shore. Only the Spaniards may enter. They object to this demand, no doubt aware of how vulnerable they will be inside the city. &lt;&lt;print $Aztec_Leader&gt;&gt; makes one small concession: you and the other Tlaxcalan leaders may enter, but no one else.&lt;br&gt;
&lt;br&gt;
As you join the Spaniards and [[head towards the city|Into the City]], you take the opportunity to gain intelligence. Go to the main discussion board and get to know each other. Each member of your team must ask ONE question, but you may ask it of whomever you like. You may want to meet beforehand on the Tlaxcalan discussion board to decide what information would be most valuable to you. You may also want to hang back and listen before asking your questions. You never know what the other teams might say!&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="162" name="On the way to Puebla" tags="Done" position="1975,3325" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve been on the road for weeks now and can hardly believe the things you&#39;ve seen. You marched for three days through desert, where all the water you found was salt and you feared you might die of thirst. You&#39;ve survived a sandstorm and bitter cold. All the men remarked on how long it had been since they felt such cold as this. Many of the Indian porters fell ill. You have climbed mountains and discovered villages, everywhere hearing tales about the Mexica capital, a place of untold treasure and bloody sacrifice. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Tl_Attacks_Pu or $Tl_Attacks_Pu eq &quot;&quot;&gt;&gt;
Along your journey, you have met many people. Some have been willing allies of the Mexica, while others have chafed under Mexica rule and were eager to give you their support. After all this, you are now approaching Tlaxcala. Many of your informants have told you of Tlaxcala&#39;s hatred for the Mexica and you are hopeful that you might win them to your side, but you&#39;ve also been warned that they are fierce warriors and do not respond well to strangers in their territory. Will this journey never end?&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalans to do something.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Tl_Attacks_Pu is &quot;Yes&quot;&gt;&gt;
Along your journey, you have met many people. Some have been willing allies of the Mexica, while others have chafed under Mexica rule and were eager to give you their support. After all this, you are now approaching Tlaxcala. Many of your informants have told you of Tlaxcala&#39;s hatred for the Mexica and you are hopeful that you might win them to your side, but you&#39;ve also been warned that they are fierce warriors and do not respond well to strangers in their territory. You remain on guard, aware that danger [[may lie just around the next corner|Tlaxcala Attacks in Puebla]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tl_Attacks_Pu is &quot;No&quot;&gt;&gt;
Along your journey, you have met many people. Some have been willing allies of the Mexica, while others have chafed under Mexica rule and were eager to give you their support. After all this, you are now approaching Tlaxcala. Many of your informants have told you of Tlaxcala&#39;s hatred for the Mexica and you are hopeful that you might win them to your side, but you&#39;ve also been warned that they are fierce warriors and do not respond well to strangers in their territory. You remain on guard, aware that danger [[may lie just around the next corner|Tlaxcala Doesn&#39;t Attack in Puebla]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="163" name="PassageHeader" tags="" position="138,11" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;storeSet _roles = {
  &quot;Marina&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Doña Marina/Malinche&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Alvarado&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Pedro de Alvarado&quot;,    
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Aguilar&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Gerónimo de Aguilar&quot;,  
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Garrido&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Juan Garrido&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Olid&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Cristóbal de Olid&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Cortes&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Hernán Cortés&quot;,
    &quot;isLeader&quot;: &quot;TRUE&quot;
  },
  &quot;Moctezuma&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Moctezuma&quot;,
    &quot;isLeader&quot;: &quot;TRUE&quot;
  },
  &quot;Tlacaelel&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Tlacaelel Xocoyotl (aka Tlacaelel the Younger)&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Cuauhtemoc&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Cuauhtémoc&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Aztec_Priest&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Aztec Priest&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Cacamatzin&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Cacamatzín&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Pochteca&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Pochteca&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Xicotencatl_Elder&quot;: {
    &quot;faction&quot;: &quot;Tlaxcalans&quot;,
    &quot;Character&quot;: &quot;Xicotencatl the Elder&quot;,
    &quot;isLeader&quot;: &quot;TRUE&quot;
  },
  &quot;Xicotencatl_Younger&quot;: {
    &quot;faction&quot;: &quot;Tlaxcalans&quot;,
    &quot;Character&quot;: &quot;Xicotencatl the Younger&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Maxixcatl&quot;: {
    &quot;faction&quot;: &quot;Tlaxcalans&quot;,
    &quot;Character&quot;: &quot;Maxixcatl&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  }
}
		&gt;&gt;
/* &lt;&lt;storeSet _macro = 23&gt;&gt;
&lt;&lt;storeSet $test = &quot;Test&quot;&gt;&gt;
&lt;&lt;storeSet $test = $test.toLowerCase()&gt;&gt; */
/* &lt;&lt;run changeStats(&quot;Aztec_Priest&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt; */
/* &lt;&lt;storeSet $users[$userId][&quot;stats&quot;][&quot;Strength&quot;] -= 1&gt;&gt; */

/* List of passages where ui elements don&#39;t show up */


/* &lt;&lt;audio &quot;:all&quot; stop&gt;&gt; */
&lt;!-- &lt;&lt;masteraudio mute&gt;&gt; --&gt;
&lt;&lt;masteraudio unmute&gt;&gt;
&lt;&lt;if passage() != &quot;Home&quot;&gt;&gt;
 	&lt;&lt;run showStats()&gt;&gt;
	 &lt;&lt;run showMap()&gt;&gt;
	&lt;&lt;script&gt;&gt;
	let homeButton= $(&#39;&lt;img/&gt;&#39;,{id:&quot;homeButton&quot;,src:&quot;Twine/images/Home/HomeButton.png&quot;}).on(&quot;click&quot;, ()=&gt; { Engine.play(&quot;Home&quot;)});	
	if(!$(&#39;#homeButton&#39;).length){
	$(&#39;#story&#39;).append(homeButton);
	}
	&lt;&lt;/script&gt;&gt;


&lt;br&gt;
&lt;&lt;/if&gt;&gt;

/* updates user&#39;s current passage */
&lt;&lt;if passage() != Config.passages.start &amp;&amp; passage() != &quot;Home&quot; &amp;&amp; $users[$userId][&quot;passage&quot;] != passage()&gt;&gt;
	&lt;&lt;storeSet $users[$userId][&quot;passage&quot;] = passage()&gt;&gt; 
&lt;&lt;/if&gt;&gt;

/* adds background image to screen */
&lt;&lt;script&gt;&gt;
	let imageURL = State.getVar(&quot;$users[$userId][&#39;faction&#39;]&quot;);
	if(State.passage == &quot;Home&quot;){
		$(&quot;#story&quot;).addClass(&quot;playerList&quot;);
		imageURL = &quot;Home&quot;;
	}else{
		$(&quot;#story&quot;).removeClass(&quot;playerList&quot;);
	}

	$(&#39;#story&#39;).css({
		&#39;backgroundImage&#39;: `url(Twine/images/Borders/${imageURL}.jpg)`
	}
	)


&lt;&lt;/script&gt;&gt;

/* Updates user&#39;s latest logon time */
/* &lt;&lt;storeSet $users[$userId][&quot;lastSeen&quot;]=new Date().getTime()&gt;&gt; */
&lt;&lt;/theyr&gt;&gt;

/* updates user&#39;s last log in time */</tw-passagedata><tw-passagedata pid="164" name="PassageFooter" tags="Done Breaks" position="338,1151" size="100,100">&lt;&lt;theyr&gt;&gt;
/* List of passages where ui elements don&#39;t show up */
/* &lt;&lt;storeSet _menuPassages = {&quot;Name Not Recognized&quot;:0,&quot;Home&quot;:0}&gt;&gt; */

&lt;&lt;if passage() != &quot;Home&quot;&gt;&gt;
	&lt;&lt;if !(Object.keys($users[$userId][&quot;passageHistory&quot;]).includes(passage()))&gt;&gt;
		&lt;&lt;set _currPassage = passage()&gt;&gt;
		&lt;&lt;storeSet $users[$userId][&quot;passageHistory&quot;][_currPassage] = (`${passage()}: \n ${Story.get(passage()).processText()}`)&gt;&gt;
	&lt;&lt;/if&gt;&gt;
	

&lt;br&gt;

&lt;&lt;/if&gt;&gt;
&lt;&lt;set _currentTime=new Date()&gt;&gt;
&lt;&lt;if _currentTime.getTime() - $users[$userId][&quot;lastSeen&quot;] &gt; 10000&gt;&gt;
	&lt;&lt;storeSet $users[$userId][&quot;lastSeen&quot;]=_currentTime.getTime()&gt;&gt;  
&lt;&lt;/if&gt;&gt;
&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="165" name="Return to the Library_Another Door" tags="" position="2300,5775" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;audio &quot;Library&quot; play&gt;&gt;

You&#39;ve stopped by the library multiple times a day for the last two weeks, but the door has yet to appear. You try not to obsess about it this time, because last time this happened it nearly drove you crazy. That&#39;s easier said than done, however, because you&#39;re dying to know what happens next! You&#39;ve become invested in this dream you&#39;ve been having and you&#39;re getting desperate to go back.&lt;br&gt;
&lt;br&gt;
This afternoon your history professor gave you another assignment and you wonder if this might just be the key to finding that door. After all, both times you found it before you had just been given a new history assignment. Both times you woke up with those assignments complete. And both times, you got As!&lt;br&gt;
&lt;br&gt; 

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
You hurry toward the library, make your way to the top floor, and there it is: the magical door. You can barely contain your excitement as you enter the room and close the door quietly behind you. You know the routine by now. You set your assignment on the table beside you, sink into that big cozy chair, and &lt;&lt;link &quot;drift into a deep sleep&quot; &quot;Discussing the Omens&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You hurry toward the library, make your way to the top floor, and there it is: the magical door. You can barely contain your excitement as you enter the room and close the door quietly behind you. You know the routine by now. You set your assignment on the table beside you, sink into that big cozy chair, and &lt;&lt;link &quot;drift into a deep sleep&quot; &quot;Spaniards Descend into the Valley&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=8&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You hurry toward the library, make your way to the top floor, and there it is: the magical door. You can barely contain your excitement as you enter the room and close the door quietly behind you. You know the routine by now. You set your assignment on the table beside you, sink into that big cozy chair, and &lt;&lt;link &quot;drift into a deep sleep&quot; &quot;Tlaxcalans Face a Choice&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=5&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="166" name="Return to the Library_Door" tags="Done" position="1975,2700" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;audio &quot;Library&quot; play&gt;&gt;

A week has passed and every day you&#39;ve gone back to the library after class, looking for the mysterious room. You&#39;ve explored every inch of the building, growing increasingly desperate with every day that goes by. Every night you&#39;ve lain awake for hours, trying to figure out what happened and whether you just imagined the whole thing. You wonder if you&#39;re losing your mind, because it sure feels like it.&lt;br&gt;
&lt;br&gt;
Your history teacher didn&#39;t help the situation when she handed back your assignment today. It turns out you really did write it. And you got an A. You now have another assignment due next week and you&#39;re extra stressed because now the bar is way too high! Your teacher is going to expect A-level work from you every time and you&#39;re just not sure it&#39;s in you.&lt;br&gt;
&lt;br&gt;
It&#39;s the end of the day and you know you should go home and get to work on this new assignment, but you just can&#39;t stop yourself from going back to the library. It&#39;s become an obsession. Just like every other day for the last week, you start on the top floor in the back corner. You brace yourself for the worst, knowing that you won&#39;t find what you were looking for, but there it is! You can barely believe your eyes. &lt;br&gt;
&lt;br&gt;
You carefully reach for the door knob, afraid that it will disappear before you can grasp it. But it doesn&#39;t! You turn the handle, give the door a good pull, and it opens to reveal the room exactly as you remember it: books piled high, overstuffed chair, one small table. How is this even happening? This can&#39;t be real...can it?&lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You make your way to the chair and you hear the door swing shut behind you. You sink down into the cushions and close your eyes, confused and relieved all at the same time. Without meaning to, &lt;&lt;link &quot;you quickly drift off to sleep&quot; &quot;Tlaxcalans Prepare for a Council Meeting&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
You make your way to the chair and you hear the door swing shut behind you. You sink down into the cushions and close your eyes, confused and relieved all at the same time. Without meaning to, &lt;&lt;link &quot;you quickly drift off to sleep&quot; &quot;Aztecs Prepare for a Council Meeting&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
You make your way to the chair and you hear the door swing shut behind you. You sink down into the cushions and close your eyes, confused and relieved all at the same time. Without meaning to, [[you quickly drift off to sleep|Marina&#39;s Choice]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cortes&quot; or &quot;Alvarado&quot; or &quot;Aguilar&quot; or &quot;Garrido&quot; or &quot;Olid&quot;&gt;&gt;
You make your way to the chair and you hear the door swing shut behind you. You sink down into the cushions and close your eyes, confused and relieved all at the same time. Without meaning to, &lt;&lt;link &quot;you quickly drift off to sleep&quot; &quot;Spaniards wake up at camp&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=5&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="167" name="Rumors from the Coast" tags="Done Breaks" position="3000,800" size="100,100">&lt;&lt;theyr&gt;&gt;
You return from your journey to find the village buzzing with news. One of your spies has just returned from the coast, where a band of strangers recently arrived from across the sea. The strangers are pale in skin and covered in hair. They have been giving gifts to people of the coast and winning their affection. These coastal people are allied to the Mexica, but have been brutalized by them. Like so many others in the empire, they harbor deep resentment for their Aztec overlords.&lt;br&gt;
&lt;br&gt;
Rumor has it that the strangers have been warned about the Mexica, but show little fear. They have asked many questions about the Aztec capital of Tenochtitlán and how they might reach it.&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and discuss amongst yourselves how you feel about this news.&lt;br&gt;
&lt;br&gt;

&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
You may:&lt;br&gt;
&lt;br&gt;
1. &lt;&lt;link &quot;Do nothing&quot; &quot;Tlaxcalans wait&quot;&gt;&gt;&lt;&lt;storeSet $Tl_Omens=&quot;Nothing&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
2. Venture &lt;&lt;link &quot;into Tenochtitlan&quot; &quot;Tlaxcalans and Aztecs meet&quot;&gt;&gt;&lt;&lt;storeSet $Tl_Omens=&quot;Yes&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=5&gt;&gt;&lt;&lt;/link&gt;&gt; and meet with Moctezuma. Maybe you can come to some sort of truce.&lt;br&gt;
&lt;br&gt;
or&lt;br&gt;
&lt;br&gt;
3.  &lt;&lt;link &quot;Go to the coast&quot; &quot;Tlaxcala sends spies to Veracruz&quot;&gt;&gt;&lt;&lt;storeSet $Tl_Omens=&quot;Spies&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=3&gt;&gt;&lt;&lt;/link&gt;&gt; and try to learn more as spies.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot $Tlax_Leader and $Tl_Omens is &quot;Nothing&quot;&gt;&gt;
You have decided to [[do nothing|Tlaxcalans wait]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot $Tlax_Leader and $Tl_Omens is &quot;Yes&quot;&gt;&gt;
You have decided to [[venture into Tenochtitlan|Tlaxcalans and Aztecs meet]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot $Tlax_Leader and $Tl_Omens is &quot;Spies&quot;&gt;&gt;
You have decided to [[go to the coast|Tlaxcala sends spies to Veracruz]] and spy on the strangers.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot $Tlax_Leader and ndef $Tl_Omens or $Tl_Omens eq &quot;&quot;&gt;&gt;
Your leader has not yet entered your decision.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Tlax_Leader&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="168" name="Rumors of Mutiny" tags="Done Breaks" position="1375,1675" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt;, you have heard rumors and rumblings amongst your faction that they are planning a mutiny. You don&#39;t know whether or not this is true, but you are fearful for your life and must not let them rob you of the glory that lies ahead. As you move to the group discussion board on the next screen, you must ensure that the entire faction is ready to follow you inland in pursuit of your dreams.&lt;br&gt;
&lt;br&gt;
You weigh your options and decide that the best course of action is the boldest: retreat cannot be an option! You will beach the ships so that your crew has no choice but to forge onward. Though not destroyed, fixing the ships would require many weeks of repair, assuming they could even find the necessary materials. &lt;br&gt;
&lt;br&gt;
Proceed to the next page, where you will learn [[if there is mutiny|Burning the Ships]]. Your decisions thus far have impacted your scores. Consider where you stand with your men as you decide how to proceed.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="169" name="Sad" tags="Done" position="1350,300" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve lost a wisdom point! Your wisdom is now &lt;&lt;print $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;.&lt;br&gt;
&lt;br&gt;
A ship full of bearded men has been seen off the coast of Tulum. &lt;br&gt;
&lt;br&gt;
After all these years among the Maya, you should have a better grasp of their language. You might want to brush up on your translation skills, because they&#39;re going to be key to your survival very soon! Your fortunes are about to change. &lt;br&gt;
&lt;br&gt;
Translation: &lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;Yesterday, I was in the park where I met a man from Tulum. A few days ago, he was looking out to sea and saw a big house appear in the water. The house came closer and closer and the men of the city gathered to see the house. When the house got close they could see that it was full of men with pale skin and lots of hair. Tulum&#39;s men didn&#39;t know where this house came from, but they saw trouble. They made noise and fired rocks into the sea. The house turned back and disappeared.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Did they see the house another time? Do they know where it came from?&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;No. It is strange. I think we should keep watch. &lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Our men will go to the water to wait. If the house arrives on our water we will make them leave.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Now it is time to [[head to the coast|Aguilar Receives a Letter]]. You pack up and flee the village alone.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="170" name="Scared" tags="Done" position="1225,300" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve lost a wisdom point! Your wisdom is now &lt;&lt;print $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;. &lt;br&gt;
&lt;br&gt;
A ship full of bearded men has been seen off the coast of Tulum. &lt;br&gt;
&lt;br&gt;
After all these years among the Maya, you should have a better grasp of their language. You might want to brush up on your translation skills, because they&#39;re going to be key to your survival very soon! Your fortunes are about to change. &lt;br&gt;
&lt;br&gt;
Translation: &lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;Yesterday, I was in the park where I met a man from Tulum. A few days ago, he was looking out to sea and saw a big house appear in the water. The house came closer and closer and the men of the city gathered to see the house. When the house got close they could see that it was full of men with pale skin and lots of hair. Tulum&#39;s men didn&#39;t know where this house came from, but they saw trouble. They made noise and fired rocks into the sea. The house turned back and disappeared.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Did they see the house another time? Do they know where it came from?&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Yich&#39;ak-k&#39;ak&#39;:&lt;/b&gt; &lt;i&gt;No. It is strange. I think we should keep watch. &lt;/i&gt;&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Chak-balam:&lt;/b&gt; &lt;i&gt;Our men will go to the water to wait. If the house arrives on our water we will make them leave.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Now it is time to [[head to the coast |Aguilar Receives a Letter]]. You pack up and flee the village alone.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="171" name="Scavenger Hunt Hub" tags="Done Breaks" position="2925,400" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Quest_Points_A &gt;&gt;
&lt;&lt;storeSet$Quest_Points_A=0 &gt;&gt;
&lt;&lt;/if&gt;&gt;
Your team has accumulated &lt;&lt;print $Quest_Points_A&gt;&gt; points. &lt;br&gt;
&lt;br&gt;
Click each of the following glyphs to visit key sites around the Aztec Empire. Once you have read the clue and figured out your location, your quest leader must enter the name of the place into the text box provided. When you have obtained enough resources to survive your journey, you will be given the location of Quetzalcoatl&#39;s heart. &lt;br&gt;
&lt;br&gt;
Remember: You must enter the proper Nahuatl name and you must use the correct spelling! The text box will remain available until you enter the correct response.&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if ndef $Xochimilco_Ans_A or $Xochimilco_Ans_A eq &quot;&quot; or $Xochimilco_Ans_A isnot &quot;xochimilco&quot;&gt;&gt; 

[img[Twine/images/Glyphs/city_6.png][Xochimilco]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Xochimilco_Ans_A is &quot;xochimilco&quot;&gt;&gt;
You have already completed your quest to Xochimilco, and you have all the corn you need.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Chapultepec_Ans_A or $Chapultepec_Ans_A eq &quot;&quot; or $Chapultepec_Ans_A isnot &quot;chapultepec&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_2.png][Chapultepec]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Chapultepec_Ans_A is &quot;chapultepec&quot;&gt;&gt;
You have already completed your quest to Chapultepec, and you have all the water you can carry.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Cuauhnahuac_Ans_A or $Cuauhnahuac_Ans_A eq &quot;&quot; or $Cuauhnahuac_Ans_A isnot &quot;cuauhnahuac&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_3.png][Cuauhnahuac]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuauhnahuac_Ans_A is &quot;cuauhnahuac&quot;&gt;&gt;
You have already completed your quest to Cuauhnahuac, and you have all the fruit you need.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Tlatelolco_Ans_A or $Tlatelolco_Ans_A eq &quot;&quot; or $Tlatelolco_Ans_A isnot &quot;tlatelolco&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_5.png][Tlatelolco]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlatelolco_Ans_A is &quot;tlatelolco&quot;&gt;&gt;
You have already completed your quest to Tlatelolco, and you have all the trade goods you need.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Azcapotzalco_Ans_A or $Azcapotzalco_Ans_A eq &quot;&quot; or $Azcapotzalco_Ans_A isnot &quot;azcapotzalco&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_1.png][Azcapotzalco]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Azcapotzalco_Ans_A is &quot;azcapotzalco&quot;&gt;&gt;
You have already completed your quest to Azcapotzalco, and you have all the slaves you need.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Malinalco_Ans_A or $Malinalco_Ans_A eq &quot;&quot; or $Malinalco_Ans_A isnot &quot;malinalco&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_4.png][Malinalco]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinalco_Ans_A is &quot;malinalco&quot;&gt;&gt;
You have already completed your quest to Malinalco, and you have offered all the blood you can afford to loose.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

Your team has accumulated &lt;&lt;print $Quest_Points_A&gt;&gt; points. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Quest_Points_A &gt;=5&gt;&gt;
Congratulations! You&#39;ve gathered all the materials necessary for your journey.  You may now travel to &lt;&lt;link &quot;Cholula&quot; &quot;Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=4&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Points_A &lt;=4&gt;&gt;
You cannot yet travel to Cholula, continue your quest to gather all the items necessary to travel.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if ndef $Xochimilco_Ans_T or $Xochimilco_Ans_T eq &quot;&quot; or $Xochimilco_Ans_T isnot &quot;xochimilco&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_6.png][Xochimilco]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Xochimilco_Ans_T is &quot;xochimilco&quot;&gt;&gt;
You have already completed your quest to Xochimilco, and you have all the corn you need.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Chapultepec_Ans_T or $Chapultepec_Ans_T eq &quot;&quot; or $Chapultepec_Ans_T isnot &quot;chapultepec&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_2.png][Chapultepec]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Chapultepec_Ans_T is &quot;chapultepec&quot;&gt;&gt;
You have already completed your quest to Chapultepec, and you have all the water you can carry.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Cuauhnahuac_Ans_T or $Cuauhnahuac_Ans_T eq &quot;&quot; or $Cuauhnahuac_Ans_T isnot &quot;cuauhnahuac&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_3.png][Cuauhnahuac]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cuauhnahuac_Ans_T is &quot;cuauhnahuac&quot;&gt;&gt;
You have already completed your quest to Cuauhnahuac, and you have all the fruit you need.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Tlatelolco_Ans_T or $Tlatelolco_Ans_T eq &quot;&quot; or $Tlatelolco_Ans_T isnot &quot;tlatelolco&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_5.png][Tlatelolco]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlatelolco_Ans_T is &quot;tlatelolco&quot;&gt;&gt;
You have already completed your quest to Tlatelolco, and you have all the trade goods you need.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Azcapotzalco_Ans_T or $Azcapotzalco_Ans_T eq &quot;&quot; or $Azcapotzalco_Ans_T isnot &quot;azcapotzalco&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_1.png][Azcapotzalco]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Azcapotzalco_Ans_T is &quot;azcapotzalco&quot;&gt;&gt;
You have already completed your quest to Azcapotzalco, and you have all the slaves you need.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Malinalco_Ans_T or $Malinalco_Ans_T eq &quot;&quot; or $Malinalco_Ans_T isnot &quot;malinalco&quot;&gt;&gt; 
[img[Twine/images/Glyphs/city_4.png][Malinalco]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Malinalco_Ans_T is &quot;malinalco&quot;&gt;&gt;
You have already completed your quest to Malinalco, and you have offered all the blood you can afford to loose.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

Your team has accumulated &lt;&lt;print $Quest_Points_T&gt;&gt; points. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Quest_Points_T &gt;=4&gt;&gt;
Congratulations! You&#39;ve gathered all the materials necessary for your journey.  You may now travel to &lt;&lt;link &quot;Cholula&quot; &quot;Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=4&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Points_T &lt;=3&gt;&gt;
You cannot yet travel to Cholula, continue your quest to gather all the items necessary to travel.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="172" name="Scripts" tags="" position="4175,1200" size="100,100">&lt;&lt;theyr&gt;&gt;
/* &lt;&lt;audio &quot;Library&quot; play&gt;&gt; */
&lt;&lt;script&gt;&gt;
$(output).append(vote(&quot;vote1&quot;,&quot;for&quot;,&quot;against&quot;))
&lt;&lt;/script&gt;&gt;


&lt;&lt;if  def $vote1  &amp;&amp; &quot;for&quot; in $vote1 &amp;&amp; $vote1[&#39;for&#39;].length==2&gt;&gt;
Vote is 2
&lt;&lt;/if&gt;&gt;

&lt;&lt;run counter(2,&quot;counter1&quot;,&quot;counter2&quot;,&quot;counter3&quot;)&gt;&gt;
&lt;&lt;link &quot;you&#39;re startled by a loud noise&quot; &quot;Character Identification&quot; &gt;&gt;&lt;&lt;storeSet $counter1 = $counter1 + -1&gt;&gt;&lt;&lt;/link&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="173" name="Secret Information Drop Moctezuma and Tlacaelel the Younger" tags="" position="4175,5925" size="100,100">&lt;&lt;theyr&gt;&gt;
Moctezuma and Tlacaelel the Younger, the Spaniards are approaching your city.  As the rulers of the Empire, it is up to you to decide how to treat the strangers.  In the next scene, you and the rest of your faction will have the opportunity to get to these strangers in your city. However, at the end of the day, DAY 10, after everybody has had a chance to get to know each other, you should be prepared to advance to the next scene with a decision you have secretly made together.  Assess the situation in the next discussion board conversation, and then decide how you want to behave towards the Spaniards and their allies. 
 

You may choose to consult the rest of your faction about your options, or you may decide between yourselves. 
 

Option 1: Invite the Spaniards to be your personal guests and offer them shelter in the palace. 
 

Option 2: Declare war and attack the Spaniards
 

Option 3: Order the Spaniards to leave the city.
 

Click through to the page titled &quot;Moctezuma Speaks&quot;, follow the link to the Go to the main discussion board, and post your decision for all to read by the beginning of DAY 11.

[[Act 3, Scene 1: The Great Encounter]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="174" name="Set up for the Feast" tags="" position="2450,7175" size="100,100">While your guests are off exploring the city, it&#39;s time to prepare for the greatest feast this city has ever seen! &lt;br&gt;
&lt;br&gt;

&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You must spare no expense! These strangers, both Spanish and Tlaxcalan, will enjoy the greatest meal of their life. They will not be able to deny the wealth of the Aztec Empire! If this event is to go down in history as the greatest feast the world has ever seen, there must be a record. You commission a cookbook to commemorate the event. You order your closest advisors to assist you in this task. Each member of your team will create a recipe to include in your cookbook. To demonstrate your culinary greatness, you too will contribute a recipe!&lt;br&gt;
&lt;br&gt;

Your first task is to go to your game documents and read Bernal Diaz&#39; account of the Aztec feast. When you are done, go to your site and start a new page titled “Aztec Cookbook.” Here, you must create a recipe using only ingredients that we know were accessible to the Aztecs. You may provide a detailed recipe of a dish described by Diaz or you may use his account as inspiration for a dish or your own creation. Either way, be careful to source local ingredients, because there are points at stake here!&lt;br&gt;
&lt;br&gt;

Once your recipe is complete, paste a link here to share with the other players. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$Moc_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlacaelel&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$Tlc_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cuauhtemoc&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$Cu_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cacamatzin&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$Ca_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$AP_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;else&gt;&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; has decided to spare no expense! These strangers, both Spanish and Tlaxcalan, will enjoy the greatest meal of their life. They will not be able to deny the wealth of the Aztec Empire! If this event is to go down in history as the greatest feast the world has ever seen, there must be a record. &lt;&lt;print $Aztec_Leader&gt;&gt; has commissioned a cookbook to commemorate the event. He orders all of his closest advisors to assist in this task. Each member of your team will create a recipe to include in your cookbook. To demonstrate his culinary greatness, &lt;&lt;print $Aztec_Leader&gt;&gt; will contribute a recipe of his own.&lt;br&gt;
&lt;br&gt;
Your first task is to go to your game documents and read Bernal Diaz&#39; account of the Aztec feast. When you are done, go to your site and start a new page titled “Aztec Cookbook.” Here, you must create a recipe using only ingredients that we know were accessible to the Aztecs. You may provide a detailed recipe of a dish described by Diaz or you may use his account as inspiration for a dish or your own creation. Either way, be careful to source local ingredients, because there are points at stake here!&lt;br&gt;
&lt;br&gt;
Once your recipe is complete, paste a link here to share with the other players. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$Moc_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlacaelel&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$Tlc_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cuauhtemoc&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$Cu_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cacamatzin&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$Ca_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
Your recipe is:  &lt;&lt;textbox &quot;$AP_Rec&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;
&lt;&lt;/if&gt;&gt;

When your contribution to the cookbook is ready, you may continue &lt;&lt;link &quot;on to the feast&quot; &quot;Everyone Gathers for a Feast&quot;&gt;&gt;&lt;&lt;storeSet $Feast = $Feast + 1&gt;&gt;&lt;&lt;/link&gt;&gt;!</tw-passagedata><tw-passagedata pid="175" name="Smallpox in Tenochtitlán" tags="" position="2575,12025" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Hostage_Exch is &quot;Yes&quot;&gt;&gt;
They are finally gone. For seven months, the strangers occupied your city. For seven months, their presence dominated life in Tenochtitlán. Rather than celebrate, your friends and neighbors breathe a sigh of relief, thankful to reclaim the city.&lt;br&gt;
&lt;br&gt;
This respite is short-lived, however, for it&#39;s not long before a new enemy enters the city. Though invisible, this enemy is deadly and it rains death upon the people of Tenochtitlán. You&#39;ve never seen a sickness like this before, one that kills almost everyone it touches. This can only be a curse from the Gods!&lt;br&gt;
&lt;br&gt;
The sickness lasts for many moons and by the time it finally leaves, only half the population remains.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Hostage_Exch is &quot;No&quot;&gt;&gt;
They are finally gone. For seven months, the strangers occupied your city. For seven months, their presence dominated life in Tenochtitlán. But now you have cut them down! Those who escaped with their lives must cower in fear at the strength of the mighty Mexica! You have suffered your own losses, however, and now it is time to mourn the dead. &lt;br&gt;
&lt;br&gt;
Little could you have imagined that you would soon be mourning many more, for it&#39;s not long before a new enemy enters the city. Though invisible, this enemy is deadly and it rains death upon the people of Tenochtitlán. You&#39;ve never seen a sickness like this before, one that kills almost everyone it touches. This can only be a curse from the Gods!&lt;br&gt;
&lt;br&gt;
The sickness lasts for many moons and by the time it finally leaves, only half the population remains.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $Tlax_Final_Dec eq &quot;&quot; or ndef $Tlax_Final_Dec&gt;&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Tlax_Leader&gt;&gt; to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Dec is &quot;Span&quot;&gt;&gt;
Rumors from the mountains begin to [[trickle in|Tlaxcala helps the Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Dec is &quot;AttackSpan&quot;&gt;&gt;
Rumors from the mountains begin to [[trickle in|Battle Outcome Spaniards Versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Dec is &quot;Alone&quot;&gt;&gt;
Rumors from the mountains begin to [[trickle in|Tlaxcala Does Nothing Spaniards Fight Aztecs Alone]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Dec is &quot;Aztecs&quot;&gt;&gt;
Rumors from the mountains begin to [[trickle in|Tlaxcala Sides with the Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="176" name="Spaniards Attack" tags="Done" position="1825,4800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
The next morning, you ask your hosts to summon all the nobles of the city so you can deliver an address. After thanking them for their hospitality, you inform them that you must now carry on your journey and ask for some men to help load your supplies. When everyone is gathered outside the main temple, you order your men to kill everyone present. You then spill into the streets of Cholula, killing everyone in sight.&lt;br&gt;
&lt;br&gt;
Hearing the noise from outside the walls, your Tlaxcalan friends enter the city and join you in your pillage. As you gather all the gold and silver you can find, they help themselves to the Cholulan stocks of salt and cloth--items they&#39;ve been denied by an Aztec embargo.&lt;br&gt;
&lt;br&gt;
You leave the city of Cholula a smoldering mess and [[carry on your journey|Cholula Spanish Leadership Challenge]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Span_Leader isnot $users[$userId][&quot;role&quot;] and $users[$userId][&quot;role&quot;] isnot &quot;Marina&quot;&gt;&gt;
The next morning, &lt;&lt;print $Span_Leader&gt;&gt; asks your hosts to summon all the nobles of the city so he can deliver an address. After thanking them for their hospitality, he informs them that you must now carry on your journey and asks for some men to help load your supplies. When everyone is gathered outside the main temple, he orders you to kill everyone present. You then spill into the streets of Cholula, killing everyone in sight.&lt;br&gt;
&lt;br&gt;
Hearing the noise from outside the walls, your Tlaxcalan friends enter the city and join you in your pillage. As you gather all the gold and silver you can find, they help themselves to the Cholulan stocks of salt and cloth--items they&#39;ve been denied by an Aztec embargo.&lt;br&gt;
&lt;br&gt;
You leave the city of Cholula a smoldering mess and [[carry on your journey|Cholula Spanish Leadership Challenge]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
The next morning, &lt;&lt;print $Span_Leader&gt;&gt; asks your hosts to summon all the nobles of the city so he can deliver an address. After thanking them for their hospitality, he informs them that you must now carry on your journey and asks for some men to help load your supplies. When everyone is gathered outside the main temple, he orders his men to kill everyone present. They then spill into the streets of Cholula, killing everyone in sight.&lt;br&gt;
&lt;br&gt;
Hearing the noise from outside the walls, the Tlaxcalan army enters the city and joins in the pillage. The Spanish gather all the gold and silver they can find, while the Tlaxcalsn help themselves to the Cholulan stocks of salt and cloth--items they&#39;ve been denied by an Aztec embargo.&lt;br&gt;
&lt;br&gt;
You leave the city of Cholula a smoldering mess and [[carry on your journey|Cholula Spanish Leadership Challenge]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="177" name="Spaniards Battle the Tabascans" tags="Done Breaks" position="1525,825" size="100,100">&lt;&lt;theyr&gt;&gt;
You continue along the coast, stopping next at a place called Tabasco. &lt;br&gt;
&lt;br&gt;
As you make your way inland, curious what lies ahead, you hear the sound of drums. You barely have time to process the sound before you realize that you&#39;ve been surrounded by an entire army of native warriors, their faces painted in black and white, armed bows and arrows, lances, slings, and stones.&lt;br&gt;
&lt;br&gt;
Recalling this event years later, Bernal Diaz wrote: 
“they rushed upon us like mad dogs completely surrounding us, and they let fly such a cloud of arrows, javelins and stones that on the first assault they wounded over seventy of us...I remember that when we fired shots the Indians gave great shouts and whistles and threw dust and rubbish into the air so that we should not see the damage done to them, and they sounded their trumpets and drums and shouted and whistled and cried ‘Alala! Alala!&#39;”&lt;br&gt;
&lt;br&gt;
Your battle with the Tabascans was fierce, but in the end it was the cavalry that secured your victory. Your horsemen arrived late to the battle and overwhelmed the native force. You manage to take five captives and send two of them back to their leader, laden with beads and gifts. Speaking in the strange native tongue, Aguilar instructs them to deliver a message: The native peoples of this land have nothing to fear, for you come in peace. &lt;br&gt;
&lt;br&gt;
You continue inland, [[following behind|Spaniards Meet Marina]] the native messengers.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="178" name="Spaniards Cannot Go Back" tags="" position="1925,2025" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is &quot;Cortes&quot;&gt;&gt;
It turns out that your bold decision may not have been the best course of action! Rumors of a mutiny were unfounded and your crew were shocked when they saw what you had done to the ships. Despite their desire to keep moving forward, this discovery has a significant impact on team morale.&lt;br&gt;
&lt;br&gt;
Head to the Spanish discussion board and explain yourself. How can you rebuild their trust after what you have done?&lt;br&gt;
&lt;br&gt;
When you have made your case, [[you may carry on|The Spaniards Head Inland]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Span_Leader is &quot;Olid&quot;&gt;&gt;
Your bold decision has paid off! When they saw what you did to the ships, you could see the horror on their faces. You have left them with no choice but to forge onward, though you must now concede to Olid&#39;s authority. &lt;br&gt;
&lt;br&gt;
Head to the Spanish discussion board and explain yourself. Can you rebuild their trust after what you have done?&lt;br&gt;
&lt;br&gt;
When you have made your case, [[you may carry on|The Spaniards Head Inland]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Olid&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is &quot;Cortes&quot;&gt;&gt;
After the first encounter with the fabled Mexica, the group was uneasy. Cortes, mistaking the unease for a desire to go inland made a bold move. In a bid to force the group inland, he beached your ships! Though not destroyed, fixing them would require many weeks of repair, assuming you could even find the necessary materials. &lt;br&gt;
&lt;br&gt;
Clearly, your desire to lead was not misplaced! Perhaps now, your teammates will begin to see Cortes for who he really is.&lt;br&gt;
&lt;br&gt;
There is little choice now but to forge onward. Head to the Spanish discussion board to hear what Cortes has to say about this. How will the team move forward with so many betrayals? How will you play this relationship [[moving forward|The Spaniards Head Inland]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Span_Leader is &quot;Olid&quot;&gt;&gt;
After the first encounter with the fabled Mexica, the group was uneasy. Cortes, mistaking the unease for a desire to go inland made a bold move. In a bid to force the group inland, he beached your ships! Though not destroyed, fixing them would require many weeks of repair, assuming you could even find the necessary materials. &lt;br&gt;
&lt;br&gt;
Clearly, your desire to lead and your teammates trust in you were both warranted!&lt;br&gt;
&lt;br&gt;
There is little choice now but to forge onward. Head to the Spanish discussion board to hear what Cortes has to say about this. How will the team move forward with so many betrayals? As the new leader, it is your responsibility to get everybody working together [[if you are going to survive|The Spaniards Head Inland]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Marina&quot; or &quot;Aguilar&quot; or &quot;Garrido&quot; or &quot;Alvarado&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is &quot;Cortes&quot;&gt;&gt;
After the first encounter with the fabled Mexica, the group was uneasy. Cortes, mistaking the unease for a desire to go inland made a bold move. In a bid to force the group inland, he beached your ships! Though not destroyed, fixing them would require many weeks of repair, assuming you could even find the necessary materials. &lt;br&gt;
&lt;br&gt;
Maybe you should have listened to Olid!&lt;br&gt;
&lt;br&gt;
There is little choice now but to forge onward. Head to the Spanish discussion board to hear what Cortes has to say about this. How will the team move forward with [[so many betrayals|The Spaniards Head Inland]]?&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Span_Leader is &quot;Olid&quot;&gt;&gt;
After the first encounter with the fabled Mexica, the group was uneasy. Cortes, mistaking the unease for a desire to go inland made a bold move. In a bid to force the group inland, he beached your ships! Though not destroyed, fixing them would require many weeks of repair, assuming you could even find the necessary materials. &lt;br&gt;
&lt;br&gt;
Clearly, you&#39;ve made the right decision in electing Olid as your new winner.&lt;br&gt;
&lt;br&gt;
There is little choice now but to forge onward. Head to the Spanish discussion board to hear what Cortes has to say about this. How will the team move forward with so [[many betrayals|The Spaniards Head Inland]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="179" name="Spaniards Decide How to Proceed" tags="" position="2200,11350" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $NT_Fight eq &quot;&quot; or ndef $NT_Fight&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has not made a decision yet.

&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $NT_Fight is &quot;Yes&quot;&gt;&gt;
It is decided.  You gather yourself together and prepare to [[do battle with the Aztecs once again|Spaniards Fight the Aztecs Alone]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $NT_Fight is &quot;No&quot;&gt;&gt;
It is decided.  You gather yourself together and prepare to [[return to Tlaxcala|Spaniards Retreat to Tlaxcala]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] eq $New_Aztec_Leader&gt;&gt;
&lt;&lt;if $NT_Fight eq &quot;&quot; or ndef $NT_Fight&gt;&gt;
A calm settles over the city, and you wonder what the Spaniards will do next.
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $NT_Fight eq &quot;Yes&quot;&gt;&gt;
A calm settles over the city, [[and you wonder what the Spaniards will do next|Spaniards Fight the Aztecs Alone]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $NT_Fight eq&quot;No&quot;&gt;&gt;
A calm settles over the city, but strange things &lt;&lt;link &quot;are unfolding in Tenochtitlan&quot; &quot;Smallpox in Tenochtitlán&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]*=.5&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $NT_Fight eq &quot;&quot; or ndef $NT_Fight&gt;&gt;
A calm settles over the city, and you wonder what the Spaniards will do next.
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $NT_Fight eq &quot;Yes&quot;&gt;&gt;
A calm settles over the city, [[and you wonder what the Spaniards will do next|Spaniards Fight the Aztecs Alone]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $NT_Fight eq &quot;No&quot;&gt;&gt;
A calm settles over the city, but strange things [[are unfolding in Tenochtitlan|Smallpox in Tenochtitlán]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $NT_Fight eq &quot;&quot; or ndef $NT_Fight&gt;&gt;
You wait and wonder what the Spaniards will do next.
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $NT_Fight eq &quot;Yes&quot;&gt;&gt;
You wait and [[wonder what the Spaniards will do next|Spaniards Fight the Aztecs Alone]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $NT_Fight eq &quot;No&quot;&gt;&gt;
You wait and [[wonder what the Spaniards will do next|Spaniards Retreat to Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="180" name="Spaniards Decide Whether to Retreat to Tlaxcala" tags="" position="2525,11250" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
&lt;&lt;if $Hostage_Exch is &quot;Yes&quot;&gt;&gt;
As you exit the causeway and the city of Tenochtitlán fades into the distance, you breathe a sigh of relief. You spent seven long months inside the city, surrounded by your enemies and acutely aware of your own vulnerability. The path before you may not yet be clear or free of danger, but your sense of security has ithemproved considerably.&lt;br&gt;
&lt;br&gt;
It is now time to decide just what that path will be, however. You gather your most trusted counselors to weigh your options. Given the conflict with Velazquez back in Cuba and the condition of your ships, escape from the mainland is not an option. Besides, you have witnessed the riches of this land and could never walk away from so great a reward. &lt;br&gt;
&lt;br&gt;
There is no choice but to lay siege to the city. But will you go it alone or will you return to Tlaxcala and attempt to rebuild your army? If you choose the former, you have no safe place to regroup and will have to launch your attack quickly, relying on the element of surprise to strengthen your hand. To succeed at the latter, however, will require the support of the Tlaxcalan people. Do you think you have it?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and consider your options. When you have made your decision, input your choice below.&lt;br&gt;
&lt;br&gt;
You may then move forward with your plan.
&lt;br&gt;
&lt;br&gt;
Option 1: &lt;&lt;link &quot;Attack Alone&quot; &quot;Spaniards Fight the Aztecs Alone&quot;&gt;&gt;&lt;&lt;storeSet $NT_Fight=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
Option 2: &lt;&lt;link &quot;Retreat to Tlaxcala&quot; &quot;Spaniards Retreat to Tlaxcala&quot;&gt;&gt;&lt;&lt;storeSet $NT_Fight=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Hostage_Exch is &quot;No&quot;&gt;&gt;
You drag yourself to shore, eager to get beyond reach of the city that almost became your grave. You can&#39;t believe you escaped with your life! Many others were not so lucky-a fact that becomes starkly clear as you take stock of the men who now walk beside you. &lt;br&gt;
&lt;br&gt;
When you feel you have reached a safe distance, you call out to your compatriots to stop and recommend they rest a while. As the ragged soldiers settle in and create a makeshift camp with what little supplies they have, you gather your most trusted counselors to weigh your options. &lt;br&gt;
&lt;br&gt;
Given the conflict with Velazquez back in Cuba and the condition of your ships, escape from the mainland is not an option. Besides, you have witnessed the riches of this land and could never walk away from so great a reward. You inform your men that there is no choice but to lay siege to the city. But will you go it alone or will you return to Tlaxcala and attempt to rebuild your army? If you choose the former, you have no safe place to regroup and will have to launch your attack quickly. You have suffered enormous damages in your escape from the city, but you would  have the element of surprise to strengthen your hand. To succeed at the latter, however, will require the support of the Tlaxcalan people. Do you think you have it?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and consider your options. When you have made your decision, input your choice below.&lt;br&gt;
&lt;br&gt;
You may then move forward with your plan.&lt;br&gt;
&lt;br&gt;
Option 1: &lt;&lt;link &quot;Attack Alone&quot; &quot;Spaniards Fight the Aztecs Alone&quot;&gt;&gt;&lt;&lt;storeSet $NT_Fight=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
Option 2: &lt;&lt;link &quot;Retreat to Tlaxcala&quot; &quot;Spaniards Retreat to Tlaxcala&quot;&gt;&gt;&lt;&lt;storeSet $NT_Fight=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;else&gt;&gt;
&lt;&lt;if $Hostage_Exch is &quot;Yes&quot;&gt;&gt;
As you exit the causeway and the city of Tenochtitlán fades into the distance, you breathe a sigh of relief. You spent seven long months inside the city, surrounded by your enemies and acutely aware of your own vulnerability. The path before you may not yet be clear or free of danger, but your sense of security has improved considerably.&lt;br&gt;
&lt;br&gt;
It is now time to decide just what that path will be, however. &lt;&lt;print $Span_Leader&gt;&gt; gathers their most trusted counselors to weigh your options. Given the conflict with Velazquez back in Cuba and the condition of your ships, escape from the mainland is not an option. Besides, you have witnessed the riches of this land and could never walk away from so great a reward. &lt;br&gt;
&lt;br&gt;
There is no choice but to lay siege to the city. But will you go it alone or will you return to Tlaxcala and attempt to rebuild your army? If you choose the former, you have no safe place to regroup and will have to launch your attack quickly, relying on the element of surprise to strengthen your hand. To succeed at the latter, however, will require the support of the Tlaxcalan people. Do you think you have it?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and consider your options. When you have made your decision, &lt;&lt;print $Span_Leader&gt;&gt; will input your choice and you may then [[move forward with your plan|Spaniards Decide How to Proceed]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Hostage_Exch is &quot;No&quot;&gt;&gt;
You drag yourself to shore, eager to get beyond reach of the city that almost became your grave. You can&#39;t believe you escaped with your life! Many others were not so lucky-a fact that becomes starkly clear as you take stock of the men who now walk beside you. &lt;br&gt;
&lt;br&gt;
When you feel you have reached a safe distance, &lt;&lt;print $Span_Leader&gt;&gt; calls out to your compatriots to stop and recommend they rest a while. As the ragged soldiers settle in and create a makeshift camp with what little supplies they have, you gather your most trusted counselors to weigh your options. &lt;br&gt;
&lt;br&gt;
Given the conflict with Velazquez back in Cuba and the condition of your ships, escape from the mainland is not an option. Besides, you have witnessed the riches of this land and could never walk away from so great a reward. You inform your men that there is no choice but to lay siege to the city. But will you go it alone or will you return to Tlaxcala and attempt to rebuild your army? If you choose the former, you have no safe place to regroup and will have to launch your attack quickly. You have suffered enormous damages in your escape from the city, but you would  have the element of surprise to strengthen your hand. To succeed at the latter, however, will require the support of the Tlaxcalan people. Do you think you have it?&lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and consider your options. When you have made your decision, &lt;&lt;print $Span_Leader&gt;&gt; will input your choice and you may then [[move forward with your plan|Spaniards Decide How to Proceed]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="181" name="Spaniards Defeat Tlaxcalans and Fight Aztecs Alone" tags="" position="2450,12375" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
The battle against Tlaxcala was long and hard-fought. The Spanish forces have been greatly weakened and now your friends must face the Mexica alone. You heard that the city has been devastated by disease, but will this be enough to assure a Spanish victory?&lt;br&gt;
&lt;br&gt;
You leave Tlaxcala in ruins and start your journey back to Tenochtilán. You have no choice but to return alone. As you near the city, you set up camp for the night, preparing to attack by dark. When all is ready, the Spaniards launch their attack, cutting off the causeways and trapping the Mexica inside the city. Despite being caught off guard, the Mexica mount a powerful defense. The people of the city spent weeks preparing for just such a battle, and they are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you could have imagined. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs versus Spaniards 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The battle against Tlaxcala was long and hard-fought. Your forces have been greatly weakened and now you must face the Mexica alone. You heard that the city has been devastated by disease, but will this be enough to assure your victory?&lt;br&gt;
&lt;br&gt;
You leave Tlaxcala in ruins and start your journey back to Tenochtilán. You have no choice but to return alone. As you near the city, you set up camp for the night, preparing to attack by dark. When all is ready, you launch your attack, cutting off the causeways and trapping the Mexica inside the city. Despite being caught off guard, the Mexica mount a powerful defense. The people of the city spent weeks preparing for just such a battle, and they are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve ever experienced before. The stakes are high and this will be a fight to the death for both sides.The residents of the city-young, old, man, woman-all join the fray, luring your men into traps and fighting with makeshift weapons. Many others, however, fall victim to your superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs versus Spaniards 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The past months have been a waking nightmare. The arrival of the strangers on your shore so long ago set in motion a chain of events beyond your wildest imagination. You prayed to the Gods to restore peace and order, but the departure of the Spaniards was followed by a plague worse than any before seen. Tenochtilán has seemed like a ghost town of late, those who remain weighed down by grief and loss.&lt;br&gt;
&lt;br&gt;
In the midst of this horror, you are awoken in the dead of night by an attack! It seems the Spaniards have attempted to catch you off guard! Despite the despair that hangs like a cloud over the city, the people are quick to launch a defense. You spent months preparing for just such a fight and now the time has come.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve seen before. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs versus Spaniards 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="182" name="Spaniards Defeat Tlaxcalans and Fight Aztecs Alone Aztec Victory" tags="" position="3800,14300" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over the city, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Mexica.&lt;br&gt;
&lt;br&gt;
The Mexica have won the battle! Will you be able to escape the city with your life or will you meet [[the same fate as your friends|The End]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Even through the chaos that surrounds you, you can see your men falling one after the next. The horror of what lies before you barely registers before you fall to your knees, cut down by your enemy. You give your last breath knowing that your death will be in vain. &lt;br&gt;
&lt;br&gt;
You have lost your battle. Glory has eluded you and your [[name will be forgotten by history|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization.&lt;br&gt;
&lt;br&gt;
You have won the battle! You have saved your city and [[brought death to your enemies|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="183" name="Spaniards Defeat Tlaxcalans and Fight Aztecs Alone Spanish Victory" tags="" position="3650,14300" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over the city, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Spanish.&lt;br&gt;
&lt;br&gt;
The Spaniards have won the battle! But will they repay you for [[the debt they owe you|The End]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization. &lt;br&gt;
&lt;br&gt;
You have won the battle! The city is yours and you will [[reap your reward|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Even through the chaos that surrounds you, you can see your men falling one after the next. The horror of what lies before you barely registers before you fall to your knees, cut down by your enemy. You give your last breath knowing that your death will be in vain. &lt;br&gt;
&lt;br&gt;
You have lost your battle. [[The city belongs to your enemies now|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="184" name="Spaniards Descend into the Valley" tags="" position="2300,5900" size="100,100">&lt;&lt;theyr&gt;&gt;
You wake to find yourself exactly where you hoped: back at camp, on the road to Tenochtitlán! You lead an army of over 10,000 men, with your Tlaxcalan allies at your side.&lt;br&gt;
&lt;br&gt;
You pack up camp and set out for your destination. Your Tlaxcalan friends have assured you that Tenochtitlán is just around the corner. You crest a hill and can [[hardly believe your eyes|Spaniards Write Letters]]. &lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="185" name="Spaniards Enter Cholula" tags="Done" position="1975,4125" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Cholula_Attack or $Cholula_Attack eq &quot;&quot;&gt;&gt;
You enter the ancient city of Cholula, which is bustling with people. Your hosts inform you that this is a holy place, where the God Quetzalcoatl stands watch. They guide you through the city, where you are awed by a massive central temple and a vibrant market. &lt;br&gt;
&lt;br&gt;
You wait, wondering what will happen next.  &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Aztecs to do something.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Cholula_Attack is &quot;Yes&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You enter the ancient city of Cholula, which is bustling with people. Your hosts inform you that this is a holy place, where the God Quetzalcoatl stands watch. They guide you through the city, where you are awed by a massive central temple and a vibrant market. &lt;br&gt;
&lt;br&gt;
As dusk settles in, you are approached by a local woman who wishes to [[speak with you in private|Marina Hears a Real Rumor]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You enter the ancient city of Cholula, which is bustling with people. Your hosts inform you that this is a holy place, where the God Quetzalcoatl stands watch. They guide you through the city, where you are awed by a massive central temple and a vibrant market. &lt;br&gt;
&lt;br&gt;
Your hosts treat you to a feast and provide you with the finest accommodations. You bed down for the night, grateful to have avoided any conflict but [[wary of what may yet come to pass|A Trap in Cholula]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;elseif $Cholula_Attack is &quot;No&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You enter the ancient city of Cholula, which is bustling with people. Your hosts inform you that this is a holy place, where the God Quetzalcoatl stands watch. They guide you through the city, where you are awed by a massive central temple and a vibrant market. &lt;br&gt;
&lt;br&gt;
As dusk settles in, you are approached by a local woman who wishes to [[speak with you in private|Marina Hears a Rumor]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You enter the ancient city of Cholula, which is bustling with people. Your hosts inform you that this is a holy place, where the God Quetzalcoatl stands watch. They guide you through the city, where you are awed by a massive central temple and a vibrant market. &lt;br&gt;
&lt;br&gt;
Your hosts treat you to a feast and provide you with the finest accommodations. You bed down for the night, grateful to have avoided any conflict but [[wary of what may yet come to pass|No Trap in Cholula]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="186" name="Spaniards Fight the Aztecs Alone" tags="" position="2850,11400" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Hostage_Exch is &quot;Yes&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;faction&quot;] is &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
Your friends have decided that your best chance of success is to launch an immediate attack. Your hosts just watched you depart in peace, so they will never expect a surprise attack right now! You have the advantage and must strike while it is least expected.&lt;br&gt;
&lt;br&gt;
There is a frenzy among the men as they quickly prepare for battle, with you at their side. When all is ready, you launch your attack by night, cutting off the causeways and trapping the Mexica inside the city. Despite being caught off guard, the Mexica mount a powerful defense. The people of the city spent weeks preparing for just such a battle, and they are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you could have imagined. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes [[clear which side will win|Victory Decision Aztecs versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have decided that your best chance of success is to launch an immediate attack. Your hosts just watched you depart in peace, so they will never expect a surprise attack right now! You have the advantage and must strike while it is least expected.&lt;br&gt;
&lt;br&gt;
There is a frenzy among the men as you quickly prepare for battle. When all is ready, you launch your attack by night, cutting off the causeways and trapping the Mexica inside the city. Despite being caught off guard, the Mexica mount a powerful defense. The people of the city spent weeks preparing for just such a battle, and they are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve ever experienced before. The stakes are high and this will be a fight to the death for both sides.The residents of the city-young, old, man, woman-all join the fray, luring your men into traps and fighting with makeshift weapons. Many others, however, fall victim to your superior weapons. The scene descends into mayhem, but it soon becomes [[clear which side will win|Victory Decision Aztecs versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $users[$userId][&quot;faction&quot;] is &quot;Aztecs&quot;&gt;&gt;
They are finally gone. For seven months, the strangers occupied your city. For seven months, their presence dominated life in Tenochtitlán. Rather than celebrate, your friends and neighbors breathe a sigh of relief and settle in for the night, thankful to reclaim the city.&lt;br&gt;
&lt;br&gt;
The calm does not last, however, for you are awoken in the dead of night by an attack! It seems the Spaniards were not to be trusted and they have attempted to catch you off guard! Nonetheless, the people of the city are quick to launch a defense. They have spent months preparing for just such a fight!&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve seen before. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes [[clear which side will win|Victory Decision Aztecs versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;faction&quot;] is &quot;Tlaxcalans&quot;&gt;&gt;
More news has arrived from Tenochtitlán. It seems the Spaniards were able to trade their captive for passage out of the city. &lt;&lt;print $Aztec_Leader&gt;&gt; lives and has been freed from his shackles. Shortly after departing the city, however, the Spaniards returned to launch a surprise attack, catching the Mexica off guard!&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and consider this turn of events with the rest of your team. Was this a bold and clever move or was it deceitful? Does this change your opinion of the Spaniards or does it confirm what you already knew? &lt;br&gt;
&lt;br&gt;
Once you have discussed this turn of events, you may proceed to learn the [[outcome of the battle|Victory Decision Aztecs versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;elseif $Hostage_Exch is &quot;No&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;faction&quot;] is &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
Despite your weakened state, your friends have decided that their best chance of success is to launch an immediate attack. Your hosts surely feel secure in their victory, so they will never expect a surprise attack right now! If you are to have any chance of survival, you must strike while it is least expected!&lt;br&gt;
&lt;br&gt;
There is a frenzy among the men as they spend the following day preparing for battle, with you at their side. When all is ready, you launch your attack by night, cutting off the causeways and trapping the Mexica inside the city. Despite being caught off guard, the Mexica mount a powerful defense. They are surely weary from the last fight, but they are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you could have imagined. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes [[clear which side will win|Victory Decision Aztecs versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Despite your weakened state, you have decided that your best chance of success is to launch an immediate attack. Your hosts surely feel secure in their victory, so they will never expect a surprise attack right now! If you are to have any chance of survival, you must strike while it is least expected.&lt;br&gt;
&lt;br&gt;
There is a frenzy among the men as you spend the following day preparing for battle. When all is ready, you launch your attack by night, cutting off the causeways and trapping the Mexica inside the city. Despite being caught off guard, the Mexica mount a powerful defense. They are surely weary from the last fight, but they are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve ever experienced before. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring your men into traps and fighting with makeshift weapons. Many others, however, fall victim to your superior weapons. The scene descends into mayhem, but it soon becomes [[clear which side will win|Victory Decision Aztecs versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $users[$userId][&quot;faction&quot;] is &quot;Aztecs&quot;&gt;&gt;
They are finally gone. For seven months, the strangers occupied your city. For seven months, their presence dominated life in Tenochtitlán. But now you have cut them down! Those who escaped with their lives must cower in fear at the strength of the mighty Mexica! You have suffered your own losses, however, and now it is time to mourn the dead. &lt;br&gt;
&lt;br&gt;
The calm does not last, however, for you only a day passes before your enemies make their next move. You are awoken in the dead of night by an attack! It seems the Spaniards have attempted to catch you off guard! Nonetheless, the people of the city are quick to launch a defense. Despite the weariness that remains from the recent fight, your people are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve seen before. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes [[clear which side will win|Victory Decision Aztecs versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;faction&quot;] is &quot;Tlaxcalans&quot;&gt;&gt;
More news has arrived from Tenochtitlán. After barely escaping the city with their lives, the Spaniards returned to launch a surprise attack, catching the Mexica off guard!&lt;br&gt;
&lt;br&gt; 
Go to the Tlaxcalan discussion board and consider this turn of events with the rest of your team. Was this a bold and clever move or was it stupid and wreckless? Does this change your opinion of the Spaniards or does it confirm what you already knew? &lt;br&gt;
&lt;br&gt;
Once you have discussed this turn of events, you may proceed to learn the [[outcome of the battle|Victory Decision Aztecs versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="187" name="Spaniards Fight the Aztecs Alone Aztec Victory" tags="" position="2775,11900" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over the city, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Mexica.&lt;br&gt;
&lt;br&gt;
The Mexica have won the battle! Will you be able to escape the city with your life or will you meet [[the same fate as your friends|The End]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Even through the chaos that surrounds you, you can see your men falling one after the next. The horror of what lies before you barely registers before you fall to your knees, cut down by your enemy. You give your last breath knowing that your death will be in vain. &lt;br&gt;
&lt;br&gt;
You have lost your battle. Glory has eluded you and your name will be [[forgotten by history|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization.&lt;br&gt;
&lt;br&gt;
You have won the battle! You have saved your city and [[brought death to your enemies|Tlaxcalans Make the First Decision about Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
The battle was quick and bloody, but the Spaniards&#39; daring move has cost them dearly! The Mexica have vanquished the foreigners, once and for all. &lt;br&gt;
&lt;br&gt;
As you contemplate this turn of events, you wonder what this means for your people. The Mexica are your hated enemy and they have been badly weakened by the events of the last months. But have they been chastened? Or will they brutalize Tlaxcala in an attempt to rebuild their power? You consider your options and realize you have two choices: you can either launch a surprise attack and attempt to defeat the Mexica in their weakened state or you can attempt to make peace and put an end to years of fighting.&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options with the other members of your team. When you have reached a decision, input your choice here&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;Attack the Aztecs&quot; &quot;Tlaxcala Attacks Aztecs&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Bat = &quot;War&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2: &lt;/b&gt; &lt;&lt;link &quot;Make a Peace Treaty&quot; &quot;Tlaxcala Makes a Peace Treaty with the Aztecs&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Bat = &quot;Peace&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The battle was quick and bloody, but the Spaniards&#39; daring move has cost them dearly! The Mexica have vanquished the foreigners, once and for all. &lt;br&gt;
&lt;br&gt;
As you contemplate this turn of events, you wonder what this means for your people. The Mexica are your hated enemy and they have been badly weakened by the events of the last months. But have they been chastened? Or will they brutalize Tlaxcala in an attempt to rebuild their power? You consider your options and realize you have two choices: you can either launch a surprise attack and attempt to defeat the Mexica in their weakened state or you can attempt to make peace and put an end to years of fighting.&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options with the other members of your team. When you have reached a decision, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your choice. When this is complete, you may carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="188" name="Spaniards Fight the Aztecs Alone Spanish Victory" tags="" position="2375,11775" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over the city, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Spanish.&lt;br&gt;
&lt;br&gt;
The Spaniards have won the battle! But will they repay you for the debt they owe you?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization.&lt;br&gt;
&lt;br&gt;
You have won the battle! The city is yours and [[you will reap your reward|Tlaxcalans Make the First Decision about Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Even through the chaos that surrounds you, you can see your men falling one after the next. The horror of what lies before you barely registers before you fall to your knees, cut down by your enemy. You give your last breath knowing that your death will be in vain. &lt;br&gt;
&lt;br&gt;
You have lost your battle. The city [[belongs to your enemies now|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
The battle was quick and bloody, but the Spaniards&#39; daring move paid off! They have emerged victorious and, in doing so, they have finally seized the Aztec capital and toppled the mighty Aztec empire. Can it really be true?&lt;br&gt;
&lt;br&gt;
As you contemplate this turn of events, you wonder what this means for your people. The Mexica were your hated enemy, but will life be any better under these new overlords? What is your best chance of survival? You consider your options and realize you have two choices: you can either launch a surprise attack and attempt to claim the empire for yourselves or you can attempt to make peace with the Spaniards.&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options with the other members of your team. When you have reached a decision, input your choice here&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;Attack the Spaniards&quot; &quot;Tlaxcala Attacks the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Bat = &quot;War&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2: &lt;/b&gt; &lt;&lt;link &quot;Make a Peace Treaty&quot; &quot;Tlaxcala Does Nothing and Makes a Peace Treaty with Spanish Winners&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Bat = &quot;Peace&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The battle was quick and bloody, but the Spaniards&#39; daring move paid off! They have emerged victorious and, in doing so, they have finally seized the Aztec capital and toppled the mighty Aztec empire. Can it really be true?&lt;br&gt;
&lt;br&gt;
As you contemplate this turn of events, you wonder what this means for your people. The Mexica were your hated enemy, but will life be any better under these new overlords? What is your best chance of survival? You consider your options and realize you have two choices: you can either launch a surprise attack and attempt to claim the empire for yourselves or you can attempt to make peace with the Spaniards.&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options with the other members of your team. When you have reached a decision, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your choice. When this is complete, you may carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="189" name="Spaniards Keep Aztec Leader Alive" tags="" position="3200,10425" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You have decided that the benefit of keeping &lt;&lt;print $Aztec_Leader&gt;&gt; alive outweighs the risk. Only time will tell if you have [[made the right choice|Spaniards Plot their Departure]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
You contemplate your situation and wonder how you ended up in this position. Are you not the most powerful man alive? What could you have done to anger the gods?&lt;br&gt;
&lt;br&gt;
You put an end to the riot outside and have proven your value as a hostage, but you know that your captors could turn against you at any minute. You must trust your council to make the right decisions.&lt;br&gt;
&lt;br&gt;
All you can do now is wait to [[see what happens next|Spaniards Plot their Departure]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
An uneasy calm has settled upon the city, but it is clear this situation cannot continue. Though you chose to heed the warning of &lt;&lt;print $Aztec_Leader&gt;&gt; this time, it is clear that he is no longer capable of leading your people. You gather the council [[for a meeting|Aztec Leader Lives and Aztecs Choose a Leader Riot]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You&#39;ve just received another report from Tenochtitlán. It seems there was a riot among the citizens of Tenochtitlán. The Spaniards sent the captive &lt;&lt;print $Aztec_Leader&gt;&gt; out to calm the crowd and he was able to restore calm to the city…but barely. Rumor has it that the city&#39;s nobles have may be losing faith in their leader.&lt;br&gt;
&lt;br&gt;
What does fate have in store for the captive Mexica ruler? [[Only time will tell|Spaniards Plot their Departure]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="190" name="Spaniards Keep Aztec Leader Alive Riot" tags="" position="2800,10325" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You have decided that the benefit of saving &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s life outweighs the risk. You tend to his wounds and keep a careful watch over the fallen leader. Only time will tell if you have [[made the right choice|Spaniards Plot their Departure]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
You are gravely wounded, but your captors have saved your life. They treat your wounds and watch over you as you recover. However, you cannot wonder if you would have been better off dead. What dignity have you left? You contemplate your situation and wonder how you ended up in this position. Are you not the most powerful man alive? What could you have done to anger the gods?&lt;br&gt;
&lt;br&gt;
Your people have turned against you and your fate is now in the hands of your Spanish enemies. All you can do now is wait to [[see what happens next|Spaniards Plot their Departure]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The riot lasted for many hours, as the residents of the city released months of anger and frustration. An uneasy calm has now settled upon the city, but it is clear this situation cannot continue. The people have lost faith in &lt;&lt;print $Aztec_Leader&gt;&gt;. It is clear that he is no longer capable of leading your people. You gather the council [[for a meeting|Aztec Leader Lives and Aztecs Choose a Leader Riot]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You&#39;ve just received another report from Tenochtitlán: &lt;&lt;print $Aztec_Leader&gt;&gt; is wounded! It seems there was a riot among the citizens of Tenochtitlán. The Spaniards sent the captive &lt;&lt;print $Aztec_Leader&gt;&gt; out to calm the crowd but they turned on him! He was struck in the head with a rock. Your spies report that he was still alive when the strangers carried him back into the palace. &lt;br&gt;
&lt;br&gt;

It seems the mighty &lt;&lt;print $Aztec_Leader&gt;&gt; has proven to be just as mortal as everyone else. You wonder [[what will be his fate|Spaniards Plot their Departure]] .&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="191" name="Spaniards Kill Aztec Leader" tags="" position="3000,10325" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You have decided that the risk of keeping &lt;&lt;print $Aztec_Leader&gt;&gt; alive outweighs the benefit and have sent him to meet his Gods. &lt;br&gt;
&lt;br&gt;
You send a messenger to the roof of the palace to inform the residents of Tenochtitlán that their leader is dead. Though you feared a riot, the city remains strangely calm. You worry at the quiet that settles over the city and hope that you will not live to [[regret this decision|Spaniards Plot their Departure]].
&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
As you descend back into the palace, you can feel the tension in the air. Your captors seem nervous and have been whispering excitedly amongst themselves.&lt;br&gt;
&lt;br&gt; 
As you feel the knife in your back, you cry out to your attacker. Do you not deserve a more dignified death than this?! As you slip into darkness, you wonder one last time how your gods could have [[forsaken you so|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
It is not long before you learn of &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s fate. After the mob receded and people retreated back to their homes, a messenger returned to the roof of the palace bearing the worst possible news: &lt;&lt;print $Aztec_Leader&gt;&gt; is dead, slain by the hands of his Spanish captors. &lt;br&gt;
&lt;br&gt;
The treachery! The deceit! How could the gods have forsaken your people so? &lt;br&gt;
&lt;br&gt;
The council gathers in haste. [[Decisions must be made|Aztec Leader Dies and Aztecs Choose a Leader Riot]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You&#39;ve just received a shocking report from Tenochtitlán: &lt;&lt;print $Aztec_Leader&gt;&gt; is dead! You can hardly believe the news! It seems there was a riot among the citizens of Tenochtitlán. The Spaniards sent the captive &lt;&lt;print $Aztec_Leader&gt;&gt; out to calm the crowd and, though he succeeded, the foreigners no longer saw any value in keeping him alive. &lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; was your enemy, but he was the most powerful man in the world. Will the Gods forgive the Spaniards for this crime? [[Only time will tell|Spaniards Plot their Departure]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="192" name="Spaniards Kill Aztec Leader Riot" tags="" position="2525,10375" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You have decided that the risk of keeping &lt;&lt;print $Aztec_Leader&gt;&gt; alive outweighs the benefit. This injury at the hands of his people has provided you with an excellent opportunity: you can put an end to him and they will never know. You decide to finish him off and send him to meet his Gods. &lt;br&gt;
&lt;br&gt;
You send a messenger to the roof of the palace to inform the residents of Tenochtitlán that their leader is dead, brought down by the hands of his own people! Though you fear another riot, the city remains strangely calm. You worry at the quiet that settles over the city and hope that you will not live to [[regret this decision|Spaniards Plot their Departure]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Aztec_Leader&gt;&gt;
Someone is carrying you back into the palace. Even in your confusion, you can feel the tension in the air. Your captors seem nervous and have been whispering excitedly amongst themselves. &lt;br&gt;
&lt;br&gt;
As you feel the knife in your back, you cry out to your attacker. Do you not deserve a more dignified death than this?! As you slip into darkness, you wonder one last time how your gods [[could have forsaken you so|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
It is not long before you learn of &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s fate. After the chaos died down and people retreated back to their homes, a messenger returned to the roof of the palace bearing the worst possible news: &lt;&lt;print $Aztec_Leader&gt;&gt; is dead, toppled by the hand of his own people! &lt;br&gt;
&lt;br&gt;
You yourself watched him fall on the rooftop, but could this really have been his fate? &lt;br&gt;
&lt;br&gt;
The council gathers in haste. [[Decisions must be made|Aztec Leader Dies and Aztecs Choose a Leader Riot]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You&#39;ve just received a shocking report from Tenochtitlán: &lt;&lt;print $Aztec_Leader&gt;&gt; is dead! You can hardly believe the news! It seems there was a riot among the citizens of Tenochtitlán. The Spaniards sent the captive &lt;&lt;print $Aztec_Leader&gt;&gt; out to calm the crowd but they turned on him! He struck in the head with a rock. Your spies report that he was still alive when the strangers carried him back into the palace and no one has seen the body. However, shortly thereafter, the Spaniards sent a messenger out to the roof to inform the residents of the city that their Emperor was dead.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Aztec_Leader&gt;&gt; was your enemy, but he was the most powerful man in the world. Will the Gods forgive the Spaniards for this crime? [[Only time will tell|Spaniards Plot their Departure]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="193" name="Spaniards Leave Cuba" tags="Done" position="1525,50" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
As Cuba disappears behind the horizon, you are faced with a ship full of nervous, uncertain men.  You MUST convince them to move forward. &lt;br&gt;
&lt;br&gt;

Adjourn to the Spanish discussion board and convince them, persuade them, bully them, do whatever you have to do to move them forward.  &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Olid&quot; OR &quot;Alvarado&quot; OR &quot;Garrido&quot;&gt;&gt;
As Cuba disappears behind the horizon, you find yourself feeling increasingly anxious and uncertain. You must continue on your journey, but why will you continue? &lt;br&gt;
&lt;br&gt;
Adjourn to the Spanish discussion board and listen to what Cortes has to say. Decide for yourself how he will persuade you.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

When you have come to an agreement, you may  [[continue on|The Spaniards Decide to Continue]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="194" name="Spaniards Meet Marina" tags="Done Breaks" position="1525,975" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
&lt;&lt;if ndef $Mal_Story or $Mal_Story eq &quot;&quot;&gt;&gt; 
You haven&#39;t told the Spaniards your story.  Please [[return|Marina Tells Her Story]] and complete your task.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif  ndef $L_Received or $L_Received eq &quot;&quot;&gt;&gt;
You wait, wondering what will happen next.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $L_Received is &quot;Yes&quot;&gt;&gt; 
Marina, the last few days have seen a flurry of activity in the village. The Chontal leaders have been gathering food and jewelry to offer the strangers in a show of peace and friendship. Their greatest offering, however, will be a group of twenty women. These will not be the sisters or the daughters of powerful families, offered in marriage to secure alliances; instead they will be slave women, with whom the foreigners might do what they choose. The master of your house has informed you that you will be included in the offering and you are sent to join the others.&lt;br&gt;
&lt;br&gt;
When you are brought before the foreigners, one of the men performs a ceremony, speaking strange words that you cannot understand and sprinkling water over your head. He points at you while repeating the word “Marina” over and over. You understand that this is what they will call you.&lt;br&gt;
&lt;br&gt;
[[Click through|Spaniards and Marina Talk]] to see what comes of this encounter.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Cortes&quot; OR &quot;Alvarado&quot; OR &quot;Aguilar&quot; OR &quot;Garrido&quot; OR &quot;Olid&quot;&gt;&gt;

&lt;&lt;if ndef $Mal_Story or $Mal_Story eq &quot;&quot;&gt;&gt;

You arrive at the village. You sense that something important is going to happen. Keep an eye on this page.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;else&gt;&gt;

The next morning you meet with the local chiefs and you are delighted to learn that they have chosen to accept your offer of peace. They present you with a number of gifts, among them a number of gold ornaments shaped like dogs and lizards. You are excited to see the gold, but the rest of the gifts are of little value, with one exception: a group of twenty slave women.&lt;br&gt;
&lt;br&gt;
After baptizing the women and assigning each of them a Christian name, the one named Marina comes forward to present you with her story.  Copy and paste this link: &lt;br&gt;
&lt;br&gt;
&lt;b&gt;&lt;&lt;print $Mal_Story&gt;&gt;&lt;/b&gt;&lt;br&gt;
&lt;br&gt;
to learn more about her.&lt;br&gt;
&lt;br&gt;
Based on her story, what is your gut reaction to Marina? Choose one of the following:&lt;br&gt;
&lt;br&gt;
You &lt;&lt;link &quot;admire her strength&quot; &quot;Spaniards and Marina Talk&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:1})&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
You &lt;&lt;link &quot;wonder why she didn&#39;t fight back against her captors&quot; &quot;Spaniards and Marina Talk&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:-1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:-1})&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
She&#39;s &lt;&lt;link &quot;clearly very intelligent&quot; &quot;Spaniards and Marina Talk&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;. You wonder how you might use her to your advantage. &lt;br&gt;
&lt;br&gt;
You &lt;&lt;link &quot;would rather leave her behind&quot; &quot;Spaniards and Marina Talk&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:-1,&quot;Loyalty&quot;:-1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt;. Resources are already scarce and she will be one more mouth to feed.&lt;br&gt;
&lt;br&gt;
You &lt;&lt;link &quot;don&#39;t trust her&quot; &quot;Spaniards and Marina Talk&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Marina&quot;,{&quot;Wisdom&quot;:-1,&quot;Loyalty&quot;:-1,&quot;Strength&quot;:-1})&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="195" name="Spaniards Plot their Departure" tags="" position="2975,10725" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
&lt;&lt;if $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
With tension gripping the city, you decide it is time to make your escape. But will you make it out with your lives? It is clear that your hosts have run out of patience... and goodwill. You do have one potential advantage, however: &lt;&lt;print $Aztec_Leader&gt;&gt; remains your hostage. Do you think he is valuable enough to his people that he can buy you your escape? Or is he a burden that is better disposed of? &lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and decide on the best course of action. You have two choices:&lt;br&gt;
&lt;br&gt;
Option 1: Offer to release &lt;&lt;print $Aztec_Leader&gt;&gt; &lt;&lt;link &quot;in exchange for free passage out of the city&quot; &quot;Offer to Bargain or Not&quot;&gt;&gt;&lt;&lt;storeSet $Hostage=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
Option 2: Send &lt;&lt;print $Aztec_Leader&gt;&gt; &lt;&lt;link &quot;to meet his Gods&quot; &quot;Offer to Bargain or Not&quot;&gt;&gt;&lt;&lt;storeSet $Hostage=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Az_Ld_Dead=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and make your escape by cover of night. &lt;br&gt;
&lt;br&gt;
Once your team has made their choice, enter your decision and move forward with your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
With tension gripping the city, you decide it is time to make your escape. But will you make it out with your lives? It is clear that your hosts have run out of patience... and goodwill. &lt;br&gt;
&lt;br&gt;
You decide that your best chance of escape is to leave by cover of night. You will need to be quick and silent, so you decide carefully what is worth taking. After all this time coveting Moctezuma&#39;s treasure, however, you can&#39;t help but fill your pockets with all the gold and valuables you can find. You hope they won&#39;t weigh you down as you [[|]] &lt;&lt;link &quot;make your escape&quot; &quot;Noche Triste&quot;&gt;&gt;&lt;&lt;storeSet $Noche=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
With tension gripping the city, you decide it is time to make your escape. But will you make it out with your lives? It is clear that your hosts have run out of patience…and goodwill. You do have one potential advantage, however: &lt;&lt;print $Aztec_Leader&gt;&gt; remains your hostage. Do you think he is valuable enough to his people that he can buy you your escape? Or is he a burden that is better disposed of? &lt;br&gt;
&lt;br&gt;
Go to the Spanish discussion board and decide on the best course of action. You have two choices: &lt;br&gt;
&lt;br&gt;
Option 1: Offer to release &lt;&lt;print $Aztec_Leader&gt;&gt; in exchange for free passage out of the city. &lt;br&gt;
&lt;br&gt;
Option 2: Send &lt;&lt;print $Aztec_Leader&gt;&gt; to meet his gods and make your escape by cover of night. &lt;br&gt;
&lt;br&gt;
Once your team has made their choice, &lt;&lt;print $Span_Leader&gt;&gt; will enter your decision and [[you may move forward with your plan|Offer to Bargain or Not]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
With tension gripping the city, you decide it is time to make your escape. But will you make it out with your lives? It is clear that your hosts have run out of patience…and goodwill. &lt;br&gt;
&lt;br&gt;
You decide that your best chance of escape is to leave by cover of night. You will need to be quick and silent, so you decide carefully what is worth taking. After all this time coveting Moctezuma&#39;s treasure, however, you can&#39;t help but fill your pockets with all the gold and valuables you can find. You hope they won&#39;t weigh you down as [[you make your escape|Noche Triste]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if ndef $Hostage or $Hostage eq &quot;&quot;&gt;&gt;
Tension grips the city and you listen as your captors plot their escape. It seems they are deciding whether they should use you as leverage to secure safe passage out of the city. This may be your last chance to come out of this alive! &lt;br&gt;
&lt;br&gt;
Choose a Spaniard who you think might listen to reason and make your case. Perhaps you can convince them of your value.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Tension grips the city and you listen as your captors plot their escape. It seems they are deciding whether they should use you as leverage to secure safe passage out of the city. You approach their leader in attempt to plead your case, but it seems he has already made his decision. You have missed your opportunity [[and must wait to learn your fate|Offer to Bargain or Not]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if ndef $Hostage or $Hostage eq &quot;&quot;&gt;&gt;
Again, you are without news. What could be happening?&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Span_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;No&quot;&gt;&gt;
[[Finally, one of your messengers approach|Offer to Bargain or Not]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Az_Ld_Dead is &quot;Yes&quot;&gt;&gt;
[[Finally, one of your messengers approach|Noche Triste]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="196" name="Spaniards Quest Instructions 1" tags="" position="2125,250" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
A day after you first hear the conversation above, you are approached by the Mayan lord who has been your master these long years. He tells you that a pair of messengers have arrived from the coast, bearing beautiful gifts. A group of strangers have come who desire your release and they have paid him handsomely. Your master informs you that you are free and hands you a letter. It reads: &lt;br&gt;
&lt;br&gt;
“Gentlemen and brothers, here in Cozumel I have learnt that you are captives in the hands of a Cacique, and I pray you that you come here to Cozumel at once, and for this purpose I have sent a ship with soldiers, in case you have need of them, and a ransom to be paid to those Indians with whom you are living. The ship will wait eight days for you. Come in all haste, and you will be welcomed and protected. I am here at this Island with five hundred soldiers and eleven ships, in which I go on, please God, to a town called Tabasco or Potonchan.”&lt;br&gt;
&lt;br&gt;
You are elated at the message and set out in search of your former companion, Gonzalo Guerrero. Together, you were the sole survivors of the wreck that left you here among the Maya, but unlike you, Guerrero has adopted this new land and forsaken his one true God. Unlike you, Guerrero has not lived out these long years as a slave.&lt;br&gt;
&lt;br&gt;
When you find him, you share the letter. Guerrero reads it and, much to your dismay, he refuses to leave. “Brother Aguilar,” he says to you, “I am married and have three children and the Indians look on me as a Cacique and captain in wartime,--You go and God be with you, but I have my face tattooed and my ears pierced, what would the Spaniards say should they see me in this guise?”&lt;br&gt;
&lt;br&gt;
You inform Guerrero that God will never forgive him and [[head off to meet your compatriots|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
For weeks now, the Chontal leaders have been hearing rumors that a group of foreigners has been traveling along the coast, making their way towards your village. When word arrived that they had landed upon your shores, the local chiefs sent an army to head them off. Much to everyone&#39;s surprise, many of the men came back wounded, telling stories of their defeat.&lt;br&gt;
&lt;br&gt;
The last few days have seen a flurry of activity in the village. The Chontal leaders have been gathering food and jewelry to offer the strangers in a show of peace and friendship. Their greatest offering, however, will be a group of twenty women. These will not be the sisters or the daughters of powerful families, offered in marriage to secure alliances; instead they will be slave women, with whom the foreigners might do what they choose. The master of your house has informed you that you will be included in the offering and you are sent to join the others.&lt;br&gt;
&lt;br&gt;
When you are brought before the foreigners, one of the men performs a ceremony, speaking strange words that you cannot understand and sprinkling water over your head. He points at you while repeating the word “Marina” over and over. You understand that this is [[what they will call you|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
It&#39;s been many weeks since you left Cuba and the island now seems a distant memory. You landed upon the shores of a new land and have been traveling along the coast ever since, meeting different people along the way. Among your many encounters, two stand out.&lt;br&gt;
&lt;br&gt;
The first occurred early in your journey when you landed upon an island and were approached by the residents, who greeted you with a cry that sounded distinctly like “Castilan, Castilan!” You questioned the local people, who shared a rumor that there were Spaniards living as slaves two days journey inland. You listened to this news with great curiosity, but a storm was coming and you hurried on your way.&lt;br&gt;
&lt;br&gt;
Further along the coast, you did battle with a fierce group of warriors who you came to know as the Chontal Maya. The battle was bloody, but it was decided in the end by your cavalry. The warriors gazed in terror at your horses, clearly overwhelmed and confused at a creature they had never before seen. As part of their peace offering, they presented you with twenty slave women. You were told that one of them possesses many skills, including the gift of language.&lt;br&gt;
&lt;br&gt;
It is now time to &lt;&lt;link &quot;investigate these two individuals&quot; &quot;Spaniards Quest Instructions 2&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_Free=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_Free=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Alvarado&quot; or &quot;Olid&quot; or &quot;Garrido&quot;&gt;&gt;
It&#39;s been many weeks since you left Cuba and the island now seems a distant memory. You landed upon the shores of a new land and have been traveling along the coast ever since, meeting different people along the way. Among your many encounters, two stand out.&lt;br&gt;
&lt;br&gt;
The first occurred early in your journey when you landed upon an island and were approached by the residents, who greeted you with a cry that sounded distinctly like “Castilan, Castilan!” You questioned the local people, who shared a rumor that there were Spaniards living as slaves two days journey inland. You listened to this news with great curiosity, but a storm was coming and you hurried on your way.&lt;br&gt;
&lt;br&gt;
Further along the coast, you did battle with a fierce group of warriors who you came to know as the Chontal Maya. The battle was bloody, but it was decided in the end by your cavalry. The warriors gazed in terror at your horses, clearly overwhelmed and confused at a creature they had never before seen. As part of their peace offering, they presented you with twenty slave women. You were told that one of them possesses many skills, including the gift of language.&lt;br&gt;
&lt;br&gt;
It is now time to [[investigate these two individuals|Spaniards Quest Instructions 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="197" name="Spaniards Quest Instructions 2" tags="" position="2125,375" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
&lt;&lt;if $Aguilar_Free is &quot;No&quot; or ndef $Aguilar_Free or $Aguilar_Free eq &quot;&quot; and $Malinche_Free is &quot;No&quot; or ndef $Malinche_Free or $Malinche_Free eq &quot;&quot;&gt;&gt;
Aguilar, the Spaniards must interview and gain information about the gossip you heard. Go to the Discord discussion board, and when they approach you, help them find the information they seek. If you can help them answer all three questions correctly, you will be able to join their team and continue on their journey with them. &lt;br&gt;
&lt;br&gt;
Beware, though, every wrong answer will weaken the team by one strength point, while every right answer will gain them two points! [[Good luck|Aguilar Quest]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;Yes&quot; and $Malinche_Free is &quot;No&quot; or $Malinche_Free eq &quot;&quot; or ndef $Malinche_Free&gt;&gt;
The Spaniards have freed you from your long captivity! You may now join them and help them recruit this strange woman, Marina. Your gift for languages [[will come in handy here|Malinche Quest]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;No&quot; or ndef $Aguilar_Free or $Aguilar_Free eq &quot;&quot; and $Malinche_Free is &quot;Yes&quot;&gt;&gt;
Aguilar, the Spaniards must interview and gain information about the gossip you heard. Go to the Discord discussion board, and when they approach you, help them find the information they seek. If you can help them answer all three questions correctly, you will be able to join their team and continue on their journey with them. &lt;br&gt;
&lt;br&gt;
Beware, though, every wrong answer will weaken the team by one strength point, while every right answer will gain them two points! [[Good luck|Aguilar Quest]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;Yes&quot; and $Malinche_Free is &quot;Yes&quot;&gt;&gt;
Congratulations! You have sucessfully completed the quest!  You may now join the rest of the Spaniards [[on their journey|On The Way to Veracruz]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
&lt;&lt;if $Aguilar_Free is &quot;No&quot; or ndef $Aguilar_Free or $Aguilar_Free eq &quot;&quot; and $Malinche_Free is &quot;No&quot; or ndef $Malinche_Free or $Malinche_Free eq &quot;&quot;&gt;&gt;
Marina, the Spaniards must interview and gain information about the gossip you heard. Go to the Discord discussion board, and when they approach you, help them find the information they seek. If you can help them answer all three questions correctly, you will be able to join their team and continue on their journey with them. This is the chance to prove your worth to them. Handle this well, and you might become a trusted member of their group, handle it poorly, and who knows what your fate will hold!&lt;br&gt;
&lt;br&gt;
Beware, though, every wrong answer will weaken the team by one strength point, while every right answer will gain them two points! [[Good luck|Malinche Quest]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;Yes&quot; and $Malinche_Free is &quot;No&quot; or $Malinche_Free eq &quot;&quot; or ndef $Malinche_Free&gt;&gt;
Marina, the Spaniards must interview and gain information about the gossip you heard. Go to the Discord discussion board, and when they approach you, help them find the information they seek. If you can help them answer all three questions correctly, you will be able to join their team and continue on their journey with them. This is the chance to prove your worth to them. Handle this well, and you might become a trusted member of their group, handle it poorly, and who knows what your fate will hold!&lt;br&gt;
&lt;br&gt;
Beware, though, every wrong answer will weaken the team by one strength point, while every right answer will gain them two points! [[Good luck|Malinche Quest]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;No&quot; or ndef $Aguilar_Free or $Aguilar_Free eq &quot;&quot; and $Malinche_Free is &quot;Yes&quot;&gt;&gt;
The Spaniards have recruited you, and you seem to have won their respect! You may now join them and help them rescue their compatriot Aguilar. Your gift for languages [[will come in handy here|Aguilar Quest]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;Yes&quot; and $Malinche_Free is &quot;Yes&quot;&gt;&gt;
Congratulations! You have sucessfully completed the quest!  You may now join the Spaniards [[on their journey|On The Way to Veracruz]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
&lt;&lt;if $Aguilar_Free is &quot;No&quot; or ndef $Aguilar_Free or $Aguilar_Free eq &quot;&quot; and $Malinche_Free is &quot;No&quot; or ndef $Malinche_Free or $Malinche_Free eq &quot;&quot;&gt;&gt;
You are to go on a quest to find the last two members of your team.  You may choose which team member you want to recruit first.  Interview them on Discord and find the answers to the questions on the next page.  The questions are multiple choice, but be careful! &lt;b&gt; Each wrong answer will cost you 1 strength point, while each correct answer will gain you 2 strength points.  There is a lot at stake here.&lt;/b&gt;  The less guessing you do, the stronger you will become!&lt;br&gt;
&lt;br&gt;
You have the choice of interviewing either Aguilar or Marina first. You must correctly answer three questions to unlock their character so they can join your team. Once they are unlocked, they can help you complete your quest for the other character, so choose wisely.&lt;br&gt;
&lt;br&gt;
As leader of your team, you will select which character you will start with. Meet with your team on the discord board and decide where to start.&lt;br&gt;
&lt;br&gt;
Will you rescue &lt;&lt;link &quot;Aguilar&quot; &quot;Aguilar Quest&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_3=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
or&lt;br&gt;
&lt;br&gt;
Will you recruit &lt;&lt;link &quot;Marina&quot; &quot;Malinche Quest&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_3=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Aguilar_Free is &quot;Yes&quot; and $Malinche_Free is &quot;No&quot; or $Malinche_Free eq &quot;&quot; or ndef $Malinche_Free&gt;&gt;
Congratulations! You have rescued your compatriot Aguilar from his long years of slavery! Now you may turn your attention to this strange woman you have baptised as Marina, and see if she will be of &lt;&lt;link &quot;value to your team&quot; &quot;Malinche Quest&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Malinche_3=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;No&quot; or ndef $Aguilar_Free or $Aguilar_Free eq &quot;&quot; and $Malinche_Free is &quot;Yes&quot;&gt;&gt;
Congratulations! You have recruited this woman Marina! Now you may turn your attention to freeing your compatriot Aguilar from &lt;&lt;link &quot;his long years in captivity&quot; &quot;Aguilar Quest&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_1=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_2=&quot;No&quot;&gt;&gt;&lt;&lt;storeSet $Aguilar_3=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;Yes&quot; and $Malinche_Free is &quot;Yes&quot;&gt;&gt;
Congratulations! You have sucessfully completed the quest!  You may now continue [[on your journey|On The Way to Veracruz]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Alvarado&quot; or &quot;Olid&quot; or &quot;Garrido&quot;&gt;&gt;
&lt;&lt;if $Aguilar_Free is &quot;No&quot; or ndef $Aguilar_Free or $Aguilar_Free eq &quot;&quot; and $Malinche_Free is &quot;No&quot; or ndef $Malinche_Free or $Malinche_Free eq &quot;&quot;&gt;&gt;
You are to go on a quest to find the last two members of your team.  You may choose which team member you want to recruit first.  Interview them on Discord and find the answers to the questions on the next page.  The questions are multiple choice, but be careful! &lt;b&gt; Each wrong answer will cost you 1 strength point, while each correct answer will gain you 2 strength points.  There is a lot at stake here.&lt;/b&gt;  The less guessing you do, the stronger you will become!&lt;br&gt;
&lt;br&gt;
You have the choice of interviewing either Aguilar or Marina first. You must correctly answer three questions to unlock their character so they can join your team. Once they are unlocked, they can help you complete your quest for the other character, so choose wisely.&lt;br&gt;
&lt;br&gt;
You have the choice of interviewing either Aguilar or Marina first. You must correctly answer three questions to unlock their character so they can join your team. Once they are unlocked, they can help you complete your quest for the other character, so choose wisely.&lt;br&gt;
&lt;br&gt;
As leader of your team, Cortes will select which character you will start with. Meet with your team on the discord board and decide where to start, then help Cortes solve the puzzle!&lt;br&gt;
&lt;br&gt;
Will you rescue [[Aguilar|Aguilar Quest]]?&lt;br&gt;
&lt;br&gt;
or&lt;br&gt;
&lt;br&gt;
Will you recruit [[Marina|Malinche Quest]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;Yes&quot; and $Malinche_Free is &quot;No&quot; or $Malinche_Free eq &quot;&quot; or ndef $Malinche_Free&gt;&gt;
Congratulations! You have rescued your compatriot Aguilar from his long years of slavery! Now you may turn your attention to this strange woman you have baptised as Marina, and see if she will be of [[value to your team|Malinche Quest]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;No&quot; or ndef $Aguilar_Free or $Aguilar_Free eq &quot;&quot; and $Malinche_Free is &quot;Yes&quot;&gt;&gt;
Congratulations! You have recruited this woman Marina! Now you may turn your attention to freeing your compatriot Aguilar from [[his long years in captivity|Aguilar Quest]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Aguilar_Free is &quot;Yes&quot; and $Malinche_Free is &quot;Yes&quot;&gt;&gt;
Congratulations! You have sucessfully completed the quest!  You may now continue [[on your journey|On The Way to Veracruz]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="198" name="Spaniards Retreat to Tlaxcala" tags="" position="2125,11550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Cortes_Dead is &quot;Yes&quot;&gt;&gt;
You have decided that your best course of action is to return to Tlaxcala. There, you hope to persuade your Tlaxcala friends to come to your aid once more. You make your way [[over the mountains to safety|Spaniards in Tlaxcala Cortes Dead]].
&lt;&lt;elseif $Cortes_Dead is &quot;No&quot;&gt;&gt;
You have decided that your best course of action is to return to Tlaxcala. There, you hope to persuade your Tlaxcala friends to come to your aid once more. You make your way [[over the mountains to safety|Spaniards in Tlaxcala Cortes Alive]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Cortes_Dead is &quot;Yes&quot;&gt;&gt;
Your spies warn you that [[the Spaniards approach|Spaniards in Tlaxcala Cortes Dead]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cortes_Dead is &quot;No&quot;&gt;&gt;
Your spies warn you that [[the Spaniards approach|Spaniards in Tlaxcala Cortes Alive]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="199" name="Spaniards Return to Tlaxcala" tags="" position="4025,6800" size="100,100">&lt;&lt;theyr&gt;&gt;
Double-click this passage to edit it.


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="200" name="Spaniards Send a Letter" tags="Done Breaks" position="1525,575" size="100,100">&lt;&lt;theyr&gt;&gt;
Spaniards, you have been at sea for many weeks when you land on the shores of Cozumel.&lt;br&gt;
&lt;br&gt;

&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
To your surprise, the residents of the island see you and begin shouting words that sound distinctly like “Castilan, Castilan!” You question the local people, who tell that they&#39;ve heard rumors of Spaniards living as slaves two days journey inland. Excited at the news, you write a letter:&lt;br&gt;
&lt;br&gt;
“Gentlemen and brothers, here in Cozumel I have learnt that you are captives in the hands of a Cacique, and I pray you that you come here to Cozumel at once, and for this purpose I have sent a ship with soldiers, in case you have need of them, and a ransom to be paid to those Indians with whom you are living. The ship will wait eight days for you. Come in all haste, and you will be welcomed and protected. I am here at this Island with five hundred soldiers and eleven ships, in which I go on, please God, to a town called Tabasco or Potonchan.”&lt;br&gt;
&lt;br&gt;
You find a pair of local messengers and instruct them to find these mysterious Spanish slaves. You tell them to deliver your letter, along with a ransom of beads that they may use to pay the men&#39;s owners. &lt;br&gt;
&lt;br&gt;
You settle in and &lt;&lt;link &quot;wait for a response&quot; &quot;Spaniards arrive at Yucatan&quot;&gt;&gt;&lt;&lt;storeSet $Letter=&quot;sent&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Span_Leader isnot $users[$userId][&quot;role&quot;]&gt;&gt;
To your surprise, the residents of the island see you and begin shouting words that sound distinctly like “Castilan, Castilan!” You question the local people, who tell that they&#39;ve heard rumors of Spaniards living as slaves two days journey inland. &lt;&lt;print $Span_Leader&gt;&gt;, excited at the news, writes a letter:&lt;br&gt;
&lt;br&gt;
“Gentlemen and brothers, here in Cozumel I have learnt that you are captives in the hands of a Cacique, and I pray you that you come here to Cozumel at once, and for this purpose I have sent a ship with soldiers, in case you have need of them, and a ransom to be paid to those Indians with whom you are living. The ship will wait eight days for you. Come in all haste, and you will be welcomed and protected. I am here at this Island with five hundred soldiers and eleven ships, in which I go on, please God, to a town called Tabasco or Potonchan.”&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Span_Leader&gt;&gt; finds a pair of local messengers and instructs them to find these mysterious Spanish slaves. He tells them to deliver his letter, along with a ransom of beads that they may use to pay the men&#39;s owners. &lt;br&gt;
&lt;br&gt;
You settle in and [[wait for a response|Spaniards arrive at Yucatan]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="201" name="Spaniards Tour Tenochtitlan" tags="" position="2150,7175" size="100,100">You settle in quickly, eager to see everything this remarkable city has to offer. Moctezuma has sent a group of Aztec nobles to be your guides and they have presented you with an itinerary:&lt;br&gt;
&lt;br&gt;

1:00-1:30		Tour the Kitchen Palace&lt;br&gt;
1:30-2:00		Visit the Armory&lt;br&gt;
2:00-2:30		Tour the Aviary/Zoo&lt;br&gt;
2:30-3:30		Shopping at Tlatelolco Market&lt;br&gt;
3:30-5:00		Meet with Moctezuma at Templo Mayor&lt;br&gt;
&lt;br&gt;
At the conclusion of the tour, you have been invited to Moctezuma&#39;s Palace for, you are promised, a sumptuous feast like none you&#39;ve ever experienced!&lt;br&gt;
&lt;br&gt;

&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You listen as your companions reflect on the fact that they will be the first Spaniards to ever lay eyes upon these sights. They wonder if others may follow in their footsteps. As you prepare to set out on your tour, your companions decide it would be in everyone&#39;s best interest to create a guide to the city. Surely their countrymen will want to see these sights later on! They all agree that it would be good to help future adventurers make the most of their visit, but it&#39;s clear that they also want to establish their own authority and newfound expertise.&lt;br&gt;
&lt;br&gt;

Your first task is to go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán, where you will find a description of each of the five sites above. When you have finished reading, go to your site and start a new page titled “Lonely Planet Guide: Tenochtitlán.” Each Spanish player will be responsible for writing the entry for one stop on the itinerary above. Marina, you have been tasked with writing the introduction. &lt;br&gt;
&lt;br&gt;

Like any good guide book, your introduction should include:&lt;br&gt;
&lt;br&gt;

A broad overview of the city, with its most important highlights&lt;br&gt;
Any historical background that might be of interest to travelers&lt;br&gt;
Instructions for how to get there&lt;br&gt;
Suggestions for what to eat… and what not to eat... during your stay&lt;br&gt;
&lt;br&gt;

Pay attention to detail, because there are points at stake here!&lt;br&gt;
&lt;br&gt;

Once your guidebook entry is complete, paste a link here to share with the other players. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
Your entry is:  &lt;&lt;textbox &quot;$Ma_TG&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;
You reflect on the fact that you will be the first Spaniards to ever lay eyes upon these sights and you wonder if others may follow in your footsteps. As you prepare to set out on your tour, you discuss this among yourselves and decide it would be in everyone&#39;s best interest to create a guide to the city. Surely your countrymen will want to see these sights later on! You want to help them make the most of their visit, but you also want to establish your own authority and newfound expertise.&lt;br&gt;
&lt;br&gt;

Your first task is to go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán, where you will find a description of each of the five sites above. When you have finished reading, go to your site and start a new page titled “Lonely Planet Guide: Tenochtitlán.” Marina will write the introduction and each Spanish player will be responsible for writing the entry for ONE stop on the itinerary above. You may assign the five sites among your team members however you like, as long as each player completes one entry.&lt;br&gt;
&lt;br&gt;

Like any good travel guide, your entry should include each of the following elements:&lt;br&gt;
&lt;br&gt;

An introduction that describes the specific location&lt;br&gt;
Most important sights to see at this location&lt;br&gt;
Instructions for how to get there&lt;br&gt;
Suggestions for what to eat… and what not to eat... during your stay&lt;br&gt;
&lt;br&gt;

Pay attention to detail, because there are points at stake here!&lt;br&gt;
&lt;br&gt;

Once your guidebook entry is complete, paste a link here to share with the other players. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
Your entry is:  &lt;&lt;textbox &quot;$Co_TG&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Alvarado&quot;&gt;&gt;
Your entry is:  &lt;&lt;textbox &quot;$Al_TG&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
Your entry is:  &lt;&lt;textbox &quot;$Ag_TG&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Olid&quot;&gt;&gt;
Your entry is:  &lt;&lt;textbox &quot;$Ol_TG&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Garrido&quot;&gt;&gt;
Your entry is:  &lt;&lt;textbox &quot;$Ga_TG&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

&lt;&lt;/if&gt;&gt;

When your contribution to the guidebook is ready, you may continue &lt;&lt;link &quot;on to the feast&quot; &quot;Everyone Gathers for a Feast&quot;&gt;&gt;&lt;&lt;storeSet $Feast = $Feast + 1&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;</tw-passagedata><tw-passagedata pid="202" name="Spaniards Write Letters" tags="" position="2300,6250" size="100,100">Your compatriot Bernal Diaz later recalled the sight as such:&lt;br&gt;
&lt;br&gt;
&lt;i&gt;“The next morning we reached the broad high road of Iztapalapan, whence we for the first time beheld the numbers of towns and villages built in the lake, and the still greater number of large townships on the mainland, with the level causeway which ran in a straight line into Mexico. Our astonishment was indeed raised to the highest pitch, and we could not help remarking to each other, that all these buildings resembled the fairy castles we read of in Amadis de Gaul; so high, majestic, and splendid did the temples, towers, and houses of the town, all built of massive stone and lime, rise up out of the midst of the lake. Indeed, many of our men believed what they saw was a mere dream. And the reader must not feel surprised at the manner in which I have expressed myself, for it is impossible to speak coolly of things which we had never seen nor heard of, nor even could have dreamt of, beforehand.” (Lockhart, 219)&lt;/i&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
The sight before you is unlike anything you&#39;ve ever seen and you only wish that your loved ones could share this experience with you. You decide to capture the moment and sit down to write a letter home.&lt;br&gt;
&lt;br&gt;

Go to your site and create a new page titled “Letter from Iztapalapan.” Write a letter home in which you share your feelings at what you have just seen. Create an image to accompany your letter. How will you convey the enormity of this experience?&lt;br&gt;
&lt;br&gt;

When your letter is complete, input your link in the box below. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
&lt;&lt;textbox &quot;$Cortes_Let_Hm&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
From a young age, you have heard tales of the great city of Tenochtitlán, but never before have you laid eyes upon it. And what a sight it is! You cannot help but feel the weight of this moment and you are overwhelmed by the sense that a new chapter is about to unfold before you. You decide to capture the moment and add it to your story.&lt;br&gt;
&lt;br&gt;
Go to your site and create a new page titled “Arriving at Tenochtitlán.” Add a new chapter to your story, in which you share your feelings of all that you have just seen. Create an image to accompany your account. How will you convey the enormity of this experience?&lt;br&gt;
&lt;br&gt;
When your story is complete, you may carry on your journey.&lt;br&gt;
&lt;br&gt;
&lt;&lt;textbox &quot;$Marina_Let_Hm&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Alvarado&quot;&gt;&gt;
The sight before you is unlike anything you&#39;ve ever seen and you only wish that your loved ones could share this experience with you. You decide to capture the moment and sit down to write a letter home.&lt;br&gt;
&lt;br&gt;
Go to your site and create a new page titled “Letter from Iztapalapan.” Write a letter home in which you share your feelings at what you have just seen. Create an image to accompany your letter. How will you convey the enormity of this experience?&lt;br&gt;
&lt;br&gt;
When your letter is complete, input your link in the box below. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
&lt;&lt;textbox &quot;$Alvarado_Let_Hm&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aguilar&quot;&gt;&gt;
The sight before you is unlike anything you&#39;ve ever seen and you only wish that your loved ones could share this experience with you. You decide to capture the moment and sit down to write a letter home.&lt;br&gt;
&lt;br&gt;
Go to your site and create a new page titled “Letter from Iztapalapan.” Write a letter home in which you share your feelings at what you have just seen. Create an image to accompany your letter. How will you convey the enormity of this experience?&lt;br&gt;
&lt;br&gt;
When your letter is complete, input your link in the box below. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
&lt;&lt;textbox &quot;$Aguilar_Let_Hm&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Garrido&quot;&gt;&gt;
The sight before you is unlike anything you&#39;ve ever seen and you only wish that your loved ones could share this experience with you. You decide to capture the moment and sit down to write a letter home.&lt;br&gt;
&lt;br&gt;
Go to your site and create a new page titled “Letter from Iztapalapan.” Write a letter home in which you share your feelings at what you have just seen. Create an image to accompany your letter. How will you convey the enormity of this experience?&lt;br&gt;
&lt;br&gt;
When your letter is complete, input your link in the box below. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
&lt;&lt;textbox &quot;$Garrido_Let_Hm&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Olid&quot;&gt;&gt;
The sight before you is unlike anything you&#39;ve ever seen and you only wish that your loved ones could share this experience with you. You decide to capture the moment and sit down to write a letter home.&lt;br&gt;
&lt;br&gt;
Go to your site and create a new page titled “Letter from Iztapalapan.” Write a letter home in which you share your feelings at what you have just seen. Create an image to accompany your letter. How will you convey the enormity of this experience?&lt;br&gt;
&lt;br&gt;
When your letter is complete, input your link in the box below. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
&lt;&lt;textbox &quot;$Olid_Let_Hm&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;

Once you have entered your link, you may &lt;&lt;link &quot;continue your journey&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=10&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;</tw-passagedata><tw-passagedata pid="203" name="Spaniards and Marina Talk" tags="Done Breaks" position="1950,1125" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
Now that the strangers have read your story, keep an eye on your points. They will indicate what your new friends really think of you.&lt;br&gt;
&lt;br&gt;
In the meantime, go to the Spanish discussion board and get to know these strange men to whom you now belong. The one named Aguilar speaks your language. You may communicate directly with him, but none of the others.&lt;br&gt;
&lt;br&gt;
As you speak through your interpreter, does he accurately represent your words? &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Yes&quot; &quot;Act 1 Scene 1&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=5&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;No&quot; &quot;Act 1 Scene 1&quot;&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]-=1&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=5&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cortes&quot; OR &quot;Alvarado&quot; OR &quot;Aguilar&quot; OR &quot;Garrido&quot; OR &quot;Olid&quot;&gt;&gt;

Now that you have read Marina&#39;s story, go to the Spanish discussion board and get to know your new captive. Fortunately, Aguilar speaks her language. It is his responsibility to convey her words to you.&lt;br&gt;
&lt;br&gt;
When you feel like you have gotten to know Marina &lt;&lt;link &quot;continue on&quot; &quot;Act 1 Scene 1&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=5&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="204" name="Spaniards and Tlaxcalans on the way to Cholula" tags="Done" position="1975,3875" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
After a long stay in Tlaxcala, where you recovered from battle and enjoyed the hospitality of your new allies, you set out for the Mexica capital of Tenochtitlán. Your forces took a hit in the long and hard-fought battle with Tlaxcala, and you now number only 250--only half the number who set sail from Cuba! However, you have succeeded in building a massive army of indigenous allies. You march onward with a force of 10,000 men. &lt;br&gt;
&lt;br&gt;
Before you enter the capital, you have one important stop to make: the city of Cholula, where you will stock up on some much-needed supplies. You have been assured that this stop is necessary, but it might not be easy. Until recently, the people of Cholula were allies of your Tlaxcalan friends, but now the city&#39;s leadership is loyal to the Mexica. There is clearly bad blood between the two peoples and you stay on guard as you approach the city.&lt;br&gt;
&lt;br&gt;
It&#39;s getting late and you decide to set up camp for the night. Given your wariness towards the people of Cholula, you would rather approach the city by daylight.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Cholula_Attack or $Cholula_Attack eq &quot;&quot;&gt;&gt;
The night is long and you can&#39;t seem to rest. You toss and turn, waiting for morning to find you.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Aztecs to make a decision.&lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;
After a long night, you wake to a visit from some [[Cholulan delegates|Cholula Makes an Invitation]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
After the battle, you welcomed the Spaniards into the city and helped your new allies to regain their strength. You killed many of their men in battle and there are only 250 of them left, but they are skilled warriors and--even more important--they carry powerful weapons. They also bring with them an army of allies and Mexica enemies that they have gathered along the way. With the addition of your men, you are now 10,000 strong. You leave Tlaxcala headed for the city of Tenochtitlán.&lt;br&gt;
&lt;br&gt;
You must make one stop along the way, however: the city of Cholula. The people of Cholula were your loyal allies for many years, until they betrayed you to become loyal vassals of the Mexica. There is bad blood between you and you long to make the cowardly Cholulans pay for their betrayal.&lt;br&gt;
&lt;br&gt;
As you approach the city, your blood boils, but you remain calm and alert. It&#39;s getting dark and your Spanish allies decide to stop for the night, so you set up camp and lie down upon your reed mat to get some rest.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Cholula_Attack or $Cholula_Attack eq &quot;&quot;&gt;&gt;
The night is long and you can&#39;t seem to rest. You toss and turn, waiting for morning to find you.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Aztecs to do something.&lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;
After a long night, you wake to a visit from some [[Cholulan delegates|Cholula Makes an Invitation]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="205" name="Spaniards arrive at Yucatan" tags="Done Breaks" position="1450,700" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] isnot &quot;Aguilar&quot; and ndef $L_Received or $L_Received eq &quot;&quot;&gt;&gt;

You continue to bide your time and wait for a response to the letter.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot &quot;Aguilar&quot; and $Span_Leader isnot $users[$userId][&quot;role&quot;] and $L_Received is &quot;Yes&quot;&gt;&gt;

You are hunting along the shore of Cozumel when you see a large canoe approaching. In it sit three Mayan men. You send word to &lt;&lt;print $Span_Leader&gt;&gt;, who sends a delegation to the shore to greet the visitors. &lt;br&gt;
&lt;br&gt;
As they disembark, one of the men falls to his knees and cries out “Díos y Santa María de Sevilla!” You can barely believe your eyes, for this man looks no different from the Mayans at his side. He wears only one sandal, a ragged cloak, and a loincloth, but he addresses you in Spanish and he tells you his name: Gerónimo de Aguilar. You embrace this poor man and send someone off in search of &lt;&lt;print $Span_Leader&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Span_Leader&gt;&gt; arrives on the shore and Aguilar shares with him a tattered Bible to prove his identity. After telling you all a harrowing tale of shipwreck and enslavement, Aguilar turns to address the local Cacique in his own language. He advises the Cacique and his people to respect the holy cross, assuring them that it will benefit them greatly. Upon hearing these strange words flow from this Spaniard&#39;s tongue, &lt;&lt;print $Span_Leader&gt;&gt; realizes what a valuable asset this Aguilar will be to his expedition. &lt;br&gt;
&lt;br&gt;
You leave Cozumel buoyed by your good fortune. Aguilar&#39;s arrival can only be seen as a blessing from God.&lt;br&gt;
&lt;br&gt;
You now &lt;&lt;link &quot;continue on your journey&quot; &quot;Spaniards Battle the Tabascans&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=3&gt;&gt;&lt;&lt;/link&gt;&gt; together.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $users[$userId][&quot;role&quot;] isnot &quot;Aguilar&quot; and $Span_Leader is $users[$userId][&quot;role&quot;] and $L_Received is &quot;Yes&quot;&gt;&gt;
This morning you received a report that a canoe had arrived on the nearby shore carrying a group of Mayan men.  You sent a delegation out to greet them and one has just returned, excited at a remarkable development. It seems that not all the men in the canoe were Mayan, but one of them was, in fact, a Spaniard! The man gave his name as Gerónimo de Aguilar and claims that he was shipwrecked many years ago and has been living as a slave amongst the Maya.&lt;br&gt;
&lt;br&gt;
You make your way to shore where you greet the ragged looking Spaniard, who shows you his tattered Bible to prove his identity. After telling you a harrowing tale of shipwreck and enslavement, Aguilar turns to address the local Cacique in his own language. He advises the Cacique and his people to respect the holy cross, assuring them that it will benefit them greatly. Upon hearing these strange words flow from this Spaniard&#39;s tongue, you realize what a valuable asset this Aguilar will be to your expedition. &lt;br&gt;
&lt;br&gt;
You leave Cozumel buoyed by your good fortune. Aguilar&#39;s arrival can only be seen as a blessing from God.&lt;br&gt;
&lt;br&gt;
You now &lt;&lt;link &quot;continue on your journey&quot; &quot;Spaniards Battle the Tabascans&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=3&gt;&gt;&lt;&lt;/link&gt;&gt; together.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;role&quot;] is &quot;Aguilar&quot;&gt;&gt;
You arrive at your destination by canoe, accompanied by two Mayan men and are elated to see a group of Spaniards heading towards you.&lt;br&gt;
&lt;br&gt;
Overcome with joy and relief, you step out of the canoe and fall to your knees, crying out “Díos y Santa María de Sevilla!” Your countrymen look at you in shock and disbelief. You look down at your tattered clothing, for you wear only one sandal, a ragged cloak, and a loincloth. Your Spanish is rusty from disuse, but you assure them that you are one of their own. The men embrace you and one rushes off to find their leader.&lt;br&gt;
&lt;br&gt;
Their leader arrives and tells you his name is &lt;&lt;print $Span_Leader&gt;&gt;. He looks you up and down, in disbelief that you are who you say you are. To prove yourself, you show him your most prized possession: the worn old Bible that you have kept safe all these years. Only then does &lt;&lt;print $Span_Leader&gt;&gt; accept you as one of his own. &lt;br&gt;
&lt;br&gt;
You tell them all your harrowing tale of shipwreck and enslavement, and then you turn to address the local Cacique. Speaking in Mayan, you advise him and his people to respect the holy cross, assuring them that it will benefit them greatly. &lt;br&gt;
&lt;br&gt;
You leave Cozumel in disbelief that your long nightmare is over. God has tested your faith all these many years and you have finally received your reward.&lt;br&gt;
&lt;br&gt;
You now &lt;&lt;link &quot;continue on your journey&quot; &quot;Spaniards Battle the Tabascans&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=3&gt;&gt;&lt;&lt;/link&gt;&gt; together.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="206" name="Spaniards in Tlaxcala Cortes Alive" tags="" position="2050,11700" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Cortes&quot;&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
You arrive in Tlaxcala and breathe a sigh of relief. There is a sense of safety knowing that you are back among friends…and that those friends have been closely guarding the cannons you won in your battle against Velazquez on the coast.&lt;br&gt;
&lt;br&gt;
Your hosts welcome you with open arms and treat you to a hearty meal. As you gratefully fill your belly, you recount the events of the past weeks. However, your friends are already aware of everything that has transpired. It seems they have been keeping tabs through their network of spies. &lt;br&gt;
&lt;br&gt;
The time has come to make your case. You inform the Tlaxcalan leaders of your plan: you will regroup, consolidate your forces over the coming months, and prepare to lay siege to Tenochtitlán. [[Will they join you|Tlaxcalans Decide About the Spaniards]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot;&gt;&gt;
You arrive in Tlaxcala and breathe a sigh of relief. There is a sense of safety knowing that you are back among friends…but are you? When you asked your allies to fight with you against Velazquez, they made it clear that they would not risk their lives to fight your battles. &lt;br&gt;
&lt;br&gt;
Your hosts welcome you with open arms and treat you to a hearty meal. As you gratefully fill your belly, you recount the events of the past weeks. However, your friends are already aware of everything that has transpired. It seems they have been keeping tabs through their network of spies. &lt;br&gt;
&lt;br&gt;
The time has come to make your case. You inform the Tlaxcalan leaders of your plan: you will regroup, consolidate your forces over the coming months, and prepare to lay siege to Tenochtitlán. [[Will they join you|Tlaxcalans Decide About the Spaniards]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;else&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
You arrive in Tlaxcala and breathe a sigh of relief. There is a sense of safety knowing that you are back among friends…and that those friends have been closely guarding the cannons Cortes won in his battle against Velazquez on the coast.&lt;br&gt;
&lt;br&gt;
Your hosts welcome you with open arms and treat you to a hearty meal. As you gratefully fill your belly, you recount the events of the past weeks. However, your friends are already aware of everything that has transpired. It seems they have been keeping tabs through their network of spies. &lt;br&gt;
&lt;br&gt;
The time has come to make your case. You inform the Tlaxcalan leaders of your plan: you will regroup, consolidate your forces over the coming months, and prepare to lay siege to Tenochtitlán. [[Will they join you|Tlaxcalans Decide About the Spaniards]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot;&gt;&gt;
You arrive in Tlaxcala and breathe a sigh of relief. There is a sense of safety knowing that you are back among friends…but are you? When Cortes asked your allies to fight with him against Velazquez, they made it clear that they would not risk their lives to fight your battles.&lt;br&gt;
&lt;br&gt; 
Your hosts welcome you with open arms and treat you to a hearty meal. As you gratefully fill your belly, you recount the events of the past weeks. However, your friends are already aware of everything that has transpired. It seems they have been keeping tabs through their network of spies. &lt;br&gt;
&lt;br&gt;
The time has come to make your case. You inform the Tlaxcalan leaders of your plan: you will regroup, consolidate your forces over the coming months, and prepare to lay siege to Tenochtitlán. [[Will they join you|Tlaxcalans Decide About the Spaniards]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
You are not surprised when the Spaniards arrive in Tlaxcala, weary from the events of the past weeks. Your spies alerted you to their presence well in advance. &lt;br&gt;
&lt;br&gt;
You treat your guests to a warm meal and they settle in to recount their own version of recent events. When their story is done, they inform you of their plans: they want to regroup, consolidate their forces over the coming months, and prepare to lay siege to Tenochtitlán. And they want your help. &lt;br&gt;
&lt;br&gt;
You already fought with Cortes at the coast and your hand is now strengthened by the cannons you won in that battle, but will you put your lives on the line for these strangers again? Is this your opportunity to finally defeat your Mexica enemies once and for all? &lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have 4 choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Aid the Spaniards and lay siege to the Aztec capital. These foreigners have proven themselves to be fierce warriors and they have powerful weapons at their disposal. This may be your best chance to &lt;&lt;link &quot;claim victory over your Mexica enemies&quot; &quot;Tlaxcala helps the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Span&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Attack the Spaniards. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted and you have them in your grasp. Now is your chance to do away with the strangers and &lt;&lt;link &quot;restore order to your world&quot; &quot;Tlaxcala Attacks the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;AttackSpan&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; Refuse the request and send the strangers on their way. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you let the two sides continue their fight, they will both come out &lt;&lt;link &quot;weaker in the end&quot; &quot;Tlaxcala Does Nothing&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Alone&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 4:&lt;/b&gt; Lie to the Spaniards to trick them into complacency. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you join forces with your historical enemies, the foreigners won&#39;t stand a chance. You will promise support and then send word to the Mexica, laying a trap that the Spaniards cannot possibly escape &lt;&lt;link &quot;Spaniards cannot possibly escape&quot; &quot;Tlaxcala Sides with the Aztecs&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Aztecs&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot;&gt;&gt;
You are not surprised when the Spaniards arrive in Tlaxcala, weary from the events of the past weeks. Your spies alerted you to their presence well in advance. &lt;br&gt;
&lt;br&gt;
You treat your guests to a warm meal and they settle in to recount their own version of recent events. When their story is done, they inform you of their plans: they want to regroup, consolidate their forces over the coming months, and prepare to lay siege to Tenochtitlán. And they want your help. &lt;br&gt;
&lt;br&gt;
The last time Cortes asked you to put your life on the line, you refused. And yet they now ask again. This is different, however. Last time they faced their own enemies and it was not your fight. This time, you have an opportunity to finally defeat the Mexica once and for all. Will you take it?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have 4 choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Aid the Spaniards and lay siege to the Aztec capital. These foreigners have proven themselves to be fierce warriors and they have powerful weapons at their disposal. This may be your best chance to &lt;&lt;link &quot;claim victory over your Mexica enemies&quot; &quot;Tlaxcala helps the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Span&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Attack the Spaniards. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted and you have them in your grasp. Now is your chance to do away with the strangers and &lt;&lt;link &quot;restore order to your world&quot; &quot;Tlaxcala Attacks the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;AttackSpan&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; Refuse the request and send the strangers on their way. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you let the two sides continue their fight, they will both come out &lt;&lt;link &quot;weaker in the end&quot; &quot;Tlaxcala Does Nothing&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Alone&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 4:&lt;/b&gt; Lie to the Spaniards to trick them into complacency. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you join forces with your historical enemies, the foreigners won&#39;t stand a chance. You will promise support and then send word to the Mexica, laying a trap that the Spaniards cannot possibly escape &lt;&lt;link &quot;Spaniards cannot possibly escape&quot; &quot;Tlaxcala Sides with the Aztecs&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Aztecs&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;else&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
You are not surprised when the Spaniards arrive in Tlaxcala, weary from the events of the past weeks. Your spies alerted you to their presence well in advance. &lt;br&gt;
&lt;br&gt;
You treat your guests to a warm meal and they settle in to recount their own version of recent events. When their story is done, they inform you of their plans: they want to regroup, consolidate their forces over the coming months, and prepare to lay siege to Tenochtitlán. And they want your help. &lt;br&gt;
&lt;br&gt;
You already fought with Cortes at the coast and your hand is now strengthened by the cannons you won in that battle, but will you put your lives on the line for these strangers again? Is this your opportunity to finally defeat your Mexica enemies once and for all? &lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have 4 choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Aid the Spaniards and lay siege to the Aztec capital. These foreigners have proven themselves to be fierce warriors and they have powerful weapons at their disposal. This may be your best chance to claim victory over your Mexica enemies.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Attack the Spaniards. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted and you have them in your grasp. Now is your chance to do away with the strangers and restore order to your world.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; Refuse the request and send the strangers on their way. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you let the two sides continue their fight, they will both come out weaker in the end.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 4:&lt;/b&gt; Lie to the Spaniards to trick them into complacency. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you join forces with your historical enemies, the foreigners won&#39;t stand a chance. You will promise support and then send word to the Mexica, laying a trap that the Spaniards cannot possibly escape. &lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then move forward to [[carry out your plan|Tlaxcalans Decide About the Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot;&gt;&gt;
You are not surprised when the Spaniards arrive in Tlaxcala, weary from the events of the past weeks. Your spies alerted you to their presence well in advance. &lt;br&gt;
&lt;br&gt;
You treat your guests to a warm meal and they settle in to recount their own version of recent events. When their story is done, they inform you of their plans: they want to regroup, consolidate their forces over the coming months, and prepare to lay siege to Tenochtitlán. And they want your help. &lt;br&gt;
&lt;br&gt;
The last time Cortes asked you to put your life on the line, you refused. And yet they now ask again. This is different, however. Last time they faced their own enemies and it was not your fight. This time, you have an opportunity to finally defeat the Mexica once and for all. Will you take it?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have 4 choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Aid the Spaniards and lay siege to the Aztec capital. These foreigners have proven themselves to be fierce warriors and they have powerful weapons at their disposal. This may be your best chance to claim victory over your Mexica enemies.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Attack the Spaniards. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted and you have them in your grasp. Now is your chance to do away with the strangers and restore order to your world.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; Refuse the request and send the strangers on their way. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you let the two sides continue their fight, they will both come out weaker in the end.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 4:&lt;/b&gt; Lie to the Spaniards to trick them into complacency. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you join forces with your historical enemies, the foreigners won&#39;t stand a chance. You will promise support and then send word to the Mexica, laying a trap that the Spaniards cannot possibly escape. &lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then move forward to [[carry out your plan|Tlaxcalans Decide About the Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="207" name="Spaniards in Tlaxcala Cortes Dead" tags="" position="2225,11700" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You arrive in Tlaxcala tired and wary. The last time you saw your friends, they left with Cortes to confront Velazquez&#39; men on the coast... and never came back. Though you wonder if they are to be trusted, you have few other options at this point and even fewer friends. &lt;br&gt;
&lt;br&gt;
Much to your relief, your hosts welcome you with open arms and treat you to a hearty meal. As you gratefully fill your belly, you address the question on everyone&#39;s minds: what happened to Cortes? It seems the fate of your former leader will remain a mystery, however. The Tlaxcalan leaders report that they left Cortes and the rest of the contingent as they passed Tlaxcala, taking the opportunity to return home. That was the last they ever saw of him.&lt;br&gt;
&lt;br&gt;
You then recount the events of the past weeks, but it seems your friends have kept up with the news out of Tenochtitlán and they already know what transpired in the city. All that remains, then, is to make your case. You inform the Tlaxcalan leaders of your plan: you will regroup, consolidate your forces over the coming months, and prepare to lay siege to Tenochtitlán. [[Will they join you|Tlaxcalans Decide About the Spaniards]]?&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Home&quot;&gt;&gt;

You are not surprised when the Spaniards arrive in Tlaxcala, weary from the events of the past weeks. Your spies alerted you to their presence well in advance. &lt;br&gt;
&lt;br&gt;
You treat your guests to a warm meal and as they settle in, they address the question on everyone&#39;s minds: what happened to Cortes? It seems the fate of their former leader will remain a mystery, however. You report that you left Cortes and the rest of the contingent as you passed Tlaxcala, taking the opportunity to return home. It seems he never made his way back to Tenochtitlán and that was the last anyone saw of him.&lt;br&gt;
&lt;br&gt;
They go on to recount the events that transpired after you left the city. When their story is done, they inform you of their plans: they want to regroup, consolidate their forces over the coming months, and prepare to lay siege to Tenochtitlán. And they want your help. &lt;br&gt;
&lt;br&gt;
The last time Cortes asked you to put your life on the line, you refused. And yet they now ask again. This is different, however. Last time they faced their own enemies and it was not your fight. This time, you have an opportunity to finally defeat the Mexica once and for all. Will you take it?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have 4 choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Aid the Spaniards and lay siege to the Aztec capital. These foreigners have proven themselves to be fierce warriors and they have powerful weapons at their disposal. This may be your best chance to &lt;&lt;link &quot;claim victory over your Mexica enemies&quot; &quot;Tlaxcala helps the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Span&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Attack the Spaniards. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted and you have them in your grasp. Now is your chance to do away with the strangers and &lt;&lt;link &quot;restore order to your world&quot; &quot;Tlaxcala Attacks the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;AttackSpan&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; Refuse the request and send the strangers on their way. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you let the two sides continue their fight, they will both come out &lt;&lt;link &quot;weaker in the end&quot; &quot;Tlaxcala Does Nothing&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Alone&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 4:&lt;/b&gt; Lie to the Spaniards to trick them into complacency. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you join forces with your historical enemies, the foreigners won&#39;t stand a chance. You will promise support and then send word to the Mexica, laying a trap that the Spaniards cannot possibly escape &lt;&lt;link &quot;Spaniards cannot possibly escape&quot; &quot;Tlaxcala Sides with the Aztecs&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Aztecs&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Tlax_Alliance is &quot;Betray&quot;&gt;&gt;
You are not surprised when the Spaniards arrive in Tlaxcala, weary from the events of the past weeks. Your spies alerted you to their presence well in advance. &lt;br&gt;
&lt;br&gt;
You treat your guests to a warm meal and as they settle in, they address the question on everyone&#39;s minds: what happened to Cortes? Rather than admit that you abandoned their former leader to his fate, you lie and report that you left Cortes and the rest of the continent as you passed Tlaxcala, taking the opportunity to return home. It seems he never made his way back to Tenochtitlán and that was the last anyone saw of him. It&#39;s best for everyone if they don&#39;t know you led him into a trap.&lt;br&gt;
&lt;br&gt;
They go on to recount the events that transpired after you left the city. When their story is done, they inform you of their plans: they want to regroup, consolidate their forces over the coming months, and prepare to lay siege to Tenochtitlán. And they want your help. &lt;br&gt;
&lt;br&gt;
The last time Cortes asked you to put your life on the line, you refused. And yet they now ask again. This is different, however. Last time they faced their own enemies and it was not your fight. This time, you have an opportunity to finally defeat the Mexica once and for all. Will you take it?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have 4 choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Aid the Spaniards and lay siege to the Aztec capital. These foreigners have proven themselves to be fierce warriors and they have powerful weapons at their disposal. This may be your best chance to &lt;&lt;link &quot;claim victory over your Mexica enemies&quot; &quot;Tlaxcala helps the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Span&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Attack the Spaniards. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted and you have them in your grasp. Now is your chance to do away with the strangers and &lt;&lt;link &quot;restore order to your world&quot; &quot;Tlaxcala Attacks the Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;AttackSpan&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; Refuse the request and send the strangers on their way. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you let the two sides continue their fight, they will both come out &lt;&lt;link &quot;weaker in the end&quot; &quot;Tlaxcala Does Nothing&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Alone&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 4:&lt;/b&gt; Lie to the Spaniards to trick them into complacency. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you join forces with your historical enemies, the foreigners won&#39;t stand a chance. You will promise support and then send word to the Mexica, laying a trap that the Spaniards cannot possibly escape &lt;&lt;link &quot;Spaniards cannot possibly escape&quot; &quot;Tlaxcala Sides with the Aztecs&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Dec=&quot;Aztecs&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;else&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Home&quot;&gt;&gt;
You are not surprised when the Spaniards arrive in Tlaxcala, weary from the events of the past weeks. Your spies alerted you to their presence well in advance. &lt;br&gt;
&lt;br&gt;
You treat your guests to a warm meal and as they settle in, they address the question on everyone&#39;s minds: what happened to Cortes? It seems the fate of their former leader will remain a mystery, however. You report that you left Cortes and the rest of the continent as you passed Tlaxcala, taking the opportunity to return home. It seems he never made his way back to Tenochtitlán and that was the last anyone saw of him.&lt;br&gt;
&lt;br&gt;
They go on to recount the events that transpired after you left the city. When their story is done, they inform you of their plans: they want to regroup, consolidate their forces over the coming months, and prepare to lay siege to Tenochtitlán. And they want your help. &lt;br&gt;
&lt;br&gt;
The last time Cortes asked you to put your life on the line, you refused. And yet they now ask again. This is different, however. Last time they faced their own enemies and it was not your fight. This time, you have an opportunity to finally defeat the Mexica once and for all. Will you take it?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have 4 choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Aid the Spaniards and lay siege to the Aztec capital. These foreigners have proven themselves to be fierce warriors and they have powerful weapons at their disposal. This may be your best chance to claim victory over your Mexica enemies.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Attack the Spaniards. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted and you have them in your grasp. Now is your chance to do away with the strangers and restore order to your world.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; Refuse the request and send the strangers on their way. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you let the two sides continue their fight, they will both come out weaker in the end.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 4:&lt;/b&gt; Lie to the Spaniards to trick them into complacency. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you join forces with your historical enemies, the foreigners won&#39;t stand a chance. You will promise support and then send word to the Mexica, laying a trap that the Spaniards cannot possibly escape. &lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then move forward to [[carry out your plan|Tlaxcalans Decide About the Spaniards]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Tlax_Alliance is &quot;Betray&quot;&gt;&gt;
You are not surprised when the Spaniards arrive in Tlaxcala, weary from the events of the past weeks. Your spies alerted you to their presence well in advance. &lt;br&gt;
&lt;br&gt;
You treat your guests to a warm meal and as they settle in, they address the question on everyone&#39;s minds: what happened to Cortes? Rather than admit that you abandoned their former leader to his fate, you lie and report that you left Cortes and the rest of the continent as you passed Tlaxcala, taking the opportunity to return home. It seems he never made his way back to Tenochtitlán and that was the last anyone saw of him. It&#39;s best for everyone if they don&#39;t know you led him into a trap.&lt;br&gt;
&lt;br&gt;
They go on to recount the events that transpired after you left the city. When their story is done, they inform you of their plans: they want to regroup, consolidate their forces over the coming months, and prepare to lay siege to Tenochtitlán. And they want your help. &lt;br&gt;
&lt;br&gt;
The last time Cortes asked you to put your life on the line, you refused. And yet they now ask again. This is different, however. Last time they faced their own enemies and it was not your fight. This time, you have an opportunity to finally defeat the Mexica once and for all. Will you take it?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have 4 choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Aid the Spaniards and lay siege to the Aztec capital. These foreigners have proven themselves to be fierce warriors and they have powerful weapons at their disposal. This may be your best chance to claim victory over your Mexica enemies.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Attack the Spaniards. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted and you have them in your grasp. Now is your chance to do away with the strangers and restore order to your world.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; Refuse the request and send the strangers on their way. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you let the two sides continue their fight, they will both come out weaker in the end.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 4:&lt;/b&gt; Lie to the Spaniards to trick them into complacency. Though your hatred of the Mexica runs deep, the Spaniards are not to be trusted. If you join forces with your historical enemies, the foreigners won&#39;t stand a chance. You will promise support and then send word to the Mexica, laying a trap that the Spaniards cannot possibly escape. &lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then move forward to [[carry out your plan|Tlaxcalans Decide About the Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="208" name="Spaniards wake up at camp" tags="Done" position="1800,2825" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Mal_Boy or $Mal_Boy eq &quot;&quot;&gt;&gt;
You wake to the sound of snoring and open your eyes to find you are back at camp. You feel the hard ground beneath you and look up at the stars. You&#39;ve never seen a night so clear. The horses rest nearby and the other men sleep in the open, scattered around the site. You can hardly believe you&#39;re back here.  You shift, trying to escape that rock that seems to have found its way under your hip, and you fall back into an uneasy rest.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for Marina to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mal_Boy is &quot;alone&quot;&gt;&gt;
You wake to the sound of snoring and open your eyes to find you are back at camp. You feel the hard ground beneath you and look up at the stars. You&#39;ve never seen a night so clear. The horses rest nearby and the other men sleep in the open, scattered around the site. You can hardly believe you&#39;re back here.  You shift, trying to escape that rock that seems to have found its way under your hip, and you fall back into an uneasy rest.&lt;br&gt;
&lt;br&gt;
You wake again, unable to escape that rock! You watch the sky grow lighter and the trees begin to take shape around you. Your compatriots begin to stir and you see the woman, Marina, get up to start a fire. Your stomach growls in hunger and you make your way to the fire, [[wondering what today will bring|On the way to Puebla]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Mal_Boy is $users[$userId][&quot;role&quot;]&gt;&gt;
You wake to the sound of snoring and open your eyes to find you are back at camp. You feel the hard ground beneath you and look up at the stars. You&#39;ve never seen a night so clear. The horses rest nearby and the other men sleep in the open, scattered around the site. You can hardly believe you&#39;re back here.  You shift, trying to escape that rock that seems to have found its way under your hip, and you fall back into an uneasy rest.&lt;br&gt;
&lt;br&gt;
[[You wake again with a start of fear|Marina&#39;s Boyfriend]]!&lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;
You wake to the sound of snoring and open your eyes to find you are back at camp. You feel the hard ground beneath you and look up at the stars. You&#39;ve never seen a night so clear. The horses rest nearby and the other men sleep in the open, scattered around the site. You can hardly believe you&#39;re back here.  You shift, trying to escape that rock that seems to have found its way under your hip, and you fall back into an uneasy rest.&lt;br&gt;
&lt;br&gt;
You wake again, unable to escape that rock! Something catches your eye on the other side of camp and you tense up, fearing an attack. You relax when you realize it is only the woman, Marina. What is she doing though? You watch her closely, distrusting the stranger in your midst. She makes her way quietly across the camp and slips beside a sleeping figure, &lt;&lt;print $Mal_Boy&gt;&gt;. You curse your luck and lay awake, jealous but helpless. Breakfast can&#39;t come soon enough.&lt;br&gt;
&lt;br&gt;
Finally, dawn comes. You rise and begin packing up [[eager to continue your journey|On the way to Puebla]]&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="209" name="Spanish Leadership Challenge" tags="" position="2800,4975" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You have made your decisions and led your people through a complicated situation, but do they still believe in your leadership? &lt;br&gt;
&lt;br&gt;
[[You await their decision|Generic Spanish Leadership Results]].

&lt;&lt;else&gt;&gt;
&lt;&lt;print $Span_Leader&gt;&gt; has led you through a complex situation, but do you agree with him? Is he the leader your people need right now? &lt;br&gt;
&lt;br&gt;

He leaves the group to debate and each member of the group must vote. When it is your turn, you make your choice.  Should &lt;&lt;print $Span_Leader&gt;&gt; remain in power? Or should one of the other elegible conquistadors take over?  Vote for your leader below.&lt;br&gt;
&lt;br&gt;

Option 1: &lt;&lt;link &quot;Cortes&quot; &quot;Generic Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Cor = $Sp_Ld_Cor + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Cortes&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should lead your people.&lt;br&gt;
&lt;br&gt;
Option 2: &lt;&lt;link &quot;Alvarado&quot; &quot;Generic Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Alv = $Sp_Ld_Alv + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Alvarado&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; should be in charge.&lt;br&gt;
&lt;br&gt;
Option 3: &lt;&lt;link &quot;Aguilar&quot; &quot;Generic Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Agu = $Sp_Ld_Agu + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Aguilar&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is best suited to lead in these difficult times.&lt;br&gt;
&lt;br&gt;
Option 4: &lt;&lt;link &quot;Garrido&quot; &quot;Generic Spanish Leadership Results&quot;&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Gar = $Sp_Ld_Gar + 1&gt;&gt;&lt;&lt;run changeStats(&quot;Garrido&quot;,{&quot;Wisdom&quot;:2,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Sp_Ld_Vote = $Sp_Ld_Vote + 1&gt;&gt;&lt;&lt;/link&gt;&gt; is your best chance of suriving these strange turns of events.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="210" name="Status of the Quest" tags="" position="4275,50" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Check Player and Team Status and Location|Control: Player Status]]&lt;br&gt;
[[Check the Status of Holds and Votes|Control: Votes]]&lt;br&gt;
[[Return to the Dashboard|Dashboard]]&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="211" name="StoryInit" tags="" position="4600,1200" size="100,100">/* &lt;&lt;set $lastSeenDelay=60 * 5000&gt;&gt; */
&lt;&lt;cacheaudio &quot;Gulls_and_waves__5min_&quot; &quot;audio/Gulls_and_waves__5min_.mp3&quot;&gt;&gt;
&lt;&lt;cacheaudio &quot;Library&quot; &quot;audio/Library.mp3&quot;&gt;&gt;
&lt;!-- &lt;&lt;masteraudio volume 0&gt;&gt; --&gt;

/* Gets discord info  */
&lt;&lt;script&gt;&gt;
	const loc = location.search
	const searchParams = new URLSearchParams(loc);
	State.setVar(&quot;$userId&quot;, searchParams.get(&#39;id&#39;) || userData.authData.id)
	State.setVar(&quot;_username&quot;, searchParams.get(&#39;username&#39;) || userData.authData.username)
	State.setVar(&quot;_role&quot;, searchParams.get(&#39;nick&#39;) || userData.authData.nick)
	State.setVar(&quot;_discriminator&quot;, searchParams.get(&#39;discriminator&#39;) || userData.authData.discriminator)
	setup.printTime = function (date) {
		return new Date(date).toLocaleString(&#39;en-US&#39;, {
    timeZone: &#39;America/New_York&#39;,
  });
	};

&lt;&lt;/script&gt;&gt;

/* 
List of valid roles and their info */
&lt;&lt;storeSet _roles = {
  &quot;Marina&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Do&amp;#xf1;a Marina/Malinche&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Alvarado&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Pedro de Alvarado&quot;,    
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Aguilar&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Ger&amp;#xf3;nimo de Aguilar&quot;,  
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Garrido&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Juan Garrido&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Olid&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Crist&amp;#xf3;bal de Olid&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Cortes&quot;: {
    &quot;faction&quot;: &quot;Spaniards&quot;,
    &quot;Character&quot;: &quot;Hern&amp;#xe1;n Cort&amp;#xe9;s&quot;,
    &quot;isLeader&quot;: &quot;TRUE&quot;
  },
  &quot;Moctezuma&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Moctezuma&quot;,
    &quot;isLeader&quot;: &quot;TRUE&quot;
  },
  &quot;Tlacaelel&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Tlacaelel Xocoyotl (aka Tlacaelel the Younger)&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Cuauhtemoc&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Cuauht&amp;#xe9;moc&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Aztec_Priest&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Aztec Priest&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Cacamatzin&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Cacamatz&amp;#xed;n&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Pochteca&quot;: {
    &quot;faction&quot;: &quot;Aztecs&quot;,
    &quot;Character&quot;: &quot;Pochteca&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Xicotencatl_Elder&quot;: {
    &quot;faction&quot;: &quot;Tlaxcalans&quot;,
    &quot;Character&quot;: &quot;Xicotencatl the Elder&quot;,
    &quot;isLeader&quot;: &quot;TRUE&quot;
  },
  &quot;Xicotencatl_Younger&quot;: {
    &quot;faction&quot;: &quot;Tlaxcalans&quot;,
    &quot;Character&quot;: &quot;Xicotencatl the Younger&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  },
  &quot;Maxixcatl&quot;: {
    &quot;faction&quot;: &quot;Tlaxcalans&quot;,
    &quot;Character&quot;: &quot;Maxixcatl&quot;,
    &quot;isLeader&quot;: &quot;FALSE&quot;
  }
}
		&gt;&gt;

/* init global users list */
&lt;&lt;if ndef $users&gt;&gt;
&lt;&lt;storeSet $users = {}&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* Not seen user is for testing purposes. Anytime a non-existing user&#39;s stats are needed, they will be directed to this temp user */
&lt;&lt;if ndef $users[&quot;notSeen&quot;]&gt;&gt;
&lt;&lt;storeSet $users[&quot;notSeen&quot;] = {
		&quot;stats&quot; : {
			&quot;Loyalty&quot; : 0,
			&quot;Strength&quot; : 0,
			&quot;Wisdom&quot; : 0
		},
		&quot;character&quot; : &quot;Not seen&quot;,
		&quot;faction&quot; : &quot;notSeen&quot;,
		&quot;isLeader&quot; : &quot;notSeen&quot;,
		&quot;lastSeen&quot; : 0,
		&quot;passage&quot; : &quot;Name Not Recognized&quot;,
		&quot;role&quot; : &quot;notSeen&quot;,
		&quot;username&quot; : &quot;notSeen&quot;
	}&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* Intialize faction data */
&lt;&lt;if ndef $factions&gt;&gt;
	&lt;&lt;storeSet $factions = {
		&quot;Aztecs&quot;: {&quot;stats&quot;: {

			&quot;Strength&quot; : 0,

			}
		},

		&quot;Spaniards&quot;: {&quot;stats&quot;: {

			&quot;Strength&quot; : 0,

			}
		},

		&quot;Tlaxcalans&quot;: {&quot;stats&quot;: {

			&quot;Strength&quot; : 0,
	
			}
		},
	}&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* inits lookup table. Maps roles to userid */
&lt;&lt;if ndef $lookup&gt;&gt;
	&lt;&lt;storeSet $lookup = {}&gt;&gt;
	&lt;&lt;for _user, _data  range _roles&gt;&gt;
		&lt;&lt;storeSet $lookup[_user] = &quot;notSeen&quot;&gt;&gt;
	&lt;&lt;/for&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* inits userdata in $users */
&lt;&lt;if ndef $users[$userId] || !(Object.keys(_roles).includes($users[$userId][&quot;role&quot;]))&gt;&gt;
&lt;&lt;storeSet $users[$userId] = {}&gt;&gt;
&lt;script&gt;
console.log(&quot;new user detected&quot;)
&lt;/script&gt;
&lt;&lt;storeSet $users[$userId][&quot;role&quot;] = _role&gt;&gt;
&lt;&lt;storeSet $users[$userId][&quot;username&quot;] = _username&gt;&gt;
&lt;&lt;storeSet $users[$userId][&quot;discriminator&quot;] =  _discriminator&gt;&gt;
&lt;&lt;storeSet $users[$userId][&quot;faction&quot;] = _roles[$users[$userId][&quot;role&quot;]]?.faction || &quot;undefined&quot;&gt;&gt;
&lt;&lt;storeSet $users[$userId][&quot;character&quot;] = _roles[$users[$userId][&quot;role&quot;]]?.Character || &quot;undefined&quot;&gt;&gt;
&lt;&lt;storeSet $users[$userId][&quot;isLeader&quot;] = _roles[$users[$userId][&quot;role&quot;]]?.isLeader || &quot;undefined&quot;&gt;&gt;
&lt;&lt;storeSet $users[$userId][&quot;passage&quot;] = Config.passages.start&gt;&gt;
&lt;&lt;storeSet $users[$userId][&quot;passageHistory&quot;] = {}&gt;&gt;
&lt;&lt;storeSet $lookup[$users[$userId][&quot;role&quot;]] = $userId&gt;&gt;
&lt;&lt;/if&gt;&gt;





/* for testing discord macro: */

/* &lt;&lt;discord aztecSpan&gt;&gt; as &lt;&lt;/discord&gt;&gt;
&lt;&lt;discord aztecs&gt;&gt; a &lt;&lt;/discord&gt;&gt;
&lt;&lt;discord tlax&gt;&gt; t &lt;&lt;/discord&gt;&gt;
&lt;&lt;discord spanish&gt;&gt; s &lt;&lt;/discord&gt;&gt;
&lt;&lt;discord aztecTlax&gt;&gt; at &lt;&lt;/discord&gt;&gt;
&lt;&lt;discord spanTlax&gt;&gt; st &lt;&lt;/discord&gt;&gt;
&lt;&lt;discord general&gt;&gt; g &lt;&lt;/discord&gt;&gt;
&lt;&lt;discord omen&gt;&gt; omen &lt;&lt;/discord&gt;&gt; */

/* Load passage */
&lt;&lt;script&gt;&gt;
	const loc = location.search
	const searchParams = new URLSearchParams(loc);

	if(searchParams.get(&#39;test&#39;)){
		console.log(&quot;Test user&quot;);
		if(searchParams.has(&#39;passage&#39;)){
			State.setVar(&quot;$users[$userId][&#39;passage&#39;]&quot;, searchParams.get(&#39;passage&#39;))
			}
	}  


	var passage =  State.getVar(&quot;$users[$userId][&#39;passage&#39;]&quot;)  
	var role = State.getVar(&quot;$users&quot;)[State.getVar(&quot;$userId&quot;)][&quot;role&quot;];

	// If not using test user and role is not recognized, go to Name not Recognized passage
	if(!searchParams.get(&#39;test&#39;) &amp;&amp; !(role in State.getVar(&quot;_roles&quot;))) passage = &quot;Name Not Recognized&quot;

	if((passage)){
		setTimeout(() =&gt; {
			console.log(&quot;playing passage&quot;, passage)
			Engine.play(passage)
		}, 100);

	}else{
		console.log(&quot;no passage&quot;)
		Engine.show();
	}
	$(&quot;body&quot;).css({opacity:1})
&lt;&lt;/script&gt;&gt;</tw-passagedata><tw-passagedata pid="212" name="Tenochtitlan New Spanish Leader" tags="" position="2675,9300" size="100,100">&lt;&lt;theyr&gt;&gt;
After much  debate , you finally determine that &lt;&lt;print $Span_Leader&gt;&gt; has the greatest loyalty , and you [[move forward under his leadership|Toxcatl]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="213" name="Tenochtitlan Spanish Leadership Results" tags="" position="2675,9175" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Sp_Ld_Vote_Teno isnot 5&gt;&gt;
When everyone has voted, you will find out who will lead you now.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the rest of your team to vote.&lt;br&gt;
&lt;br&gt;

&lt;&lt;else&gt;&gt;

&lt;&lt;if $Sp_Ld_Mar_Teno &gt;=$Sp_Ld_Alv_Teno and $Sp_Ld_Mar_Teno &gt;=$Sp_Ld_Agu_Teno and $Sp_Ld_Mar_Teno &gt;=$Sp_Ld_Gar_Teno and $Sp_Ld_Mar_Teno&gt;=$Sp_Ld_Oli_Teno&gt;&gt;

&lt;&lt;if $Sp_Ld_Mar_Teno is 5 or $Sp_Ld_Alv_Teno is 5 or $Sp_Ld_Agu_Teno is 5 or $Sp_Ld_Gar_Teno is 5 or $Sp_Ld_Oli_Teno is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Marina&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Marina&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Sp_Ld_Alv_Teno &gt;=$Sp_Ld_Mar_Teno and $Sp_Ld_Alv_Teno &gt;=$Sp_Ld_Agu_Teno and $Sp_Ld_Alv_Teno &gt;=$Sp_Ld_Gar_Teno and $Sp_Ld_Alv_Teno &gt;=$Sp_Ld_Oli_Teno&gt;&gt;
&lt;&lt;if $Sp_Ld_Mar_Teno is 5 or $Sp_Ld_Alv_Teno is 5 or $Sp_Ld_Agu_Teno is 5 or $Sp_Ld_Gar_Teno is 5 or $Sp_Ld_Oli_Teno is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Alvarado&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Sp_Ld_Agu_Teno &gt;=$Sp_Ld_Mar_Teno and $Sp_Ld_Agu_Teno &gt;=$Sp_Ld_Alv and $Sp_Ld_Agu_Teno &gt;=$Sp_Ld_Gar_Teno and $Sp_Ld_Agu_Teno &gt;=$Sp_Ld_Oli_Teno&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;
&lt;&lt;if $Sp_Ld_Mar_Teno is 5 or $Sp_Ld_Alv_Teno is 5 or $Sp_Ld_Agu_Teno is 5 or $Sp_Ld_Gar_Teno is 5 or $Sp_Ld_Oli_Teno is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Aguilar&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Sp_Ld_Gar_Teno &gt;=$Sp_Ld_Mar_Teno and $Sp_Ld_Gar_Teno &gt;=$Sp_Ld_Alv and $Sp_Ld_Gar_Teno &gt;=$Sp_Ld_Agu_Teno and $Sp_Ld_Gar_Teno &gt;=$Sp_Ld_Oli_Teno&gt;&gt;
&lt;&lt;if $Sp_Ld_Mar_Teno is 5 or $Sp_Ld_Alv_Teno is 5 or $Sp_Ld_Agu_Teno is 5 or $Sp_Ld_Gar_Teno is 5 or $Sp_Ld_Oli_Teno is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Garrido&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Sp_Ld_Oli_Teno &gt;=$Sp_Ld_Mar_Teno and $Sp_Ld_Oli_Teno &gt;=$Sp_Ld_Alv and $Sp_Ld_Oli_Teno &gt;=$Sp_Ld_Agu_Teno and $Sp_Ld_Oli_Teno &gt;=$Sp_Ld_Gar_Teno &gt;&gt;
&lt;&lt;if $Sp_Ld_Mar_Teno is 5 or $Sp_Ld_Alv_Teno is 5 or $Sp_Ld_Agu_Teno is 5 or $Sp_Ld_Gar_Teno is 5 or $Sp_Ld_Oli_Teno is 5&gt;&gt;
The group has made a decision, and your team has shown great unity of purpose.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=1&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Olid&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and take note of your team strength points!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The group has made a decision.  Continue to the next page to find out &lt;&lt;link &quot;who will lead your people&quot; &quot;Tenochtitlan New Spanish Leader&quot;&gt;&gt;&lt;&lt;storeSet $Span_Leader=&quot;Olid&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="214" name="The Aztec Legend of Quetzalcoatl" tags="" position="3125,100" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Start &lt;=10&gt;&gt;

You must wait for all the team members to gather for gameplay to begin.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Start &gt;=12&gt;&gt;

Mexica, over the last 200 years, you have vanquished your enemies one by one to become the most powerful city-state in central Mexico. Your first leader, Acamapichtli, was a son of the Culhua, descended from the Toltecs. This lineage secured his political legitimacy, and with him that of the empire. Religious legitimacy has been harder to come by, however, for it must be granted by the god Quetzalcoatl and the priests who wield his power.&lt;br&gt;
&lt;br&gt;
Many moons ago, during the time of the 4th sun, Quetzalcoatl walked the Earth and ruled over the sacred city of Tollan. Jealous of his power, Quetzalcoatl&#39;s brother, Tezcatlipoca, disguised himself as a sorcerer and tricked Quetzalcoatl into drunkenly cavorting with his sister, the priestess Quetzalpetlatl. The next day, Quetzalcoatl left Tollan in shame, never to return. Quetzalcoatl died in exile, whereupon he was cremated and his remains mixed with the blood of four sacrificed children to symbolize his heart. The heart was then placed in a wooden box and locked in one of the many temples that dot the landscape of central Mexico. The priests who guard this temple hold great power and only they can grant &lt;&lt;link &quot;the blessing that you seek&quot; &quot;The Aztec Quest for Legitimacy&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=2&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="215" name="The Aztec Quest for Legitimacy" tags="Done" position="3125,225" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Pochteca&quot;&gt;&gt;
You will find the heart of Quetzalcoatl in the city of Cholula. You must travel there to claim the heart and secure his blessing. Your journey will be long and difficult, however, and you will need many resources to sustain you if you are to succeed. Collecting these resources is the key to victory. Pochteca, as a trader, you know the terrain well. It is up to you to lead your team in this quest.&lt;br&gt;
&lt;br&gt;d
Do not hesitate in this journey, for you are not the only ones seeking this treasure. Your sworn enemies, the Tlaxcalans, have fought valiantly against you for many years and have resisted conquest. They would deny you the blessing of Quetzalcoatl to claim it for themselves, a feat which would surely fuel their warriors and steel them in their struggle against you.&lt;br&gt;
&lt;br&gt;
When you have read the following instructions and are ready to begin your quest, click the link below to enter the palace. &lt;br&gt;
&lt;br&gt;
In the palace you will find 6 place glyphs. Each of these glyphs represents a site of great significance in Central Mexico and in each you will find a vital resource for your journey. In order to collect each resource, you must work with your team to identify the correct name that corresponds with the glyph. Click on each glyph to visit that place and receive a clue to its location. You will need to draw on all your knowledge to solve each puzzle! Once you have figured out where you are, you will enter the name into a text box that is only available to you. When you enter the correct response, your entire team will advance to collect the resource located there and you will not be able to return.&lt;br&gt;
&lt;br&gt;
When you have obtained enough resources to survive your journey, you will be allowed to travel to Cholula. Because the Aztecs have further to travel, they must gather 5 goods, while the Tlaxcalans only require 4. &lt;br&gt;
&lt;br&gt;
Enter the palace and &lt;&lt;link &quot;begin your quest&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Leader_A=&quot;Pochteca&quot;&gt;&gt;&lt;&lt;storeSet $A_Q_Heart=&quot;no&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You will find the heart of Quetzalcoatl in the city of Cholula. You must travel there to claim the heart and secure his blessing. Your journey will be long and difficult, however, and you will need many resources to sustain you if you are to succeed. Collecting these resources is the key to victory. Because the Pochteca is a trader, he knows the terrain well. It is up to him to lead your team in this quest.&lt;br&gt;
&lt;br&gt;
Do not hesitate in this journey, for you are not the only ones seeking this treasure. Your sworn enemies, the Tlaxcalans, have fought valiantly against you for many years and have resisted conquest. They would deny you the blessing of Quetzalcoatl to claim it for themselves, a feat which would surely fuel their warriors and steel them in their struggle against you.&lt;br&gt;
&lt;br&gt;
When you have read the following instructions and are ready to begin your quest, click the link below to enter the palace. &lt;br&gt;
&lt;br&gt;
In the palace you will find 6 place glyphs. Each of these glyphs represents a site of great significance in Central Mexico and in each you will find a vital resource for your journey. In order to collect each resource, you must work with your team to identify the correct name that corresponds with the glyph. Click on each glyph to visit that place and receive a clue to its location. You will need to draw on all your knowledge to solve each puzzle! Once you have figured out where you are, the Pochteca will enter the name into a text box that is only available on his screen. When he enters the correct response, your team will collect the resource located there and you will not be able to return.&lt;br&gt;
&lt;br&gt;
When you have obtained enough resources to survive your journey, you will be allowed to travel to Cholula. Because the Aztecs have further to travel, they must gather 5 goods, while the Tlaxcalans only require 4. &lt;br&gt;
&lt;br&gt;
Enter the palace and [[begin your quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="216" name="The Aztecs Regroup" tags="" position="4300,9850" size="100,100">&lt;&lt;theyr&gt;&gt;
Double-click this passage to edit it.


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="217" name="The End" tags="" position="3725,13375" size="100,100">&lt;&lt;theyr&gt;&gt;
As the smell of blood and smoke fills your nostrils, you wake with a start. You jolt upright, open your eyes, and let out a scream. You are back in the library, but this time you&#39;re not alone. The room is lit with a soft, red glow and looming over you is the most terrifying figure you&#39;ve ever seen. &lt;br&gt;
&lt;br&gt;
A walking skeleton stands eight feet tall. Feathers sticky with blood cling to his bones and he bears the stench of death. You thought this whole adventure was just a dream, but the god of the Aztec underworld now stands before you. You briefly wonder if you are still dreaming, but when a drop of blood falls on your hand, the feeling is all too real. You know you are awake.&lt;br&gt;
&lt;br&gt;
As Mictlantecuhtli begins to speak, smoke spills from his open mouth. “Human, you have come to my lair uninvited one too many times. Every time I want to nap, I find you in my chair. Robbed of sleep, I have completed all your assignments for you in the hope that you would go away and never come back. And yet, here you are. Again. Have you no gratitude?”&lt;br&gt;
&lt;br&gt;
“And so, I will make you an offer: I will continue to do your work and you will make the Dean&#39;s list every semester for the rest of your college career. What you do with that success is up to you. All I ask is for two things in return: first, you must stay out of my chair and second, you must promise me your immortal soul. When you finally reach the end of your life, you will join me in Mictlán. If you refuse me this offer, you must leave immediately and promise never to return. Worst of all, you must do your own damn work. The choice is yours.”&lt;br&gt;
&lt;br&gt;
Well, this explains a lot. You knew you couldn&#39;t have written those papers--they were just too good--but you had no idea the price of plagiarism was so high! You think about all the assignments that still await you; graduation is a long way off. Is all that work worth the price of your eternal soul?&lt;br&gt;
&lt;br&gt;
You rise up out of the chair, knees shaking. You know what you must do...&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="218" name="The Festival of Toxcatl" tags="" position="4300,9250" size="100,100">&lt;&lt;theyr&gt;&gt;
[[The Festival of Toxcatl: The Spaniards]]

[[The Festival of Toxcatl: The Aztecs]]

[[The Festival of Toxcatl: The Tlaxcalans]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="219" name="The Festival of Toxcatl: The Aztecs" tags="" position="4500,9400" size="100,100">&lt;&lt;theyr&gt;&gt;
[[La Noche Triste]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="220" name="The Festival of Toxcatl: The Spaniards" tags="" position="4100,9400" size="100,100">&lt;&lt;theyr&gt;&gt;
[[La Noche Triste]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="221" name="The Festival of Toxcatl: The Tlaxcalans" tags="" position="4300,9400" size="100,100">&lt;&lt;theyr&gt;&gt;
[[La Noche Triste]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="222" name="The Land of the Olmeca Xicalanca" tags="Done Breaks" position="2475,975" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlacaelel&quot;&gt;&gt;
Tlacaelel, you lead the delegation on a long and dangerous journey to the coast. If the rumors are true, there you will find a band of foreign intruders. Moctezuma has sent you with instructions to gather information and prevent the strangers from moving further into Aztec territory. He has given you gifts of gold and feathers that you may use to gain their trust.&lt;br&gt;
&lt;br&gt;
You must decide how you will proceed if you find the strange men you seek. Choose from the following options:&lt;br&gt;
&lt;br&gt;
1.  You trust Moctezuma&#39;s instincts and will follow his instructions. You will &lt;&lt;link &quot;offer the gifts&quot; &quot;On a Beach in Veracruz: Gifts&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and gather as much information as you can about the pale men and their intentions.&lt;br&gt;
&lt;br&gt;
2. You agree with Moctezuma&#39;s decision to seek information, but question the wisdom in offering gifts. You will approach the strangers and inquire about their intentions, but you will &lt;&lt;link &quot;not offer the gifts&quot; &quot;On a Beach in Veracruz: No Gifts&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
3.  You disagree with Moctezuma&#39;s plan. You are wary of the strangers and believe the smartest move is to catch them off guard with &lt;&lt;link &quot;an immediate attack&quot; &quot;Attack On a Beach in Veracruz&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Tlacaelel&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:0,&quot;Strength&quot;:-1})&gt;&gt;&lt;&lt;run changeStats(&quot;Cuauhtemoc&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:0,&quot;Strength&quot;:-1})&gt;&gt;&lt;&lt;run changeStats(&quot;Cacamatzin&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:0,&quot;Strength&quot;:-1})&gt;&gt;&lt;&lt;run changeStats(&quot;Pochteca&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:0,&quot;Strength&quot;:-1})&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;Attack&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
 &lt;br&gt;
4.  You are wary of making a hasty decision and &lt;&lt;link &quot;seek the counsel of your men&quot; &quot;Discuss these options with your men&quot;&gt;&gt;&lt;&lt;storeSet $flags[&quot;gifts&quot;]=&quot;Talk&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Cuauhtemoc&quot; OR &quot;Cacamatzin&quot; OR &quot;Pochteca&quot;&gt;&gt;

You have been ordered by Moctezuma to make the long and dangerous journey to the coast. If the rumors are true, there you will find a band of foreign intruders. Moctezuma has sent you with instructions to gather information and prevent the strangers from moving further into Aztec territory. He has given you gifts of gold and feathers that you may use to gain their trust.&lt;br&gt;
&lt;br&gt;
As Moctezuma&#39;s second in command and the highest ranking among you, it is up to Tlacaelel Xocoyotl to decide how you will proceed if you encounter these strangers. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $flags[&quot;gifts&quot;] is &quot;Attack&quot;&gt;&gt;

Tlacaelel Xocoyotl disagrees with Moctezuma&#39;s plan and prepares you for an attack. He is wary of the strangers and believes the course of action is to catch them off guard. These pale men will surely be overwhelmed by a [[show of Aztec force|Attack On a Beach in Veracruz]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;No&quot;&gt;&gt;

Tlacaelel Xocoyotl questions Moctezuma&#39;s decision to offer gifts.  You will approach the strangers and inquire about their intentions, but you will not offer the gifts. You [[approach the strangers|On a Beach in Veracruz: No Gifts]] with empty hands and nervous hearts.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;Yes&quot;&gt;&gt;

Tlacaelel Xocoyotl instructs you to follow Moctezuma&#39;s directions. You will offer the gifts and gather as much information as you can about the pale men and their intentions. You [[approach the strangers|On a Beach in Veracruz: Gifts]] with the gifts Moctezuma provided you with.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;Talk&quot;&gt;&gt;

Tlacaelel Xocoyotl has a difficult decision to make and has decided to seek your counsel. Go to your faction discussion board and decide on the best course of action. You will need to decide from among the following options:&lt;br&gt;
&lt;br&gt;
1. You trust Moctezuma&#39;s instincts and will follow his instructions. You will offer the gifts and gather as much information as you can about the pale men and their intentions.&lt;br&gt;
&lt;br&gt;
2. You agree with Moctezuma&#39;s decision to seek information, but question the wisdom in offering gifts. You will approach the strangers and inquire about their intentions, but you will not offer the gifts.&lt;br&gt;
&lt;br&gt;
3. You disagree with Moctezuma&#39;s plan. You are wary of the strangers and believe the smartest move is to catch them off guard with an immediate attack.&lt;br&gt;
&lt;br&gt;
After you have come to a conclusion on the discussion board, you may [[proceed|Discuss these options with your men]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] eq &quot;&quot; or ndef $flags[&quot;gifts&quot;]&gt;&gt;

You anxiously await his instructions, wondering what lies ahead.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for Tlacaelel to input his decision.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="223" name="The Library" tags="Done" position="3875,1275" size="100,100">&lt;&lt;theyr&gt;&gt;

It&#39;s eight weeks into the semester and you&#39;re already drowning in work. You have your first exams this week, you need to get started on some research, and now your history professor has sprung a surprise assignment on you at the last minute--and it&#39;s due tomorrow! The only way you&#39;re going to get everything done is to pull an all-nighter. There&#39;s no way you&#39;ll be able to stay awake at home; your bed is there and it&#39;s just too tempting. So you head to the library. &lt;br&gt;
&lt;br&gt;
It&#39;s 7 pm and the library is more crowded than usual. It looks like you&#39;re not the only one with a mountain of work to do this week! There&#39;s no way you&#39;ll be able to focus in the midst of so many people. Maybe the top floor is quieter. You head upstairs towards the study carrels, but they&#39;re all taken. It&#39;s dead quiet up here, but there&#39;s nowhere to work. You begin wandering down unfamiliar hallways, poking your head into all the different rooms, but none of them work. You&#39;re beginning to get frustrated when you notice a door you&#39;ve never seen before. It&#39;s tucked into an alcove in the very back corner of the building. You decide to check this one last spot before you give up and join the masses downstairs. &lt;br&gt;
&lt;br&gt;
The door sticks as you try to open it, but you can tell it&#39;s not locked. You give it a pull and it creaks open, revealing a tiny room piled high with books and a single, overstuffed chair. There&#39;s not a soul to be found. When you close the door behind you, you can&#39;t even hear the sound of the H-VAC that hums through the rest of the building. This is perfect. You can&#39;t believe your luck! &lt;br&gt;
&lt;br&gt;
You unload your books and make yourself comfortable--maybe a little too comfortable. You get to work on your assignment, but within a matter of minutes your eyes get heavy. You struggle to stay awake but it&#39;s impossible to focus. Maybe a ten-minute nap will help. You tell yourself that if you just get it out of your system, you&#39;ll be good to go for the rest of the night. You close your eyes and quickly slip into a deep sleep. &lt;br&gt;
&lt;br&gt;
Suddenly, &lt;&lt;link &quot;you&#39;re startled by a loud noise&quot; &quot;Character Identification&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=1&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;] = 7&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=1&gt;&gt;&lt;&lt;storeSet $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;] = 7&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;] = 7&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="224" name="The Spaniards Decide to Continue" tags="Done" position="1525,175" size="100,100">&lt;&lt;theyr&gt;&gt;
Now that you&#39;ve made a decision, you can move forward. &lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Olid&quot; OR &quot;Alvarado&quot; OR &quot;Garrido&quot;&gt;&gt;

But why are you moving forward? &lt;br&gt;
&lt;br&gt;
Cortés has &lt;&lt;link &quot;totally inspired you&quot; &quot;Cortes Leadership Check&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cortes&quot;,{&quot;Wisdom&quot;:0,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Cuba_Voted = $Cuba_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt; with his vision for what lays ahead! &lt;br&gt;
&lt;br&gt;
Cortés is clearly &lt;&lt;link &quot;much smarter than Velazquez&quot; &quot;Cortes Leadership Check&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cortes&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Cuba_Voted = $Cuba_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt; and he knows the path forward is filled with glory and riches! &lt;br&gt;
&lt;br&gt;
Cortés has &lt;&lt;link &quot;threatened you&quot; &quot;Cortes Leadership Check&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cortes&quot;,{&quot;Wisdom&quot;:-1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:1})&gt;&gt;&lt;&lt;storeSet $Cuba_Voted = $Cuba_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt; with what he will do to you if you don&#39;t follow! &lt;br&gt;
&lt;br&gt;
Cortés has not &lt;&lt;link &quot;convinced you&quot; &quot;Cortes Leadership Check&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Cortes&quot;,{&quot;Wisdom&quot;:-1,&quot;Loyalty&quot;:-1,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Cuba_Voted = $Cuba_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt;  but now you are stuck on this boat and outnumbered!&lt;br&gt;
&lt;br&gt;

&lt;&lt;case &quot;Cortes&quot;&gt;&gt;

Cortes, you have convinced your men somehow.  As you move to the next page, note that you may have gained or lost points in Wisdom, Strength, or Loyalty. You may [[continue on your adventure|Cortes Leadership Check]], but this experience has marked you, laying the groundwork of your future leadership.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="225" name="The Spaniards Head Inland" tags="Done Breaks" position="1975,2325" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
Despite everything you have seen and heard, you have decided to forge ahead. The journey will undoubtedly be dangerous, through harsh weather and over treacherous terrain. And all without the blessing of the king! &lt;br&gt;
&lt;br&gt;
You face these challenges bravely, however, confident that God will watch over you and reward you generously should you succeed. &lt;br&gt;
&lt;br&gt;
You settle in to your basecamp for the night, &lt;&lt;link &quot;drifting off&quot; &quot;Waking up in the library&quot;&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=0&gt;&gt;&lt;&lt;/link&gt;&gt; to the sound of the waves lapping the nearby shore.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Despite your best efforts to deter the strangers, your spies inform you that they are heading inland and will not stop until they reach your great city. What do these foreigners want and why are they so bold as to seek an audience with the mighty Moctezuma? Are they even a threat, or merely a nuisance? How will you deal with these men if they survive their journey?&lt;br&gt;
&lt;br&gt;
Exhausted from the events of the last few weeks, you settle down on your sleeping mat and &lt;&lt;link &quot;quickly fall asleep&quot; &quot;Waking up in the library&quot;&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=0&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt; 
You&#39;ve been watching the events of the last few weeks closely, wondering what all this might mean for you. The foreigners have no intention of turning back. They are now headed for Tenochtitlán, but must pass through Tlaxcalan lands if they hope to reach their destination.&lt;br&gt;
&lt;br&gt;
You have never before allowed intruders into your territory and have no intention of doing so now. Are you prepared for their arrival?&lt;br&gt;
&lt;br&gt;
Exhausted from the events of the last few weeks, you settle down on your sleeping mat and &lt;&lt;link &quot;quickly fall asleep&quot; &quot;Waking up in the library&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=0&gt;&gt;&lt;&lt;/link&gt;&gt;


&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="226" name="The Tabascans battle the Spaniards" tags="Done Breaks" position="1375,825" size="100,100">&lt;&lt;theyr&gt;&gt;
For weeks now, the Chontal leaders have been hearing rumors that a group of foreigners has been traveling along the coast, making their way towards your village. When word arrived that they had landed upon your shores, the local chiefs sent an army to head them off. Much to everyone&#39;s surprise, many of the men came back wounded, telling stories of their defeat. &lt;br&gt;
&lt;br&gt;
They recount the harrowing tale to their leaders, telling of dirty men with pale skin and unkempt hair. The warriors surrounded the strangers and quickly overwhelmed them, firing their arrows and piercing them with spears. They were sure they had killed at least two strangers. They were sure they had secured a victory, only to be shocked by the most terrifying sights. First, there was the loudest noise they had ever heard, so loud it left the men deaf and disoriented. The noise was immediately followed by a giant stone that flew through the air, raining fire down upon them. Second, a team of men descended on them, riding upon the backs of the biggest deer they had ever seen! Wounded and terrified, the warriors fled, but not everyone made it out. Over two hundred men fell dead in the battle.&lt;br&gt;
&lt;br&gt;
Never before have you felt such fear among the Chontal people. As they consider their next move, [[you wonder what these events might mean for you|Marina Tells Her Story]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="227" name="The Tlaxcalan Leader Decides" tags="Done" position="2175,3350" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
Your people have recognized your wisdom, and you will now lead them through the treachourous times ahead, at least for now.  You made your argument to the Council, but will you follow through with it?  You must decide, and your fellow Tlaxcalans must follow.  Will you &lt;&lt;link &quot;attack the Spaniards&quot; &quot;Tlaxcala Attacks in Puebla&quot;&gt;&gt;&lt;&lt;storeSet $Tl_Attacks_Pu=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;, or &lt;&lt;link &quot;will you approach them as friends&quot; &quot;Tlaxcala Doesn&#39;t Attack in Puebla&quot;&gt;&gt;&lt;&lt;storeSet $Tl_Attacks_Pu=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;?

&lt;&lt;elseif $Tlax_Leader isnot $users[$userId][&quot;role&quot;] and ndef $Tl_Attacks_Pu or $Tl_Attacks_Pu eq &quot;&quot;&gt;&gt;
Together, the Council has decided that &lt;&lt;print $Tlax_Leader&gt;&gt; has the greatest wisdom.  He will lead your people forward, but where? Will he pursue the path he set out in his arguments, or will he do something unexpected?&lt;br&gt;
&lt;br&gt;
You wait for his decision. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Tlax_Leader isnot $users[$userId][&quot;role&quot;] and $Tl_Attacks_Pu is &quot;Yes&quot;&gt;&gt;
Together, the Council has decided that &lt;&lt;print $Tlax_Leader&gt;&gt; has the greatest wisdom.  He will lead your people forward, but where? Will he pursue the path he set out in his arguments, or will he do something unexpected?&lt;br&gt;
&lt;br&gt;
He leads you [[into battle with the Spaniards|Tlaxcala Attacks in Puebla]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Leader isnot $users[$userId][&quot;role&quot;] and $Tl_Attacks_Pu is &quot;No&quot;&gt;&gt;
Together, the Council has decided that &lt;&lt;print $Tlax_Leader&gt;&gt; has the greatest wisdom.  He will lead your people forward, but where? Will he pursue the path he set out in his arguments, or will he do something unexpected?&lt;br&gt;
&lt;br&gt;
You march across the plains [[in hopes of peace|Tlaxcala Doesn&#39;t Attack in Puebla]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="228" name="The Tlaxcalan Legend of Quetzalcoatl" tags="Done" position="2975,100" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Start &lt;=10&gt;&gt;
You must wait for all the team members to gather for gameplay to begin.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Start &gt;=12&gt;&gt;

Tlaxcalans, over the last 200 years, you have watched the Mexica vanquish their enemies one by one to become the most powerful city-state in central Mexico. Their first leader, Acamapichtli, was a son of the Culhua, descended from the Toltecs. This lineage secured his political legitimacy, and with him that of his empire. Religious legitimacy has been harder to come by, however, for it must be granted by the god Quetzalcoatl and the priests who wield his power. &lt;br&gt;
&lt;br&gt;
Many moons ago, during the time of the 4th sun, Quetzalcoatl walked the Earth and ruled over the sacred city of Tollan. Jealous of his power, Quetzalcoatl&#39;s brother, Tezcatlipoca, disguised himself as a sorcerer and tricked Quetzalcoatl into drunkenly cavorting with his sister, the priestess Quetzalpetlatl. The next day, Quetzalcoatl left Tollan in shame, never to return. Quetzalcoatl died in exile, whereupon he was cremated and his remains mixed with the blood of four sacrificed children to symbolize his heart. The heart was then placed in a wooden box and locked in one of the many temples that dot the landscape of central Mexico. The priests who guard this temple hold great power and only they can grant &lt;&lt;link &quot;the blessing that you seek&quot; &quot;The Tlaxcalan Quest for Legitimacy&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=2&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="229" name="The Tlaxcalan Quest for Legitimacy" tags="Done" position="2975,225" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Xicotencatl_Younger&quot;&gt;&gt;
You will find the heart of Quetzalcoatl in the city of Cholula. You must travel there to claim the heart and secure his blessing. Your journey will be long and difficult, however, and you will need many resources to sustain you if you are to succeed. Collecting these resources is the key to victory. Xicotencatl the Younger, you have much to prove and this is your chance. It is up to you to lead your team on this quest!&lt;br&gt;
&lt;br&gt;
If you succeed, you will deny legitimacy to the Mexica and maintain the balance of power in central Mexico. The blessing of Quetzalcoatl will surely fuel your warriors and steel you in your struggle against the Mexica. Do not hesitate in this quest, for you are in a race against the most powerful warriors of the Aztec Empire.&lt;br&gt;
&lt;br&gt;
When you have read the following instructions and are ready to begin your quest, click the link below to enter the palace. &lt;br&gt;
&lt;br&gt;
In the palace you will find 6 place glyphs. Each of these glyphs represents a site of great significance in Central Mexico and in each you will find a vital resource for your journey. In order to collect each resource, you must work with your team to identify the correct name that corresponds with the glyph. Click on each glyph to visit that place and receive a clue to its location. You will need to draw on all your knowledge to solve each puzzle! Once you have figured out where you are, you will enter the name into a text box that is only available on your screen. When you enters the correct response, your entire team will collect the resource located there and you will not be able to return.&lt;br&gt;
&lt;br&gt;
When you have obtained enough resources to survive your journey, you will be allowed to travel to Cholula. Because the Aztecs have further to travel, they must gather 5 goods, while you only require 4.&lt;br&gt;
&lt;br&gt;
Enter the palace and &lt;&lt;link &quot;begin your quest&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=2&gt;&gt;&lt;&lt;storeSet $Quest_Leader_T=&quot;Xicotencatl_Younger&quot;&gt;&gt;&lt;&lt;storeSet $T_Q_Heart=&quot;no&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You will find the heart of Quetzalcoatl in the city of Cholula. You must travel there to claim the heart and secure his blessing. Your journey will be long and difficult, however, and you will need many resources to sustain you if you are to succeed. Collecting these resources is the key to victory. Xicotencatl the Younger is young and strong, and he will lead this quest.&lt;br&gt;
&lt;br&gt;
If you succeed, you will deny legitimacy to the Mexica and maintain the balance of power in central Mexico. The blessing of Quetzalcoatl will surely fuel your warriors and steel you in your struggle against the Mexica. Do not hesitate in this quest, for you are in a race against the most powerful warriors of the Aztec Empire.&lt;br&gt;
&lt;br&gt;
When you have read the following instructions and are ready to begin your quest, click the link below to enter the palace. &lt;br&gt;
&lt;br&gt;
In the palace you will find 6 place glyphs. Each of these glyphs represents a site of great significance in Central Mexico and in each you will find a vital resource for your journey. In order to collect each resource, you must work with your team to identify the correct name that corresponds with the glyph. Click on each glyph to visit that place and receive a clue to its location. You will need to draw on all your knowledge to solve each puzzle! Once you have figured out where you are, Xicotencatl the Younger will enter the name into a text box that is only available on his screen. When he enters the correct response, your entire team will collect the resource located there and you will not be able to return.&lt;br&gt;
&lt;br&gt;
When you have obtained enough resources to survive your journey, you will be allowed to travel to Cholula. Because the Aztecs have further to travel, they must gather 5 goods, while you only require 4.&lt;br&gt;
&lt;br&gt;
Enter the palace and [[begin your quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="230" name="The Tlaxcalans and Spaniards Flee" tags="" position="4125,9850" size="100,100">&lt;&lt;theyr&gt;&gt;
Double-click this passage to edit it.


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="231" name="Tlatelolco" tags="Done Breaks" position="2525,175" size="100,100">This place has you buzzing with energy. Your senses are nearly overwhelmed! You can barely hear over the din of voices, and you find yourself drawn towards the scent of fresh tortillas, epazote, and copal smoke.&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Tlatelolco_Ans_A&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Tlatelolco 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_A&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Tlatelolco 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Tlatelolco_Ans_T&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Tlatelolco 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_T&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Tlatelolco 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="232" name="Tlatelolco 2" tags="Done Breaks" position="2675,175" size="100,100">&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;print $Tlatelolco_Ans_A&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Tlatelolco_Ans_A and $Tlatelolco_Ans_A isnot 0 and $Tlatelolco_Ans_A isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Tlatelolco_Ans_A = $Tlatelolco_Ans_A.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Tlatelolco_Ans_A or $Tlatelolco_Ans_A eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Tlatelolco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Tlatelolco_Ans_A is &quot;tlatelolco&quot; and $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of trade goods for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_A = $Quest_Points_A + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlatelolco_Ans_A is &quot;tlatelolco&quot; and $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of trade goods for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlatelolco_Ans_A isnot &quot;tlatelolco&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Tlatelolco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;print $Tlatelolco_Ans_T&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Tlatelolco_Ans_T and $Tlatelolco_Ans_T isnot 0 and $Tlatelolco_Ans_T isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Tlatelolco_Ans_T = $Tlatelolco_Ans_T.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Tlatelolco_Ans_T or $Tlatelolco_Ans_T eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Tlatelolco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlatelolco_Ans_T is &quot;tlatelolco&quot; and $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of trade goods for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_T = $Quest_Points_T + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlatelolco_Ans_T is &quot;tlatelolco&quot; and $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of trade goods for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlatelolco_Ans_T isnot &quot;tlatelolco&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Tlatelolco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="233" name="Tlaxcala Attacks Aztecs" tags="" position="3325,12600" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat is &quot;War&quot;&gt;&gt;
The events of months past have taught you many lessons, but they have done nothing to diminish your hatred of the Mexica. With your enemy weakened, now is the time to strike! Mexica spies are everywhere, so you must be swift.&lt;br&gt;
&lt;br&gt;
You prepare your forces and lay siege to Tenochtitlán. Though the city has been ravaged, the Mexica put up a powerful defense. It seems the preparations they laid for a fight with the Spaniards are working to their advantage! Much to your dismay,  your two sides are as evenly matched as ever. Only one side can [[claim victory though|Victory Decision Aztecs Versus Tlaxcalans 2]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The events of months past have taught you many lessons, but they have done nothing to diminish your hatred of the Mexica. With your enemy weakened by disease, now is the time to strike! Mexica spies are everywhere, so you must be swift.&lt;br&gt;
&lt;br&gt;
You prepare your forces and lay siege to Tenochtitlán. Though the city has been ravaged by disease, the Mexica put up a powerful defense. It seems the preparations they laid for a fight with the Spaniards are working to their advantage! Much to your dismay,  your two sides are as evenly matched as ever. Only one side can [[claim victory though|Victory Decision Aztecs Versus Tlaxcalans 2]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat is &quot;War&quot;&gt;&gt;
The past months have been a waking nightmare. The arrival of the strangers on your shore so long ago set in motion a chain of events beyond your wildest imagination. You have fought many battles and have emerged victorious, but can life ever go back to the way it was before?&lt;br&gt;
&lt;br&gt;
Your relief is short-lived, however, for the Tlaxcalans are attacking Tenochtitlán! In your moment of victory, they somehow believe they can take control of the mighty Aztec Empire.&lt;br&gt;
&lt;br&gt;
You gather your wits and your weapons, facing off once more against your hated enemy. The Tlaxcalans don&#39;t stand a chance! [[Or do they|Victory Decision Aztecs Versus Tlaxcalans 2]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The past months have been a waking nightmare. The arrival of the strangers on your shore so long ago set in motion a chain of events beyond your wildest imagination. You prayed to the Gods to restore peace and order, but the departure of the Spaniards was followed by a plague worse than any before seen. Tenochtilán has seemed like a ghost town of late, those who remain weighed down by grief and loss.&lt;br&gt;
&lt;br&gt;
You are thus heartened when you receive word that the Tlaxcalans have launched an attack on the Spaniards and devastated their forces! Can it be true? Are they really finished? Your optimism is short-lived, however, for the victorious Tlaxcalans are attacking Tenochtitlán! It seems they have been buoyed by their victory and believe they can take control of the mighty Aztec Empire.&lt;br&gt;
&lt;br&gt;
You gather your wits and your weapons, facing off once more against your hated enemy. The Tlaxcalans don&#39;t stand a chance! [[Or do they|Victory Decision Aztecs Versus Tlaxcalans 2]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="234" name="Tlaxcala Attacks Aztecs Aztec Victory" tags="" position="3425,13550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Mexica had the Gods on their side and it is they who won this quick and bloody war. As you are finally taken captive, you prepare to meet your end, grateful that you will at least be taken to the temple and [[offered up to the Gods|The End]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Tlaxcalans, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="235" name="Tlaxcala Attacks Aztecs Tlaxcalan Victory" tags="" position="3525,13175" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Mexica, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Tlaxcalans had the Gods on their side and it is they who won this quick and bloody war. As you are finally taken captive, you prepare to meet your end, grateful that you will at least be taken to the temple and [[offered up to the Gods|The End]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="236" name="Tlaxcala Attacks in Puebla" tags="Done" position="1875,3475" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You sent a pair of indigenous messengers out ahead to announce your arrival and declare your good intentions, but they failed to return. Though you would prefer to have assurances that you will be met peacefully, you have no choice but to forge on.&lt;br&gt;
&lt;br&gt;
A day into your journey, you encounter the messengers upon the road, both of them in a state of terror. They tell you that they were imprisoned in Tlaxcala and only managed to escape because the Tlaxcalans were preoccupied preparing for your arrival. The messengers claimed that the Tlaxcalans had threatened them, saying: “Now we are going to kill those whom you call Teules, and eat their flesh, and we will see whether they are as valiant as you announce; and we shall eat your flesh too, you who come here with treasons and lies from that traitor Montezuma!” The messengers tried their best to convince the Tlaxcalans that you share an enemy in Moctezuma, but could not change their minds.&lt;br&gt;
&lt;br&gt;
Alert to the danger ahead, you steel yourselves for battle and thank God for his favor in sending you this news. You send your horsemen out ahead and they are able to thwart an ambush. The battle that follows is fierce and bloody, lasting many days. 45 of your men are killed on the battlefield, but your preparations serve you well and you are able to secure [[a narrow victory|A Spanish Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Your first communication with the foreigners comes in the form of two messengers who they send to meet you. The men inform you that the strangers are approaching your territory, but assure you that they seek no quarrel. They claim that you share a common enemy in the Mexica Emperor, Moctezuma, but you do not trust them and you take the two messengers prisoner. &lt;br&gt;
&lt;br&gt;
After all this time wondering what might come next, you now know that the strange men are headed your way. You begin preparing for war, leaving a crew of men to defend the homefront while the bulk of your forces advance ahead to prepare an ambush. &lt;br&gt;
&lt;br&gt;
The foreigners surround you, however, almost as though they knew what to expect! You&#39;ve lost the element of surprise and a bloody battle ensues. It lasts many days and you kill many of their men, but their weapons are too much for you and you are overwhelmed by the giant deer that they ride into battle. Despite your best efforts, the foreigners prove to be too much and you are eventually [[forced to retreat|An Unexpected Loss for Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="237" name="Tlaxcala Attacks the Spaniards" tags="" position="2225,12075" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat is &quot;War&quot;&gt;&gt;
These strangers might be strong, but Tlaxcala has never been conquered and never will be! They may have defeated the Mexica, but they spilled much blood in the fight. Now is the time to attack!&lt;br&gt;
&lt;br&gt;
The battle is long and hard fought. Though you have caught your enemy off guard, they have powerful weapons and put up a valiant fight. You watch as some of your best warriors are cut down by their heavy blades.&lt;br&gt;
&lt;br&gt;
By the time it is done, no-one has any remaining will to fight. Finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Spaniards versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You carefully weigh the Spaniards&#39; offer. This may be your best chance to do away with your Mexica enemies for good. At the same time, you question the Spaniards&#39; loyalty and wonder if they are, in fact, the greater danger. This decision is not to be taken lightly.&lt;br&gt;
&lt;br&gt;
After much debate, you decide that the best course of action is to attack the foreigners. You would rather live with the enemy you know. You quietly begin preparing for war, telling your friends that you have yet to make a decision. Meanwhile, you continue playing the gracious hosts. &lt;br&gt;
&lt;br&gt;
When all is ready, you launch your attack! The battle is long and hard fought. Though you have caught your enemy off guard and have the advantage of being on home territory, they have powerful weapons and put up a valiant fight. You watch as some of your best warriors are cut down by their heavy blades.&lt;br&gt;
&lt;br&gt;
By the time it is done, Tlaxcala is a ruin and it seems that no-one has any remaining will to fight. But finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Spaniards versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat is &quot;War&quot;&gt;&gt;
You have achieved victory over the Mexica once and for all and brought glory to the Spanish crown! You barely have time to imagine the rewards that await you, however, for the Tlaxcalans have launched a surprise attack! It seems they would deny you the spoils of your victory.&lt;br&gt;
&lt;br&gt;
The Tlaxcalans are well-rested and well-supplied, but you have the stronger weapons. You cut many of their best warriors down with your swords and yet their forces don&#39;t seem to grow any weaker.&lt;br&gt;
&lt;br&gt;
By the time it is done, no-one has any remaining will to fight. Finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Spaniards versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have made your case to the Tlaxcalans. You have handed them a golden opportunity to take down their long-time enemies, but will they take it? You saw the Tlaxcalan leaders&#39; eyes light up at the possibility and yet they have been debating amongst themselves for many days. Perhaps their decision is not as easy as you had hoped. You wonder if they might be plotting an attack of their own.&lt;br&gt;
&lt;br&gt;
Weeks have passed when your hosts launch a surprise attack! Your hunch was right! Luckily for you, you were not caught entirely off guard. The Tlaxcalans have the clear advantage of being on home turf, but you have the stronger weapons. You cut many of their best warriors down with your swords and yet their forces don&#39;t seem to grow any weaker.&lt;br&gt;
&lt;br&gt;
By the time it is done, Tlaxcala is a ruin and it seems that no-one has any remaining will to fight. But finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Spaniards versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="238" name="Tlaxcala Attacks the Spaniards Spanish Victory" tags="" position="2650,12325" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat is &quot;War&quot;&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over the city, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Spanish.&lt;br&gt;
&lt;br&gt;
The Spaniards have won the battle! But will they repay you for [[the debt they owe you|The End]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over the city, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Spanish.&lt;br&gt;
&lt;br&gt;
The Spaniards have won this battle, but [[can they win the next|Spaniards Defeat Tlaxcalans and Fight Aztecs Alone]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $Tlax_Bat is &quot;War&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Tlaxcalans. They will serve as a powerful lesson to those who doubt your power. [[Victory is yours|The End]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization.&lt;br&gt;
&lt;br&gt;
You have won the battle! Tlaxcala has fallen and you will [[live to fight another day|Spaniards Defeat Tlaxcalans and Fight Aztecs Alone]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Even through the chaos that surrounds you, you can see your men falling one after the next. The horror of what lies before you barely registers before you fall to your knees, cut down by your enemy. You give your last breath knowing that your death will be in vain. &lt;br&gt;
&lt;br&gt;
You have lost your battle. The Spaniards have defeated you, but are they strong enough to best the Mexica too? Alas, [[you will never know|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="239" name="Tlaxcala Attacks the Spaniards Tlaxcalan Victory" tags="" position="3925,12375" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over Tlaxcala, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Tlaxcalan.&lt;br&gt;
&lt;br&gt;
Tlaxcala has won the battle! Will you be able to escape the city with your life or will you meet [[the same fate as your friends|The End]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Even through the chaos that surrounds you, you can see your men falling one after the next. The horror of what lies before you barely registers before you fall to your knees, cut down by your enemy. You give your last breath knowing that your death will be in vain. &lt;br&gt;
&lt;br&gt;
You have lost your battle. Glory has eluded you and your name will be [[forgotten by history|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
&lt;&lt;if $Tlax_Bat is &quot;War&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Spaniards, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization.&lt;br&gt;
&lt;br&gt;
You have won the battle! You have saved Tlaxcala and brought death to your Spanish enemies. &lt;br&gt;
&lt;br&gt;
Your Mexica enemies remain, however, and it is clear after everything that the long-standing stalemate that existed between you cannot continue. Something has to change and now is the moment. &lt;br&gt;
&lt;br&gt;
Has this experience changed your feelings about your archenemies? Or does the hatred of a thousand suns still consume you? Go to the Tlaxcalan discussion board and weigh your options. You have two choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;Offer to make peace with the Mexica&quot; &quot;Tlaxcala Makes a Peace Treaty with the Aztecs&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Az=&quot;Peace&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Launch a surprise attack on Tenochtitlán and put an end to your enemies, &lt;&lt;link &quot;once and for all&quot; &quot;Tlaxcala Attacks Aztecs&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Final_Az=&quot;War&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $Tlax_Bat is &quot;War&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Spaniards, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization.&lt;br&gt;
&lt;br&gt;
You have won the battle! You have saved Tlaxcala and brought death to your Spanish enemies. &lt;br&gt;
&lt;br&gt;
Your Mexica enemies remain, however, and it is clear after everything that the long-standing stalemate that existed between you cannot continue. Something has to change and now is the moment. &lt;br&gt;
&lt;br&gt;
Has this experience changed your feelings about your archenemies? Or does the hatred of a thousand suns still consume you? Go to the Tlaxcalan discussion board and weigh your options. You have two choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Offer to make peace with the Mexica.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Launch a surprise attack on Tenochtitlán and put an end to your enemies, once and for all.&lt;br&gt;
&lt;br&gt;

&lt;&lt;if ndef $Tlax_Final_Az or $Tlax_Final_Az eq &quot;&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then carry on.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to input your decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Az is &quot;Peace&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Makes a Peace Treaty with the Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Az is &quot;War&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Attacks Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if ndef $Tlax_Final_Az or $Tlax_Final_Az eq &quot;&quot;&gt;&gt;

&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to do something.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Az is &quot;Peace&quot;&gt;&gt;
[[A delegation from Tlaxcala approaches|Tlaxcala Makes a Peace Treaty with the Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Az is &quot;War&quot;&gt;&gt;
[[A delegation from Tlaxcala approaches|Tlaxcala Attacks Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="240" name="Tlaxcala Decides What To Do" tags="" position="2850,12325" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Final_Aztec Points eq &quot;&quot; or ndef $Final_Aztec_Points or $Final_Spanish_Points eq &quot;&quot; or ndef $Final_Spanish_Points&gt;&gt;
You wait for your options to become clear.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
The Spaniards and Aztecs must battle it out.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Spanish_Points &gt;=$Final_Aztec_Points&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
After the Spaniards made their departure, your spies followed close behind. They&#39;ve been keeping close watch and now there is news to report! It seems there has been a great battle and the Spaniards emerged victorious! The Mexica defeat was catastrophic. It seems clear that Huitzilopochtli has abandoned them.&lt;br&gt;
&lt;br&gt;
But what will this mean for you? What is your best way forward? Should you propose peace and try to salvage your relationship with the Spaniards? Or is now the chance to make your move, to be the last ones standing and to rule over the once powerful Aztec Empire yourselves?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have two choices:
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;Offer to make peace with the Spaniards&quot; &quot;Tlaxcala Does Nothing and Makes a Peace Treaty with Spanish Winners&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Span_Peace=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; &lt;&lt;link &quot;Launch a surprise attack and put an end to the foreigners, once and for all&quot; &quot;Tlaxcala Does Nothing Attacks the Spanish Winners&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Span_Peace=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then carry on.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
After the Spaniards made their departure, your spies followed close behind. They&#39;ve been keeping close watch and now there is news to report! It seems there has been a great battle and the Spaniards emerged victorious! The Mexica defeat was catastrophic. It seems clear that Huitzilopochtli has abandoned them.&lt;br&gt;
&lt;br&gt;
But what will this mean for you? What is your best way forward? Should you propose peace and try to salvage your relationship with the Spaniards? Or is now the chance to make your move, to be the last ones standing and to rule over the once powerful Aztec Empire yourselves?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have two choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Offer to make peace with the Spaniards.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Launch a surprise attack and put an end to the foreigners, once and for all.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Tlax_Span_Peace or $Tlax_Span_Peace eq &quot;&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then carry on.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to input your decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Span_Peace is &quot;Yes&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Does Nothing and Makes a Peace Treaty with Spanish Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Span_Peace is &quot;No&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Does Nothing Attacks the Spanish Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $Final_Aztec_Points &gt;$Final_Spanish_Points&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
After the Spaniards made their departure, your spies followed close behind. They&#39;ve been keeping close watch and now there is news to report! It seems there has been a great battle and the Mexica emerged victorious! So great was their victory that the foreign enemies are no more. Those who survived the battle were offered up to Huitzilopochtli, who will surely reward the victors for such a valuable gift.&lt;br&gt;
&lt;br&gt;
You are now faced with a decision. Has this experience changed your feelings about your archenemies? Or does the hatred of a thousand suns still consume you? &lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have two choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;Offer to make peace with the Mexica&quot; &quot;Tlaxcala Does Nothing and Makes a Peace Treaty with the Aztec Winners&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Az_Peace=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; &lt;&lt;link &quot;Launch a surprise attack on Tenochtitlán and put an end to your enemies, once and for all&quot; &quot;Tlaxcala Does Nothing Attacks the Aztec Winners&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Az_Peace=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then carry on.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
After the Spaniards made their departure, your spies followed close behind. They&#39;ve been keeping close watch and now there is news to report! It seems there has been a great battle and the Mexica emerged victorious! So great was their victory that the foreign enemies are no more. Those who survived the battle were offered up to Huitzilopochtli, who will surely reward the victors for such a valuable gift.&lt;br&gt;
&lt;br&gt;
You are now faced with a decision. Has this experience changed your feelings about your archenemies? Or does the hatred of a thousand suns still consume you? &lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan discussion board and weigh your options. You have two choices:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Offer to make peace with the Mexica.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Launch a surprise attack on Tenochtitlán and put an end to your enemies, once and for all.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Tlax_Az_Peace or $Tlax_Az_Peace eq &quot;&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then carry on.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to input your decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Az_Peace is &quot;Yes&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Does Nothing and Makes a Peace Treaty with the Aztec Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Az_Peace is &quot;No&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Tlax_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Does Nothing Attacks the Aztec Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="241" name="Tlaxcala Does Nothing" tags="" position="3200,11825" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You have made your case to the Tlaxcalans. You have handed them a golden opportunity to take down their long-time enemies, but will they take it? You saw the Tlaxcalan leaders&#39; eyes light up at the possibility and yet they have been debating amongst themselves for many days. Perhaps their decision is not as easy as you had hoped. &lt;br&gt;
&lt;br&gt;
When they finally inform you of their decision, you cannot conceal your disappointment. They have refused your request. They will not fight on your behalf and send you to face the Mexica alone. &lt;br&gt;
&lt;br&gt;
As you head back into the mountains, you wonder if you [[stand a chance without your indigenous allies at your side|Tlaxcala Does Nothing Spaniards Fight Aztecs Alone]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You carefully weigh the Spaniards&#39; offer. This may be your best chance to do away with your Mexica enemies for good. At the same time, you question the Spaniards&#39; loyalty and wonder if they are, in fact, the greater danger. This decision is not to be taken lightly.&lt;br&gt;
&lt;br&gt;
After much debate, you decide that the best course of action is to remain neutral. You don&#39;t trust anyone at this point and, besides, the longer the Mexica and the Spaniards fight among themselves, the weaker they both become. This could work to your advantage.&lt;br&gt;
&lt;br&gt;
You inform your guests that they must fight their battles alone and [[send them on their way|Tlaxcala Decides What To Do]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="242" name="Tlaxcala Does Nothing Attacks the Aztec Winners" tags="" position="3150,12700" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Your hatred of Mexica outweighs any benefit of making peace. They may have emerged victorious in their battle with the Spaniards, but they have been weakened nonetheless. Now is the time to make your move!&lt;br&gt;
&lt;br&gt;
You launch your attack but much to your surprise, your two sides are as evenly matched as ever. Only one side [[can claim victory though|Victory Decision Aztecs Versus Tlaxcalans 3]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The Tlaxcalans have launched an attack! You gather your wits and your weapons, facing off once more against your hated enemy. &lt;br&gt;
&lt;br&gt;
Your two sides are evenly matched, as usual, but only one [[can claim victory|Victory Decision Aztecs Versus Tlaxcalans 3]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="243" name="Tlaxcala Does Nothing Attacks the Spanish Winners" tags="" position="2725,12725" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Your distrust of the Spaniards outweighs any benefit of making peace and you cannot imagine a world in which your two peoples live side-by-side. They may have emerged victorious in their battle with the Mexica, but they have been weakened nonetheless. Now is the time to make your move!&lt;br&gt;
&lt;br&gt;
You launch your attack but much to your surprise, your two sides are as evenly matched as ever. Only one side can [[claim victory though|Victory Decision Spaniards versus Tlaxcalans 2]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The Tlaxcalans have launched an attack! You gather your wits and your weapons, facing off against yet another enemy.&lt;br&gt;
&lt;br&gt;
Your two sides are evenly matched, as usual, but only one [[can claim victory|Victory Decision Spaniards versus Tlaxcalans 2]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="244" name="Tlaxcala Does Nothing Aztecs Accept Peace Treaty" tags="" position="2875,13050" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The Mexica have listened to reason and agreed with your wisdom! You will set aside your hatred in the interest of peace. As you reflect on this moment, you cannot help but wonder how different your world will be [[from this moment on|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The Tlaxcalans have convinced you that peace is your best way forward. You agree to set aside your hatred and unite against any enemies that might come your way. As you reflect on this moment, you cannot help but wonder how different your world will be [[from this moment on|The End]].
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="245" name="Tlaxcala Does Nothing Aztecs Refuse Peace Treaty and Attack Tlaxcala" tags="" position="3025,12800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The Mexica have launched an attack! You gather your wits and your weapons, facing off once more against your hated enemy. What treachery!&lt;br&gt;
&lt;br&gt;
Your two sides are evenly matched, as usual, but only one [[can claim victory|Victory Decision Aztecs Versus Tlaxcalans 3]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Your hatred of Tlaxcala outweighs any benefit of making peace. Besides, you defeated the Spaniards and the Gods smile upon you!&lt;br&gt;
&lt;br&gt;
You launch your attack but much to your surprise, your two sides are as evenly matched as ever. Only one side [[can claim victory|Victory Decision Aztecs Versus Tlaxcalans 3]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="246" name="Tlaxcala Does Nothing Aztecs Refuse Peace Treaty and Attack Tlaxcala Aztec Victory" tags="" position="3050,13400" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Mexica had the Gods on their side and it is they who won this quick and bloody war. As you are finally taken captive, you prepare to meet your end, grateful that you will at least be taken to the temple and [[offered up to the Gods|The End]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Tlaxcalans, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="247" name="Tlaxcala Does Nothing Aztecs Refuse Peace Treaty and Attack Tlaxcala Tlaxcalan Victory" tags="" position="3200,13525" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Mexica, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Tlaxcalans had the Gods on their side and it is they who won this quick and bloody war. As you are finally taken captive, you prepare to meet your end, grateful that you will at least be taken to the temple and [[offered up to the Gods|The End]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="248" name="Tlaxcala Does Nothing Spaniards Accept Peace Treaty" tags="" position="2375,13550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The Tlaxcalans have convinced you that peace is your best way forward. They will stand at your side and unite against any enemies that might come your way. As you reflect on this moment, you cannot help but [[bask in your glory|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The Spaniards have listened to reason and agreed with your wisdom! You will move forward at their side, in the interest of peace. As you reflect on this moment, you cannot help but wonder how different your world will be [[from this moment on|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="249" name="Tlaxcala Does Nothing Spaniards Fight Aztecs Alone" tags="" position="3200,12000" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
The news in Tlaxcala has left your companions bitter and the mood is dark. The Spanish forces must face the Mexica alone. You heard that the city has been devastated by disease, but will this be enough to assure a Spanish victory?&lt;br&gt;
&lt;br&gt;
As you near Tenochtitlán, you set up camp for the night, preparing to attack by dark. When all is ready, the Spaniards launch their attack, cutting off the causeways and trapping the Mexica inside the city. Despite being caught off guard, the Mexica mount a powerful defense. The people of the city spent weeks preparing for just such a battle, and they are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you could have imagined. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs versus Spaniards 3]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You leave Tlaxcala disappointed and unsure of the future. You have no choice but to face the Mexica alone. You heard that the city has been devastated by disease, but will this be enough to assure your victory?&lt;br&gt;
&lt;br&gt;
As you near Tenochtitlán, you set up camp for the night, preparing to attack by dark. When all is ready, you launch your attack, cutting off the causeways and trapping the Mexica inside the city. Despite being caught off guard, the Mexica mount a powerful defense. The people of the city spent weeks preparing for just such a battle, and they are quick to jump into action.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve ever experienced before. The stakes are high and this will be a fight to the death for both sides.The residents of the city-young, old, man, woman-all join the fray, luring your men into traps and fighting with makeshift weapons. Many others, however, fall victim to your superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs versus Spaniards 3]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The past months have been a waking nightmare. The arrival of the strangers on your shore so long ago set in motion a chain of events beyond your wildest imagination. You prayed to the Gods to restore peace and order, but the departure of the Spaniards was followed by a plague worse than any before seen. Tenochtilán has seemed like a ghost town of late, those who remain weighed down by grief and loss.&lt;br&gt;
&lt;br&gt;
In the midst of this horror, you are awoken in the dead of night by an attack! It seems the Spaniards have attempted to catch you off guard! Despite the despair that hangs like a cloud over the city, the people are quick to launch a defense. You spent months preparing for just such a fight and now the time has come.&lt;br&gt;
&lt;br&gt;
The battle is like nothing you&#39;ve seen before. The stakes are high and this will be a fight to the death for both sides. The residents of the city-young, old, man, woman-all join the fray, luring the Spaniards into traps and fighting with makeshift weapons. Many others, however, fall victim to the foreigners&#39; superior weapons. The scene descends into mayhem, but it soon becomes clear [[which side will win|Victory Decision Aztecs versus Spaniards 3]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="250" name="Tlaxcala Does Nothing Spaniards Fight Aztecs Alone Aztec Victory" tags="" position="3125,12500" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over the city, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Mexica.&lt;br&gt;
&lt;br&gt;
The Mexica have won the battle! Will you be able to escape the city with your life or will you meet [[the same fate as your friends|The End]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Even through the chaos that surrounds you, you can see your men falling one after the next. The horror of what lies before you barely registers before you fall to your knees, cut down by your enemy. You give your last breath knowing that your death will be in vain. &lt;br&gt;
&lt;br&gt;
You have lost your battle. Glory has eluded you and your [[name will be forgotten by history|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization.&lt;br&gt;
&lt;br&gt;
You have won the battle! You have saved your city and brought death to your enemies.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Tlax_Az_Peace or $Tlax_Az_Peace eq &quot;&quot;&gt;&gt;
You look up from the battlefield and notice the Tlaxcalans watching from afar.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to make a move.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Az_Peace is &quot;Yes&quot;&gt;&gt;
[[The Tlaxcalans approach|Tlaxcala Does Nothing and Makes a Peace Treaty with the Aztec Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Az_Peace is &quot;No&quot;&gt;&gt;
[[The Tlaxcalans approach|Tlaxcala Does Nothing Attacks the Aztec Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="251" name="Tlaxcala Does Nothing Spaniards Fight Aztecs Alone Spanish Victory" tags="" position="3375,12350" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
You managed to take cover and have been watching in horror the bloody scene before you. As the din begins to fade and quiet settles over the city, you look out to see the few lone survivors remaining on the battlefield. They are overwhelmingly Spanish.&lt;br&gt;
&lt;br&gt;
The Spaniards have won the battle! But will they repay you for the debt they owe you?&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Tlax_Span_Peace or $Tlax_Span_Peace eq &quot;&quot;&gt;&gt;
You look up from the battlefield and notice the Tlaxcalans watching from afar.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to make a move.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Span_Peace is &quot;Yes&quot;&gt;&gt;
[[The Tlaxcalans approach|Tlaxcala Does Nothing and Makes a Peace Treaty with Spanish Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Span_Peace is &quot;No&quot;&gt;&gt;
[[The Tlaxcalans approach|Tlaxcala Does Nothing Attacks the Spanish Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
As the din that surrounds you begins to fade, you stop to survey your surroundings. Few of your enemies remain. You watch your compatriots as they come to the same realization. &lt;br&gt;
&lt;br&gt;
You have won the battle! The city is yours and you will reap your reward.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Tlax_Span_Peace or $Tlax_Span_Peace eq &quot;&quot;&gt;&gt;
You look up from the battlefield and notice the Tlaxcalans watching from afar.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to make a move.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Span_Peace is &quot;Yes&quot;&gt;&gt;
[[The Tlaxcalans approach|Tlaxcala Does Nothing and Makes a Peace Treaty with Spanish Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Span_Peace is &quot;No&quot;&gt;&gt;
[[The Tlaxcalans approach|Tlaxcala Does Nothing Attacks the Spanish Winners]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Even through the chaos that surrounds you, you can see your men falling one after the next. The horror of what lies before you barely registers before you fall to your knees, cut down by your enemy. You give your last breath knowing that your death will be in vain. &lt;br&gt;
&lt;br&gt;
You have lost your battle. [[The city belongs to your enemies now|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="252" name="Tlaxcala Does Nothing Spaniards Refuse Peace Treaty and Attack Tlaxcala" tags="" position="2575,12775" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The Spaniards have launched an attack! You gather your wits and your weapons, facing off once more against your powerful enemy. You knew they were not to be trusted!&lt;br&gt;
&lt;br&gt;
Your two sides are evenly matched, but only one [[can claim victory|Victory Decision Spaniards versus Tlaxcalans 2]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The Tlaxcalans refused to fight at your side and now they must pay the price. You defeated the might Aztec Empire and will surely crush Tlaxcala as well.&lt;br&gt;
&lt;br&gt;
You launch your attack but much to your surprise, your two sides are evenly matched. Only one side [[can claim victory though|Victory Decision Spaniards versus Tlaxcalans 2]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="253" name="Tlaxcala Does Nothing Spaniards Refuse Peace Treaty and Attack Tlaxcala Spanish Victory" tags="" position="2675,13275" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Spaniards had more powerful weapons and it is they who won this quick and bloody war. As you look upon the tragic scene before you, you are cut down. You look to the Gods one last time, wondering why [[they have forsaken you|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Tlaxcalans. They will serve as a powerful lesson to those who doubt your power. [[Victory is yours|The End]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="254" name="Tlaxcala Does Nothing Spaniards Refuse Peace Treaty and Attack Tlaxcala Tlaxcalan Victory" tags="" position="2825,13325" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Spaniards, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you [[for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Tlaxcalans had the Gods on their side and it is they who won this quick and bloody war. As you are finally taken captive, you prepare to meet your end. You shudder at the thought of [[what surely awaits you|The End]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="255" name="Tlaxcala Does Nothing and Makes a Peace Treaty with Spanish Winners" tags="" position="2550,12600" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Span_Leader&gt;&gt;
You have vanquished the vicious and powerful Mexica, toppling the Aztec Empire and claiming this great land for the King! You must now restore order to the city, decide what to do with the residents of the city who remain, and find the treasure that is surely hidden within the walls of the city.&lt;br&gt;
&lt;br&gt;
As you set to work on the most pressing tasks, a Tlaxcalan messenger arrives in the city, conveying an offer. It seems the Tlaxcalans want to make peace! But is this a wise decision? Go to the Spanish-Tlaxcalan discussion board and hear what they have to say. Will you:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;Sign a peace treaty&quot; &quot;Tlaxcala Does Nothing Spaniards Accept Peace Treaty&quot;&gt;&gt;&lt;&lt;storeSet $Final_Peace=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; &lt;&lt;link &quot;Reject the peace treaty and attack Tlaxcala&quot; &quot;Tlaxcala Does Nothing Spaniards Refuse Peace Treaty and Attack Tlaxcala&quot;&gt;&gt;&lt;&lt;storeSet $Final_Peace=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have vanquished the vicious and powerful Mexica, toppling the Aztec Empire and claiming this great land for the King! You must now restore order to the city, decide what to do with the residents of the city who remain, and find the treasure that is surely hidden within the walls of the city.&lt;br&gt;
&lt;br&gt;
As you set to work on the most pressing tasks, a Tlaxcalan messenger arrives in the city, conveying an offer. It seems the Tlaxcalans want to make peace! But is this a wise decision? Go to the Spanish-Tlaxcalan discussion board and hear what they have to say. Will you:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Sign a peace treaty&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Reject the peace treaty and attack Tlaxcala&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Final_Peace or $Final_Peace eq &quot;&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Span_Leader&gt;&gt; will input your decision. You may then carry on.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Span_Leader&gt;&gt; to input your decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Peace is &quot;Yes&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Span_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Does Nothing Spaniards Accept Peace Treaty]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Peace is &quot;No&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $Span_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Does Nothing Spaniards Refuse Peace Treaty and Attack Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The Gods have smiled upon the Spaniards and you question the wisdom of fighting them again. The world as you knew it no longer exists and you wonder what is in store for you. Had you fought with the Spaniards, you might have won yourselves a seat at the table, but that seems unlikely now. It would be in their best interest to maintain the peace however, so you make the offer. &lt;br&gt;
&lt;br&gt;
You send a messenger to Tenochtitlán to congratulate the Spaniards on their victory and request a summit. When everyone has gathered, you make your case. &lt;br&gt;
&lt;br&gt;
Go to the Spanish-Tlaxcalan discussion board and convince the Spaniards that it&#39;s in their best interest to sign a peace treaty. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Final_Peace or $Final_Peace eq &quot;&quot;&gt;&gt;
You wait anxiously to hear their response.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $Span_Leader&gt;&gt; to input a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Peace is &quot;Yes&quot;&gt;&gt;
[[The Spaniards approach|Tlaxcala Does Nothing Spaniards Accept Peace Treaty]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Peace is &quot;No&quot;&gt;&gt;
[[The Spaniards approach|Tlaxcala Does Nothing Spaniards Refuse Peace Treaty and Attack Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="256" name="Tlaxcala Does Nothing and Makes a Peace Treaty with the Aztec Winners" tags="" position="2950,12650" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The Gods have smiled upon your Mexica enemy and you question the wisdom of fighting them again now. At the same time, recent events have led you to the realization that there are enemies out there more dangerous than the Mexica and there is strength in unity. You have decided it&#39;s time to bury the macuahuitl once and for all. &lt;br&gt;
&lt;br&gt;
You send a messenger to Tenochtitlán bearing news of your recent victory and request a summit with the Mexica leaders. When everyone has gathered-an unprecedented event in the history of your two peoples-you make your case. &lt;br&gt;
&lt;br&gt;
Go to the Aztec-Tlaxcalan discussion board and convince the Mexica that it&#39;s in their best interest to sign a peace treaty. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Final_Peace or $Final_Peace eq &quot;&quot;&gt;&gt;
You wait anxiously to hear their response.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $New_Aztec_Leader&gt;&gt; to input a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Peace is &quot;Yes&quot;&gt;&gt;
[[The Aztecs approach|Tlaxcala Does Nothing Aztecs Accept Peace Treaty]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Peace is &quot;No&quot;&gt;&gt;
[[The Aztecs approach|Tlaxcala Does Nothing Aztecs Refuse Peace Treaty and Attack Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $New_Aztec_Leader&gt;&gt;
You emerge from your victory battered but hopeful. You have vanquished your Spanish enemies, offered them up to Huitzilipochtli, and have restored the natural balance. Surely the Gods must be satisfied now!&lt;br&gt;
&lt;br&gt;
You are surprised when a Tlaxcalan messenger arrives in the city, conveying an offer. It seems the Tlaxcalans want to make peace! But is this a wise decision? Go to the Aztec-Tlaxcalan discussion board and hear what they have to say. You will want to consult your council to weigh your options. Will you:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;Sign a peace treaty&quot; &quot;Tlaxcala Does Nothing Aztecs Accept Peace Treaty&quot;&gt;&gt;&lt;&lt;storeSet $Final_Peace=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; &lt;&lt;link &quot;Reject the peace treaty and attack Tlaxcala&quot; &quot;Tlaxcala Does Nothing Aztecs Refuse Peace Treaty and Attack Tlaxcala&quot;&gt;&gt;&lt;&lt;storeSet $Final_Peace=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You emerge from your victory battered but hopeful. You have vanquished your Spanish enemies, offered them up to Huitzilipochtli, and have restored the natural balance. Surely the Gods must be satisfied now!&lt;br&gt;
&lt;br&gt;
You are surprised when a Tlaxcalan messenger arrives in the city, conveying an offer. It seems the Tlaxcalans want to make peace! But is this a wise decision? Go to the Aztec-Tlaxcalan discussion board and hear what they have to say. You will want to consult your council to weigh your options. Will you:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Sign a peace treaty&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Reject the peace treaty and attack Tlaxcala&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Final_Peace or $Final_Peace eq &quot;&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $New_Aztec_Leader&gt;&gt; will input your decision. You may then carry on.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You must wait for &lt;&lt;print $New_Aztec_Leader&gt;&gt; to input your decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Peace is &quot;Yes&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $New_Aztec_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Does Nothing Aztecs Accept Peace Treaty]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Final_Peace is &quot;No&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $New_Aztec_Leader&gt;&gt; will input your decision. You may then [[carry on|Tlaxcala Does Nothing Aztecs Refuse Peace Treaty and Attack Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="257" name="Tlaxcala Doesn&#39;t Attack in Puebla" tags="Done" position="2050,3475" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You sent a pair of indigenous messengers out ahead to announce your arrival and declare your good intentions, but they failed to return. You take their disappearance as a bad sign and wonder if they met their fate at the hands of the Tlaxcalans. You have no choice but to forge on.&lt;br&gt;
&lt;br&gt;
You make your way quietly through the woods when one of the men sees movement up ahead. You&#39;re being watched and you glimpse the man&#39;s bow and arrow as he darts across your path. Already on edge, one of your men aims carelessly into the woods with his crossbow, launching an attack. The man fires back and an arrow whizzes past your head!&lt;br&gt;
&lt;br&gt;
Your horsemen run ahead and they encounter a group of Tlaxcalan soldiers, preparing for what appears to be an ambush. The battle that follows is fierce and bloody, lasting many days. 45 of your men are killed on the battlefield, but your preparations serve you well and you are able to [[secure a narrow victory|A Spanish Victory]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Your first communication with the foreigners comes in the form of two messengers who they send to meet you. The men inform you that the strangers are approaching your territory, but assure you that they seek no quarrel. They claim that you share a common enemy in the Mexica Emperor, Moctezuma. After all this time wondering what might come next, you now know that the foreigners are headed your way. You send the messengers back with your reply: you will welcome them in peace.&lt;br&gt;
&lt;br&gt;
You prepare for the arrival of these strange visitors and take a delegation out to meet them. One of your guards runs out ahead when he is attacked! He rushes back to the group to warn you and you quickly prepare for battle. A thunderous sound bears down upon you and soon you are confronted by a herd of giant deer! The strangers sit perched atop them and they rush upon you, tearing at you with knives! &lt;br&gt;
&lt;br&gt;
A bloody battle ensues. It lasts many days and you kill many of their men, but their weapons are too much for you and you are overwhelmed by the giant deer that they ride into battle. Despite your best efforts, the foreigners prove to be too much and you are eventually [[forced to retreat|An Unexpected Loss for Tlaxcala]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="258" name="Tlaxcala Makes a Peace Treaty with the Aztecs" tags="" position="4000,12500" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The events of the past months have led you to the realization that there are enemies out there more dangerous than the Mexica and there is strength in unity. You have decided it&#39;s time to bury the macuahuitl once and for all. &lt;br&gt;
&lt;br&gt;
You send a messenger to Tenochtitlán bearing news of your recent victory and request a summit with the Mexica leaders. When everyone has gathered-an unprecedented event in the history of your two peoples-you make your case. &lt;br&gt;
&lt;br&gt;
Go to the Aztec-Tlaxcalan discussion board and convince the Mexica that it&#39;s in their best interest to sign a peace treaty.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Tlax_Az_Peace or $Tlax_Az_Peace eq &quot;&quot;&gt;&gt;
You wait anxiously to hear their response.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $New_Aztec_Leader&gt;&gt; to enter the decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Az_Peace is &quot;Yes&quot;&gt;&gt;
You wait anxiously to hear [[their response|Aztecs Accept Peace Treaty]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Az_Peace is &quot;No&quot;&gt;&gt;
You wait anxiously to hear [[their response|Aztecs Refuse Peace Treaty and Attack Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $New_Aztec_Leader&gt;&gt;
The past months have been a waking nightmare. The arrival of the strangers on your shore so long ago set in motion a chain of events beyond your wildest imagination. You prayed to the Gods to restore peace and order, but the departure of the Spaniards was followed by a plague worse than any before seen. Tenochtilán has seemed like a ghost town of late, those who remain weighed down by grief and loss.&lt;br&gt;
&lt;br&gt;
You are thus heartened when you receive word that the Tlaxcalans have launched an attack on the Spaniards and devastated their forces! Can it be true? Are they really finished? Your hopes are confirmed by a Tlaxcalan messenger who arrives in Tenochtitlán. He assures you that the Tlaxcalans have sent the Spaniards to meet their Gods and the Tlaxcalan leaders now seek an audience. The messenger assures you that the offer is made in peace and you agree to hold a summit-an unprecedented event in the history of your two peoples.&lt;br&gt;
&lt;br&gt;
It seems the Tlaxcalans want to make peace! But is this a wise decision? Go to the Aztec-Tlaxcalan discussion board and hear what they have to say. You will want to consult your council to weigh your options. Will you:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;Sign a peace treaty&quot; &quot;Aztecs Accept Peace Treaty&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Az_Peace=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; &lt;&lt;link &quot;Reject the peace treaty and attack Tlaxcala&quot; &quot;Aztecs Refuse Peace Treaty and Attack Tlaxcala&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Az_Peace=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
When you have agreed on the best course of action, input your decision here. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
The past months have been a waking nightmare. The arrival of the strangers on your shore so long ago set in motion a chain of events beyond your wildest imagination. You prayed to the Gods to restore peace and order, but the departure of the Spaniards was followed by a plague worse than any before seen. Tenochtilán has seemed like a ghost town of late, those who remain weighed down by grief and loss.&lt;br&gt;
&lt;br&gt;
You are thus heartened when you receive word that the Tlaxcalans have launched an attack on the Spaniards and devastated their forces! Can it be true? Are they really finished? Your hopes are confirmed by a Tlaxcalan messenger who arrives in Tenochtitlán. He assures you that the Tlaxcalans have sent the Spaniards to meet their Gods and the Tlaxcalan leaders now seek an audience. The messenger assures you that the offer is made in peace and you agree to hold a summit-an unprecedented event in the history of your two peoples.&lt;br&gt;
&lt;br&gt;
It seems the Tlaxcalans want to make peace! But is this a wise decision? Go to the Aztec-Tlaxcalan discussion board and hear what they have to say. &lt;&lt;print $New_Aztec_Leader&gt;&gt; will want to consult his council to weigh the options. Will you:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; Sign a peace treaty.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; Reject the peace treaty and attack Tlaxcala.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if ndef $Tlax_Az_Peace or $Tlax_Az_Peace eq &quot;&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $New_Aztec_Leader&gt;&gt; will input your decision. You may then move forward to carry out your plan.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $New_Aztec_Leader&gt;&gt; to enter the decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Az_Peace is &quot;Yes&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $New_Aztec_Leader&gt;&gt; will input your decision. You may then move forward to [[carry out your plan|Aztecs Accept Peace Treaty]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Az_Peace is &quot;No&quot;&gt;&gt;
When you have agreed on the best course of action, &lt;&lt;print $New_Aztec_Leader&gt;&gt; will input your decision. You may then move forward to [[carry out your plan|Aztecs Refuse Peace Treaty and Attack Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="259" name="Tlaxcala Sides with the Aztecs" tags="" position="2250,12350" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The foreigners have made their case and you have listened closely, deliberated carefully, and made your decision. You would rather put your faith in the enemy you know than in the enemy you don&#39;t know. You will propose an alliance with the Mexica-a risky move, but one that you hope will pay off!&lt;br&gt;
&lt;br&gt;
You tell your guests that they must fight their battle alone and send them on their way. In the meantime, you send a messenger to Tenochtitlán to make your offer. [[You wait anxiously for a reply|Aztecs and Tlaxcalans Join Forces]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You have made your case to the Tlaxcalans. You have handed them a golden opportunity to take down their long-time enemies, but will they take it? You saw the Tlaxcalan leaders&#39; eyes light up at the possibility and yet they have been debating amongst themselves for many days. Perhaps their decision is not as easy as you had hoped. &lt;br&gt;
&lt;br&gt;
When they finally inform you of their decision, you cannot conceal your disappointment. They have refused your request. They will not fight on your behalf and send you to face the Mexica alone. &lt;br&gt;
&lt;br&gt;
As you head back into the mountains, you wonder if you stand a chance without your [[indigenous allies at your side|Aztecs and Tlaxcalans Join Forces]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The past months have been a waking nightmare. The arrival of the strangers on your shore so long ago set in motion a chain of events beyond your wildest imagination. You prayed to the Gods to restore peace and order, but the departure of the Spaniards was followed by a plague worse than any before seen. Tenochtilán has seemed like a ghost town of late, those who remain weighed down by grief and loss.&lt;br&gt;
&lt;br&gt;
You are thus heartened when a Tlaxcalan messenger arrives with an offer. It seems the Spaniards are headed your way, prepared to launch an attack, and the Tlaxcalans would like to join forces against them.&lt;br&gt;
&lt;br&gt;
Weakened by the sickness, you would be fools to fight the foreigners alone. You accept the offer and [[prepare for war|Aztecs and Tlaxcalans Join Forces]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="260" name="Tlaxcala Sides with the Aztecs Aztec and Tlaxcalan Victory" tags="" position="2500,13225" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Spaniards, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you for such [[a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Spaniards, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you for such [[a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. Your enemies had the Gods on their side and it is they who won this quick and bloody war. As you are finally taken captive, you prepare to meet your end. You shudder at the thought of [[what surely awaits you|The End]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="261" name="Tlaxcala Sides with the Aztecs Spanish Victory" tags="" position="2200,13200" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Spaniards had more powerful weapons and it is they who won this quick and bloody war. As you look upon the tragic scene before you, you are cut down. You look to the Gods one last time, wondering [[why they have forsaken you|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Spaniards had more powerful weapons and it is they who won this quick and bloody war. As you look upon the tragic scene before you, you are cut down. You look to the Gods one last time, wondering [[why they have forsaken you|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The battle was quick and bloody, but you have emerged victorious! You round up the defeated Tlaxcalans. They will serve as a powerful lesson to those who doubt your power. [[Victory is yours|The End]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="262" name="Tlaxcala helps the Spaniards" tags="" position="4600,12400" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
Your Tlaxcalan friends have decided that your offer is too good to pass up. You have won them over and gained your support! You must now prepare for what could be the greatest battle of your lifetime. Your enemies are strong and these preparations are not to be taken lightly. &lt;br&gt;
&lt;br&gt;
Ten months pass before you are ready to lay siege to Tenochtitlán. Your Tlaxcalan allies use those precious months to win more allies to your cause, taking advantage of family rivalries, in-fighting, and long-standing hatred of the Mexica to expand your army. By turning their neighbors against them, you are able to isolate the Mexica and cut off resources flowing into the capital. Perhaps the greatest move of all, however, was your ingenious plan to build 13 ships that you will carry over the mountains toward the city, along with your cannons.&lt;br&gt;
&lt;br&gt;
When the day comes, you launch your ships and attack from the lake. The island capital is completely cut off and you are able to take the offensive. As you enter the city, you note that the population has diminished. You heard rumors that a plague had torn through the city and it has clearly taken its toll. Nonetheless, the residents of Tenochtitlán present a strong defense. The fighting lasts for 90 days and by the end, with men fighting hand-to-hand in the streets in the bloodiest and longest battle you have ever seen. &lt;br&gt;
&lt;br&gt;
90 days of battle take their toll. The city is a ruin and it seems that no-one has any remaining will to fight. But finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Aztecs versus Spaniards and Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Your Tlaxcalan friends have decided that your offer is too good to pass up. You have won them over and gained your support! You must now prepare for what could be the greatest battle of your lifetime. Your enemies are strong and these preparations are not to be taken lightly.&lt;br&gt; 
&lt;br&gt;
Ten months pass before you are ready to lay siege to Tenochtitlán. Your Tlaxcalan allies use those precious months to win more allies to your cause, taking advantage of family rivalries, in-fighting, and long-standing hatred of the Mexica to expand your army. By turning their neighbors against them, you are able to isolate the Mexica and cut off resources flowing into the capital. Perhaps the greatest move of all, however, was your ingenious plan to build 13 ships that you will carry over the mountains toward the city.&lt;br&gt; 
&lt;br&gt;
When the day comes, you launch your ships and attack from the lake. The island capital is completely cut off and you are able to take the offensive. As you enter the city, you note that the population has diminished. You heard rumors that a plague had torn through the city and it has clearly taken its toll. Nonetheless, the residents of Tenochtitlán present a strong defense. The fighting lasts for 90 days and by the end, with men fighting hand-to-hand in the streets in the bloodiest and longest battle you have ever seen. &lt;br&gt; 
&lt;br&gt;
90 days of battle take their toll. The city is a ruin and it seems that no-one has any remaining will to fight. But finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Aztecs versus Spaniards and Tlaxcalans]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
You have decided that the Spaniards&#39; offer is too good to pass up. This may be your best chance to do away with your Mexica enemies for good. You promise them your support and begin preparing for what could be the greatest battle of your lifetime. Your enemies are strong and these preparations are not to be taken lightly. &lt;br&gt;
&lt;br&gt;
Ten months pass before you are ready to lay siege to Tenochtitlán. You use those precious months to win more allies to your cause, taking advantage of family rivalries, in-fighting, and long-standing hatred of the Mexica to expand your army. By turning their neighbors against them, you are able to isolate the Mexica and cut off resources flowing into the capital. Perhaps the greatest move of all comes from the Spaniards, however, for they devise a plan to build 13 ships that you will carry over the mountains toward the city, along with your cannons.&lt;br&gt;
&lt;br&gt;
When the day comes, you launch your ships and attack from the lake. The island capital is completely cut off and you are able to take the offensive. As you enter the city, you note that the population has diminished. It seems the rumors of the mysterious illness were true, and it has taken its toll. Nonetheless, the residents of Tenochtitlán present a strong defense. The fighting lasts for 90 days and by the end, with men fighting hand-to-hand in the streets in the bloodiest and longest battle you have ever seen. &lt;br&gt;
&lt;br&gt;
90 days of battle take their toll. The city is a ruin and it seems that no-one has any remaining will to fight. But finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Aztecs versus Spaniards and Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have decided that the Spaniards&#39; offer is too good to pass up. This may be your best chance to do away with your Mexica enemies for good. You promise them your support and begin preparing for what could be the greatest battle of your lifetime. Your enemies are strong and these preparations are not to be taken lightly. &lt;br&gt;
&lt;br&gt;
Ten months pass before you are ready to lay siege to Tenochtitlán. You use those precious months to win more allies to your cause, taking advantage of family rivalries, in-fighting, and long-standing hatred of the Mexica to expand your army. By turning their neighbors against them, you are able to isolate the Mexica and cut off resources flowing into the capital. Perhaps the greatest move of all comes from the Spaniards, however, for they devise a plan to build 13 ships that you will carry over the mountains toward the city.&lt;br&gt;
&lt;br&gt;
When the day comes, you launch your ships and attack from the lake. The island capital is completely cut off and you are able to take the offensive. As you enter the city, you note that the population has diminished. It seems the rumors of the mysterious illness were true, and it has taken its toll. Nonetheless, the residents of Tenochtitlán present a strong defense. The fighting lasts for 90 days and by the end, with men fighting hand-to-hand in the streets in the bloodiest and longest battle you have ever seen.&lt;br&gt;
&lt;br&gt;
90 days of battle take their toll. The city is a ruin and it seems that no-one has any remaining will to fight. But finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Aztecs versus Spaniards and Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Just when you think things could not get any worse, they do. For months, the city has been plagued by the mysterious illness. You lost count of the dead many moons past. One quiet morning, two spies enter the city, frantic. They have seen the Spaniards heading towards Tenochtitlán at the head of a massive army. You can barely believe their words when they report that the enemies carry boats over their heads!&lt;br&gt; 
&lt;br&gt;
The city flies into action, preparing for battle. You cut off the causeways and prepare the traps you created now ten months past. &lt;br&gt; 
&lt;br&gt;
The enemy exits the mountain pass. You can barely believe your eyes as they make their way to shore, launch their ships, and attack from the lake. Your island capital is completely cut off and they are able to take the offensive. Nonetheless, the residents of Tenochtitlán present a strong defense. The fighting lasts for 90 days and by the end, with men fighting hand-to-hand in the streets in the bloodiest and longest battle you have ever seen. &lt;br&gt; 
&lt;br&gt;
90 days of battle take their toll. The city is a ruin and it seems that no-one has any remaining will to fight. But finally, only a few survivors remain and it becomes clear [[which side has won|Victory Decision Aztecs versus Spaniards and Tlaxcalans]].&lt;br&gt; 
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="263" name="Tlaxcala sends spies to Veracruz" tags="Done Breaks" position="2850,1325" size="100,100">&lt;&lt;theyr&gt;&gt;
You disguise yourselves as Huastec traders, and you head to the coast of Veracruz.  There, you observe the meeting of the Mexica and the bearded strangers from afar.&lt;br&gt;
&lt;br&gt;
&lt;&lt;if $flags[&quot;gifts&quot;] is &quot;Attack&quot;&gt;&gt;
[[You watch your enemies the Mexica attack|Attack On a Beach in Veracruz]] the strangers.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;No&quot;&gt;&gt;

[[You watch an awkward and uncomfortable meeting|On a Beach in Veracruz: No Gifts]] between your enemies and the strangers.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;Yes&quot;&gt;&gt;

[[You watch a friendly meeting|On a Beach in Veracruz: Gifts]] between your enemies and the strangers.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] is &quot;Talk&quot;&gt;&gt;

All is quiet on the coast.  But keep watch, you sense something will happen.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $flags[&quot;gifts&quot;] eq &quot;&quot; or ndef $flags[&quot;gifts&quot;]&gt;&gt;

All is quiet on the coast.  But keep watch, you sense something will happen.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Aztecs to make a move.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="264" name="Tlaxcalan Wisdom Check" tags="Done" position="2175,3200" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $TL_St_Voted &lt;3&gt;&gt;
You wait nervously while the others deliberate. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $TL_St_Voted is 3 and $users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] &gt;=$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] and $users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] &gt;=$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Tlax_Leader=&quot;Xicotencatl_Elder&quot;&gt;&gt;
You and your fellow council members have weighed each other&#39;s arguments carefully. The impact of the faith placed by all of you in the statements you present has been reflected in your wisdom points. Surely now more than ever your people need wisdom. He with the most wisdom points will lead the Tlaxcalan people forward, deciding whether or not you go to war with the Spaniards. &lt;br&gt;
&lt;br&gt;
The Tlaxcalan leader is &lt;&lt;print $Tlax_Leader&gt;&gt;&lt;br&gt;
&lt;br&gt;
Now, despite these deliberations, will you [[go to war|The Tlaxcalan Leader Decides]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_St_Voted is 3 and $users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] &gt;=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] and $users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] &gt;=$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Tlax_Leader=&quot;Xicotencatl_Younger&quot;&gt;&gt;
You and your fellow council members have weighed each other&#39;s arguments carefully. The impact of the faith placed by all of you in the statements you present has been reflected in your wisdom points. Surely now more than ever your people need wisdom. He with the most wisdom points will lead the Tlaxcalan people forward, deciding whether or not you go to war with the Spaniards. &lt;br&gt;
&lt;br&gt;
The Tlaxcalan leader is &lt;&lt;print $Tlax_Leader&gt;&gt;&lt;br&gt;
&lt;br&gt;
Now, despite these deliberations, will you [[go to war|The Tlaxcalan Leader Decides]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $TL_St_Voted is 3 and $users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] &gt;=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] and $users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;] &gt;=$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Tlax_Leader=&quot;Maxixcatl&quot;&gt;&gt;
You and your fellow council members have weighed each other&#39;s arguments carefully. The impact of the faith placed by all of you in the statements you present has been reflected in your wisdom points. Surely now more than ever your people need wisdom. He with the most wisdom points will lead the Tlaxcalan people forward, deciding whether or not you go to war with the Spaniards. &lt;br&gt;
&lt;br&gt;
The Tlaxcalan leader is &lt;&lt;print $Tlax_Leader&gt;&gt;&lt;br&gt;
&lt;br&gt;
Now, despite these deliberations, will you [[go to war|The Tlaxcalan Leader Decides]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="265" name="Tlaxcalan&#39;s Contribution" tags="" position="2300,8175" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Here you will find links to each entry of the Spanish guidebook, along with a special section written by your Tlaxcalan guests. You must read each entry and evaluate their descriptions. Are they accurate in their portrayals? &lt;br&gt;
&lt;br&gt;
To aid you in this task, go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán. You may also want to revisit other course materials. When you have read each entry, you must decide whether it is accurate and assign it a grade of pass or fail.&lt;br&gt;
&lt;br&gt;
Marina&#39;s introduction is:  &lt;&lt;print &quot;$Ma_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Marina&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Cortes&#39; entry is:  &lt;&lt;print &quot;$Co_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Cortes&#39; contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Alvarado&#39;s entry is:  &lt;&lt;print &quot;$Al_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Alvarado&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Aguilar&#39;s entry is:  &lt;&lt;print &quot;$Ag_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Aguilar&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Olid&#39;s entry is:  &lt;&lt;print &quot;$Ol_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Olid&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
Garrido&#39;s entry is:  &lt;&lt;print &quot;$Ga_TG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;i&gt;You have already rated Garrido&#39;s contribution.&lt;/i&gt;&lt;br&gt;
&lt;br&gt;
The Tlaxcalan&#39;s Insider&#39;s Guide is:  &lt;&lt;print &quot;$Tl_IG&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
Do they &lt;&lt;link &quot;PASS&quot; &quot;After the Feast&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=3&gt;&gt;&lt;&lt;/link&gt;&gt; or &lt;&lt;link &quot;FAIL&quot; &quot;After the Feast&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=3&gt;&gt;&lt;&lt;/link&gt;&gt;?&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="266" name="Tlaxcalans Attack Aztecs on return journey" tags="Done Breaks" position="2225,1875" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
As you make your way toward home, you think back on your encounter with the strangers. It seems likely they will head for the city, but how will Moctezuma respond? You discuss this among yourselves, contemplating the best strategy.&lt;br&gt;
&lt;br&gt;
Suddenly, you find yourselves under attack by a band of Tlaxcalan warriors. You manage to fight them off and the battle ends in a draw, as it so often does. Nonetheless, you have been weakened by this attack and remain on guard &lt;&lt;link &quot;the rest of the way home&quot; &quot;Aztecs Return to Tenochtitlan to report&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You attack the Mexica, hoping to catch them off guard. But, like always, the battle ends in a draw.  Both sides have been weakened and you have increased hostilities between your groups, as the strangers on the shore prepare to head inland.  &lt;br&gt;
&lt;br&gt;
You hope you don&#39;t regret this decision later!&lt;br&gt;
&lt;br&gt;
It&#39;s time to &lt;&lt;link &quot;return to Tlaxcala&quot; &quot;The Spaniards Head Inland&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=1&gt;&gt;&lt;&lt;/link&gt;&gt; and regroup.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="267" name="Tlaxcalans Back In Tlaxcala" tags="" position="2400,9550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
You make your way home, weary but encouraged by your most recent victory. Events have been unfolding in your favor and you can&#39;t help but feel confident in the choices you have made.&lt;br&gt;
&lt;br&gt;
You arrive back in Tlaxcala, dragging the enormous weapons behind you. You will keep them safe in case your Spanish friends need them again. &lt;br&gt;
&lt;br&gt;
For now, however, you settle in, [[happy to finally return home|Cortes Returns Victorious]].&lt;br&gt;
&lt;br&gt; 

&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot;&gt;&gt;
You make your way home, relieved to have avoided yet another battle. You are confident that you would have won, but this is not your fight and you are not convinced that it would have been worth more Tlaxcalan blood.&lt;br&gt;
&lt;br&gt;
Having removed yourself from this strange and unexpected situation, you wonder how events will unfold in your absence. For now, you will just have to wait and see. &lt;br&gt;
&lt;br&gt;
You settle in, happy to finally return home.&lt;br&gt;
&lt;br&gt; 
&lt;&lt;if ndef $Cortes_Dead or $Cortes_Dead eq &quot;&quot;&gt;&gt;
You wait for news, curious how your decision has impacted the course of history. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt; &lt;br&gt;
&lt;br&gt;
You are waiting for Cortes to do something. &lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cortes_Dead is &quot;No&quot;&gt;&gt;
[[You send spies to Tenochtitlan, eager to hear what will happen next|Cortes Returns Weakened]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif  $Cortes_Dead is &quot;Yes&quot;&gt;&gt;
[[You send spies to Tenochtitlan, eager to hear what will happen next|Cortes Doesn&#39;t Return]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;elseif $Tlax_Alliance is &quot;Betray&quot;&gt;&gt;
You make your way home, knowing that Cortés will never survive the battle alone. You wonder what fate has in store for those he left behind in Tenochtitlán, but this is no longer your fight. The Mexica will most likely crush the invaders and perhaps life will return to normal. &lt;br&gt;
&lt;br&gt;
For now, you will just have to wait and see. You settle in, happy to [[finally return home|Cortes Doesn&#39;t Return]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="268" name="Tlaxcalans Decide About the Spaniards" tags="" position="2225,11850" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if ndef $Tlax_Final_Dec or $Tlax_Final_Dec eq &quot;&quot;&gt;&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Tlax_Leader&gt;&gt; to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Dec is &quot;Span&quot;&gt;&gt;
A decision has [[been made|Tlaxcala helps the Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Dec is &quot;AttackSpan&quot;&gt;&gt;
A decision has [[been made|Tlaxcala Attacks the Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Dec is &quot;Alone&quot;&gt;&gt;
A decision has [[been made|Tlaxcala Does Nothing]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Final_Dec is &quot;Aztecs&quot;&gt;&gt;
A decision has [[been made|Tlaxcala Sides with the Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="269" name="Tlaxcalans Face a Choice" tags="" position="2450,5900" size="100,100">&lt;&lt;theyr&gt;&gt;
You wake to find yourself exactly where you hoped: back at camp, on the road to Tenochtitlán! You lead an army of over 10,000 men, with your Spanish allies at your side.&lt;br&gt;
&lt;br&gt;

You pack up camp and set out for your destination, assuring your Spanish friends that it&#39;s just around the corner. You crest a hill and the city appears before you. Your friends can hardly believe their eyes. One of them would later describe it as such:&lt;br&gt;
&lt;br&gt;

&lt;i&gt;“The next morning we reached the broad high road of Iztapalapan, whence we for the first time beheld the numbers of towns and villages built in the lake, and the still greater number of large townships on the mainland, with the level causeway which ran in a straight line into Mexico. Our astonishment was indeed raised to the highest pitch, and we could not help remarking to each other, that all these buildings resembled the fairy castles we read of in Amadis de Gaul; so high, majestic, and splendid did the temples, towers, and houses of the town, all built of massive stone and lime, rise up out of the midst of the lake. Indeed, many of our men believed what they saw was a mere dream. And the reader must not feel surprised at the manner in which I have expressed myself, for it is impossible to speak coolly of things which we had never seen nor heard of, nor even could have dreamt of, beforehand.” (Lockhart, 219)&lt;/i&gt;&lt;br&gt;
&lt;br&gt;

The sight that lies ahead has [[a much different meaning for you|Tlaxcalans consider their options]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="270" name="Tlaxcalans Hold for a Council Meeting" tags="Done" position="2175,2950" size="100,100">&lt;&lt;theyr&gt;&gt;
You gather together with the other two members of your leadership council. All of you have prepared your statements, which you share with the others. &lt;br&gt;
&lt;br&gt;
Xicotencatl the Elder&#39;s Statement: &lt;&lt;print $XE_Statement&gt;&gt;&lt;br&gt;
Xicotencatl the Younger&#39;s Statement: &lt;&lt;print $XY_Statement&gt;&gt;&lt;br&gt;
Maxixcatl&#39;s Statement: &lt;&lt;print $Max_Statement&gt;&gt;&lt;br&gt;
&lt;br&gt;
Once you have composed your statement, you must present it to the rest of the council on the Tlaxcalan discussion board. After all council members have presented their statements, you will vote on the most convincing argument.&lt;br&gt;
&lt;br&gt;
[[Click here|Tlaxcalans Vote on Attacking Spaniards]] when you are ready to cast your vote.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="271" name="Tlaxcalans Make the First Decision about Aztecs" tags="" position="2800,12100" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat eq &quot;&quot; or ndef $Tlax_Bat&gt;&gt;
You catch your breath.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Tlax_Leader&gt;&gt; to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Bat is &quot;War&quot;&gt;&gt;
The [[Tlaxcalans approach|Tlaxcala Attacks Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Bat is &quot;Peace&quot;&gt;&gt;
The [[Tlaxcalans approach|Tlaxcala Makes a Peace Treaty with the Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat eq &quot;&quot; or ndef $Tlax_Bat&gt;&gt;
You wait for your leader to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Bat is &quot;War&quot;&gt;&gt;
Your leader has made [[a decision|Tlaxcala Attacks Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Bat is &quot;Peace&quot;&gt;&gt;
Your leader has made [[a decision|Tlaxcala Makes a Peace Treaty with the Aztecs]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="272" name="Tlaxcalans Make the First Decision about Spaniards" tags="" position="2350,11925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat eq &quot;&quot; or ndef $Tlax_Bat&gt;&gt;
You catch your breath.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
You are waiting for &lt;&lt;print $Tlax_Leader&gt;&gt; to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Bat is &quot;War&quot;&gt;&gt;
The [[Tlaxcalans approach|Tlaxcala Attacks the Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Bat is &quot;Peace&quot;&gt;&gt;
The [[Tlaxcalans approach|Tlaxcala Does Nothing and Makes a Peace Treaty with Spanish Winners]].
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Bat eq &quot;&quot; or ndef $Tlax_Bat&gt;&gt;
You wait for your leader to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Bat is &quot;War&quot;&gt;&gt;
Your leader has made [[a decision|Tlaxcala Attacks the Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Bat is &quot;Peace&quot;&gt;&gt;
Your leader has made [[a decision|Tlaxcala Does Nothing and Makes a Peace Treaty with Spanish Winners]].
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="273" name="Tlaxcalans Negotiate Peace" tags="Done" position="1975,3750" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The Tlaxcalans have invited you to negotiate peace. Go to the Spanish-Tlaxcalan discussion board and work out an agreement. &lt;br&gt;
&lt;br&gt;
Once you have heard everything they have to say, do you trust them?&lt;br&gt;
&lt;br&gt;

&lt;&lt;if $users[$userId][&quot;faction&quot;] is &quot;Spaniards&quot; and $Tlax_Leader is &quot;Xicotencatl_Elder&quot;&gt;&gt;
&lt;&lt;link &quot;Yes.&quot; &quot;Spaniards and Tlaxcalans on the way to Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Xicotencatl_Elder&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=7&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;No.&quot; &quot;Spaniards and Tlaxcalans on the way to Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Xicotencatl_Elder&quot;,{&quot;Wisdom&quot;:-1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=7&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;faction&quot;] is &quot;Spaniards&quot; and $Tlax_Leader is &quot;Xicotencatl_Younger&quot;&gt;&gt;
&lt;&lt;link &quot;Yes.&quot; &quot;Spaniards and Tlaxcalans on the way to Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Xicotencatl_Younger&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=7&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;No.&quot; &quot;Spaniards and Tlaxcalans on the way to Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Xicotencatl_Younger&quot;,{&quot;Wisdom&quot;:-1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=7&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $users[$userId][&quot;faction&quot;] is &quot;Spaniards&quot; and $Tlax_Leader is &quot;Maxixcatl&quot;&gt;&gt;
&lt;&lt;link &quot;Yes.&quot; &quot;Spaniards and Tlaxcalans on the way to Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Maxixcatl&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=7&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;No.&quot; &quot;Spaniards and Tlaxcalans on the way to Cholula&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Maxixcatl&quot;,{&quot;Wisdom&quot;:-1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=7&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Now that you have made your decision, go to the Spanish-Tlaxcalan discussion board to negotiate peace with the foreigners. Whatever you have decided, you will have to convince them of your loyalty.&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Tlax_Leader&gt;&gt;, keep an eye on your wisdom points, for they will give you a clue to the Spaniards&#39; faith in your alliance as you &lt;&lt;link &quot;move forward&quot; &quot;Spaniards and Tlaxcalans on the way to Cholula&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=4&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="274" name="Tlaxcalans Observe the Ship Burning" tags="Done Breaks" position="2525,1825" size="100,100">&lt;&lt;theyr&gt;&gt;
You have continued to observe events along the coast, waiting to see what this strange turn of events will mean for you. The news that arrives next is intriguing.&lt;br&gt;
&lt;br&gt;
Your spies have witnessed turmoil among the foreigners. Their leader was seen moving their canoes to land and when the other men saw what he had done, they were clearly angry. There seems to be a good deal of conflict among them and you wonder what this could mean. Should you take advantage of this moment to act? And if so, how? Who is the bigger threat in this moment: the Mexica or the strangers on the coast?&lt;br&gt;

&lt;br&gt;
Go to the Tlaxcalan discussion board and decide upon your best course of action. You can decide as a group to: &lt;br&gt;
&lt;br&gt;

&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
&lt;&lt;link &quot;do nothing&quot; &quot;Tlaxcalans let Cortes move inland&quot;&gt;&gt;&lt;&lt;storeSet $TL_Attacks=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;, &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;attack the Spaniards on the beach&quot; &quot;Tlaxcalans attack Cortes in Veracruz&quot;&gt;&gt;&lt;&lt;storeSet $TL_Attacks=&quot;Spanish&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;,&lt;br&gt;
&lt;br&gt;
or you can &lt;&lt;link &quot;attack the Mexica on their way back to Tenochtitlan&quot; &quot;Tlaxcalans Attack Aztecs on return journey&quot;&gt;&gt;&lt;&lt;storeSet $TL_Attacks=&quot;Aztecs&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.
&lt;&lt;else&gt;&gt;
[[do nothing|Tlaxcalans let Cortes move inland]], &lt;br&gt;
&lt;br&gt;
[[attack the Spaniards on the beach|Tlaxcalans attack Cortes in Veracruz]],&lt;br&gt;
&lt;br&gt;
or you can [[attack the Mexica on their way back to Tenochtitlan|Tlaxcalans Attack Aztecs on return journey]].
&lt;&lt;/if&gt;&gt;
&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="275" name="Tlaxcalans Prepare for a Council Meeting" tags="Done" position="2175,2825" size="100,100">You wake to the buzz of people talking. You haven&#39;t even opened your eyes when you catch the scent of tortillas cooking over an open fire and you know you&#39;re back in Tlaxcala!&lt;br&gt;
&lt;br&gt;
You get up from your sleeping mat and excitedly make your way outside, where you learn that there is to be a council meeting tonight. Word has reached the village that the strangers are nearing Tlaxcalan territory and they could arrive any day now. The leadership must decide how to respond to the strangers...and that includes you.&lt;br&gt;
&lt;br&gt;
In order to prepare for the meeting, you must write a formal statement of your position, which you will present to the rest of the council. In your statement, you must make a clear and logical case for why you believe the Tlaxcalan people should or should not attack the intruders. Weigh your decision carefully, as this is not to be taken lightly.&lt;br&gt;
&lt;br&gt;
Go to your site and start a new page titled “Council Meeting.” Prepare your statement here.&lt;br&gt;
&lt;br&gt;
Once your statement is prepared, paste a link here to share with your fellow Council Members. Make sure you&#39;ve set it so that everyone with the link can read it. When this is finished [[continue on to the council meeting|Tlaxcalans Hold for a Council Meeting]]&lt;br&gt;
&lt;br&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Xicotencatl_Elder&quot;&gt;&gt;
&lt;&lt;textbox &quot;$XE_Statement&quot; &quot;&quot;&gt;&gt;
&lt;&lt;case &quot;Xicotencatl_Younger&quot;&gt;&gt;
&lt;&lt;textbox &quot;$XY_Statement&quot; &quot;&quot;&gt;&gt;
&lt;&lt;case &quot;Maxixcatl&quot;&gt;&gt;
&lt;&lt;textbox &quot;$Max_Statement&quot; &quot;&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="276" name="Tlaxcalans Respond to La Noche Triste" tags="" position="4300,9700" size="100,100">&lt;&lt;theyr&gt;&gt;
[[Game Over: Aztecs Win La Noche Triste]]

[[The Tlaxcalans and Spaniards Flee]]

[[The Aztecs Regroup]]


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="277" name="Tlaxcalans Visit Tlatelolco" tags="" position="2300,7175" size="100,100">&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Pochteca&quot;&gt;&gt;
You set out for the market with your Tlaxcalan guests in tow. They are eager to visit the legendary Tlatelolco Market and, as one of the most important agents of the market, you can&#39;t help but take pride in their excitement. You are halfway to your destination when you are approached by a messenger. He has come to assign your guests a task.&lt;br&gt;
&lt;br&gt;
The messenger informs you that the Spaniards have decided to create a guide to the city that will provide useful advice to future explorers. Given the importance of Tlatelolco Market, it must occupy a central place in the guide. However, the Spaniards worry that they will be unfamiliar with many of the riches to be found there and that their description may not do it justice. They would like to enlist the help of the Tlaxcalans. As the market expert, you must assist them in their task.  As compensation for this work, however, the Spaniards have decided to include you in their dinner invitation at Moctezuma&#39;s Palace tonight, where there will be a spectacular feast!&lt;br&gt;
&lt;br&gt;
Your first task is to go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán, where you will find a detailed description of the Tlatelolco Market. When everyone has finished reading, the Tlaxcalans will choose one team member to start a new page on their site titled “Tlatelolco Market: Insider&#39;s Guide.” You must work with them to create a special entry for the Spanish guidebook.&lt;br&gt;
&lt;br&gt;
LIke any good insider&#39;s guide, the entry should include:&lt;br&gt;
&lt;br&gt;
An introduction that describes the specific location&lt;br&gt;
An account of which sights live up to the hype and which ones do not&lt;br&gt;
The best bargains to be found&lt;br&gt;
Instructions on where to eat like a local and how to avoid tourist traps&lt;br&gt;
&lt;br&gt;
Pay attention to detail, because there are points at stake here!&lt;br&gt;
&lt;br&gt;
Once the guidebook entry is complete, your Tlaxcalan guests will share their link with the other players. &lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Tlax_Leader&gt;&gt; is responsible for submitting your entry. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
With the pochteca as your guide, you set out across the city. You are eager to visit the legendary Tlatelolco Market and to be the first Tlaxcalans ever to lay eyes upon its fabled riches. You are halfway to your destination when you are approached by a messenger. He has come to assign you a task.&lt;br&gt;
&lt;br&gt;
The messenger informs you that the Spaniards have decided to create a guide to the city that will provide useful advice to future explorers. Given the importance of Tlatelolco Market, it must occupy a central place in the guide. However, the Spaniards worry that they will be unfamiliar with many of the riches to be found there and that their description may not do it justice. They would like to enlist your help.&lt;br&gt;
&lt;br&gt;
Your first task is to go to your game documents and read Bernal Diaz&#39; account of Tenochtitlán, where you will find a detailed description of the Tlatelolco Market. When you have finished reading, choose one team member to start a new page on their site titled “Tlatelolco Market: Insider&#39;s Guide.” You must work together to create a special entry for the Spanish guidebook.&lt;br&gt;
&lt;br&gt;
Like any good insider&#39;s guide, your entry should include:&lt;br&gt;
&lt;br&gt;
An introduction that describes the specific location&lt;br&gt;
An account of which sights live up to the hype and which ones do not&lt;br&gt;
The best bargains to be found&lt;br&gt;
Instructions on where to eat like a local and how to avoid tourist traps&lt;br&gt;
&lt;br&gt;
Pay attention to detail, because there are points at stake here!&lt;br&gt;
&lt;br&gt;
As compensation for this work, however, the Spaniards have decided to include you in their dinner invitation at Moctezuma&#39;s Palace tonight, where there will be a spectacular feast!&lt;br&gt;
&lt;br&gt;
But first, you must complete your task. Once your guidebook entry is complete, paste a link here to share with the other players. Make sure you&#39;ve set it so that everyone with the link can read it. &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
Your Insider&#39;s Guide is:  &lt;&lt;textbox &quot;$Tl_IG&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;print $Tlax_Leader&gt;&gt; is responsible for submitting your entry. &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

When your work is complete, you may continue &lt;&lt;link &quot;on to the feast&quot; &quot;Everyone Gathers for a Feast&quot;&gt;&gt;&lt;&lt;storeSet $Feast = $Feast + 1&gt;&gt;&lt;&lt;/link&gt;&gt;!&lt;br&gt;
&lt;br&gt;</tw-passagedata><tw-passagedata pid="278" name="Tlaxcalans Vote on Attacking Spaniards" tags="Done" position="2175,3075" size="100,100">&lt;&lt;theyr&gt;&gt;
You sit in the council chamber weighing the arguments made by the other two men.  You measure their wisdom and ambition against your own. Whose statement is most compelling?&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Xicotencatl the Elder&quot; &quot;Tlaxcalan Wisdom Check&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Xicotencatl_Elder&quot;,{&quot;Wisdom&quot;:3,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $TL_St_Voted = $TL_St_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt; &lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Xicotencatl the Younger&quot; &quot;Tlaxcalan Wisdom Check&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Xicotencatl_Younger&quot;,{&quot;Wisdom&quot;:3,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $TL_St_Voted = $TL_St_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Maxixcatl&quot; &quot;Tlaxcalan Wisdom Check&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Maxixcatl&quot;,{&quot;Wisdom&quot;:3,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;storeSet $TL_St_Voted = $TL_St_Voted + 1&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="279" name="Tlaxcalans Wait Outside and Send Spies" tags="Done" position="2325,5225" size="100,100">&lt;&lt;theyr&gt;&gt;
You watch your allies enter the city of Cholula where they will consort with your enemy. When they are out of sight, you send out spies to keep watch. It is clearly to your benefit to know exactly what goes on inside the city walls.&lt;br&gt;
&lt;br&gt;
You remain at camp, curious to learn what&#39;s going on inside the city walls. Your spies have yet to return. You wait anxiously for news.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
Both the Aztecs and Marina need to do something for this block to clear.&lt;br&gt;
&lt;br&gt;

&lt;&lt;if $Cholula_Attack is &quot;Yes&quot; and $Mal_Share is &quot;No&quot;&gt;&gt;
The first day and night pass quietly, with little news from inside. The next morning, however, your spies come running back to camp just as you hear the sound of screaming from inside the city.&lt;br&gt;
&lt;br&gt;
The Aztecs have laid a trap and attacked the Spaniards! This will surely be a massacre and an Aztec victory would not be to your benefit. You rush through the city gates and engage your enemies in battle. You fight your way back out of the city with your Spanish allies at your side. They made it out alive, but barely. &lt;br&gt;
&lt;br&gt;
You head for the mountains, eager to get [[beyond the reach of the Aztec warriors|Into the Mountain Pass]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Cholula_Attack is &quot;Yes&quot; and $Mal_Span is &quot;No&quot;&gt;&gt;
The first day and night pass quietly, with little news from inside. The next morning, however, your spies come running back to camp just as you hear the sound of screaming from inside the city.&lt;br&gt;
&lt;br&gt;
The Aztecs have laid a trap and attacked the Spaniards! This will surely be a massacre and an Aztec victory would not be to your benefit. You rush through the city gates and engage your enemies in battle. You fight your way back out of the city with your Spanish allies at your side. They made it out alive, but barely. &lt;br&gt;
&lt;br&gt;
You head for the mountains, eager to get [[beyond the reach of the Aztec warriors|Into the Mountain Pass]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Cholula_Attack is &quot;Yes&quot; and $Span_Cho_Att is &quot;No&quot;&gt;&gt;
The first day and night pass quietly, with little news from inside. The next morning, however, your spies come running back to camp just as you hear the sound of screaming from inside the city.&lt;br&gt;
&lt;br&gt;
The Aztecs have laid a trap and attacked the Spaniards! This will surely be a massacre and an Aztec victory would not be to your benefit. You rush through the city gates and engage your enemies in battle. You fight your way back out of the city with your Spanish allies at your side. They made it out alive, but barely. &lt;br&gt;
&lt;br&gt;
You head for the mountains, eager to get [[beyond the reach of the Aztec warriors|Into the Mountain Pass]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Span_Cho_Att is &quot;Yes&quot;&gt;&gt;
The first day and night pass quietly, with little news from inside. The next morning, however, your spies come running back to camp just as you hear the sound of screaming from inside the city.&lt;br&gt;
&lt;br&gt;
The Spaniards have attacked the Cholulans! It&#39;s not clear why, but your spies report that they gathered all the city&#39;s nobles and cut them down in front of the main temple. You make your way to the city, eager to raid Cholula&#39;s stores of salt and cloth--items that you&#39;ve been denied by an Aztec embargo.&lt;br&gt;
&lt;br&gt;
When you&#39;ve taken all you can find, you leave the city of Cholula a smoldering mess and [[carry on your journey|Into the Mountain Pass]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Cholula_Attack is &quot;No&quot; and $Mal_Share is &quot;No&quot;&gt;&gt;
Days pass with little news from inside. It seems your Spanish friends are being treated well, with an ample supply of food and pulque. &lt;br&gt;
&lt;br&gt;
How do you feel about these events? Go to the Tlaxcalan discussion board and decide whether the friendly relations between your allies and your foes has any bearing on your relationship.&lt;br&gt;
&lt;br&gt;
Meanwhile, you wait impatiently to [[carry on your journey|Into the Mountain Pass]]. 

&lt;&lt;elseif $Cholula_Attack is &quot;No&quot; and $Mal_Span is &quot;No&quot;&gt;&gt;
Days pass with little news from inside. It seems your Spanish friends are being treated well, with an ample supply of food and pulque. &lt;br&gt;
&lt;br&gt;
How do you feel about these events? Go to the Tlaxcalan discussion board and decide whether the friendly relations between your allies and your foes has any bearing on your relationship.&lt;br&gt;
&lt;br&gt;
Meanwhile, you wait impatiently to [[carry on your journey|Into the Mountain Pass]]. &lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Cholula_Attack is &quot;No&quot; and $Span_Cho_Att is &quot;No&quot;&gt;&gt;
Days pass with little news from inside. It seems your Spanish friends are being treated well, with an ample supply of food and pulque. &lt;br&gt;
&lt;br&gt;
How do you feel about these events? Go to the Tlaxcalan discussion board and decide whether the friendly relations between your allies and your foes has any bearing on your relationship.&lt;br&gt;
&lt;br&gt;
Meanwhile, you wait impatiently to [[carry on your journey|Into the Mountain Pass]]. 
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="280" name="Tlaxcalans agree to fight" tags="" position="2300,9375" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Cortes&quot;&gt;&gt;
You have received word that the enemy camp lies just ahead. The time has come to face the force of Spaniards who have come to secure your arrest.&lt;br&gt;
&lt;br&gt;
You confer with your Tlaxcalan allies, who assure you they will fight by your side. You decide that the best course of action is not to confront the enemy head on, but to take them by surprise in a sneak attack.&lt;br&gt;
&lt;br&gt;
You wait until midnight to launch your attack, hoping to catch the enemy forces asleep. After a quick and bloody battle, you succeed in capturing their leader, Pánfilo Narváez, who miraculously survives being stuck in the eye with a pike. You put Narváez in chains, disarm the remainder of his men, and give them a choice: return to Cuba or join you in Tenochtitlán. &lt;br&gt;
&lt;br&gt;
Fortunately for you, these men are no fools. They have heard tales of the great Mexica city and the riches found there. Hundreds of them choose to join you. You have just quadrupled your forces. This could not have gone better.&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;As you prepare for the journey back to Tenochtitlán&quot; &quot;Cortes Returns Victorious&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+=3&gt;&gt;&lt;&lt;/link&gt;&gt;you take possession of Narváez&#39; cannons, and your team&#39;s strength increases significantly. Your Tlaxcalan friends are returning home and will take them for safekeeping.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have received word that the enemy camp lies just ahead. The time has come to face yet another force of Spaniards in battle.&lt;br&gt;
&lt;br&gt;
As you approach the camp, Cortes proposes a plan: rather than meet his enemies head on, he wants to catch them off guard in a surprise attack. You agree that this is the best chance for success and wait patiently for nightfall.&lt;br&gt;
&lt;br&gt;
You wait until midnight to launch your attack, hoping to catch the enemy forces asleep. After a quick and bloody battle, you succeed in capturing the leader and disarming his men. When Cortes gives them the choice of going back where they came from or joining you on the return journey, very few choose to turn back. Your force has just grown considerably. You make your way back to Tenochtitlán.&lt;br&gt;
&lt;br&gt;
As you depart the scene of the battle, Cortes instructs you to take the large and terrifying weapons that these new Spaniards brought with them. He tells you they are called cannons and asks you to take them to Tlaxcala for safekeeping. [[You prepare to finally return home|Tlaxcalans Back In Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="281" name="Tlaxcalans and Aztecs meet" tags="Done Breaks" position="2825,1075" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Intrigued by this new development, you sit down to meet with the Tlaxcalan representatives.&lt;br&gt;
&lt;br&gt;
Go to the Aztec-Tlaxcalan discussion board to hear what they have to say. Do you trust them? &lt;br&gt;
&lt;br&gt;
When you are done negotiating, you return to the palace and wait anxiously for your coastal delegation to return with [[news from the coast|Aztecs Return to Tenochtitlan to report]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You have been granted an audience by the great Moctezuma, your sworn enemy. You seek a truce, but can you gain his trust? &lt;br&gt;
&lt;br&gt;
Go to the Aztec-Tlaxcalan discussion board to make your case. &lt;br&gt;
&lt;br&gt;
When you are done negotiating, you return to the palace and wait anxiously for whatever &lt;&lt;link &quot;news from the coast&quot; &quot;The Spaniards Head Inland&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=1&gt;&gt;&lt;&lt;storeSet $TL_Attacks=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; you can glean from vague and untrustworthy sources.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="282" name="Tlaxcalans and Spaniards Fight Aztecs Aztec Victory" tags="" position="4400,13600" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. You are taken captive and the horror of what lies before you sinks in. You look towards the Templo Mayor in terror, praying that you will not be made a gift to their blood-thirsty gods.&lt;br&gt;
&lt;br&gt;
You have lost your battle. Glory has eluded you and [[your name will be forgotten by history|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. The Mexica had the Gods on their side and it is they who won this long and bloody war. As you are finally taken captive, you prepare to meet your end, grateful that you will at least be taken to the temple and [[offered up to the Gods|The End]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
The battle seemed as though it would never end. Your city lies in ruins and countless lives have been lost, but you have won. Your compatriots are rounding up the few who remain, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely [[reward you for such a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="283" name="Tlaxcalans and Spaniards Fight Aztecs Spanish and Tlaxcalan Victory" tags="" position="4425,13250" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The battle seemed as though it would never end. The city lies in ruins and countless lives have been lost, but it is yours! You close your eyes and dream of the riches that await you. Surely the King will reward you handsomely for your victory. [[Glory is yours|The End]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
The battle seemed as though it would never end. Your city lies in ruins and countless lives have been lost, but you have won. Your compatriots are rounding up the few who remain, taking them captive and preparing for a sacrifice like none ever seen. The Gods did not abandon you in the end, and they will surely reward you for such [[a hard-won gift|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
You put up a valiant fight, but it was not enough. Your enemies had the Gods on their side and it is they who won this long and bloody war. As you are finally taken captive, you prepare to meet your end. You pray that your Tlaxcalan enemies will take you and offer you up to the Gods. You pray for [[a noble death|The End]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="284" name="Tlaxcalans announce their departure" tags="" position="2100,9550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Cortes&quot;&gt;&gt;
Much to your dismay, your fears turn out to be valid. As you near Tlaxcala,  &lt;&lt;print $Tlax_Leader&gt;&gt; informs you that he and his men will not be carrying on the rest of the way. They will remain in Tlaxcala, leaving you to face the enemy with a greatly-diminished force.&lt;br&gt;
&lt;br&gt;
This news comes as a terrible blow. The odds are no longer in your favor.&lt;br&gt;
&lt;br&gt; 
You spend the night in Tlaxcala and lie awake all night weighing your next move. Will you try to catch Velazquez&#39; men off guard in a sneak attack or is it safer to negotiate an agreement?&lt;br&gt;
&lt;br&gt;
Think carefully about this decision. What are the potential repercussions of either choice? Which is the right move? Once you have made your decision, select your choice below.&lt;br&gt;
&lt;br&gt;
Option 1: You will &lt;&lt;link &quot;launch a surprise attack&quot; &quot;Cortes Attacks Narvaez&quot;&gt;&gt;&lt;&lt;storeSet $Cortes_Dead=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
Option 2: You will &lt;&lt;link &quot;propose a meeting with the Spanish leader&quot; &quot;Cortes Proposes a meeting with Narvaez&quot;&gt;&gt;&lt;&lt;storeSet $Cortes_Dead=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;, Pánfilo Narváez&lt;br&gt;
&lt;br&gt;
You leave Tlaxcala in a much more precarious position than you were in yesterday.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
As you near home, you feel your heart soar. You have been away for many moons, a stranger in a foreign land. It is now time to tell Cortes that you will not be at his side when he meets his enemy at the coast. &lt;br&gt;
&lt;br&gt;
Cortes takes the news with a steely glare and it is clear that he is not happy with the news. With the loss of your men, his forces are greatly diminished. But this is not your battle to fight.&lt;br&gt;
&lt;br&gt;
You host the troops for the night and see them on their way the next morning, [[content to remain where you are|Tlaxcalans Back In Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="285" name="Tlaxcalans attack Cortes in Veracruz" tags="Done Breaks" position="2125,2175" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
The Tlaxcalans have decided to take the offensive and launch an attack! They made their move, but it was too soon and they were ill prepared to confront your weapons. The battle ends in a draw, but you have been weakened and must remain wary of these new foes. &lt;br&gt;
&lt;br&gt;
You regroup and &lt;&lt;link &quot;settle into your basecamp&quot; &quot;The Spaniards Head Inland&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt; for the night.&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You attack the foreigners, but you&#39;ve moved too soon! You cannot overpower the strangers with their powerful weapons. The battle ends in a draw, but your side has been weakened and you have put the Spaniards on high alert.  &lt;br&gt;
&lt;br&gt;
Hopefully, this doesn&#39;t leave you vulnerable down the road! If only you had been more patient!&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Return to Tlaxcala&quot; &quot;The Spaniards Head Inland&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=1&gt;&gt;&lt;&lt;/link&gt;&gt; and regroup.&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="286" name="Tlaxcalans consider their options" tags="" position="2450,6025" size="100,100">&lt;&lt;theyr&gt;&gt;
The Aztec capital may be impressive, rising up from the lake, but it&#39;s teeming with your enemies. You have battled the Aztecs many times before. Is this time any different? You lead an army of 10,000 allies who share your hatred of the Aztecs. The Spanish force is small, but they carry powerful weapons and they ride their giant deer.&lt;br&gt;
&lt;br&gt;
This is your final opportunity to weigh your options before you reach the point of no return. Go to the Tlaxcalan discussion board and decide on your best course of action. &lt;br&gt;
&lt;br&gt;
Option 1: This is your best chance to defeat the Aztecs. You&#39;ve waited years for this opportunity and you&#39;re not about to let it slip away from you now! You will carry on to the city.&lt;br&gt;
&lt;br&gt;
Option 2: You have serious doubts about the Spaniards in your camp. Recent events have led you to wonder if they might be a more immediate threat than your Aztec enemies. You send a messenger to Tenochtitlán to negotiate an alliance.&lt;br&gt;
&lt;br&gt;
Option 3: You have serious doubts about the Spaniards in your camp. You wonder if they&#39;re leading you into a losing battle with the hated Aztecs. You decide to cut your losses. You leave the Spaniards to their fate and head for home.&lt;br&gt;
&lt;br&gt;
Option 4: You have long doubted the Spaniards in your camp and already made a secret alliance with the Aztecs. After recent events, you are more convinced than ever that this was the right decision. You will honor your alliance with the Aztecs and enter the city as friends.&lt;br&gt;
&lt;br&gt;
When you have reached a decision, &lt;&lt;print $Tlax_Leader&gt;&gt; [[must input your choice|Tlaxcalans decide where to go]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="287" name="Tlaxcalans cut their losses" tags="" position="2450,6375" size="100,100">&lt;&lt;theyr&gt;&gt;
You&#39;ve packed up camp and are headed for home when you find yourself surrounded by a group of angry warriors. Their weapons trained upon you, the allies that have marched at your side since you began this journey are angry. They remind you that it&#39;s not only the Spaniards you have left at the mercy of the Aztecs. They demand that you stay and fight. &lt;br&gt;
&lt;br&gt;
They have you surrounded and you find yourselves with little choice. Besides their numerical advantage, you may need these friends in the future. &lt;br&gt;
&lt;br&gt;
You turn back [[towards Tenochtitlan|On the Causeway]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="288" name="Tlaxcalans decide where to go" tags="" position="2450,6250" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
Now that you have consulted with your men, it is up to you to decide how to proceed.&lt;br&gt;
&lt;br&gt;
You will carry on to the city, allied with the Spaniards, and &lt;&lt;link &quot;hope to defeat the Aztecs once and for all&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Cause=&quot;fight&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
You will send a messenger to Tenochtitlán to negotiate an alliance, &lt;&lt;link &quot;you just don&#39;t trust the Spaniards&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Cause=&quot;neg&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;/link&gt;&gt;. But for now, you continue on with the Spaniards while you negotiations continue behind the scenes.&lt;br&gt;
&lt;br&gt;
You decide to cut your losses. You leave the Spaniards to their fate and &lt;&lt;link &quot;head for home&quot; &quot;Tlaxcalans cut their losses&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Cause=&quot;flee&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;storeSet $factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]-=5&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=6&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
You will honor an existing but secret alliance with the Aztecs and &lt;&lt;link &quot;enter the city as their friends&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Cause=&quot;allies&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;

&lt;&lt;else&gt;&gt;
&lt;&lt;if ndef $Tlax_Cause or $Tlax_Cause eq &quot;&quot;&gt;&gt;
You wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to make your intentions known.&lt;br&gt;&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;

&lt;&lt;elseif $Tlax_Cause is &quot;fight&quot;&gt;&gt;
You will carry on to the city, allied with the Spaniards, and &lt;&lt;link &quot;hope to defeat the Aztecs once and for all&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=6&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Cause is &quot;neg&quot;&gt;&gt;
You will send a messenger to Tenochtitlán to negotiate an alliance, &lt;&lt;link &quot;you just don&#39;t trust the Spaniards&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=6&gt;&gt;&lt;&lt;/link&gt;&gt;. But for now, you continue on with the Spaniards while you negotiations continue behind the scenes.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Cause is &quot;flee&quot;&gt;&gt;
You decide to cut your losses. You leave the Spaniards to their fate and &lt;&lt;link &quot;head for home&quot; &quot;Tlaxcalans cut their losses&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=6&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Cause is &quot;allies&quot;&gt;&gt;
You will honor an existing but secret alliance with the Aztecs and &lt;&lt;link &quot;enter the city as their friends&quot; &quot;On the Causeway&quot;&gt;&gt;&lt;&lt;storeSet $Causeway = $Causeway + 1&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=6&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="289" name="Tlaxcalans decide whether or not to fight with Cortes" tags="" position="2200,9175" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is $Tlax_Leader&gt;&gt;
Select your team&#39;s decision from the options below.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; &lt;&lt;link &quot;You agree to go to battle with Cortes&quot; &quot;Tlaxcalans agree to fight&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Alliance=&quot;Veracruz&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; &lt;&lt;link &quot;You will not go to battle with Cortes and you will tell him this before you reach Tlaxcala, so that you might leave the war party and go home&quot; &quot;Tlaxcalans announce their departure&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Alliance=&quot;Home&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; &lt;&lt;link &quot;You will not go to battle with Cortes, but you decide not to tell him. When the time comes to fight, you will leave him to his fate&quot; &quot;Tlaxcalans leave Cortes to fend for himself&quot;&gt;&gt;&lt;&lt;storeSet $Tlax_Alliance=&quot;Betray&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;
You prepare for the next phase of your journey.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;if $Tlax_Alliance is &quot;Veracruz&quot;&gt;&gt;
&lt;&lt;print $Tlax_Leader&gt;&gt; has finalized your choice. You will agree to support Cortes and go into battle with him.&lt;br&gt;
&lt;br&gt;
You prepare for the [[next phase of your journey|Tlaxcalans agree to fight]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Home&quot;&gt;&gt;
&lt;&lt;print $Tlax_Leader&gt;&gt; has finalized your choice. You will take your leave of Cortes and head back to Tlaxcala before you arrive in Veracruz.&lt;br&gt;
&lt;br&gt;
You prepare for the [[next phase of your journey|Tlaxcalans announce their departure]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tlax_Alliance is &quot;Betray&quot;&gt;&gt;
&lt;&lt;print $Tlax_Leader&gt;&gt; has finalized your choice. You will go to Veracruz, but when the time comes, you will leave Cortes to his fate.&lt;br&gt;
&lt;br&gt;
You prepare for the [[next phase of your journey|Tlaxcalans leave Cortes to fend for himself]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You wait for &lt;&lt;print $Tlax_Leader&gt;&gt; to finalize your decision.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="290" name="Tlaxcalans go with Cortes to the coast" tags="" position="2225,9050" size="100,100">&lt;&lt;theyr&gt;&gt;
You travel for many days and many nights. Cortes warns you of the force that you will likely encounter. They will be men like his own, but they will carry even more weapons. He reminds you of the battle you once fought against each other and the giant pipes that made smoke and noise. He calls them cannons and prepares you to face them once again.&lt;br&gt;
&lt;br&gt;
As you make your way to the coast, you and your compatriots discuss your options. Will you fight for Cortes, as he has asked? Is it worth it? What might you gain if you do?&lt;br&gt;
&lt;br&gt;
Go to the Tlaxcalan board and discuss the following options:&lt;br&gt;
&lt;br&gt;
&lt;b&gt;Option 1:&lt;/b&gt; You agree to go to battle with Cortes.&lt;br&gt;
&lt;b&gt;Option 2:&lt;/b&gt; You will not go to battle with Cortes and you will tell him this before you reach Tlaxcala, so that you might leave the war party and go home.&lt;br&gt;
&lt;b&gt;Option 3:&lt;/b&gt; You will not go to battle with Cortes, but you decide not to tell him. When the time comes to fight, you will leave him to his fate.&lt;br&gt;
&lt;br&gt;
Once your team has decided on the best course of action, [[proceed to the next page|Tlaxcalans decide whether or not to fight with Cortes]].&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="291" name="Tlaxcalans keep waiting" tags="Done" position="2975,2200" size="100,100">&lt;&lt;theyr&gt;&gt;
Unfortunately, you have no way of knowing what&#39;s going on. If only you had eyes on the coast, you might be better able to prepare.&lt;br&gt;
&lt;br&gt;
Head to the Tlaxcalan discussion board to discuss whether there&#39;s anything you can do to prepare for the unknown.&lt;br&gt;
&lt;br&gt;
When you have made your plan, &lt;&lt;link &quot;click here to continue&quot; &quot;A Tlaxcalan Nap&quot;&gt;&gt;&lt;&lt;storeSet $TL_Attacks=&quot;No&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="292" name="Tlaxcalans leave Cortes to fend for himself" tags="" position="2500,9375" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Cortes&quot;&gt;&gt;
You have received word that the enemy camp lies just ahead. The time has come to face the force of Spaniards who have come to secure your arrest.&lt;br&gt;
&lt;br&gt;
You confer with your Tlaxcalan allies, who assure you they will fight by your side. You decide that the best course of action is not to confront the enemy head on, but to take them by surprise in a sneak attack. &lt;br&gt;
&lt;br&gt;
You wait until midnight to launch your attack, hoping to catch the enemy forces asleep. You give the command to attack and charge the Spanish camp, but you are missing some of your men! As the enemy forces collect themselves and gather their weapons to fight back, you realize that none of your Tlaxcalan allies are with you. Have you been betrayed? &lt;br&gt;
&lt;br&gt;
You don&#39;t have long to dwell on this fact, for the battle quickly turns against you. You fight for your life, but to no avail. As you feel the strike of the final blow, you fall to your knees and wonder why &lt;&lt;link &quot;God has forsaken you&quot; &quot;The End&quot;&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]=0&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]=0&gt;&gt;&lt;&lt;storeSet $users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]=0&gt;&gt;&lt;&lt;storeSet $Cortes_Dead=&quot;Yes&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You have received word that the enemy camp lies just ahead. The time has come to execute your plan.&lt;br&gt;
&lt;br&gt;
As you approach the camp, Cortes proposes a plan of his own: rather than meet his enemies head on, he wants to catch them off guard in a surprise attack. You agree that this is the best chance for success and wait patiently for nightfall.&lt;br&gt;
&lt;br&gt;
At midnight, Cortes makes the signal to attack, hoping to catch the enemy forces asleep. Rather than spring into action, you make your retreat. This is not your battle to fight and Cortes is not your friend. You make your way towards Tlaxcala with [[the sound of cannon fire ringing in your ears|Tlaxcalans Back In Tlaxcala]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="293" name="Tlaxcalans let Cortes move inland" tags="Done Breaks" position="2300,2175" size="100,100">&lt;&lt;theyr&gt;&gt;
You have decided that it&#39;s best to remain patient. You will leave both groups to carry on their journeys undisturbed, watching carefully and waiting for your opening.&lt;br&gt;
&lt;br&gt;
You &lt;&lt;link &quot;head back to Tlaxcala&quot; &quot;The Spaniards Head Inland&quot;&gt;&gt;&lt;&lt;run changeStats(&quot;Xicotencatl_Elder&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;run changeStats(&quot;Xicotencatl_Younger&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;run changeStats(&quot;Maxixcatl&quot;,{&quot;Wisdom&quot;:1,&quot;Loyalty&quot;:0,&quot;Strength&quot;:0})&gt;&gt;&lt;&lt;/link&gt;&gt; wondering what the future holds.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="294" name="Tlaxcalans wait" tags="Done" position="3050,925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;&lt;&lt;if $Mutiny_Voted &lt;3&gt;&gt;&gt;&gt;
All is quiet in Tlaxcala and you find yourself bored, wondering what could possibly be happening on the coast. Unfortunately, your decision not to send spies means that you&#39;ve lost track of the foreigners and have no idea what&#39;s going on.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;
&lt;&lt;elseif $Mutiny_Voted &gt;=3 and $Mut_Cor &gt;=2&gt;&gt;
You wait anxiously for news from the coast. [[Any news at all|Tlaxcalans keep waiting]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Mutiny_Voted &gt;=3 and $Mut_Olid &gt;2&gt;&gt;
Your guards have seen Aztec spies running to and from the coast. Clearly [[things are happening|Tlaxcalans keep waiting]]!&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="295" name="To Mutiny or Not" tags="Done Breaks" position="1925,1600" size="100,100">&lt;&lt;theyr&gt;&gt;

&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Cortes&quot;&gt;&gt;
After your encounter with the Mexica, the mood amongst your men has shifted. There is excitement about the riches that may well lie inland, but there is also a clear current of unease. You have heard whispers that the men have doubts about your leadership and that one of your crew may be even be planning a mutiny. &lt;br&gt;
&lt;br&gt;
You must convince your men to remain loyal. Only you can lead them to the gold and the glory that await them! You may want to address them as a group, but it might be more effective to win over each individually. Choose your best course of action and go to Discord to make your case.&lt;br&gt;
&lt;br&gt;
When you are satisfied with your effort [[you may continue on|Cortes Beaches Ships]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Olid&quot;&gt;&gt;
After your encounter with the Mexica, the mood amongst the men has shifted. There is excitement about the riches that may well lie inland, but there is also a clear current of unease. You&#39;ve always questioned Cortés&#39; abilities and his betrayal of your friend Velazquez left a bitter taste in your mouth. Like Cortés, you are convinced that the journey inland could bring you untold riches, but you do not have faith in his leadership. Besides, whoever leads the expedition will surely be rewarded by the King. Now is your chance to take that victory for yourself!&lt;br&gt;
&lt;br&gt;
You must convince the others that you will make a better leader than Cortés. Go to Discord and convince them to mutiny. It is of the utmost importance that Cortés not find out, however, so be discrete in your interactions. You don&#39;t want to get caught!&lt;br&gt;
&lt;br&gt;
Once you have done all you can to convince your teammates, continue [[to the next screen to find out if you have succeeded|Mutiny Outcome]]. &lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Alvarado&quot; or &quot;Aguilar&quot; or &quot;Garrido&quot;&gt;&gt;
After your encounter with the Mexica, the mood amongst the crew has shifted. There is excitement about the riches that may well lie inland, but there is also a clear current of unease. Cortés thinks you should forge inland, in search of the Aztec capital and the riches that surely await you, but do you trust him to lead you there? There is at least one among you who lacks faith in Cortés.&lt;br&gt;
&lt;br&gt;
Go to Discord to see what is being said. Is Cortés able to maintain your support? Or can you be convinced to change your allegiance? You may be approached in private, so keep an eye on your DMs.&lt;br&gt;
&lt;br&gt;
Once you have decided where your loyalty lies, [[continue to the next screen|Mutiny Vote]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Marina&quot;&gt;&gt;
After your encounter with the Mexica, the mood amongst the men has shifted. There is excitement about the riches that may well lie inland, but there is also a clear current of unease. You have learned a great deal about your companions during these last weeks and it seems there is deep distrust among them.&lt;br&gt;
&lt;br&gt;
Go Discord to see what is being said. Will you support Cortés? Or would you rather place your trust in someone else? You may be approached in private, so keep an eye on your DMs. If the men do not yet perceive you as a member of the team, now might be a good time to prove your allegiance.&lt;br&gt;
&lt;br&gt;
Once you have decided where your loyalty lies, [[continue to the next screen|Mutiny Vote]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="296" name="Toxcatl" tags="" position="2650,9425" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $users[$userId][&quot;role&quot;] is &quot;Marina&quot;&gt;&gt;
Cortes and your Tlaxcalan friends have been gone for over three weeks, but life goes on in Tenochtitlán. &lt;&lt;print $Aztec_Leader&gt;&gt; has granted permission for an elaborate celebration to be held, the festival of Toxcatl, which will honor the God Huitzilopochtli.  For days now, the city has been bustling with energy as the residents prepare.&lt;br&gt;
&lt;br&gt;
The festival will begin today and the final preparation last night was the installation of an elaborate sculpture of Huitzilopochtli in front of the Templo Mayor. The sculpture is moulded from the ground seeds of the chicolote, a medicinal plant, and adorned in the finest of feathers. It is a remarkable piece of workmanship. You look on as a parade of warriors pass in single file before the God, making offerings of food. &lt;br&gt;
&lt;br&gt;
The drums begin to sound and the greatest warriors in the Aztec Empire start to dance. You find yourself mesmerized. As the music reaches a fever pitch, chaos unfolds around you. The Spaniards are attacking the warriors, who have been caught off guard. They cut down the bulk of the mighty Aztec Army in a single blow.&lt;br&gt;
&lt;br&gt;
As the dust settles, people flood into the plaza and you feel yourself surrounded. You join your companions as they flee the plaza and [[head for the palace|Aztec Leader taken prisoner]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Cortes and your Tlaxcalan friends have been gone for over three weeks, but life goes on in Tenochtitlán. &lt;&lt;print $Aztec_Leader&gt;&gt; has granted permission for an elaborate celebration to be held, the festival of Toxcatl, which will honor the God Huitzilopochtli.  For days now, the city has been bustling with energy as the residents prepare.&lt;br&gt;
&lt;br&gt;
The festival will begin today and the final preparation last night was the installation of an elaborate sculpture of Huitzilopochtli in front of the Templo Mayor. The sculpture is moulded from the ground seeds of the chicolote, a medicinal plant, and adorned in the finest of feathers. You&#39;ve never seen anything like it. You look on as a parade of warriors pass in single file before the God, making offerings of food. &lt;br&gt;
&lt;br&gt;
The drums begin to sound and the greatest warriors in the Aztec Empire start to dance. You find yourself mesmerized. As the music reaches a fever pitch, chaos unfolds around you. Your men are attacking the warriors, who have been caught off guard. You cut down the bulk of the mighty Aztec Army in a single blow.&lt;br&gt;
&lt;br&gt;
As the dust settles, people flood into the plaza and you feel yourself surrounded. You flee the plaza and [[head for the palace|Aztec Leader taken prisoner]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
Cortes took his Tlaxcalan allies to the coast three weeks past, but left a large contingent of men behind. It&#39;s clear that the people of Tenochtitlán are wary of their presence. Nonetheless, life must go on. You have granted permission for an elaborate celebration to be held, the festival of Toxcatl, which will honor the God Huitzilopochtli. For days now, the city has been bustling with energy as everyone prepares.&lt;br&gt;
&lt;br&gt;
The festival will begin today and the final preparation last night was the installation of an elaborate sculpture of Huitzilopochtli in front of the Templo Mayor. The sculpture is moulded from the ground seeds of the chicolote, a medicinal plant, and adorned in the finest of feathers. You gaze proudly upon this magnificent tribute to your God. You look on as a parade of warriors pass in single file before him, making offerings of food. &lt;br&gt;
&lt;br&gt;
The drums begin to sound and the greatest warriors in the Aztec Empire start to dance. You watch, mesmerized. As the music reaches a fever pitch, chaos unfolds around you. The Spaniards are attacking the warriors, who have been caught off guard! They cut down the bulk of the mighty Aztec Army in a single blow.&lt;br&gt;
&lt;br&gt;
Horrified at this turn of events, [[you quickly slip back to the palace|Aztec Leader taken prisoner]]. It is up to you to deal with the enemies in your midst.&lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
Cortes took his Tlaxcalan allies to the coast three weeks past, but left a large contingent of men behind. It&#39;s clear that the people of Tenochtitlán are wary of their presence. Nonetheless, life must go on. &lt;&lt;print $Aztec_Leader&gt;&gt; has granted permission for an elaborate celebration to be held, the festival of Toxcatl, which will honor the God Huitzilopochtli. For days now, the city has been bustling with energy as everyone prepares.&lt;br&gt;
&lt;br&gt;
The festival will begin today and the final preparation last night was the installation of an elaborate sculpture of Huitzilopochtli in front of the Templo Mayor. The sculpture is moulded from the ground seeds of the chicolote, a medicinal plant, and adorned in the finest of feathers. You gaze proudly upon this magnificent tribute to your God. You look on as a parade of warriors pass in single file before him, making offerings of food. &lt;br&gt;
&lt;br&gt;
The drums begin to sound and the greatest warriors in the Aztec Empire start to dance. You watch, mesmerized. As the music reaches a fever pitch, chaos unfolds around you. The Spaniards are attacking the warriors, who have been caught off guard! They cut down the bulk of the mighty Aztec Army in a single blow.&lt;br&gt;
&lt;br&gt;
As the dust settles, people flood into the plaza. You join the mob in an attempt to hunt down the Spaniards, who have [[fled toward the palace|Aztec Leader taken prisoner]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="297" name="Victory Decision Aztecs Versus Tlaxcalans" tags="" position="3925,12800" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $New_Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Tlaxcalans&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $New_Aztec_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Tlaxcalans&quot;&gt;&gt;&lt;&lt;storeSet  
$Final_Tlaxcalan_Players=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players/=3&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Points=$factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Tlaxcalan_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt; 
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Tlax_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="298" name="Victory Decision Aztecs Versus Tlaxcalans 2" tags="" position="3325,12875" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $New_Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Tlaxcalans 2&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $New_Aztec_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Tlaxcalans 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Tlaxcalans 2&quot;&gt;&gt;&lt;&lt;storeSet  
$Final_Tlaxcalan_Players=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players/=3&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Points=$factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Tlaxcalan_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt; 
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Tlax_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Tlaxcalans 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="299" name="Victory Decision Aztecs Versus Tlaxcalans 3" tags="" position="3175,12900" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;

&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $New_Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Tlaxcalans 3&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $New_Aztec_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Tlaxcalans 3]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Tlaxcalans 3&quot;&gt;&gt;&lt;&lt;storeSet  
$Final_Tlaxcalan_Players=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players/=3&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Points=$factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Tlaxcalan_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt; 
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Tlax_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Tlaxcalans 3]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="300" name="Victory Decision Aztecs and Tlaxcalans versus Spaniards" tags="" position="2250,12700" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your sword and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs and Tlaxcalans versus Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players=$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Points=$factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Spanish_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Span_Leader&gt;&gt; raises his sword and [[strikes the final blow|Battle Outcome Aztecs and Tlaxcalans versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $New_Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs and Tlaxcalans versus Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $New_Aztec_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Aztecs and Tlaxcalans versus Spaniards]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs and Tlaxcalans versus Spaniards&quot;&gt;&gt;&lt;&lt;storeSet  
$Final_Tlaxcalan_Players=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players/=3&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Points=$factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Tlaxcalan_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt; 
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Tlax_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs and Tlaxcalans versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="301" name="Victory Decision Aztecs versus Spaniards" tags="" position="2850,11525" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your sword and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players=$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Points=$factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Spanish_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Span_Leader&gt;&gt; raises his sword and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $New_Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $New_Aztec_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
You watch from afar as [[the battle rages|Battle Outcome Aztecs Versus Spaniards]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="302" name="Victory Decision Aztecs versus Spaniards 2" tags="" position="3725,13975" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your sword and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards 2&quot;&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players=$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Points=$factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Spanish_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Span_Leader&gt;&gt; raises his sword and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $New_Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards 2&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $New_Aztec_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="303" name="Victory Decision Aztecs versus Spaniards 3" tags="" position="3200,12125" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your sword and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards 3&quot;&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players=$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Points=$factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Spanish_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Span_Leader&gt;&gt; raises his sword and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards 3]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $New_Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards 3&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $New_Aztec_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards 3]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="304" name="Victory Decision Aztecs versus Spaniards and Tlaxcalans" tags="" position="4600,12575" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your sword and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards and Tlaxcalans&quot;&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players=$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Points=$factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Spanish_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Span_Leader&gt;&gt; raises his sword and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards and Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $New_Aztec_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards and Tlaxcalans&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $New_Aztec_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards and Tlaxcalans]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;/if&gt;&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Aztecs Versus Spaniards and Tlaxcalans&quot;&gt;&gt;&lt;&lt;storeSet  
$Final_Tlaxcalan_Players=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players/=3&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Points=$factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Tlaxcalan_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt; 
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Tlax_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Aztecs Versus Spaniards and Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="305" name="Victory Decision Spaniards versus Tlaxcalans" tags="" position="2250,12200" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your sword and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Spaniards Versus Tlaxcalans&quot;&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players=$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Points=$factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Spanish_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Span_Leader&gt;&gt; raises his sword and [[strikes the final blow|Battle Outcome Spaniards Versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Spaniards Versus Tlaxcalans&quot;&gt;&gt;&lt;&lt;storeSet  
$Final_Tlaxcalan_Players=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players/=3&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Points=$factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Tlaxcalan_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt; 
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Tlax_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Spaniards Versus Tlaxcalans]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="306" name="Victory Decision Spaniards versus Tlaxcalans 2" tags="" position="2625,12900" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
&lt;&lt;if $Span_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your sword and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Spaniards Versus Tlaxcalans 2&quot;&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players=$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Points=$factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Spanish_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Span_Leader&gt;&gt; raises his sword and [[strikes the final blow|Battle Outcome Spaniards Versus Tlaxcalans 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Tlax_Leader is $users[$userId][&quot;role&quot;]&gt;&gt;
You raise your macuahuitl and &lt;&lt;link &quot;strike the final blow&quot; &quot;Battle Outcome Spaniards Versus Tlaxcalans 2&quot;&gt;&gt;&lt;&lt;storeSet  
$Final_Tlaxcalan_Players=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players/=3&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Points=$factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Tlaxcalan_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt; 
&lt;&lt;else&gt;&gt;
You watch as &lt;&lt;print $Tlax_Leader&gt;&gt; raises his macuahuitl and [[strikes the final blow|Battle Outcome Spaniards Versus Tlaxcalans 2]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="307" name="Waking up 6 months later" tags="" position="2300,8800" size="100,100">&lt;&lt;theyr&gt;&gt;
You wake to the smell of fresh tortillas and the chatter of Nahuatl outside your door. Just as you hoped, you are back in Tenochtitlán. And just like every time before, you wake with a clear awareness of your situation. &lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Spaniards&quot;&gt;&gt;
Six months have passed since you arrived in the city. For six months, you have been a guest of &lt;&lt;print $Aztec_Leader&gt;&gt;, but with every day that passes you feel less like a guest and more like a prisoner. You feel eyes upon you everywhere you go. The Emperor has assured you of your safety and has never shown you anything less than respect, but you don&#39;t trust him. You&#39;ve lain awake every night for weeks, as the nagging dread that lingers at the back of your mind during the day takes over your thoughts.&lt;br&gt;
&lt;br&gt;
You rouse yourself out of bed and prepare for another day of wondering and waiting, thinking about how you might force &lt;&lt;print $Aztec_Leader&gt;&gt;&#39;s hand. &lt;br&gt;
&lt;br&gt;
Suddenly, [[a messenger arrives at your lodgings|Cortes gets called to the coast]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
Six months have passed since the strangers arrived in your city. For six months, you have treated them as guests and watched their every move. They have marvelled at your city, recoiled in horror at your temples, and beseeched you to worship their god instead. Strange creatures, these bearded men and their slave woman. You don&#39;t trust them. Nobody does. For many moons, you have been weighing your options, carefully plotting the best way to remove them from your city--permanently.&lt;br&gt;
&lt;br&gt;
As you begin to prepare for your day, you hear word that the Spaniards have received a message. [[This could be just what you need|Cortes gets called to the coast]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
Six months have passed since you arrived in the city. For six months, you have been a guest of &lt;&lt;print $Aztec_Leader&gt;&gt;, but with every day that passes you feel less like a guest and more like a prisoner. You feel eyes upon you everywhere you go and you have been kept away from the Spaniards, relegated to the periphery of the city. Nonetheless, you have taken advantage of your stay to carefully gather supplies that you will take back to Tlaxcala. You have spent countless hours in the market and you have everything you could possibly need. You grow increasingly anxious by the day, wondering if all is well at home. &lt;br&gt;
&lt;br&gt;
As you begin to prepare for your day, you hear word that the Spaniards have received a message. [[Could this be your ticket home|Cortes gets called to the coast]]?&lt;br&gt;
&lt;br&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="308" name="Waking up in the Library on a Full Belly" tags="" position="2300,8425" size="100,100">&lt;&lt;theyr&gt;&gt;
You wake to find yourself back in the library, sprawled across the comfy chair. You missed dinner, but somehow your belly feels strangely full. You swear you can still taste the pulque on your lips, but that can&#39;t possibly be true... can it? &lt;br&gt;
&lt;br&gt;
You look at the stack of papers on the floor, and, sure enough, there&#39;s your latest history assignment, complete and ready to hand in. Buoyed by the knowledge that another A grade is coming your way, you pack up your things and head home. &lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="309" name="Waking up in the library" tags="Done Breaks" position="1975,2450" size="100,100">&lt;&lt;theyr&gt;&gt;
You slowly pull yourself awake.  It takes real effort, you were sleeping so deeply.  You&#39;re confused, there is nothing worse than waking up mid-dream. &lt;br&gt;
&lt;br&gt;
What is that noise? Nothing makes sense...&lt;br&gt;
&lt;br&gt;
You shake your head and catch sight of something glowing on the table next to you. &lt;br&gt;
&lt;br&gt;
Your phone. It is full of texts from your friends. Where have you been? Is your history assignment done?&lt;br&gt;
&lt;br&gt;
Your heart starts to race. You look around the room.  The library! Your assignment!  You grab your phone from the table next to you, class starts in just an hour! What are you going to do? &lt;br&gt;
&lt;br&gt;
It all comes flooding back.  That dream was weird, so realistic, but you came here to get your history paper done. And now you&#39;ve lost the whole night!&lt;br&gt;
&lt;br&gt;
You start to gather up your things frantically, praying that somehow you&#39;ll find the time to complete the assignment. You knock the pile of books off the little side table next to you, and a neatly stapled stack of paper floats gently to the floor.  &lt;br&gt;
&lt;br&gt;
You grab it, you look, you start reading.  Your history assignment, it is done!  Did you complete it before you fell asleep? You read more. This is good, like really good! You wrote this? You are pretty sure you are getting an A!&lt;br&gt;
&lt;br&gt;
You take a deep breath, you gather your things up calmly. You can&#39;t believe it. You don&#39;t remember writing this brilliant paper, but here it is, done. And you feel rested, if a bit disoriented.  Everything is going to be alright after all! You text your friends.  You&#39;ll meet them in class.&lt;br&gt;
&lt;br&gt;
As you close the door of the weird little room behind you, you know &lt;&lt;link &quot;you&#39;ll be back&quot; &quot;return to the library_no door&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=1000&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1000&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=1000&gt;&gt;&lt;&lt;/link&gt;&gt;.  You&#39;ve done your best work here, and that big red chair is so cozy!&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="310" name="Waking up in the library 3" tags="Done" position="2300,5550" size="100,100">&lt;&lt;theyr&gt;&gt;
You wake from a fitful sleep, disturbed by dreams of battle. When you open your eyes, you are surprised to find that you&#39;re not on the battlefield but back in the library once again. &lt;br&gt;
&lt;br&gt;
You know the drill by now and you look immediately to the pile of papers that lies at your feet. Sure enough, sitting on top of the stack is your history assignment, finished. You read it over and can&#39;t believe your luck. This one might be even better than the last!&lt;br&gt;
&lt;br&gt;
You check your phone and see you still have plenty of time before class starts, so you make your way home. You smell alright, but you feel like you&#39;ve never needed a shower so badly in your life!&lt;br&gt;
&lt;br&gt;
All the way home, you marvel at your luck and ignore the nagging feeling at the back of your mind that wonders if it&#39;s okay to hand in this assignment that you don&#39;t remember writing. You must have written it though, right? There&#39;s no other explanation. &lt;br&gt;
&lt;br&gt;
You decide that you&#39;ll hand the assignment in this time and &lt;&lt;link &quot;go back later to investigate&quot; &quot;return to the library_no door&quot;&gt;&gt;&lt;&lt;storeSet $Tlaxcalans_currentMap=1000&gt;&gt;&lt;&lt;storeSet $Aztecs_currentMap=1000&gt;&gt;&lt;&lt;storeSet $Spaniards_currentMap=1000&gt;&gt;&lt;&lt;/link&gt;&gt;.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="311" name="Xochimilco" tags="Done Breaks" position="2525,50" size="100,100">If you are to survive your journey, you will need to stop first at the place of flowers. Be careful as you seek what you came for, as you could easily get stuck in the mud.&lt;br&gt;
&lt;br&gt;

&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Xochimilco_Ans_A&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Xochimilco 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_A&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Xochimilco 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;if $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
This city is &lt;&lt;textbox &quot;$Xochimilco_Ans_T&quot; &quot;&quot;&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Submit your answer&quot; &quot;Xochimilco 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;print $Quest_Leader_T&gt;&gt; must answer this question. Please work on the discussion board to help him solve the riddle.  When he has input the answer, [[see if you&#39;ve solved the puzzle|Xochimilco 2]] &lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="312" name="Xochimilco 2" tags="Done Breaks" position="2675,50" size="100,100">&lt;&lt;switch $users[$userId][&quot;faction&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztecs&quot;&gt;&gt;
&lt;&lt;print $Xochimilco_Ans_A&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Xochimilco_Ans_A and $Xochimilco_Ans_A isnot 0 and $Xochimilco_Ans_A isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Xochimilco_Ans_A = $Xochimilco_Ans_A.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if ndef $Xochimilco_Ans_A or $Xochimilco_Ans_A eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Xochimilco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;

&lt;&lt;elseif $Xochimilco_Ans_A is &quot;xochimilco&quot; and $Quest_Leader_A is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of corn for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_A = $Quest_Points_A + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Xochimilco_Ans_A is &quot;xochimilco&quot; and $Quest_Leader_A isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of corn for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Xochimilco_Ans_A isnot &quot;xochimilco&quot;&gt;&gt;
Your answer is incorrect.  You may [[try again|Xochimilco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Tlaxcalans&quot;&gt;&gt;
&lt;&lt;print $Xochimilco_Ans_T&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;if def $Xochimilco_Ans_T and $Xochimilco_Ans_T isnot 0 and $Xochimilco_Ans_T isnot &quot;&quot;&gt;&gt;
&lt;&lt;storeSet $Xochimilco_Ans_T = $Xochimilco_Ans_T.toLowerCase()&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if ndef $Xochimilco_Ans_T or $Xochimilco_Ans_T eq &quot;&quot;&gt;&gt;
You have not yet submitted an answer to this challenge. You may [[try again|Xochimilco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Xochimilco_Ans_T is &quot;xochimilco&quot; and $Quest_Leader_T is $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of corn for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;storeSet $Quest_Points_T = $Quest_Points_T + 2&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Xochimilco_Ans_T is &quot;xochimilco&quot; and $Quest_Leader_T isnot $users[$userId][&quot;role&quot;]&gt;&gt;
Congratulations! You have found the correct answer! You load up the two sacks of corn for the journey! &lt;&lt;link &quot;Return to the palace&quot; &quot;Scavenger Hunt Hub&quot;&gt;&gt;&lt;&lt;/link&gt;&gt; and prepare for your next quest!&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Xochimilco_Ans_T isnot &quot;xochimilco&quot;&gt;&gt;
Your answer is incorrect. You may [[try again|Xochimilco]], or you may return to the palace and [[try another quest|Scavenger Hunt Hub]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="313" name="return to the library_no door" tags="Done Breaks" position="1975,2575" size="100,100">&lt;&lt;theyr&gt;&gt;
You made it through a full day of classes, but it was torture. You couldn&#39;t concentrate on anything because all you could think about was that mysterious room and the history assignment you don&#39;t remember writing. I mean, you must have written it, right? You feel a little guilty about handing it in, but you decide not to think too hard about that.&lt;br&gt;
&lt;br&gt;
It&#39;s now late afternoon and you&#39;re finally free for the day. You hurry back to the library, excited to revisit the mystery room and its big comfy chair. You hope that if you look closely, you&#39;ll find some clue to what happened...some indication that you really did write that killer paper.&lt;br&gt;
&lt;br&gt;
You arrive on the top floor and round the corner but you can&#39;t find the door! You swear this is exactly where you found it before, but it&#39;s not here. Confused, you scour every corner of the library to no avail. The door is nowhere to be found. You head home feeling deeply unsettled.&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="314" name="test equations" tags="" position="4350,850" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;print $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;
cut Aztec Strength in half&lt;br&gt;
&lt;br&gt;
&lt;&lt;link &quot;Halve Aztec Strength&quot; &quot;test equations outcome&quot;&gt;&gt;&lt;&lt;storeSet $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]*=.5&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;
Set Final Totals&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Final_Aztec_Points&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Final_Aztec_Players&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;link &quot;Set the Final Aztec Points&quot; &quot;test equations outcome&quot;&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players=$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Moctezuma&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Tlacaelel&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cuauhtemoc&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cacamatzin&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aztec_Priest&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Pochteca&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Aztec_Points=$factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Aztec_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;

&lt;&lt;link &quot;Set the Final Spanish Points&quot; &quot;test equations outcome&quot;&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players=$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Cortes&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Alvarado&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Aguilar&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Marina&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Garrido&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Olid&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Players/=6&gt;&gt;&lt;&lt;storeSet $Final_Spanish_Points=$factions[&quot;Spaniards&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Spanish_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;


&lt;&lt;link &quot;Set the Final Tlaxcalan Points&quot; &quot;test equations outcome&quot;&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players=$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Elder&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Xicotencatl_Younger&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Strength&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Loyalty&quot;]+$users[$lookup[&quot;Maxixcatl&quot;]][&quot;stats&quot;][&quot;Wisdom&quot;]&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Players/=3&gt;&gt;&lt;&lt;storeSet $Final_Tlaxcalan_Points=$factions[&quot;Tlaxcalans&quot;][&quot;stats&quot;][&quot;Strength&quot;]+$Final_Tlaxcalan_Players&gt;&gt;&lt;&lt;/link&gt;&gt;. &lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="315" name="test equations outcome" tags="" position="4475,550" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;print $factions[&quot;Aztecs&quot;][&quot;stats&quot;][&quot;Strength&quot;]&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;print $Final_Aztec_Points&gt;&gt;&lt;br&gt;
&lt;br&gt;

&lt;&lt;print $Final_Spanish_Points&gt;&gt;&lt;br&gt;
&lt;br&gt;
&lt;&lt;print $Final_Tlaxcalan_Points&gt;&gt;&lt;br&gt;
&lt;br&gt;
[[test equations]]&lt;br&gt;
&lt;br&gt;
[[Dashboard]]&lt;br&gt;
&lt;br&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="316" name="the Omens" tags="Done" position="2825,925" size="100,100">&lt;&lt;theyr&gt;&gt;
&lt;&lt;switch $users[$userId][&quot;role&quot;]&gt;&gt;
&lt;&lt;case &quot;Aztec_Priest&quot;&gt;&gt;
Upon hearing the news, you reflect upon a series of omens that have occurred in recent years. &lt;br&gt;
&lt;br&gt;
First, a fiery comet appeared in the sky and showed itself for a full year.&lt;br&gt;
&lt;br&gt;
Second, a fire consumed the Temple of Huitzilopochtli that could not be put out. When the residents of Tenochtitlán threw water upon the fire, it only grew stronger.&lt;br&gt;
&lt;br&gt;
Third, lightning struck the Temple of Xiuhteuctli, despite the fact that it was barely raining.&lt;br&gt;
&lt;br&gt;
Fourth, a comet fell from the sky in the middle of the day. The comet had three tails and where they were seen, they made a great noise, like the sound of rattles.&lt;br&gt;
&lt;br&gt;
Fifth, the waters of Lake Texcoco set fire, boiling and bubbling, destroying houses along the shore.&lt;br&gt;
&lt;br&gt;
Sixth, at night, a woman could  be heard crying out, “O my children, we are about to go forever.” “O my children, where am I to take you?”&lt;br&gt;
&lt;br&gt;
Seventh, the residents of Lake Texcoco caught a strange bird, like a crane. Its skull was deformed and reflected the stars, like a mirror. When Moctezuma peered into the mirror, he saw a group of men marching, outfitted for war and carried on the backs of deer.&lt;br&gt;
&lt;br&gt;
Eighth, strange creatures appeared in the city, creatures with two heads but only one body. When they were taken to Moctezuma, he looked upon them and they disappeared.&lt;br&gt;
&lt;br&gt;
What could these omens possibly mean? It is up to you to help Moctezuma find meaning in these signs. The future of the empire could be at stake. &lt;br&gt;
&lt;br&gt;
Go to your site and create a new page titled “Omens.” Here, you will work with Moctezuma to present your interpretation to the rest of your people. What meaning can you draw from these strange signs? What do they mean for the future? How can you convey their meaning?&lt;br&gt;
&lt;br&gt;
It is not yet time to tell your people what all of this means, but that time will come soon. For now, pay close attention to events as they unfold. You are certain that the arrival of the foreigners is key to interpreting these strange signs.  &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Tl_Omens is &quot;Yes&quot;&gt;&gt;

As you contemplate the meaning of the signs, you receive some surprising news. It seems that a delegation of Tlaxcalans, your sworn enemies, have arrived in Tenochtitlán to seek an audience with Moctezuma. He invites you to accompany him [[to the meeting|Tlaxcalans and Aztecs meet]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tl_Omens is &quot;Nothing&quot; or &quot;Spies&quot;&gt;&gt;

You wait anxiously for the delegation to return with [[news from the coast|Aztecs Return to Tenochtitlan to report]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tl_Omens eq &quot;&quot; or ndef $Tl_Omens&gt;&gt;
You contemplate the omens as you wait for new developments. &lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalan team to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;case &quot;Moctezuma&quot;&gt;&gt;
Upon hearing the news, you reflect upon a series of omens that have occurred in recent years. &lt;br&gt;
&lt;br&gt;
First, a fiery comet appeared in the sky and showed itself for a full year.&lt;br&gt;
&lt;br&gt;
Second, a fire consumed the Temple of Huitzilopochtli that could not be put out. When the residents of Tenochtitlán threw water upon the fire, it only grew stronger.&lt;br&gt;
&lt;br&gt;
Third, lightning struck the Temple of Xiuhteuctli, despite the fact that it was barely raining.&lt;br&gt;
&lt;br&gt;
Fourth, a comet fell from the sky in the middle of the day. The comet had three tails and where they were seen, they made a great noise, like the sound of rattles.&lt;br&gt;
&lt;br&gt;
Fifth, the waters of Lake Texcoco set fire, boiling and bubbling, destroying houses along the shore.&lt;br&gt;
&lt;br&gt;
Sixth, at night, a woman could  be heard crying out, “O my children, we are about to go forever.” “O my children, where am I to take you?”&lt;br&gt;
&lt;br&gt;
Seventh, the residents of Lake Texcoco caught a strange bird, like a crane. Its skull was deformed and reflected the stars, like a mirror. When you peered into the mirror, you saw a group of men marching, outfitted for war and carried on the backs of deer.&lt;br&gt;
&lt;br&gt;
Eighth, strange creatures appeared in the city, creatures with two heads but only one body. When they were brought to you, you looked upon them and they disappeared.&lt;br&gt;
&lt;br&gt;
What could these omens possibly mean? You consult with your priest to find meaning in these signs. The future of the empire could be at stake. &lt;br&gt;
&lt;br&gt;
Meet with the priest and visit his site, where you will create a new page titled “Omens.” Here, you will work together to present your interpretation to the rest of your people. What meaning can you draw from these strange signs? What do they mean for the future? How can you convey their meaning? &lt;br&gt;
&lt;br&gt;
It is not yet time to tell your people what all of this means, but that time will come soon. For now, pay close attention to events as they unfold. You are certain that the arrival of the foreigners is key to interpreting these strange signs.  &lt;br&gt;
&lt;br&gt;
&lt;&lt;if $Tl_Omens is &quot;Yes&quot;&gt;&gt;

As you contemplate the meaning of the signs, you receive some surprising news. It seems that a delegation of Tlaxcalans, your sworn enemies, have arrived in Tenochtitlán 	and they wish to speak with you. You take your priest with you as you go to [[hear what they have to say|Tlaxcalans and Aztecs meet]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tl_Omens is &quot;Nothing&quot; or &quot;Spies&quot;&gt;&gt;

You wait anxiously for the delegation to return with [[news from the coast|Aztecs Return to Tenochtitlan to report]].&lt;br&gt;
&lt;br&gt;
&lt;&lt;elseif $Tl_Omens eq &quot;&quot; or ndef $Tl_Omens&gt;&gt;
You contemplate the omens as you wait for new developments.&lt;br&gt;
&lt;br&gt;
&lt;img src=&quot;Twine/images/Stop_1.png&quot; style=&quot;width:60%; margin:auto; display:block;&quot;&gt;&lt;br&gt;
&lt;br&gt;
You are waiting for the Tlaxcalan team to make a decision.&lt;br&gt;
&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/switch&gt;&gt;


&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="317" name="Home" tags="Done Breaks" position="338,1151" size="100,100">&lt;&lt;theyr&gt;&gt;

/* Prints list of previous passages for user to recollect */
&lt;div id=&quot;info&quot;&gt;

  /* button to go back to other passages */
	&lt;&lt;link &quot;back&quot; $users[$userId][&quot;passage&quot;]&gt;&gt;&lt;&lt;/link&gt;&gt;
	&lt;br&gt;
	Passages Completed:
	&lt;br&gt;

  /* loop to make buttons for showing text of previous passages */
	&lt;&lt;for _passageName, _passageText range $users[$userId][&quot;passageHistory&quot;]&gt;&gt;
		&lt;&lt;set _passageId = `passage-${_passageName.replaceAll(/\s/g, &#39;-&#39;)}`&gt;&gt;

		&lt;br&gt;
		&lt;&lt;if $users[$userId][&quot;passage&quot;] != _passageName&gt;&gt;

      /* macro to make button and the previously read passage&#39;s text it shows
       if you want to edit look for historyButton macro */
			&lt;&lt;historyButton _passageName _passageText _passageId&gt;&gt;
		&lt;&lt;/if&gt;&gt;
	&lt;&lt;/for&gt;&gt;
&lt;/div&gt;

/* prints current passage */
&lt;div id=&quot;passage&quot;&gt;
	&lt;&lt;print $users[$userId][&quot;passage&quot;]&gt;&gt;
&lt;/div&gt;

/* print play status list (discord info, role, etc.) */
&lt;div id=&quot;players&quot;&gt;

/* Creates arrays for each faction and offline users */
&lt;&lt;set _factionUsers = {&quot;Aztecs&quot; : [], &quot;Spaniards&quot;:[],&quot;Tlaxcalans&quot;:[], &quot;offline&quot;:[]}&gt;&gt;

&lt;&lt;set _userCount = {&quot;Aztecs&quot; : 0, &quot;Spaniards&quot;:0,&quot;Tlaxcalans&quot;:0, &quot;offline&quot;:0}&gt;&gt;
&lt;&lt;set _totalUsers = 0&gt;&gt;

/* Defines border colors for each faction */
&lt;&lt;set _factionColor = {&quot;Aztecs&quot;: &quot;aztecBorder&quot;, &quot;Spaniards&quot;: &quot;spaniardBorder&quot;, &quot;Tlaxcalans&quot;: &quot;tlaxcalanBorder&quot;}&gt;&gt;

&lt;&lt;set _userSvgPicture = {
	&quot;Do&amp;#xf1;a Marina/Malinche&quot;:&quot;Twine/images/characters/Marina.svg&quot;,
	&quot;Pedro de Alvarado&quot;:&quot;Twine/images/characters/Alvarado.svg&quot;,
	&quot;Ger&amp;#xf3;nimo de Aguilar&quot;:&quot;Twine/images/characters/Aguilar.svg&quot;,
	&quot;Juan Garrido&quot;:&quot;Twine/images/characters/Garrido.svg&quot;,
	&quot;Cristóbal de Olid&quot;:&quot;Twine/images/characters/Cristobal.svg&quot;,
	&quot;Hern&amp;#xe1;n Cort&amp;#xe9;s&quot;:&quot;Twine/images/characters/Cortes.svg&quot;,
	&quot;Moctezuma&quot;:&quot;Twine/images/characters/Moctezuma.svg&quot;,
	&quot;Tlacaelel Xocoyotl (aka Tlacaelel the Younger)&quot;:&quot;Twine/images/characters/Tlacaelel.svg&quot;,
	&quot;Cuauht&amp;#xe9;moc&quot;:&quot;Twine/images/characters/Cuauhtemoc.svg&quot;,
	&quot;Aztec Priest&quot;:&quot;Twine/images/characters/Aztec Priest.svg&quot;,
	&quot;Cacamatzín&quot;:&quot;Twine/images/characters/Cacamatzin.svg&quot;,
	&quot;Pochteca&quot;:&quot;Twine/images/characters/Pochteca.svg&quot;,
	&quot;Xicotencatl the Elder&quot;:&quot;Twine/images/characters/Xicotencatl the Elder.svg&quot;,
	&quot;Xicotencatl the Younger&quot;:&quot;Twine/images/characters/Xicotencatl the Younger.svg&quot;,
	&quot;Maxixcatl&quot;: &quot;Twine/images/characters/Maxixcatl.svg&quot;,
	&quot;Not seen&quot;:&quot;Twine/images/characters/icon_placeholder.png&quot;
}&gt;&gt;

/* _id: discord id for each user
_data: object with user properties (to access user&#39;s passage just use _data[&quot;passage&quot;]) */
&lt;&lt;for _id, _data range $users&gt;&gt;
	&lt;&lt;storeSet _totalUsers = _totalUsers + 1&gt;&gt;

  /* _faction: the faction of the user that is currently being iterated */
	&lt;&lt;storeSet _faction = _data[&quot;faction&quot;]&gt;&gt;
	&lt;&lt;if ndef _factionUsers[_faction]&gt;&gt;
		&lt;&lt;set _factionUsers[_faction] = []&gt;&gt;
	&lt;&lt;/if&gt;&gt;

  /* If user has not been on lately, put them in the offline group */
	&lt;&lt;if new Date().getTime() - _data[&quot;lastSeen&quot;] &lt; 10000&gt;&gt;
		&lt;&lt;set _factionUsers[_faction].push(_id)&gt;&gt;
		&lt;&lt;set _userCount[_faction] = (_userCount[_faction] + 1)&gt;&gt;
	&lt;&lt;else&gt;&gt;
		&lt;&lt;set _factionUsers[&quot;offline&quot;].push(_id)&gt;&gt;
		&lt;&lt;set _userCount[&quot;offline&quot;] = (_userCount[&quot;offline&quot;] + 1)&gt;&gt;
	&lt;&lt;/if&gt;&gt;
&lt;&lt;/for&gt;&gt;

  /* creates sidebar with users */
  &lt;div id = &quot;playerClient&quot;&gt;
  		&lt;&lt;print `&lt;img id = &quot;playerImageClient&quot; class=&quot;`+_factionColor[$users[$userId][&quot;faction&quot;]]+`&quot; src = &quot;Twine/images/characters/Tlacaelel.svg&quot;&gt; `&gt;&gt;
      
      &lt;div id = &quot;playerTextClient&quot;&gt;
        &lt;div id=&quot;printUserRoleClient&quot;&gt; 
          &lt;&lt;print $users[$userId][&quot;character&quot;]&gt;&gt;
        &lt;/div&gt;
        &lt;div id=&quot;printUserNameClient&quot;&gt;
		&lt;&lt;if $users[$userId][&quot;discriminator&quot;] == 0&gt;&gt;
			&lt;&lt;print &quot;@&quot; + $users[$userId][&quot;username&quot;]&gt;&gt;
		&lt;&lt;else&gt;&gt;
			&lt;&lt;print $users[$userId][&quot;username&quot;] + &quot;#&quot; + $users[$userId][&quot;discriminator&quot;]&gt;&gt;
		&lt;&lt;/if&gt;&gt;
          
        &lt;/div&gt;
      &lt;/div&gt;
  &lt;/div&gt;




	&lt;div id=&quot;onlineCount&quot;&gt;
		&lt;&lt;print &quot;  General (&quot; + (_totalUsers - _userCount[&quot;offline&quot;]) + &quot;/&quot; + _totalUsers + &quot;)&quot;&gt;&gt;
	&lt;/div&gt;

	&lt;script&gt;
		$(document).on(&#39;mouseenter&#39;, &#39;.player&#39;, function() {
			$(this).find(&#39;.rolePanel&#39;).show();
		});

		$(document).on(&#39;mouseleave&#39;, &#39;.player&#39;, function() {
			$(this).find(&#39;.rolePanel&#39;).hide();
		});
	&lt;/script&gt;

	&lt;&lt;for _i,_faction   range [&quot;Aztecs&quot;, &quot;Spaniards&quot;,&quot;Tlaxcalans&quot;, &quot;offline&quot;]&gt;&gt;
		&lt;div id=&quot;printFactionOnlineCount&quot;&gt;
    &lt;&lt;if _faction != &quot;offline&quot;&gt;&gt;
			&lt;&lt;print _faction + &quot; -- (&quot; + _userCount[_faction] + &quot;/&quot; + _factionUsers[_faction].length + &quot;)&quot;&gt;&gt;
    &lt;&lt;else&gt;&gt;
			&lt;&lt;print &quot;Offline&quot; + &quot; -- (&quot; + _userCount[&quot;offline&quot;] + &quot;/&quot; + _totalUsers + &quot;)&quot;&gt;&gt;
		&lt;&lt;/if&gt;&gt;
    &lt;/div&gt;
		&lt;&lt;for _j, _userId range _factionUsers[_faction]&gt;&gt;
		
		&lt;div id=&quot;playerSpaceBetween&quot;&gt;&lt;/div&gt;
			&lt;&lt;print `
				&lt;div class = &quot;player&quot; id=&quot;`+$users[_userId][&#39;_faction&#39;]+`&quot;&gt;			
				&lt;img class = &quot;playerImage `+_factionColor[$users[_userId][&quot;faction&quot;]]+`&quot; src = &quot;`+_userSvgPicture[$users[_userId][&quot;character&quot;]]+`&quot;&gt; 
				&lt;div class=&quot;rolePanel&quot;&gt;
					&lt;img class=&quot;rolePanelImage `+_factionColor[$users[_userId][&quot;faction&quot;]]+`&quot; src = &quot;`+_userSvgPicture[$users[_userId][&quot;character&quot;]]+`&quot;&gt; 
					&lt;div class=&quot;rolePanelText&quot;&gt;
						&lt;div class=&quot;rolePanelPrintUserRole&quot;&gt; 
							&lt;&lt;print $users[_userId][&quot;character&quot;]&gt;&gt;
						&lt;/div&gt;
						&lt;div class=&quot;rolePanelPrintUserName&quot;&gt;
							&lt;&lt;if $users[_userId][&quot;discriminator&quot;] == 0&gt;&gt;
								&lt;&lt;print &quot;@&quot; + $users[_userId][&quot;username&quot;]&gt;&gt;
							&lt;&lt;else&gt;&gt;
								&lt;&lt;print $users[_userId][&quot;username&quot;] + &quot;#&quot; + $users[_userId][&quot;discriminator&quot;]&gt;&gt;
							&lt;&lt;/if&gt;&gt;
						&lt;/div&gt;
					&lt;/div&gt;
					&lt;div class=&quot;rolePanelDetails&quot;&gt;
						&lt;ul&gt;
							&lt;&lt;print &quot;&lt;li&gt;&lt;b&gt;Last Active&lt;/b&gt;: &quot; + $users[_userId][&quot;lastSeen&quot;]+&quot;&lt;/li&gt;&quot;&gt;&gt;
							&lt;li&gt;Details
								&lt;ul&gt;
								&lt;li&gt;hardcoded detail 1&lt;/li&gt;
								&lt;li&gt;hardcoded detail 2&lt;/li&gt;
								&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
					&lt;/div&gt;
					&lt;div class=&quot;rolePanelNotes&quot;&gt;
						&lt;&lt;print &quot;&lt;b&gt;Notes&lt;/b&gt;: &quot;&gt;&gt;
					&lt;/div&gt;
				&lt;/div&gt;

				&lt;div class = &quot;playerText&quot;&gt;
					&lt;div class=&quot;printUserRole&quot;&gt; 
						`+$users[_userId][&quot;character&quot;]+`
					&lt;/div&gt;
					&lt;div class=&quot;printUserName&quot;&gt;
						&lt;a href=&quot;https://discordapp.com/users/`+_userId+`&quot;&gt;
							&lt;&lt;if $users[_userId][&quot;discriminator&quot;] == 0&gt;&gt;
								&lt;&lt;print &quot;@&quot; + $users[_userId][&quot;username&quot;]&gt;&gt;
							&lt;&lt;else&gt;&gt;
								&lt;&lt;print $users[_userId][&quot;username&quot;] + &quot;#&quot; + $users[_userId][&quot;discriminator&quot;]&gt;&gt;
							&lt;&lt;/if&gt;&gt;
						&lt;/a&gt;
					&lt;/div&gt;&lt;/div&gt; 

					

				&lt;/div&gt;
				`&gt;&gt;
				
			&lt;div id=&quot;playerSpaceBetween&quot;&gt;&lt;/div&gt;
			/* &lt;&lt;= setup.printTime($users[_userId][&quot;lastSeen&quot;])&gt;&gt; */
		&lt;&lt;/for&gt;&gt;
			&lt;div id=&quot;factionSpaceBetween&quot;&gt;&lt;/div&gt;
	&lt;&lt;/for&gt;&gt;
	&lt;/div&gt;

	


&lt;&lt;/theyr&gt;&gt;


/* Use this as a template to make side passages */</tw-passagedata><tw-passagedata pid="318" name="Side Passage Example" tags="Done Breaks" position="338,1151" size="100,100">&lt;&lt;theyr&gt;&gt;
	Side passage example 1
	/* Put link to next passage  */
	 &lt;&lt;link &quot;Next passage (2)&quot; &quot;Side Passage Example 2&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
	 
&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="319" name="Side Passage Example 2" tags="Done Breaks" position="338,1151" size="100,100">&lt;&lt;theyr&gt;&gt;
	Side passage example 2
	/* Put link to next passage  */
	&lt;&lt;link &quot;Next passage (final)&quot; &quot;Side Passage Example Final&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;/theyr&gt;&gt;</tw-passagedata><tw-passagedata pid="320" name="Side Passage Example Final" tags="Done Breaks" position="338,1151" size="100,100">&lt;&lt;theyr&gt;&gt;
	Side passage example Final
	&lt;&lt;print $users[$userId][&quot;sidePassageReturn&quot;]&gt;&gt;
	
	/* Put this link line at the end of every side passage series */
	&lt;&lt;link &quot;Back to main passage&quot; $users[$userId][&quot;sidePassageReturn&quot;]&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;/theyr&gt;&gt;


/* Use this to send users to side passages */</tw-passagedata><tw-passagedata pid="321" name="Side Passage Control" tags="Done Breaks" position="338,1151" size="100,100">&lt;&lt;theyr&gt;&gt;
	&lt;&lt;storeSet _role = &quot;Aztec_Priest&quot;&gt;&gt;
	&lt;&lt;storeSet _passage = &quot;Side Passage Control&quot;&gt;&gt;

	/* Add the starting passage of every side passge to this  */
	&lt;&lt;storeSet _sidePassages = {
		&quot;example&quot;: &quot;Side Passage Example&quot;
	}&gt;&gt;


	&lt;&lt;listbox &quot;_role&quot; autoselect&gt;&gt;
		&lt;&lt;optionsfrom Object.keys($lookup)&gt;&gt;
	
	&lt;&lt;/listbox&gt;&gt;
	&lt;&lt;listbox &quot;_passage&quot; autoselect&gt;&gt;
		&lt;&lt;optionsfrom _sidePassages&gt;&gt;
		
	&lt;&lt;/listbox&gt;&gt;
	&lt;&lt;button &quot;send&quot;&gt;&gt;
		&lt;&lt;storeSet _user = $users[$lookup[_role]]&gt;&gt;
		&lt;&lt;storeSet _user[&quot;sidePassageReturn&quot;] = _user[&quot;passage&quot;]&gt;&gt;
		&lt;&lt;storeSet _user[&quot;passage&quot;] = _passage&gt;&gt;
	&lt;&lt;/button&gt;&gt;
&lt;&lt;/theyr&gt;&gt;</tw-passagedata></tw-storydata>
	<script id="script-sugarcube" type="text/javascript">
	/*! SugarCube JS */
	if(document.documentElement.getAttribute("data-init")==="loading"){(function(window,document,jQuery,undefined){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var errorPrologRegExp=/^(?:(?:uncaught\s+(?:exception:\s+)?)?\w*(?:error|exception|_err):\s+)+/i,Alert=function(){function mesg(where,error,isFatal,isUncaught){var mesg="Error",nice="A".concat(isFatal?" fatal":"n"," error has occurred.");nice+=isFatal?" Aborting.":" You may be able to continue, but some parts may not work properly.";var isObject=null!==error&&"object"===_typeof(error),what=(isObject&&"message"in error?String(error.message).replace(errorPrologRegExp,""):String(error)).trim()||"unknown error";null!=where&&(mesg+=" [".concat(where,"]")),mesg+=": ".concat(what,"."),isObject&&"stack"in error&&(mesg+="\n\nStack Trace:\n".concat(error.stack)),mesg&&(nice+="\n\n".concat(mesg)),isUncaught||console[isFatal?"error":"warn"](mesg),window.alert(nice)}var origOnError;return origOnError=window.onerror,window.onerror=function(what,source,lineNum,colNum,error){"complete"===document.readyState?mesg(null,null!=error?error:what,!1,!0):(mesg(null,null!=error?error:what,!0,!0),window.onerror=origOnError,"function"==typeof window.onerror&&window.onerror.apply(this,arguments))},Object.preventExtensions(Object.create(null,{error:{value:function(where,error){mesg(where,error)}},fatal:{value:function(where,error){mesg(where,error,!0)}}}))}(),Patterns=(wsMap=new Map([[" ","\\u0020"],["\f","\\f"],["\n","\\n"],["\r","\\r"],["\t","\\t"],["\v","\\v"],[" ","\\u00a0"],[" ","\\u1680"],["᠎","\\u180e"],[" ","\\u2000"],[" ","\\u2001"],[" ","\\u2002"],[" ","\\u2003"],[" ","\\u2004"],[" ","\\u2005"],[" ","\\u2006"],[" ","\\u2007"],[" ","\\u2008"],[" ","\\u2009"],[" ","\\u200a"],["\u2028","\\u2028"],["\u2029","\\u2029"],[" ","\\u202f"],[" ","\\u205f"],["　","\\u3000"],["\ufeff","\\ufeff"]]),wsRe=/^\s$/,missing="",wsMap.forEach((function(pat,char){wsRe.test(char)||(missing+=pat)})),space=missing?"[\\s".concat(missing,"]"):"\\s",spaceNoTerminator="[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]",notSpace="\\s"===space?"\\S":space.replace(/^\[/,"[^"),anyChar="(?:.|".concat("[\\n\\r\\u2028\\u2029]",")"),anyLetter="[0-9A-Z_a-z\\-\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u00ff\\u0150\\u0170\\u0151\\u0171]",anyLetterStrict=anyLetter.replace("\\-",""),identifier="".concat("[$A-Z_a-z]").concat("[$0-9A-Z_a-z]","*"),variable="[$_]"+identifier,htmlTagName="[A-Za-z](?:".concat(cENChar="(?:[\\x2D.0-9A-Z_a-z\\xB7\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u037D\\u037F-\\u1FFF\\u200C\\u200D\\u203F\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]|[\\uD800-\\uDB7F][\\uDC00-\\uDFFF])","*-").concat(cENChar,"*|[0-9A-Za-z]*)"),twStyle="(".concat(anyLetter,"+)\\(([^\\)\\|\\n]+)\\):"),cssStyle="".concat(spaceNoTerminator,"*(").concat(anyLetter,"+)").concat(spaceNoTerminator,"*:([^;\\|\\n]+);"),idOrClass="".concat(spaceNoTerminator,"*((?:").concat("[#.]").concat(anyLetter,"+").concat(spaceNoTerminator,"*)+);"),inlineCss="".concat(twStyle,"|").concat(cssStyle,"|").concat(idOrClass),url="(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+",externalUrl=url.replace(/\|javascript|\|data/g,""),Object.freeze(Object.assign(Object.create(null),{space:space,spaceNoTerminator:spaceNoTerminator,lineTerminator:"[\\n\\r\\u2028\\u2029]",notSpace:notSpace,anyChar:anyChar,anyLetter:anyLetter,anyLetterStrict:anyLetterStrict,identifierFirstChar:"[$A-Z_a-z]",identifierNextChar:"[$0-9A-Z_a-z]",identifier:identifier,variableSigil:"[$_]",variable:variable,macroName:"[A-Za-z][\\w-]*|[=-]",templateName:"[A-Za-z][\\w-]*",htmlTagName:htmlTagName,cssIdOrClassSigil:"[#.]",cssImage:"\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+",inlineCss:inlineCss,url:url,externalUrl:externalUrl}))),wsMap,wsRe,missing,cENChar,twStyle,cssStyle,idOrClass,space,spaceNoTerminator,notSpace,anyChar,anyLetter,anyLetterStrict,identifier,variable,htmlTagName,inlineCss,url,externalUrl;!function(){var startWSRe,endWSRe,_trimString=(startWSRe=new RegExp("^".concat(Patterns.space).concat(Patterns.space,"*")),endWSRe=new RegExp("".concat(Patterns.space).concat(Patterns.space,"*$")),function(str,where){var val=String(str);if(!val)return val;switch(where){case"start":return startWSRe.test(val)?val.replace(startWSRe,""):val;case"end":return endWSRe.test(val)?val.replace(endWSRe,""):val;default:throw new Error('_trimString called with incorrect where parameter value: "'.concat(where,'"'))}});function _createPadString(length,padding){var targetLength=Number.parseInt(length,10)||0;if(targetLength<1)return"";var padString=void 0===padding?"":String(padding);for(""===padString&&(padString=" ");padString.length<targetLength;){var curPadLength=padString.length,remainingLength=targetLength-curPadLength;padString+=curPadLength>remainingLength?padString.slice(0,remainingLength):padString}return padString.length>targetLength&&(padString=padString.slice(0,targetLength)),padString}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,writable:!0,value:function flat(){if(null==this)throw new TypeError("Array.prototype.flat called on null or undefined");var depth=0===arguments.length?1:Number(arguments[0])||0;return depth<1?Array.prototype.slice.call(this):Array.prototype.reduce.call(this,(function(acc,cur){return cur instanceof Array?acc.push.apply(acc,_toConsumableArray(flat.call(cur,depth-1))):acc.push(cur),acc}),[])}}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatMap called on null or undefined");return Array.prototype.map.apply(this,arguments).flat()}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");if(0===arguments.length)return!1;var length=this.length>>>0;if(0===length)return!1;var needle=arguments[0],i=Number(arguments[1])||0;for(i<0&&(i=Math.max(0,length+i));i<length;++i){var value=this[i];if(value===needle||value!=value&&needle!=needle)return!0}return!1}}),Object.entries||Object.defineProperty(Object,"entries",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.entries object parameter must be an object");return Object.keys(obj).map((function(key){return[key,obj[key]]}))}}),Object.fromEntries||Object.defineProperty(Object,"fromEntries",{configurable:!0,writable:!0,value:function(iter){return Array.from(iter).reduce((function(acc,pair){if(Object(pair)!==pair)throw new TypeError("Object.fromEntries iterable parameter must yield objects");return pair[0]in acc?Object.defineProperty(acc,pair[0],{configurable:!0,enumerable:!0,writable:!0,value:pair[1]}):acc[pair[0]]=pair[1],acc}),{})}}),Object.getOwnPropertyDescriptors||Object.defineProperty(Object,"getOwnPropertyDescriptors",{configurable:!0,writable:!0,value:function(obj){if(null==obj)throw new TypeError("Object.getOwnPropertyDescriptors object parameter is null or undefined");var O=Object(obj);return Reflect.ownKeys(O).reduce((function(acc,key){var desc=Object.getOwnPropertyDescriptor(O,key);return void 0!==desc&&(key in acc?Object.defineProperty(acc,key,{configurable:!0,enumerable:!0,writable:!0,value:desc}):acc[key]=desc),acc}),{})}}),Object.values||Object.defineProperty(Object,"values",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.values object parameter must be an object");return Object.keys(obj).map((function(key){return obj[key]}))}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padStart called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:_createPadString(targetLength-baseLength,padding)+baseString}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padEnd called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:baseString+_createPadString(targetLength-baseLength,padding)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimStart called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,"trimLeft",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimLeft called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimEnd called on null or undefined");return _trimString(this,"end")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,"trimRight",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimRight called on null or undefined");return _trimString(this,"end")}})}(),function(){var _nativeMathRandom=Math.random,_regExpMetaCharsRe,_hasRegExpMetaCharsRe,_formatRegExp,_hasFormatRegExp;function _random(){var min,max;switch(arguments.length){case 0:throw new Error("_random called with insufficient parameters");case 1:min=0,max=arguments[0];break;default:min=arguments[0],max=arguments[1]}if(min>max){var _ref=[max,min];min=_ref[0],max=_ref[1]}return Math.floor(_nativeMathRandom()*(max-min+1))+min}function _randomIndex(length,boundsArgs){var min,max;switch(boundsArgs.length){case 1:min=0,max=length-1;break;case 2:min=0,max=Math.trunc(boundsArgs[1]);break;default:min=Math.trunc(boundsArgs[1]),max=Math.trunc(boundsArgs[2])}return Number.isNaN(min)?min=0:!Number.isFinite(min)||min>=length?min=length-1:min<0&&(min=length+min)<0&&(min=0),Number.isNaN(max)?max=0:(!Number.isFinite(max)||max>=length||max<0&&(max=length+max)<0)&&(max=length-1),_random(min,max)}function _getCodePointStartAndEnd(str,pos){var code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};if(code<55296||code>57343)return{char:str.charAt(pos),start:pos,end:pos};if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)throw new Error("high surrogate without trailing low surrogate");var nextCode=str.charCodeAt(nextPos);if(nextCode<56320||nextCode>57343)throw new Error("high surrogate without trailing low surrogate");return{char:str.charAt(pos)+str.charAt(nextPos),start:pos,end:nextPos}}if(0===pos)throw new Error("low surrogate without leading high surrogate");var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);if(prevCode<55296||prevCode>56319)throw new Error("low surrogate without leading high surrogate");return{char:str.charAt(prevPos)+str.charAt(pos),start:prevPos,end:pos}}Object.defineProperty(Array,"random",{configurable:!0,writable:!0,value:function(array){if("object"!==_typeof(array)||null===array||!Object.prototype.hasOwnProperty.call(array,"length"))throw new TypeError("Array.random array parameter must be an array or array-lke object");var length=array.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments,1));return array[index]}}}),Object.defineProperty(Array.prototype,"concatUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.concatUnique called on null or undefined");var result=Array.from(this);if(0===arguments.length)return result;var items=Array.prototype.reduce.call(arguments,(function(prev,cur){return prev.concat(cur)}),[]),addSize=items.length;if(0===addSize)return result;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=items[i];-1===indexOf.call(result,value)&&push.call(result,value)}return result}}),Object.defineProperty(Array.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.count called on null or undefined");for(var indexOf=Array.prototype.indexOf,needle=arguments[0],pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,++pos;return count}}),Object.defineProperty(Array.prototype,"countWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.countWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.countWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return 0;for(var count=0,i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&++count;return count}}),Object.defineProperty(Array.prototype,"delete",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.delete called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var needles=Array.prototype.concat.apply([],arguments),needlesLength=needles.length,indices=[],i=0;i<length;++i)for(var value=this[i],j=0;j<needlesLength;++j){var needle=needles[j];if(value===needle||value!=value&&needle!=needle){indices.push(i);break}}for(var result=[],_i=0,iend=indices.length;_i<iend;++_i)result[_i]=this[indices[_i]];for(var splice=Array.prototype.splice,_i2=indices.length-1;_i2>=0;--_i2)splice.call(this,indices[_i2],1);return result}}),Object.defineProperty(Array.prototype,"deleteAt",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.deleteAt called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,cpyIndices=_toConsumableArray(new Set(Array.prototype.concat.apply([],arguments).map((function(x){return x<0?Math.max(0,length+x):x}))).values()),delIndices=_toConsumableArray(cpyIndices).sort((function(a,b){return b-a})),result=[],i=0,iend=cpyIndices.length;i<iend;++i)result[i]=this[cpyIndices[i]];for(var _i3=0,_iend=delIndices.length;_i3<_iend;++_i3)splice.call(this,delIndices[_i3],1);return result}}),Object.defineProperty(Array.prototype,"deleteWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.deleteWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.deleteWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,indices=[],result=[],i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&(result.push(this[i]),indices.push(i));for(var _i4=indices.length-1;_i4>=0;--_i4)splice.call(this,indices[_i4],1);return result}}),Object.defineProperty(Array.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.first called on null or undefined");if(0!==this.length>>>0)return this[0]}}),Object.defineProperty(Array.prototype,"includesAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAll called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(!Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!1;return!0}}),Object.defineProperty(Array.prototype,"includesAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAny called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!0;return!1}}),Object.defineProperty(Array.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.last called on null or undefined");var length=this.length>>>0;if(0!==length)return this[length-1]}}),Object.defineProperty(Array.prototype,"pluck",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pluck called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return Array.prototype.splice.call(this,index,1)[0]}}}),Object.defineProperty(Array.prototype,"pluckMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.pluckMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.pluckMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var splice=Array.prototype.splice,result=[],max=length-1;do{result.push(splice.call(this,_random(0,max--),1)[0])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"pushUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pushUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&push.call(this,value)}return this.length>>>0}}),Object.defineProperty(Array.prototype,"random",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.random called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return this[index]}}}),Object.defineProperty(Array.prototype,"randomMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.randomMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.randomMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var picked=new Map,result=[],max=length-1;do{var i=void 0;do{i=_random(0,max)}while(picked.has(i));picked.set(i,!0),result.push(this[i])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"shuffle",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.shuffle called on null or undefined");var length=this.length>>>0;if(0===length)return this;for(var i=length-1;i>0;--i){var j=Math.floor(_nativeMathRandom()*(i+1));if(i!==j){var swap=this[i];this[i]=this[j],this[j]=swap}}return this}}),Object.defineProperty(Array.prototype,"unshiftUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.unshiftUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,unshift=Array.prototype.unshift,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&unshift.call(this,value)}return this.length>>>0}}),Object.defineProperty(Function.prototype,"partial",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Function.prototype.partial called on null or undefined");var slice=Array.prototype.slice,fn=this,bound=slice.call(arguments,0);return function(){for(var applied=[],argc=0,i=0;i<bound.length;++i)applied.push(bound[i]===undefined?arguments[argc++]:bound[i]);return fn.apply(this,applied.concat(slice.call(arguments,argc)))}}}),Object.defineProperty(Math,"clamp",{configurable:!0,writable:!0,value:function(num,min,max){var value=Number(num);return Number.isNaN(value)?NaN:value.clamp(min,max)}}),Object.defineProperty(Math,"easeInOut",{configurable:!0,writable:!0,value:function(num){return 1-(Math.cos(Number(num)*Math.PI)+1)/2}}),Object.defineProperty(Number.prototype,"clamp",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Number.prototype.clamp called on null or undefined");if(2!==arguments.length)throw new Error("Number.prototype.clamp called with an incorrect number of parameters");var min=Number(arguments[0]),max=Number(arguments[1]);if(min>max){var _ref2=[max,min];min=_ref2[0],max=_ref2[1]}return Math.min(Math.max(this,min),max)}}),RegExp.escape||(_regExpMetaCharsRe=/[\\^$*+?.()|[\]{}]/g,_hasRegExpMetaCharsRe=new RegExp(_regExpMetaCharsRe.source),Object.defineProperty(RegExp,"escape",{configurable:!0,writable:!0,value:function(str){var val=String(str);return val&&_hasRegExpMetaCharsRe.test(val)?val.replace(_regExpMetaCharsRe,"\\$&"):val}})),_formatRegExp=/{(\d+)(?:,([+-]?\d+))?}/g,_hasFormatRegExp=new RegExp(_formatRegExp.source),Object.defineProperty(String,"format",{configurable:!0,writable:!0,value:function(format){function padString(str,align,pad){if(!align)return str;var plen=Math.abs(align)-str.length;if(plen<1)return str;var padding=String(pad).repeat(plen);return align<0?str+padding:padding+str}if(arguments.length<2)return 0===arguments.length?"":format;var args=2===arguments.length&&Array.isArray(arguments[1])?_toConsumableArray(arguments[1]):Array.prototype.slice.call(arguments,1);return 0===args.length?format:_hasFormatRegExp.test(format)?(_formatRegExp.lastIndex=0,format.replace(_formatRegExp,(function(match,index,align){var retval=args[index];if(null==retval)return"";for(;"function"==typeof retval;)retval=retval();switch(_typeof(retval)){case"string":break;case"object":retval=JSON.stringify(retval);break;default:retval=String(retval)}return padString(retval,align?Number.parseInt(align,10):0," ")}))):format}}),Object.defineProperty(String.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.contains called on null or undefined");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.count called on null or undefined");var needle=String(arguments[0]||"");if(""===needle)return 0;for(var indexOf=String.prototype.indexOf,step=needle.length,pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,pos+=step;return count}}),Object.defineProperty(String.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.first called on null or undefined");return _getCodePointStartAndEnd(String(this),0).char}}),Object.defineProperty(String.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.last called on null or undefined");var str=String(this);return _getCodePointStartAndEnd(str,str.length-1).char}}),Object.defineProperty(String.prototype,"splice",{configurable:!0,writable:!0,value:function(startAt,delCount,replacement){if(null==this)throw new TypeError("String.prototype.splice called on null or undefined");var length=this.length>>>0;if(0===length)return"";var start=Number(startAt);Number.isSafeInteger(start)?start<0&&(start+=length)<0&&(start=0):start=0,start>length&&(start=length);var count=Number(delCount);(!Number.isSafeInteger(count)||count<0)&&(count=0);var res=this.slice(0,start);return void 0!==replacement&&(res+=replacement),start+count<length&&(res+=this.slice(start+count)),res}}),Object.defineProperty(String.prototype,"splitOrEmpty",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.splitOrEmpty called on null or undefined");return""===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,"toLocaleUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toLocaleUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd3=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd3.char,end=_getCodePointStartAnd3.end;return-1===end?"":char.toLocaleUpperCase()+str.slice(end+1)}}),Object.defineProperty(String.prototype,"toUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd4=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd4.char,end=_getCodePointStartAnd4.end;return-1===end?"":char.toUpperCase()+str.slice(end+1)}}),Object.defineProperty(Date.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:date)",this.toISOString()]}}),Object.defineProperty(Function.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)","(".concat(this.toString(),")")]}}),Object.defineProperty(Map.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:map)",_toConsumableArray(this)]}}),Object.defineProperty(RegExp.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)",this.toString()]}}),Object.defineProperty(Set.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:set)",_toConsumableArray(this)]}}),Object.defineProperty(JSON,"reviveWrapper",{configurable:!0,writable:!0,value:function(code,data){if("string"!=typeof code)throw new TypeError("JSON.reviveWrapper code parameter must be a string");return["(revive:eval)",[code,data]]}}),Object.defineProperty(JSON,"_real_stringify",{value:JSON.stringify}),Object.defineProperty(JSON,"stringify",{configurable:!0,writable:!0,value:function(_value,replacer,space){return JSON._real_stringify(_value,(function(key,val){var value=val;if("function"==typeof replacer)try{value=replacer(key,value)}catch(ex){}return void 0===value&&(value=["(revive:eval)","undefined"]),value}),space)}}),Object.defineProperty(JSON,"_real_parse",{value:JSON.parse}),Object.defineProperty(JSON,"parse",{configurable:!0,writable:!0,value:function value(text,reviver){return JSON._real_parse(text,(function(key,val){var value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case"(revive:set)":value=new Set(value[1]);break;case"(revive:map)":value=new Map(value[1]);break;case"(revive:date)":value=new Date(value[1]);break;case"(revive:eval)":try{if(Array.isArray(value[1])){var $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(ex){}}else if("string"==typeof value&&"@@revive@@"===value.slice(0,10))try{value=eval(value.slice(10))}catch(ex){}if("function"==typeof reviver)try{value=reviver(key,value)}catch(ex){}return value}))}}),Object.defineProperty(Array.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.contains called on null or undefined");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAll called on null or undefined");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAny called on null or undefined");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"flatten",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatten called on null or undefined");return Array.prototype.flat.call(this,1/0)}}),Object.defineProperty(String.prototype,"readBracketedList",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.readBracketedList called on null or undefined");for(var match,re=new RegExp("(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)","gm"),names=[];null!==(match=re.exec(this));)match[1]?names.push(match[1]):match[2]&&names.push(match[2]);return names}})}();var Browser=(userAgent=navigator.userAgent.toLowerCase(),winPhone=userAgent.includes("windows phone"),isMobile=Object.freeze({Android:!winPhone&&userAgent.includes("android"),BlackBerry:/blackberry|bb10/.test(userAgent),iOS:!winPhone&&/ip(?:hone|ad|od)/.test(userAgent),Opera:!winPhone&&("object"===_typeof(window.operamini)||userAgent.includes("opera mini")),Windows:winPhone||/iemobile|wpdesktop/.test(userAgent),any:function(){return isMobile.Android||isMobile.BlackBerry||isMobile.iOS||isMobile.Opera||isMobile.Windows}}),isGecko=!isMobile.Windows&&!/khtml|trident|edge/.test(userAgent)&&userAgent.includes("gecko"),isIE=!userAgent.includes("opera")&&/msie|trident/.test(userAgent),ieVersion=isIE?(ver=/(?:msie\s+|rv:)(\d+\.\d)/.exec(userAgent))?Number(ver[1]):0:null,isOpera=userAgent.includes("opera")||userAgent.includes(" opr/"),operaVersion=isOpera?function(){var ver=new RegExp("".concat(/khtml|chrome/.test(userAgent)?"opr":"version","\\/(\\d+\\.\\d+)")).exec(userAgent);return ver?Number(ver[1]):0}():null,isVivaldi=userAgent.includes("vivaldi"),Object.freeze(Object.assign(Object.create(null),{userAgent:userAgent,isMobile:isMobile,isGecko:isGecko,isIE:isIE,ieVersion:ieVersion,isOpera:isOpera,operaVersion:operaVersion,isVivaldi:isVivaldi}))),ver,userAgent,winPhone,isMobile,isGecko,isIE,ieVersion,isOpera,operaVersion,isVivaldi,Has=(hasAudioElement=function(){try{return"function"==typeof document.createElement("audio").canPlayType}catch(ex){}return!1}(),hasFile=function(){try{return"Blob"in window&&"File"in window&&"FileList"in window&&"FileReader"in window&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(ex){}return!1}(),hasGeolocation=function(){try{return"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition}catch(ex){}return!1}(),hasMutationObserver=function(){try{return"MutationObserver"in window&&"function"==typeof window.MutationObserver}catch(ex){}return!1}(),hasPerformance=function(){try{return"performance"in window&&"function"==typeof window.performance.now}catch(ex){}return!1}(),hasTouch=function(){try{return"ontouchstart"in window||!!window.DocumentTouch&&document instanceof window.DocumentTouch||!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints}catch(ex){}return!1}(),hasTransitionEndEvent=function(){try{for(var teMap=new Map([["transition","transitionend"],["MSTransition","msTransitionEnd"],["WebkitTransition","webkitTransitionEnd"],["MozTransition","transitionend"]]),teKeys=_toConsumableArray(teMap.keys()),el=document.createElement("div"),i=0;i<teKeys.length;++i)if(el.style[teKeys[i]]!==undefined)return teMap.get(teKeys[i])}catch(ex){}return!1}(),Object.freeze(Object.assign(Object.create(null),{audio:hasAudioElement,fileAPI:hasFile,geolocation:hasGeolocation,mutationObserver:hasMutationObserver,performance:hasPerformance,touch:hasTouch,transitionEndEvent:hasTransitionEndEvent}))),hasAudioElement,hasFile,hasGeolocation,hasMutationObserver,hasPerformance,hasTouch,hasTransitionEndEvent,Outliner=function(){var lastEvent,styleEl=null;function outlinerHide(){document.documentElement.removeAttribute("data-outlines"),styleEl.styleSheet?styleEl.styleSheet.cssText="*:focus{outline:none;}":styleEl.textContent="*:focus{outline:none;}"}function outlinerShow(){document.documentElement.setAttribute("data-outlines",""),styleEl.styleSheet?styleEl.styleSheet.cssText="":styleEl.textContent=""}return Object.preventExtensions(Object.create(null,{init:{value:function(){styleEl||(styleEl=document.createElement("style"),jQuery(styleEl).attr({id:"style-outliner",type:"text/css"}).appendTo(document.head),jQuery(document).on("mousedown.style-outliner keydown.style-outliner",(function(ev){ev.type!==lastEvent&&(lastEvent=ev.type,"keydown"===ev.type?outlinerShow():outlinerHide())})),lastEvent="mousedown",outlinerHide())}},hide:{value:outlinerHide},show:{value:outlinerShow}}))}(),Visibility=(vendor=function(){try{return Object.freeze([{hiddenProperty:"hidden",stateProperty:"visibilityState",changeEvent:"visibilitychange"},{hiddenProperty:"webkitHidden",stateProperty:"webkitVisibilityState",changeEvent:"webkitvisibilitychange"},{hiddenProperty:"mozHidden",stateProperty:"mozVisibilityState",changeEvent:"mozvisibilitychange"},{hiddenProperty:"msHidden",stateProperty:"msVisibilityState",changeEvent:"msvisibilitychange"}].find((function(vnd){return vnd.hiddenProperty in document})))}catch(ex){}return undefined}(),Object.preventExtensions(Object.create(null,{vendor:{get:function(){return vendor}},state:{get:function(){return vendor&&document[vendor.stateProperty]||"visible"}},isEnabled:{value:function(){return Boolean(vendor)}},isHidden:{value:function(){return Boolean(vendor&&document[vendor.hiddenProperty])}},hiddenProperty:{value:vendor&&vendor.hiddenProperty},stateProperty:{value:vendor&&vendor.stateProperty},changeEvent:{value:vendor&&vendor.changeEvent}}))),vendor,Fullscreen=function(){var _hasPromise,vendor=function(){try{return Object.freeze([{isEnabled:"fullscreenEnabled",element:"fullscreenElement",requestFn:"requestFullscreen",exitFn:"exitFullscreen",changeEvent:"fullscreenchange",errorEvent:"fullscreenerror"},{isEnabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",requestFn:"webkitRequestFullscreen",exitFn:"webkitExitFullscreen",changeEvent:"webkitfullscreenchange",errorEvent:"webkitfullscreenerror"},{isEnabled:"mozFullScreenEnabled",element:"mozFullScreenElement",requestFn:"mozRequestFullScreen",exitFn:"mozCancelFullScreen",changeEvent:"mozfullscreenchange",errorEvent:"mozfullscreenerror"},{isEnabled:"msFullscreenEnabled",element:"msFullscreenElement",requestFn:"msRequestFullscreen",exitFn:"msExitFullscreen",changeEvent:"MSFullscreenChange",errorEvent:"MSFullscreenError"}].find((function(vnd){return vnd.isEnabled in document})))}catch(ex){}return undefined}(),_returnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,vendor)try{var value=document.exitFullscreen();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise});function _selectElement(requestedEl){var selectedEl=requestedEl||document.documentElement;return selectedEl===document.documentElement&&("msRequestFullscreen"===vendor.requestFn||Browser.isOpera&&Browser.operaVersion<15)&&(selectedEl=document.body),selectedEl}function isFullscreen(){return Boolean(vendor&&document[vendor.element])}function requestFullscreen(options,requestedEl){if(!vendor)return Promise.reject(new Error("fullscreen not supported"));var element=_selectElement(requestedEl);if("function"!=typeof element[vendor.requestFn])return Promise.reject(new Error("fullscreen not supported"));if(isFullscreen())return Promise.resolve();if(_returnsPromise())return element[vendor.requestFn](options);var namespace=".Fullscreen_requestFullscreen";return new Promise((function(resolve,reject){var $element=jQuery(element);$element.off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){$element.off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen request error")):resolve()})),element[vendor.requestFn](options)}))}function exitFullscreen(){if(!vendor||"function"!=typeof document[vendor.exitFn])return Promise.reject(new TypeError("fullscreen not supported"));if(!isFullscreen())return Promise.reject(new TypeError("fullscreen mode not active"));if(_returnsPromise())return document[vendor.exitFn]();var namespace=".Fullscreen_exitFullscreen";return new Promise((function(resolve,reject){var $document=jQuery(document);$document.off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){$document.off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen exit error")):resolve()})),document[vendor.exitFn]()}))}return Object.preventExtensions(Object.create(null,{vendor:{get:function(){return vendor}},element:{get:function(){return vendor?document[vendor.element]:null}},isEnabled:{value:function(){return Boolean(vendor&&document[vendor.isEnabled])}},isFullscreen:{value:isFullscreen},request:{value:requestFullscreen},exit:{value:exitFullscreen},toggle:{value:function(options,requestedEl){return isFullscreen()?exitFullscreen():requestFullscreen(options,requestedEl)}},onChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);jQuery(element).on(vendor.changeEvent,handlerFn)}}},offChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?jQuery(element).off(vendor.changeEvent,handlerFn):jQuery(element).off(vendor.changeEvent)}}},onError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);jQuery(element).on(vendor.errorEvent,handlerFn)}}},offError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?jQuery(element).off(vendor.errorEvent,handlerFn):jQuery(element).off(vendor.errorEvent)}}}}))}();function appendError(output,message,source){var $wrapper=jQuery(document.createElement("div")),$toggle=jQuery(document.createElement("button")),$source=jQuery(document.createElement("pre")),mesg="".concat(L10n.get("errorTitle"),": ").concat(message||"unknown error");return $toggle.addClass("error-toggle").ariaClick({label:L10n.get("errorToggle")},(function(){$toggle.hasClass("enabled")?($toggle.removeClass("enabled"),$source.attr({"aria-hidden":!0,hidden:"hidden"})):($toggle.addClass("enabled"),$source.removeAttr("aria-hidden hidden"))})).appendTo($wrapper),jQuery(document.createElement("span")).addClass("error").text(mesg).appendTo($wrapper),jQuery(document.createElement("code")).text(source).appendTo($source),$source.addClass("error-source").attr({"aria-hidden":!0,hidden:"hidden"}).appendTo($wrapper),$wrapper.addClass("error-view").appendTo(output),console.warn("".concat(mesg,"\n\t").concat(source.replace(/\n/g,"\n\t"))),!1}var throwError=appendError;function characterAndPosAt(text,position){var str=String(text),pos=Math.trunc(position),code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};var retval={char:str.charAt(pos),start:pos,end:pos};if(code<55296||code>57343)return retval;if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)return retval;var nextCode=str.charCodeAt(nextPos);return nextCode<56320||nextCode>57343||(retval.char=retval.char+str.charAt(nextPos),retval.end=nextPos),retval}if(0===pos)return retval;var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);return prevCode<55296||prevCode>56319||(retval.char=str.charAt(prevPos)+retval.char,retval.start=prevPos),retval}function clone(O){if("object"!==_typeof(O)||null===O)return O;if("function"==typeof O.clone)return O.clone(!0);var copy;if(O instanceof Array)copy=new Array(O.length);else if(O instanceof Date)copy=new Date(O.getTime());else if(O instanceof Map)copy=new Map,O.forEach((function(val,key){return copy.set(clone(key),clone(val))}));else if(O instanceof RegExp)(copy=new RegExp(O)).lastIndex=O.lastIndex;else if(O instanceof Set)copy=new Set,O.forEach((function(val){return copy.add(clone(val))}));else{var type=getTypeOf(O);if("Object"!==type)throw new TypeError("attempted to clone unsupported type: ".concat(type));copy=Object.create(Object.getPrototypeOf(O))}return Object.keys(O).forEach((function(P){return copy[P]=clone(O[P])})),copy}function convertBreaks(source){for(var node,output=document.createDocumentFragment(),para=document.createElement("p");null!==(node=source.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":if(null!==node.nextSibling&&node.nextSibling.nodeType===Node.ELEMENT_NODE&&"BR"===node.nextSibling.nodeName.toUpperCase()){source.removeChild(node.nextSibling),source.removeChild(node),output.appendChild(para),para=document.createElement("p");continue}if(!para.hasChildNodes()){source.removeChild(node);continue}break;case"DIV":convertBreaks(node);case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":para.hasChildNodes()&&(output.appendChild(para),para=document.createElement("p")),output.appendChild(node);continue}para.appendChild(node)}para.hasChildNodes()&&output.appendChild(para),source.appendChild(output)}var createFilename=(illegalCharsRE=/[\x00-\x1f"#$%&'*+,/:;<=>?\\^`|\x7f-\x9f]+/g,function(str){return String(str).trim().replace(illegalCharsRE,"")}),illegalCharsRE,createSlug=function(){var illegalCharsRE=/[\x00-\x20!-/:-@[-^`{-\x9f]+/g,isInvalidSlugRE=/^-*$/,storySigilRE=/^\$/,tempSigilRE=/^_/;return function(str){var base=String(str).trim(),legacy=base.replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase();return isInvalidSlugRE.test(legacy)?base.replace(storySigilRE,"").replace(tempSigilRE,"-").replace(illegalCharsRE,""):legacy}}();function cssPropToDOMProp(cssName){if(!cssName.includes("-"))switch(cssName){case"bgcolor":return"backgroundColor";case"float":return"cssFloat";default:return cssName}return("-ms-"===cssName.slice(0,4)?cssName.slice(1):cssName).split("-").map((function(part,i){return 0===i?part:part.toUpperFirst()})).join("")}var cssTimeToMS=(cssTimeRE=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/,function(cssTime){var match=cssTimeRE.exec(String(cssTime));if(null===match)throw new SyntaxError('invalid time value syntax: "'.concat(cssTime,'"'));var msec=Number(match[1]);if(1===match[2].length&&(msec*=1e3),Number.isNaN(msec)||!Number.isFinite(msec))throw new RangeError('invalid time value: "'.concat(cssTime,'"'));return msec}),cssTimeRE,decodeEntities=(escapedHtmlRE=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,hasEscapedHtmlRE=new RegExp(escapedHtmlRE.source,"i"),escapedHtmlTable=enumFrom({"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3c;":"<","&gt;":">","&#62;":">","&#x3e;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'","&#96;":"`","&#x60;":"`"}),function(str){if(null==str)return"";var val=String(str);return val&&hasEscapedHtmlRE.test(val)?val.replace(escapedHtmlRE,(function(entity){return escapedHtmlTable[entity.toLowerCase()]})):val}),escapedHtmlRE,hasEscapedHtmlRE,escapedHtmlTable,encodeEntities=(htmlCharsRE=/[&<>"'`]/g,hasHtmlCharsRE=new RegExp(htmlCharsRE.source),htmlCharsTable=enumFrom({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"}),function(str){if(null==str)return"";var val=String(str);return val&&hasHtmlCharsRE.test(val)?val.replace(htmlCharsRE,(function(ch){return htmlCharsTable[ch]})):val}),htmlCharsRE,hasHtmlCharsRE,htmlCharsTable,encodeMarkup=(markupCharsRE=/[!"#$&'*\-/<=>?@[\\\]^_`{|}~]/g,hasMarkupCharsRE=new RegExp(markupCharsRE.source),markupCharsTable=enumFrom({"!":"&#33;",'"':"&quot;","#":"&#35;",$:"&#36;","&":"&amp;","'":"&#39;","*":"&#42;","-":"&#45;","/":"&#47;","<":"&lt;","=":"&#61;",">":"&gt;","?":"&#63;","@":"&#64;","[":"&#91;","\\":"&#92;","]":"&#93;","^":"&#94;",_:"&#95;","`":"&#96;","{":"&#123;","|":"&#124;","}":"&#125;","~":"&#126;"}),function(str){if(null==str)return"";var val=String(str);return val&&hasMarkupCharsRE.test(val)?val.replace(markupCharsRE,(function(ch){return markupCharsTable[ch]})):val}),markupCharsRE,hasMarkupCharsRE,markupCharsTable;function enumFrom(O){var pEnum=Object.create(null);if(O instanceof Array)O.forEach((function(val,i){return pEnum[String(val)]=i}));else if(O instanceof Set)Array.from(O).forEach((function(val,i){return pEnum[String(val)]=i}));else if(O instanceof Map)O.forEach((function(val,key){return pEnum[String(key)]=val}));else{if(null===O||"object"!==_typeof(O)||Object.getPrototypeOf(O)!==Object.prototype)throw new TypeError("enumFrom object parameter must be an Array, Map, Set, or generic object");Object.assign(pEnum,O)}return Object.freeze(pEnum)}var exceptionFrom=(extraProps=Object.freeze(["code","data","result","stack","columnNumber","fileName","lineNumber","description","number"]),function(original,exceptionType,override){if(null===original||"object"!==_typeof(original))throw new Error("exceptionFrom original parameter must be an object");if("function"!=typeof exceptionType)throw new Error("exceptionFrom exceptionType parameter must be an error type constructor");var overrideType=_typeof(override);if("undefined"!==overrideType&&"string"!==overrideType&&"object"!==overrideType)throw new Error("exceptionFrom override parameter must be an object or string");var propValues=new Map;extraProps.forEach((function(name){void 0!==original[name]&&propValues.set(name,original[name])})),"string"===overrideType?propValues.set("message",override):"object"===overrideType&&null!==override&&Object.getOwnPropertyNames(override).forEach((function(name){void 0!==override[name]&&propValues.set(name,override[name])}));var ex=new exceptionType(propValues.get("message"));return propValues.delete("message"),propValues.forEach((function(value,name){void 0===ex[name]?Object.defineProperty(ex,name,{value:value,configurable:!0,writable:!0}):ex[name]=value})),ex}),extraProps;function getActiveElement(){try{return document.activeElement||null}catch(ex){return null}}function getErrorMessage(O){return"object"===_typeof(O)&&null!==O&&"message"in O?O.message:O}var getToStringTag=(toString=Object.prototype.toString,"[object Object]"===toString.call(new Map)?function(O){return O instanceof Map?"Map":O instanceof Set?"Set":toString.call(O).slice(8,-1)}:function(O){return toString.call(O).slice(8,-1)}),toString,getTypeOf=function(){var toString=Object.prototype.toString;return function(O){if(null===O)return"null";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType}}(),hasMediaQuery="function"!=typeof window.matchMedia?function(){return!1}:function(mediaQuery){return window.matchMedia(mediaQuery).matches},hasOwn=function(){if(Object.hasOwn)return Object.hasOwn;var hasOwnProperty=Object.prototype.hasOwnProperty;return function(O,P){if(null==O)throw new TypeError("object parameter may not be undefined or null");return hasOwnProperty.call(Object(O),P)}}(),isExternalLink=(externalUrlRE=new RegExp("^".concat(Patterns.externalUrl),"gim"),fingerprintRE=/[/\\?]/,function(link){return!Story.has(link)&&(externalUrlRE.test(link)||fingerprintRE.test(link))}),externalUrlRE,fingerprintRE,isIterable="function"!=typeof Symbol||"symbol"!==_typeof(Symbol.iterator)?function(){return!1}:function(O){return null!=O&&"function"==typeof O[Symbol.iterator]};function msToCSSTime(msec){if("number"!=typeof msec||Number.isNaN(msec)||!Number.isFinite(msec)){var what;switch(_typeof(msec)){case"string":what='"'.concat(msec,'"');break;case"number":what=String(msec);break;default:what=getTypeOf(msec)}throw new TypeError("invalid milliseconds value: ".concat(what))}return"".concat(msec,"ms")}var now=(clock=Has.performance?performance:Date,function(){return clock.now()}),clock;function parseURL(url){var parser=document.createElement("a"),searchParams=Object.create(null);parser.href=url,parser.search&&parser.search.replace(/^\?/,"").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach((function(query){var _query$split2=_slicedToArray(query.split("="),2),key=_query$split2[0],value=_query$split2[1];hasOwn(searchParams,key)?searchParams[key].push(value):searchParams[key]=[value]}));var pathname=parser.host&&"/"!==parser.pathname[0]?"/".concat(parser.pathname):parser.pathname;return Object.freeze(Object.assign(Object.create(null),{href:parser.href,protocol:parser.protocol,host:parser.host,hostname:parser.hostname,port:parser.port,path:"".concat(pathname).concat(parser.search),pathname:pathname,search:parser.search,searchParams:Object.freeze(searchParams),hash:parser.hash}))}function sameValueZero(a,b){return a===b||a!=a&&b!=b}var scrubEventKey=function(){var separatorKey,decimalKey;if("undefined"!=typeof Intl&&"function"==typeof Intl.NumberFormat){var match=(new Intl.NumberFormat).format(111111.5).match(/(\D*)\d+(\D*)/);match&&(separatorKey=match[1],decimalKey=match[2])}return separatorKey||decimalKey||(separatorKey=",",decimalKey="."),function(key){switch(key){case"Scroll":return"ScrollLock";case"Spacebar":return" ";case"Left":return"ArrowLeft";case"Right":return"ArrowRight";case"Up":return"ArrowUp";case"Down":return"ArrowDown";case"Del":return"Delete";case"Crsel":return"CrSel";case"Exsel":return"ExSel";case"Esc":return"Escape";case"Apps":return"ContextMenu";case"Nonconvert":return"NonConvert";case"MediaNextTrack":return"MediaTrackNext";case"MediaPreviousTrack":return"MediaTrackPrevious";case"VolumeUp":return"AudioVolumeUp";case"VolumeDown":return"AudioVolumeDown";case"VolumeMute":return"AudioVolumeMute";case"Zoom":return"ZoomToggle";case"SelectMedia":case"MediaSelect":return"LaunchMediaPlayer";case"Add":return"+";case"Divide":return"/";case"Multiply":return"*";case"Subtract":return"-";case"Decimal":return decimalKey;case"Separator":return separatorKey}return key}}(),setDisplayTitle=function(title,isPlainText){if("string"!=typeof title)throw new TypeError("title parameter must be a string (received: ".concat(getTypeOf(title),")"));var render,text;isPlainText?text=render=title.trim():(render=document.createDocumentFragment(),new Wikifier(render,title,{noCleanup:!0}),text=function(source){for(var node,copy=source.cloneNode(!0),frag=document.createDocumentFragment();null!==(node=copy.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":case"DIV":case"P":frag.appendChild(document.createTextNode(" "))}frag.appendChild(node)}return frag.textContent}(render).trim()),document.title=Config.passages.displayTitles&&""!==State.passage&&State.passage!==Config.passages.start?"".concat(State.passage," | ").concat(text):text,jQuery("#story-title").empty().append(render)};function setPageElement(idOrElement,titles,defaultText){var el="object"===_typeof(idOrElement)?idOrElement:document.getElementById(idOrElement);if(null==el)return null;var ids=titles instanceof Array?titles:[titles];jQuery(el).empty();for(var i=0,iend=ids.length;i<iend;++i)if(Story.has(ids[i]))return new Wikifier(el,Story.get(ids[i]).processText().trim()),el;if(null!=defaultText){var text=String(defaultText).trim();""!==text&&new Wikifier(el,text)}return el}function stringFrom(value){switch(_typeof(value)){case"function":return"[function]";case"number":if(Number.isNaN(value))return"[number NaN]";break;case"object":if(null===value)return"[null]";if(value instanceof Array)return value.map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Set)return Array.from(value).map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Map){var result=Array.from(value).map((function(_ref3){var _ref4=_slicedToArray(_ref3,2),key=_ref4[0],val=_ref4[1];return"".concat(stringFrom(key)," → ").concat(stringFrom(val))}));return"{ ".concat(result.join(", ")," }")}if(value instanceof Date)return value.toLocaleString();if(value instanceof Element){if(value===document.documentElement||value===document.head||value===document.body)throw new Error("illegal operation; attempting to convert the <html>, <head>, or <body> tags to string is not allowed");return value.outerHTML}if(value instanceof Node)return value.textContent;break;case"symbol":var desc=void 0!==value.description?' "'.concat(value.description,'"'):"";return"[symbol".concat(desc,"]");case"undefined":return"[undefined]"}return String(value)}!function(){function onKeypressFn(ev){13!==ev.which&&32!==ev.which||(ev.preventDefault(),jQuery(getActiveElement()||this).trigger("click"))}function onClickFnWrapper(fn){return function(){var $this=jQuery(this);$this.ariaIsDisabled()||($this.is("[aria-pressed]")&&$this.attr("aria-pressed","true"===$this.attr("aria-pressed")?"false":"true"),fn.apply(this,arguments))}}function oneClickFnWrapper(fn){return onClickFnWrapper((function(){jQuery(this).off(".aria-clickable").removeAttr("role tabindex aria-controls aria-pressed").filter("button").prop("disabled",!0),fn.apply(this,arguments)}))}jQuery.fn.extend({ariaClick:function(options,handler){if(0===this.length||0===arguments.length)return this;var opts=options,fn=handler;return null==fn&&(fn=opts,opts=undefined),"string"!=typeof(opts=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,role:undefined,controls:undefined,pressed:undefined,label:undefined},opts)).namespace?opts.namespace="":"."!==opts.namespace[0]&&(opts.namespace=".".concat(opts.namespace)),"boolean"==typeof opts.pressed&&(opts.pressed=opts.pressed?"true":"false"),this.filter("button").prop("type","button"),null!=opts.role?this.attr("role",opts.role):this.not("[role]").filter("a,[data-passage]").attr("role","link").end().not("a").not("[data-passage]").attr("role","button").end().end().end(),this.attr("tabindex",0),null!=opts.controls&&this.attr("aria-controls",opts.controls),null!=opts.pressed&&this.attr("aria-pressed",opts.pressed),null!=opts.label&&this.attr({"aria-label":opts.label,title:opts.label}),this.not("button").on("keypress.aria-clickable".concat(opts.namespace),opts.selector,onKeypressFn),this.on("click.aria-clickable".concat(opts.namespace),opts.selector,opts.data,opts.one?oneClickFnWrapper(fn):onClickFnWrapper(fn)),this},ariaDisabled:function(disable){if(0===this.length||0===arguments.length)return this;var $nonDisableable=this.not("button,fieldset,input,menuitem,optgroup,option,select,textarea"),$disableable=this.filter("button,fieldset,input,menuitem,optgroup,option,select,textarea");return disable?($nonDisableable.each((function(){this.setAttribute("disabled",""),this.setAttribute("aria-disabled","true")})),$disableable.each((function(){this.disabled=!0,this.setAttribute("aria-disabled","true")}))):($nonDisableable.each((function(){this.removeAttribute("disabled"),this.removeAttribute("aria-disabled")})),$disableable.each((function(){this.disabled=!1,this.removeAttribute("aria-disabled")}))),this},ariaIsDisabled:function(){return this.is("[disabled]")}})}(),jQuery.extend({wikiWithOptions:function(options){for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)sources[_key-1]=arguments[_key];if(0!==sources.length){var frag=document.createDocumentFragment();sources.forEach((function(content){return new Wikifier(frag,content,options)}));var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "))}},wiki:function(){for(var _len2=arguments.length,sources=new Array(_len2),_key2=0;_key2<_len2;_key2++)sources[_key2]=arguments[_key2];this.wikiWithOptions.apply(this,[undefined].concat(sources))}}),jQuery.fn.extend({wikiWithOptions:function(options){for(var _len3=arguments.length,sources=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)sources[_key3-1]=arguments[_key3];if(0===this.length||0===sources.length)return this;var frag=document.createDocumentFragment();return sources.forEach((function(content){return new Wikifier(frag,content,options)})),this.append(frag),this},wiki:function(){for(var _len4=arguments.length,sources=new Array(_len4),_key4=0;_key4<_len4;_key4++)sources[_key4]=arguments[_key4];return this.wikiWithOptions.apply(this,[undefined].concat(sources))}});var SimpleStore=(_adapters=[],_initialized=null,Object.preventExtensions(Object.create(null,{adapters:{value:_adapters},create:{value:function(storageId,persistent){if(_initialized)return _initialized.create(storageId,persistent);for(var i=0;i<_adapters.length;++i)if(_adapters[i].init(storageId,persistent))return(_initialized=_adapters[i]).create(storageId,persistent);throw new Error("no valid storage adapters found")}}}))),_adapters,_initialized,_ok,_WebStorageAdapter;SimpleStore.adapters.push((_ok=!1,_WebStorageAdapter=function(){function _WebStorageAdapter(storageId,persistent){_classCallCheck(this,_WebStorageAdapter);var prefix="".concat(storageId,"."),engine=null,name=null;persistent?(engine=window.localStorage,name="localStorage"):(engine=window.sessionStorage,name="sessionStorage"),Object.defineProperties(this,{_engine:{value:engine},_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:name},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_WebStorageAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){for(var keys=[],i=0;i<this._engine.length;++i){var key=this._engine.key(i);this._prefixRe.test(key)&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&this._engine.hasOwnProperty(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=this._engine.getItem(this._prefix+key);return null==value?null:_WebStorageAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{this._engine.setItem(this._prefix+key,_WebStorageAdapter._serialize(value))}catch(ex){if(/quota.?(?:exceeded|reached)/i.test(ex.name+ex.message))throw exceptionFrom(ex,Error,"".concat(this.name," quota exceeded"));throw ex}return!0}},{key:"delete",value:function(key){return!("string"!=typeof key||!key||(this._engine.removeItem(this._prefix+key),0))}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_serialize",value:function(obj){return LZString.compressToUTF16(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromUTF16(str))}}]),_WebStorageAdapter}(),Object.preventExtensions(Object.create(null,{init:{value:function(){function hasWebStorage(storeId){try{var store=window[storeId],tid="_sc_".concat(String(Date.now()));store.setItem(tid,tid);var result=store.getItem(tid)===tid;return store.removeItem(tid),result}catch(ex){}return!1}return _ok=hasWebStorage("localStorage")&&hasWebStorage("sessionStorage")}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _WebStorageAdapter(storageId,persistent)}}})))),SimpleStore.adapters.push(function(){var _MAX_EXPIRY="Tue, 19 Jan 2038 03:14:07 GMT",_MIN_EXPIRY="Thu, 01 Jan 1970 00:00:00 GMT",_ok=!1,_CookieAdapter=function(){function _CookieAdapter(storageId,persistent){_classCallCheck(this,_CookieAdapter);var prefix="".concat(storageId).concat(persistent?"!":"*",".");Object.defineProperties(this,{_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:"cookie"},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_CookieAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){if(""===document.cookie)return[];for(var cookies=document.cookie.split(/;\s*/),keys=[],i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(this._prefixRe.test(key))""!==decodeURIComponent(kvPair[1])&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&null!==_CookieAdapter._getCookie(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=_CookieAdapter._getCookie(this._prefix+key);return null===value?null:_CookieAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,_CookieAdapter._serialize(value),this.persistent?"Tue, 19 Jan 2038 03:14:07 GMT":undefined),!this.has(key))throw new Error("unknown validation error during set")}catch(ex){throw exceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"delete",value:function(key){if("string"!=typeof key||!key||!this.has(key))return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,undefined,_MIN_EXPIRY),this.has(key))throw new Error("unknown validation error during delete")}catch(ex){throw exceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_getCookie",value:function(prefixedKey){if(!prefixedKey||""===document.cookie)return null;for(var cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("=");if(prefixedKey===decodeURIComponent(kvPair[0]))return decodeURIComponent(kvPair[1])||null}return null}},{key:"_setCookie",value:function(prefixedKey,value,expiry){if(prefixedKey){var payload="".concat(encodeURIComponent(prefixedKey),"=");null!=value&&(payload+=encodeURIComponent(value)),null!=expiry&&(payload+="; expires=".concat(expiry)),payload+="; path=/",document.cookie=payload}}},{key:"_serialize",value:function(obj){return LZString.compressToBase64(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromBase64(str))}}]),_CookieAdapter}();return Object.preventExtensions(Object.create(null,{init:{value:function(storageId){try{var tid="_sc_".concat(String(Date.now()));_CookieAdapter._setCookie(tid,_CookieAdapter._serialize(tid),undefined),_ok=_CookieAdapter._deserialize(_CookieAdapter._getCookie(tid))===tid,_CookieAdapter._setCookie(tid,undefined,_MIN_EXPIRY)}catch(ex){_ok=!1}return _ok&&function(storageId){if(""===document.cookie)return;for(var oldPrefix="".concat(storageId,"."),oldPrefixRe=new RegExp("^".concat(RegExp.escape(oldPrefix))),persistPrefix="".concat(storageId,"!."),sessionPrefix="".concat(storageId,"*."),sessionTestRe=/\.(?:state|rcWarn)$/,cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(oldPrefixRe.test(key)){var value=decodeURIComponent(kvPair[1]);""!==value&&function(){var persist=!sessionTestRe.test(key);_CookieAdapter._setCookie(key,undefined,_MIN_EXPIRY),_CookieAdapter._setCookie(key.replace(oldPrefixRe,(function(){return persist?persistPrefix:sessionPrefix})),value,persist?_MAX_EXPIRY:undefined)}()}}}(storageId),_ok}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _CookieAdapter(storageId,persistent)}}}))}());var DebugView=function(){function DebugView(parent,type,name,title){_classCallCheck(this,DebugView),Object.defineProperties(this,{parent:{value:parent},view:{value:document.createElement("span")},break:{value:document.createElement("wbr")}}),jQuery(this.view).attr({title:title,"aria-label":title,"data-type":null!=type?type:"","data-name":null!=name?name:""}).addClass("debug"),jQuery(this.break).addClass("debug hidden"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}return _createClass(DebugView,[{key:"output",get:function(){return this.view}},{key:"type",get:function(){return this.view.getAttribute("data-type")},set:function(type){this.view.setAttribute("data-type",null!=type?type:"")}},{key:"name",get:function(){return this.view.getAttribute("data-name")},set:function(name){this.view.setAttribute("data-name",null!=name?name:"")}},{key:"title",get:function(){return this.view.title},set:function(title){this.view.title=title}},{key:"append",value:function(el){return jQuery(this.view).append(el),this}},{key:"modes",value:function(options){if(null==options){var current={};return this.view.className.splitOrEmpty(/\s+/).forEach((function(name){"debug"!==name&&(current[name]=!0)})),current}if("object"===_typeof(options))return Object.keys(options).forEach((function(name){this[options[name]?"addClass":"removeClass"](name)}),jQuery(this.view)),this;throw new Error("DebugView.prototype.modes options parameter must be an object or null/undefined")}},{key:"remove",value:function(){var $view=jQuery(this.view);this.view.hasChildNodes()&&$view.contents().appendTo(this.parent),$view.remove(),jQuery(this.break).remove()}}],[{key:"isEnabled",value:function(){return"enabled"===jQuery(document.documentElement).attr("data-debug-view")}},{key:"enable",value:function(){jQuery(document.documentElement).attr("data-debug-view","enabled"),jQuery.event.trigger(":debugviewupdate")}},{key:"disable",value:function(){jQuery(document.documentElement).removeAttr("data-debug-view"),jQuery.event.trigger(":debugviewupdate")}},{key:"toggle",value:function(){"enabled"===jQuery(document.documentElement).attr("data-debug-view")?DebugView.disable():DebugView.enable()}}]),DebugView}(),NodeTyper=function(){var NodeTyper=function(){function NodeTyper(config){if(_classCallCheck(this,NodeTyper),"object"!==_typeof(config)||null===config)throw new Error("config parameter must be an object (received: ".concat(getTypeOf(config),")"));if(!(config.hasOwnProperty("targetNode")&&config.targetNode instanceof Node))throw new Error('config parameter object "targetNode" property must be a node');Object.defineProperties(this,{node:{value:config.targetNode},childNodes:{value:[]},nodeValue:{writable:!0,value:""},appendTo:{writable:!0,value:config.parentNode||null},classNames:{writable:!0,value:config.classNames||null},finished:{writable:!0,value:!1}});var childNode,node=this.node;for(node.nodeValue&&(this.nodeValue=node.nodeValue,node.nodeValue="");null!==(childNode=node.firstChild);)this.childNodes.push(new NodeTyper({targetNode:childNode,parentNode:node,classNames:this.classNames})),node.removeChild(childNode)}return _createClass(NodeTyper,[{key:"finish",value:function(){for(;this.type(!0););return!1}},{key:"type",value:function(flush){if(this.finished)return!1;if(this.appendTo){if(this.appendTo.appendChild(this.node),this.appendTo=null,this.node.nodeType!==Node.ELEMENT_NODE&&this.node.nodeType!==Node.TEXT_NODE||"none"===jQuery(this.node.parentNode).css("display"))return this.finish();this.node.parentNode&&this.classNames&&jQuery(this.node.parentNode).addClass(this.classNames)}if(this.nodeValue){if(flush)this.node.nodeValue+=this.nodeValue,this.nodeValue="";else{var _characterAndPosAt=characterAndPosAt(this.nodeValue,0),char=_characterAndPosAt.char,start=_characterAndPosAt.start,end=_characterAndPosAt.end;this.node.nodeValue+=char,this.nodeValue=this.nodeValue.slice(1+end-start)}return!0}this.classNames&&(jQuery(this.node.parentNode).removeClass(this.classNames),this.classNames=null);for(var childNodes=this.childNodes;childNodes.length>0;){if(childNodes[0].type())return!0;childNodes.shift()}return this.finished=!0,!1}}]),NodeTyper}();return NodeTyper}(),PRNGWrapper=function(){function PRNGWrapper(seed,useEntropy){_classCallCheck(this,PRNGWrapper),Object.defineProperties(this,new Math.seedrandom(seed,useEntropy,(function(prng,seed){return{_prng:{value:prng},seed:{writable:!0,value:seed},pull:{writable:!0,value:0},random:{value:function(){return++this.pull,this._prng()}}}})))}return _createClass(PRNGWrapper,null,[{key:"marshal",value:function(prng){if(!prng||!prng.hasOwnProperty("seed")||!prng.hasOwnProperty("pull"))throw new Error("PRNG is missing required data");return{seed:prng.seed,pull:prng.pull}}},{key:"unmarshal",value:function(prngObj){if(!prngObj||!prngObj.hasOwnProperty("seed")||!prngObj.hasOwnProperty("pull"))throw new Error("PRNG object is missing required data");for(var prng=new PRNGWrapper(prngObj.seed,!1),i=prngObj.pull;i>0;--i)prng.random();return prng}}]),PRNGWrapper}(),StyleWrapper=(_imageMarkupRe=new RegExp(Patterns.cssImage,"g"),_hasImageMarkupRe=new RegExp(Patterns.cssImage),function(){function StyleWrapper(style){if(_classCallCheck(this,StyleWrapper),null==style)throw new TypeError("StyleWrapper style parameter must be an HTMLStyleElement object");Object.defineProperties(this,{style:{value:style}})}return _createClass(StyleWrapper,[{key:"isEmpty",value:function(){return 0===this.style.cssRules.length}},{key:"set",value:function(rawCss){this.clear(),this.add(rawCss)}},{key:"add",value:function(rawCss){var css=rawCss;_hasImageMarkupRe.test(css)&&(_imageMarkupRe.lastIndex=0,css=css.replace(_imageMarkupRe,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text.trim())}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),this.style.styleSheet?this.style.styleSheet.cssText+=css:this.style.appendChild(document.createTextNode(css))}},{key:"clear",value:function(){this.style.styleSheet?this.style.styleSheet.cssText="":jQuery(this.style).empty()}}]),StyleWrapper}()),_imageMarkupRe,_hasImageMarkupRe,Diff=function(){var Op=enumFrom({Delete:0,SpliceArray:1,Copy:2,CopyDate:3});function isNumeric(O){var num;switch(_typeof(O)){case"number":num=O;break;case"string":num=Number(O);break;default:return!1}return!Number.isNaN(num)&&Number.isFinite(num)}return Object.preventExtensions(Object.create(null,{Op:{value:Op},diff:{value:function diff(a,b){for(var aOpKey,toString=Object.prototype.toString,aIsArray=a instanceof Array,delta=Object.create(null),keys=[].concat(_toConsumableArray(Object.keys(a)),_toConsumableArray(Object.keys(b))).sort().filter((function(val,i,arr){return 0===i||arr[i-1]!==val})),isAOpKey=function(key){return key===aOpKey},i=0,klen=keys.length;i<klen;++i){var key=keys[i],aVal=a[key],bVal=b[key];if(hasOwn(a,key))if(hasOwn(b,key)){if(aVal===bVal)continue;if(_typeof(aVal)===_typeof(bVal))if("function"==typeof aVal)aVal.toString()!==bVal.toString()&&(delta[key]=[Op.Copy,bVal]);else if("object"!==_typeof(aVal)||null===aVal)delta[key]=[Op.Copy,bVal];else{var aValType=toString.call(aVal);if(aValType===toString.call(bVal))if(aVal instanceof Date)aVal.getTime()!==bVal.getTime()&&(delta[key]=[Op.Copy,clone(bVal)]);else if(aVal instanceof Map)delta[key]=[Op.Copy,clone(bVal)];else if(aVal instanceof RegExp)aVal.toString()!==bVal.toString()&&(delta[key]=[Op.Copy,clone(bVal)]);else if(aVal instanceof Set)delta[key]=[Op.Copy,clone(bVal)];else if(aVal instanceof Array||"[object Object]"===aValType){var subDelta=diff(aVal,bVal);null!==subDelta&&(delta[key]=subDelta)}else delta[key]=[Op.Copy,clone(bVal)];else delta[key]=[Op.Copy,clone(bVal)]}else delta[key]=[Op.Copy,"object"!==_typeof(bVal)||null===bVal?bVal:clone(bVal)]}else if(aIsArray&&isNumeric(key)){var idx=Number(key);if(!aOpKey){aOpKey="";do{aOpKey+="~"}while(keys.some(isAOpKey));delta[aOpKey]=[Op.SpliceArray,idx,idx]}idx<delta[aOpKey][1]&&(delta[aOpKey][1]=idx),idx>delta[aOpKey][2]&&(delta[aOpKey][2]=idx)}else delta[key]=Op.Delete;else delta[key]=[Op.Copy,"object"!==_typeof(bVal)||null===bVal?bVal:clone(bVal)]}return Object.keys(delta).length>0?delta:null}},patch:{value:function patch(orig,delta){for(var keys=delta?Object.keys(delta):[],patched=clone(orig),i=0,klen=keys.length;i<klen;++i){var key=keys[i],value=delta[key];if(value===Op.Delete)delete patched[key];else if(value instanceof Array)switch(value[0]){case Op.SpliceArray:patched.splice(value[1],value[2]-value[1]+1);break;case Op.Copy:patched[key]=clone(value[1]);break;case Op.CopyDate:patched[key]=new Date(value[1])}else patched[key]=patch(patched[key],value)}return patched}}}))}(),L10n=(_patternRe=/\{\w+\}/g,_hasPatternRe=new RegExp(_patternRe.source),Object.preventExtensions(Object.create(null,{init:{value:function(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach((function(id){try{var value;switch(id){case"identity":value=strings.identity;break;case"aborting":value=strings.aborting;break;case"cancel":value=strings.cancel;break;case"close":value=strings.close;break;case"ok":value=strings.ok;break;case"errorTitle":value=strings.errors.title;break;case"errorNonexistentPassage":value=strings.errors.nonexistentPassage;break;case"errorSaveMissingData":value=strings.errors.saveMissingData;break;case"errorSaveIdMismatch":value=strings.errors.saveIdMismatch;break;case"warningDegraded":value=strings.warnings.degraded;break;case"debugViewTitle":value=strings.debugView.title;break;case"debugViewToggle":value=strings.debugView.toggle;break;case"uiBarToggle":value=strings.uiBar.toggle;break;case"uiBarBackward":value=strings.uiBar.backward;break;case"uiBarForward":value=strings.uiBar.forward;break;case"uiBarJumpto":value=strings.uiBar.jumpto;break;case"jumptoTitle":value=strings.jumpto.title;break;case"jumptoTurn":value=strings.jumpto.turn;break;case"jumptoUnavailable":value=strings.jumpto.unavailable;break;case"savesTitle":value=strings.saves.title;break;case"savesDisallowed":value=strings.saves.disallowed;break;case"savesIncapable":value=strings.saves.incapable;break;case"savesLabelAuto":value=strings.saves.labelAuto;break;case"savesLabelDelete":value=strings.saves.labelDelete;break;case"savesLabelExport":value=strings.saves.labelExport;break;case"savesLabelImport":value=strings.saves.labelImport;break;case"savesLabelLoad":value=strings.saves.labelLoad;break;case"savesLabelClear":value=strings.saves.labelClear;break;case"savesLabelSave":value=strings.saves.labelSave;break;case"savesLabelSlot":value=strings.saves.labelSlot;break;case"savesUnavailable":value=strings.saves.unavailable;break;case"savesUnknownDate":value=strings.saves.unknownDate;break;case"settingsTitle":value=strings.settings.title;break;case"settingsOff":value=strings.settings.off;break;case"settingsOn":value=strings.settings.on;break;case"settingsReset":value=strings.settings.reset;break;case"restartTitle":value=strings.restart.title;break;case"restartPrompt":value=strings.restart.prompt;break;case"shareTitle":value=strings.share.title;break;case"alertTitle":break;case"autoloadTitle":value=strings.autoload.title;break;case"autoloadCancel":value=strings.autoload.cancel;break;case"autoloadOk":value=strings.autoload.ok;break;case"autoloadPrompt":value=strings.autoload.prompt;break;case"macroBackText":value=strings.macros.back.text;break;case"macroReturnText":value=strings.macros.return.text}value&&(l10nStrings[id]=value.replace(/%\w+%/g,(function(pat){return"{".concat(pat.slice(1,-1),"}")})))}catch(ex){}}))}},get:{value:function(ids,overrides){if(!ids)return"";var selectedId,id=((Array.isArray(ids)?ids:[ids]).some((function(id){return!!hasOwn(l10nStrings,id)&&(selectedId=id,!0)})),selectedId);if(!id)return"";for(var processed=l10nStrings[id],iteration=0;_hasPatternRe.test(processed);){if(++iteration>50)throw new Error("L10n.get exceeded maximum replacement iterations, probable infinite loop");_patternRe.lastIndex=0,processed=processed.replace(_patternRe,(function(pat){var subId=pat.slice(1,-1);return overrides&&hasOwn(overrides,subId)?overrides[subId]:hasOwn(l10nStrings,subId)?l10nStrings[subId]:void 0}))}return processed}}}))),_patternRe,_hasPatternRe,strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:"game",aborting:"Aborting",cancel:"Cancel",close:"Close",ok:"OK",errorTitle:"Error",errorToggle:"Toggle the error view",errorNonexistentPassage:'the passage "{passage}" does not exist',errorSaveDiskLoadFailed:"failed to load save file from disk",errorSaveMissingData:"save is missing required data. Either the loaded file is not a save or the save has become corrupted",errorSaveIdMismatch:"save is from the wrong {identity}",_warningIntroLacking:"Your browser either lacks or has disabled",_warningOutroDegraded:", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.",warningNoWebStorage:"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}",warningDegraded:"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}",debugBarToggle:"Toggle the debug bar",debugBarNoWatches:"— no watches set —",debugBarAddWatch:"Add watch",debugBarDeleteWatch:"Delete watch",debugBarWatchAll:"Watch all",debugBarWatchNone:"Delete all",debugBarLabelAdd:"Add",debugBarLabelWatch:"Watch",debugBarLabelTurn:"Turn",debugBarLabelViews:"Views",debugBarViewsToggle:"Toggle the debug views",debugBarWatchToggle:"Toggle the watch panel",uiBarToggle:"Toggle the UI bar",uiBarBackward:"Go backward within the {identity} history",uiBarForward:"Go forward within the {identity} history",uiBarJumpto:"Jump to a specific point within the {identity} history",jumptoTitle:"Jump To",jumptoTurn:"Turn",jumptoUnavailable:"No jump points currently available…",savesTitle:"Saves",savesDisallowed:"Saving has been disallowed on this passage.",savesIncapable:"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.",savesLabelAuto:"Autosave",savesLabelDelete:"Delete",savesLabelExport:"Save to Disk…",savesLabelImport:"Load from Disk…",savesLabelLoad:"Load",savesLabelClear:"Delete All",savesLabelSave:"Save",savesLabelSlot:"Slot",savesUnavailable:"No save slots found…",savesUnknownDate:"unknown",settingsTitle:"Settings",settingsOff:"Off",settingsOn:"On",settingsReset:"Reset to Defaults",restartTitle:"Restart",restartPrompt:"Are you sure that you want to restart? Unsaved progress will be lost.",shareTitle:"Share",alertTitle:"Alert",autoloadTitle:"Autoload",autoloadCancel:"Go to start",autoloadOk:"Load autosave",autoloadPrompt:"An autosave exists. Load it now or go to the start?",macroBackText:"Back",macroReturnText:"Return"},Config=(_debug=!1,_addVisitedLinkClass=!1,_cleanupWikifierOutput=!1,_loadDelay=0,_audioPauseOnFadeToZero=!0,_audioPreloadMetadata=!0,_historyControls=!0,_historyMaxStates=40,_macrosIfAssignmentError=!0,_macrosMaxLoopIterations=1e3,_macrosTypeSkipKey=" ",_macrosTypeVisitedPassages=!0,_passagesDisplayTitles=!1,_passagesNobr=!1,_savesId="untitled-story",_savesSlots=8,_savesTryDiskOnMobile=!0,_uiStowBarInitially=800,_uiUpdateStoryElements=!0,_errHistoryModeDeprecated="Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code",Object.freeze({get debug(){return _debug},set debug(value){_debug=Boolean(value)},get addVisitedLinkClass(){return _addVisitedLinkClass},set addVisitedLinkClass(value){_addVisitedLinkClass=Boolean(value)},get cleanupWikifierOutput(){return _cleanupWikifierOutput},set cleanupWikifierOutput(value){_cleanupWikifierOutput=Boolean(value)},get loadDelay(){return _loadDelay},set loadDelay(value){if(!Number.isSafeInteger(value)||value<0)throw new RangeError("Config.loadDelay must be a non-negative integer");_loadDelay=value},audio:Object.freeze({get pauseOnFadeToZero(){return _audioPauseOnFadeToZero},set pauseOnFadeToZero(value){_audioPauseOnFadeToZero=Boolean(value)},get preloadMetadata(){return _audioPreloadMetadata},set preloadMetadata(value){_audioPreloadMetadata=Boolean(value)}}),history:Object.freeze({get controls(){return _historyControls},set controls(value){var controls=Boolean(value);if(1===_historyMaxStates&&controls)throw new Error("Config.history.controls must be false when Config.history.maxStates is 1");_historyControls=controls},get maxStates(){return _historyMaxStates},set maxStates(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.history.maxStates must be a positive integer");_historyMaxStates=value,_historyControls&&1===value&&(_historyControls=!1)},get mode(){throw new Error(_errHistoryModeDeprecated)},set mode(_){throw new Error(_errHistoryModeDeprecated)},get tracking(){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")},set tracking(_){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")}}),macros:Object.freeze({get ifAssignmentError(){return _macrosIfAssignmentError},set ifAssignmentError(value){_macrosIfAssignmentError=Boolean(value)},get maxLoopIterations(){return _macrosMaxLoopIterations},set maxLoopIterations(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.macros.maxLoopIterations must be a positive integer");_macrosMaxLoopIterations=value},get typeSkipKey(){return _macrosTypeSkipKey},set typeSkipKey(value){_macrosTypeSkipKey=String(value)},get typeVisitedPassages(){return _macrosTypeVisitedPassages},set typeVisitedPassages(value){_macrosTypeVisitedPassages=Boolean(value)}}),navigation:Object.freeze({get override(){return _navigationOverride},set override(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.navigation.override must be a function or null/undefined (received: ".concat(getTypeOf(value),")"));_navigationOverride=value}}),passages:Object.freeze({get descriptions(){return _passagesDescriptions},set descriptions(value){if(null!=value){var valueType=getTypeOf(value);if("boolean"!==valueType&&"Object"!==valueType&&"function"!==valueType)throw new TypeError("Config.passages.descriptions must be a boolean, object, function, or null/undefined (received: ".concat(valueType,")"))}_passagesDescriptions=value},get displayTitles(){return _passagesDisplayTitles},set displayTitles(value){_passagesDisplayTitles=Boolean(value)},get nobr(){return _passagesNobr},set nobr(value){_passagesNobr=Boolean(value)},get onProcess(){return _passagesOnProcess},set onProcess(value){if(null!=value){var valueType=getTypeOf(value);if("function"!==valueType)throw new TypeError("Config.passages.onProcess must be a function or null/undefined (received: ".concat(valueType,")"))}_passagesOnProcess=value},get start(){return _passagesStart},set start(value){if(null!=value){var valueType=getTypeOf(value);if("string"!==valueType)throw new TypeError("Config.passages.start must be a string or null/undefined (received: ".concat(valueType,")"))}_passagesStart=value},get transitionOut(){return _passagesTransitionOut},set transitionOut(value){if(null!=value){var valueType=getTypeOf(value);if("string"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.passages.transitionOut must be a string, non-negative integer, or null/undefined (received: ".concat(valueType,")"))}_passagesTransitionOut=value}}),saves:Object.freeze({get autoload(){return _savesAutoload},set autoload(value){if(null!=value){var valueType=getTypeOf(value);if("boolean"!==valueType&&"string"!==valueType&&"function"!==valueType)throw new TypeError("Config.saves.autoload must be a boolean, string, function, or null/undefined (received: ".concat(valueType,")"))}_savesAutoload=value},get autosave(){return _savesAutosave},set autosave(value){if(null!=value){var valueType=getTypeOf(value);if("string"===valueType)return void(_savesAutosave=[value]);if("boolean"!==valueType&&("Array"!==valueType||!value.every((function(item){return"string"==typeof item})))&&"function"!==valueType)throw new TypeError("Config.saves.autosave must be a boolean, Array<string>, function, or null/undefined (received: ".concat(valueType).concat("Array"===valueType?"<any>":"",")"))}_savesAutosave=value},get id(){return _savesId},set id(value){if("string"!=typeof value||""===value)throw new TypeError("Config.saves.id must be a non-empty string (received: ".concat(getTypeOf(value),")"));_savesId=value},get isAllowed(){return _savesIsAllowed},set isAllowed(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.saves.isAllowed must be a function or null/undefined (received: ".concat(getTypeOf(value),")"));_savesIsAllowed=value},get slots(){return _savesSlots},set slots(value){if(!Number.isSafeInteger(value)||value<0)throw new TypeError("Config.saves.slots must be a non-negative integer (received: ".concat(getTypeOf(value),")"));_savesSlots=value},get tryDiskOnMobile(){return _savesTryDiskOnMobile},set tryDiskOnMobile(value){_savesTryDiskOnMobile=Boolean(value)},get version(){return _savesVersion},set version(value){_savesVersion=value},get onLoad(){throw new Error("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead")},set onLoad(value){console.warn("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead"),Save.onLoad.add(value)},get onSave(){throw new Error("Config.saves.onSave has been deprecated, use the Save.onSave API instead")},set onSave(value){console.warn("Config.saves.onSave has been deprecated, use the Save.onSave API instead"),Save.onSave.add(value)}}),ui:Object.freeze({get stowBarInitially(){return _uiStowBarInitially},set stowBarInitially(value){var valueType=getTypeOf(value);if("boolean"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.ui.stowBarInitially must be a boolean or non-negative integer (received: ".concat(valueType,")"));_uiStowBarInitially=value},get updateStoryElements(){return _uiUpdateStoryElements},set updateStoryElements(value){_uiUpdateStoryElements=Boolean(value)}})})),_navigationOverride,_passagesDescriptions,_passagesStart,_passagesOnProcess,_passagesTransitionOut,_savesAutoload,_savesAutosave,_savesIsAllowed,_savesVersion,_debug,_addVisitedLinkClass,_cleanupWikifierOutput,_loadDelay,_audioPauseOnFadeToZero,_audioPreloadMetadata,_historyControls,_historyMaxStates,_macrosIfAssignmentError,_macrosMaxLoopIterations,_macrosTypeSkipKey,_macrosTypeVisitedPassages,_passagesDisplayTitles,_passagesNobr,_savesId,_savesSlots,_savesTryDiskOnMobile,_uiStowBarInitially,_uiUpdateStoryElements,_errHistoryModeDeprecated,SimpleAudio=function(){var _hasPromise,_gestureEventNames=Object.freeze(["click","contextmenu","dblclick","keyup","mouseup","pointerup","touchend"]),_specialIds=Object.freeze([":not",":all",":looped",":muted",":paused",":playing"]),_formatSpecRe=/^([\w-]+)\s*\|\s*(\S.*)$/,_badIdRe=/[:\s]/,_tracks=new Map,_groups=new Map,_lists=new Map,_subscribers=new Map,_masterRate=1,_masterVolume=1,_masterMute=!1,_masterMuteOnHidden=!1,_playReturnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,Has.audio)try{var audio=document.createElement("audio");audio.muted=!0;var value=audio.play();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise}),AudioTrack=function(){function AudioTrack(obj){if(_classCallCheck(this,AudioTrack),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioTrack))throw new Error("sources parameter must be either an array, of URIs or source objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioTrack,[{key:"_create",value:function(sourceList){var dataUriRe=/^data:\s*audio\/(?:x-)?([^;,]+)\s*[;,]/i,extRe=/\.([^./\\]+)$/,formats=AudioTrack.formats,usedSources=[],audio=document.createElement("audio");audio.preload="none",sourceList.forEach((function(src){var srcUri=null;switch(_typeof(src)){case"string":var match;if("data:"===src.slice(0,5)){if(null===(match=dataUriRe.exec(src)))throw new Error("source data URI missing media type")}else if(null===(match=extRe.exec(parseURL(src).pathname)))throw new Error("source URL missing file extension");formats[match[1]]&&(srcUri=src);break;case"object":if(null===src)throw new Error("source object cannot be null");if(!src.hasOwnProperty("src"))throw new Error('source object missing required "src" property');if(!src.hasOwnProperty("format"))throw new Error('source object missing required "format" property');formats[src.format]&&(srcUri=src.src);break;default:throw new Error("invalid source value (type: ".concat(_typeof(src),")"))}if(null!==srcUri){var source=document.createElement("source");source.src=srcUri,audio.appendChild(source),usedSources.push(srcUri)}})),audio.hasChildNodes()&&Config.audio.preloadMetadata&&(audio.preload="metadata"),this._finalize(audio,usedSources,clone(sourceList))}},{key:"_copy",value:function(obj){this._finalize(obj.audio.cloneNode(!0),clone(obj.sources),clone(obj.originals))}},{key:"_finalize",value:function(audio,sources,originals){var _this=this;Object.defineProperties(this,{audio:{configurable:!0,value:audio},sources:{value:Object.freeze(sources)},originals:{value:Object.freeze(originals)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on("loadstart.AudioTrack",(function(){return _this._error=!1})).on("error.AudioTrack",(function(){return _this._error=!0})).find("source:last-of-type").on("error.AudioTrack",(function(){return _this._trigger("error")})),function(id,callback){if("function"!=typeof callback)throw new Error("callback parameter must be a function");_subscribers.set(id,callback)}(this,(function(mesg){if(_this.audio)switch(mesg){case"loadwithscreen":if(_this.hasSource()){var lockId=LoadScreen.lock();_this.off(".AudioTrack_loadwithscreen").one("canplaythrough.AudioTrack_loadwithscreen error.AudioTrack_loadwithscreen",(function(){jQuery(this).off(".AudioTrack_loadwithscreen"),LoadScreen.unlock(lockId)})).load()}break;case"load":_this.load();break;case"mute":_this._updateAudioMute();break;case"rate":_this._updateAudioRate();break;case"stop":_this.stop();break;case"volume":_this._updateAudioVolume();break;case"unload":_this.unload()}else unsubscribe(_this)})),this._updateAudioMute(),this._updateAudioRate(),this._updateAudioVolume()}},{key:"_trigger",value:function(eventName){jQuery(this.audio).triggerHandler(eventName)}},{key:"_destroy",value:function(){unsubscribe(this),this.audio&&(jQuery(this.audio).off(),this.unload(),this._error=!0,delete this.audio)}},{key:"clone",value:function(){return new AudioTrack(this)}},{key:"load",value:function(){var _this2=this;if(this.fadeStop(),this.audio.pause(),!this.audio.hasChildNodes()){if(0===this.sources.length)return;this.sources.forEach((function(srcUri){var source=document.createElement("source");source.src=srcUri,_this2.audio.appendChild(source)}))}"auto"!==this.audio.preload&&(this.audio.preload="auto"),this.isLoading()||this.audio.load()}},{key:"unload",value:function(){this.fadeStop(),this.stop();var audio=this.audio;for(audio.preload="none";audio.hasChildNodes();)audio.removeChild(audio.firstChild);audio.load()}},{key:"play",value:function(){var _this3=this;if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));"auto"!==this.audio.preload&&(this.audio.preload="auto");var namespace=".AudioTrack_play";return _playReturnsPromise()?this.audio.play():new Promise((function(resolve,reject){_this3.isPlaying()?resolve():(jQuery(_this3.audio).off(namespace).one("error".concat(namespace," playing").concat(namespace," timeupdate").concat(namespace),(function(ev){jQuery(_this3.audio).off(namespace),"error"===ev.type?reject(new Error("unknown audio play error")):resolve()})),_this3.audio.play())}))}},{key:"playWhenAllowed",value:function(){var _this4=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioTrack_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioTrack_playWhenAllowed"),_this4.audio.play()}))}))}},{key:"pause",value:function(){this.audio.pause()}},{key:"stop",value:function(){this.audio.pause(),this.time(0),this._trigger(":stopped")}},{key:"fade",value:function(duration,toVol,fromVol){var _this5=this;if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));this.fadeStop();var from=Math.clamp(null==fromVol?this.volume():fromVol,0,1),to=Math.clamp(toVol,0,1);return from!==to?(this.volume(from),jQuery(this.audio).off("timeupdate.AudioTrack_fade").one("timeupdate.AudioTrack_fade",(function(){var min,max;from<to?(min=from,max=to):(min=to,max=from);var time=Math.max(duration,1),delta=(to-from)/(time/.025);_this5._trigger(":fading"),_this5._faderId=setInterval((function(){_this5.isPlaying()?(_this5.volume(Math.clamp(_this5.volume()+delta,min,max)),Config.audio.pauseOnFadeToZero&&0===_this5.volume()&&_this5.pause(),_this5.volume()===to&&(_this5.fadeStop(),_this5._trigger(":faded"))):_this5.fadeStop()}),25)})),this.play()):void 0}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}},{key:"loop",value:function(_loop){return null==_loop?this.audio.loop:(this.audio.loop=!!_loop,this)}},{key:"mute",value:function(_mute){return null==_mute?this._mute:(this._mute=!!_mute,this._updateAudioMute(),this)}},{key:"_updateAudioMute",value:function(){this.audio.muted=this._mute||_masterMute}},{key:"rate",value:function(_rate){if(null==_rate)return this._rate;if("number"!=typeof _rate)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate,.2,5),this._updateAudioRate(),this}},{key:"_updateAudioRate",value:function(){this.audio.playbackRate=Math.clamp(this._rate*_masterRate,.2,5)}},{key:"time",value:function(_time){var _this6=this;if(null==_time)return this.audio.currentTime;if("number"!=typeof _time)throw new TypeError("time parameter must be a number");return this.hasMetadata()?this.audio.currentTime=_time:jQuery(this.audio).off("loadedmetadata.AudioTrack_time").one("loadedmetadata.AudioTrack_time",(function(){return _this6.audio.currentTime=_time})),this}},{key:"volume",value:function(_volume){if(null==_volume)return this._volume;if("number"!=typeof _volume)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume,0,1),this._updateAudioVolume(),this}},{key:"_updateAudioVolume",value:function(){this.audio.volume=Math.clamp(this._volume*_masterVolume,0,1)}},{key:"duration",value:function(){return this.audio.duration}},{key:"remaining",value:function(){return this.audio.duration-this.audio.currentTime}},{key:"isFailed",value:function(){return this._error}},{key:"isLoading",value:function(){return this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}},{key:"isUnloaded",value:function(){return!this.audio.hasChildNodes()}},{key:"isUnavailable",value:function(){return!this.hasSource()||this.isUnloaded()||this.isFailed()}},{key:"isPlaying",value:function(){return!this.audio.paused&&this.hasSomeData()}},{key:"isPaused",value:function(){return this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended}},{key:"isStopped",value:function(){return this.audio.paused&&0===this.audio.currentTime}},{key:"isEnded",value:function(){return this.audio.ended}},{key:"isFading",value:function(){return null!==this._faderId}},{key:"isSeeking",value:function(){return this.audio.seeking}},{key:"hasSource",value:function(){return this.sources.length>0}},{key:"hasNoData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}},{key:"hasMetadata",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}},{key:"hasSomeData",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}},{key:"hasData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}},{key:"on",value:function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return jQuery.fn.on.apply(jQuery(this.audio),args),this}},{key:"one",value:function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return jQuery.fn.one.apply(jQuery(this.audio),args),this}},{key:"off",value:function(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];return jQuery.fn.off.apply(jQuery(this.audio),args),this}}]),AudioTrack}();Object.defineProperties(AudioTrack,{formats:{value:function(){var audio=document.createElement("audio"),types=new Map;function canPlay(mimeType){return types.has(mimeType)||types.set(mimeType,""!==audio.canPlayType(mimeType).replace(/^no$/i,"")),types.get(mimeType)}return Object.assign(Object.create(null),{aac:canPlay("audio/aac"),caf:canPlay("audio/x-caf")||canPlay("audio/caf"),flac:canPlay("audio/x-flac")||canPlay("audio/flac"),mp3:canPlay('audio/mpeg; codecs="mp3"')||canPlay("audio/mpeg")||canPlay("audio/mp3")||canPlay("audio/mpa"),mpeg:canPlay("audio/mpeg"),m4a:canPlay("audio/x-m4a")||canPlay("audio/m4a")||canPlay("audio/aac"),mp4:canPlay("audio/x-mp4")||canPlay("audio/mp4")||canPlay("audio/aac"),ogg:canPlay("audio/ogg"),oga:canPlay("audio/ogg"),opus:canPlay('audio/ogg; codecs="opus"')||canPlay("audio/opus"),wav:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),wave:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),weba:canPlay("audio/webm"),webm:canPlay("audio/webm")})}()}});var AudioList=function(){function AudioList(obj){if(_classCallCheck(this,AudioList),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioList))throw new Error("tracks parameter must be either an array, of track objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioList,[{key:"_create",value:function(trackList){var _this7=this;this._finalize(trackList.map((function(trackObj){if("object"!==_typeof(trackObj))throw new Error("tracks parameter array members must be objects");var own,rate,track,volume;if(trackObj instanceof AudioTrack)own=!0,rate=trackObj.rate(),track=trackObj.clone(),volume=trackObj.volume();else{if(!trackObj.hasOwnProperty("track"))throw new Error('track object missing required "track" property');if(!(trackObj.track instanceof AudioTrack))throw new Error('track object\'s "track" property must be an AudioTrack object');own=trackObj.hasOwnProperty("own")&&trackObj.own,rate=trackObj.hasOwnProperty("rate")?trackObj.rate:trackObj.track.rate(),track=trackObj.track,volume=trackObj.hasOwnProperty("volume")?trackObj.volume:trackObj.track.volume()}return track.stop(),track.loop(!1),track.mute(!1),track.rate(rate),track.volume(volume),track.on("ended.AudioList",(function(){return _this7._onEnd()})),{own:own,track:track,volume:volume,rate:rate}})))}},{key:"_copy",value:function(obj){this._finalize(clone(obj.tracks))}},{key:"_finalize",value:function(tracks){Object.defineProperties(this,{tracks:{configurable:!0,value:Object.freeze(tracks)},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}})}},{key:"_destroy",value:function(){this.stop(),this.tracks.filter((function(trackObj){return trackObj.own})).forEach((function(trackObj){return trackObj.track._destroy()})),delete this.tracks,delete this.queue}},{key:"load",value:function(){this.tracks.forEach((function(trackObj){return trackObj.track.load()}))}},{key:"unload",value:function(){this.stop(),this.tracks.forEach((function(trackObj){return trackObj.track.unload()}))}},{key:"play",value:function(){return null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||(0===this.queue.length&&this._fillQueue(),this._next())?this.current.track.play():Promise.reject(new Error("no tracks were available"))}},{key:"playWhenAllowed",value:function(){var _this8=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioList_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioList_playWhenAllowed"),_this8.play()}))}))}},{key:"pause",value:function(){null!==this.current&&this.current.track.pause()}},{key:"stop",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null),this._drainQueue()}},{key:"skip",value:function(){this._next()?this.current.track.play():this._loop&&this.play()}},{key:"fade",value:function(duration,toVol,fromVol){if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(0===this.queue.length&&this._fillQueue(),null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||this._next()){var adjFromVol,adjToVol=Math.clamp(toVol,0,1)*this.current.volume;return null!=fromVol&&(adjFromVol=Math.clamp(fromVol,0,1)*this.current.volume),this._volume=toVol,this.current.track.fade(duration,adjToVol,adjFromVol)}}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this.current&&this.current.track.fadeStop()}},{key:"loop",value:function(_loop2){return null==_loop2?this._loop:(this._loop=!!_loop2,this)}},{key:"mute",value:function(_mute2){return null==_mute2?this._mute:(this._mute=!!_mute2,null!==this.current&&this.current.track.mute(this._mute),this)}},{key:"rate",value:function(_rate2){if(null==_rate2)return this._rate;if("number"!=typeof _rate2)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate2,.2,5),null!==this.current&&this.current.track.rate(this._rate*this.current.rate),this}},{key:"shuffle",value:function(_shuffle){var _this9=this;if(null==_shuffle)return this._shuffle;if(this._shuffle=!!_shuffle,this.queue.length>0&&(this._fillQueue(),!this._shuffle&&null!==this.current&&this.queue.length>1)){var _this$queue,firstIdx=this.queue.findIndex((function(trackObj){return trackObj===_this9.current}));if(-1!==firstIdx)(_this$queue=this.queue).push.apply(_this$queue,_toConsumableArray(this.queue.splice(0,firstIdx+1)))}return this}},{key:"volume",value:function(_volume2){if(null==_volume2)return this._volume;if("number"!=typeof _volume2)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume2,0,1),null!==this.current&&this.current.track.volume(this._volume*this.current.volume),this}},{key:"duration",value:function(){if(arguments.length>0)throw new Error("duration takes no parameters");return this.tracks.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0)}},{key:"remaining",value:function(){if(arguments.length>0)throw new Error("remaining takes no parameters");var remainingTime=this.queue.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0);return null!==this.current&&(remainingTime+=this.current.track.remaining()),remainingTime}},{key:"time",value:function(){if(arguments.length>0)throw new Error("time takes no parameters");return this.duration()-this.remaining()}},{key:"isPlaying",value:function(){return null!==this.current&&this.current.track.isPlaying()}},{key:"isPaused",value:function(){return null===this.current||this.current.track.isPaused()}},{key:"isStopped",value:function(){return 0===this.queue.length&&null===this.current}},{key:"isEnded",value:function(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}},{key:"isFading",value:function(){return null!==this.current&&this.current.track.isFading()}},{key:"_next",value:function(){var nextTrack;for(null!==this.current&&(this.current.track.stop(),this.current=null);nextTrack=this.queue.shift();)if(!nextTrack.track.isUnavailable()){this.current=nextTrack;break}return null!==this.current&&(this.current.track.mute(this._mute),this.current.track.rate(this._rate*this.current.rate),this.current.track.volume(this._volume*this.current.volume),this.current.track.loop(!1),!0)}},{key:"_onEnd",value:function(){if(0===this.queue.length){if(!this._loop)return;this._fillQueue()}this._next()&&this.current.track.play()}},{key:"_drainQueue",value:function(){this.queue.splice(0)}},{key:"_fillQueue",value:function(){var _this$queue2;this._drainQueue(),(_this$queue2=this.queue).push.apply(_this$queue2,_toConsumableArray(this.tracks.filter((function(trackObj){return!trackObj.track.isUnavailable()})))),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}}]),AudioList}(),AudioRunner=function(){function AudioRunner(list){if(_classCallCheck(this,AudioRunner),!(list instanceof Set||list instanceof AudioRunner))throw new TypeError("list parameter must be a Set or a AudioRunner instance");Object.defineProperties(this,{trackIds:{value:new Set(list instanceof AudioRunner?list.trackIds:list)}})}return _createClass(AudioRunner,[{key:"load",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.load)}},{key:"unload",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.unload)}},{key:"play",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.play)}},{key:"playWhenAllowed",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.playWhenAllowed)}},{key:"pause",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.pause)}},{key:"stop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.stop)}},{key:"fade",value:function(duration,toVol,fromVol){if(null==duration||null==toVol)throw new Error("fade requires parameters");AudioRunner._run(this.trackIds,AudioTrack.prototype.fade,duration,toVol,fromVol)}},{key:"fadeIn",value:function(duration,fromVol){if(null==duration)throw new Error("fadeIn requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeIn,duration,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){if(null==duration)throw new Error("fadeOut requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeOut,duration,fromVol)}},{key:"fadeStop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeStop)}},{key:"loop",value:function(_loop3){if(null==_loop3)throw new Error("loop requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.loop,_loop3),this}},{key:"mute",value:function(_mute3){if(null==_mute3)throw new Error("mute requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.mute,_mute3),this}},{key:"rate",value:function(_rate3){if(null==_rate3)throw new Error("rate requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.rate,_rate3),this}},{key:"time",value:function(_time2){if(null==_time2)throw new Error("time requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.time,_time2),this}},{key:"volume",value:function(_volume3){if(null==_volume3)throw new Error("volume requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.volume,_volume3),this}},{key:"on",value:function(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.on].concat(args)),this}},{key:"one",value:function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.one].concat(args)),this}},{key:"off",value:function(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.off].concat(args)),this}}],[{key:"_run",value:function(ids,fn){for(var _len11=arguments.length,args=new Array(_len11>2?_len11-2:0),_key11=2;_key11<_len11;_key11++)args[_key11-2]=arguments[_key11];ids.forEach((function(id){var track=_tracks.get(id);track&&fn.apply(track,args)}))}}]),AudioRunner}();var _runnerParseSelector=function(){var notWsRe=/\S/g,parenRe=/[()]/g;function processNegation(str,startPos){var match;if(notWsRe.lastIndex=startPos,null===(match=notWsRe.exec(str))||"("!==match[0])throw new Error('invalid ":not()" syntax: missing parentheticals');parenRe.lastIndex=notWsRe.lastIndex;for(var start=notWsRe.lastIndex,result={str:"",nextMatch:-1},depth=1;null!==(match=parenRe.exec(str));)if("("===match[0]?++depth:--depth,depth<1){result.nextMatch=parenRe.lastIndex,result.str=str.slice(start,result.nextMatch-1);break}return result}return function parseSelector(idArg){for(var match,ids=[],idRe=/:?[^\s:()]+/g;null!==(match=idRe.exec(idArg));){var id=match[0];if(":not"===id){if(0===ids.length)throw new Error('invalid negation: no group ID preceded ":not()"');var parent=ids[ids.length-1];if(":"!==parent.id[0])throw new Error('invalid negation of track "'.concat(parent.id,'": only groups may be negated with ":not()"'));var negation=processNegation(idArg,idRe.lastIndex);if(-1===negation.nextMatch)throw new Error('unknown error parsing ":not()"');idRe.lastIndex=negation.nextMatch,parent.not=parseSelector(negation.str)}else ids.push({id:id})}return ids}}();function masterMute(mute){if(null==mute)return _masterMute;publish("mute",_masterMute=!!mute)}function unsubscribe(id){_subscribers.delete(id)}function publish(mesg,data){_subscribers.forEach((function(fn){return fn(mesg,data)}))}function _newTrack(sources){return new AudioTrack(sources.map((function(source){if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);if(passage.tags.includes("Twine.audio"))return passage.text.trim()}var match=_formatSpecRe.exec(source);return null===match?source:{format:match[1],src:match[2]}})))}return Object.preventExtensions(Object.create(null,{tracks:{value:Object.preventExtensions(Object.create(null,{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("track ID"),arguments.length<2&&errors.push("sources"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='track ID "'.concat(id,'"');if(_badIdRe.test(id))throw new Error("invalid ".concat(what,": track IDs must not contain colons or whitespace"));var track,sources=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{track=_newTrack(sources)}catch(ex){throw new Error("".concat(what,": error during track initialization: ").concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("".concat(what,": no supported audio sources found"));_tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.set(id,track)}},delete:{value:function(id){return _tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.delete(id)}},clear:{value:function(){_tracks.forEach((function(track){return track._destroy()})),_tracks.clear()}},has:{value:function(id){return _tracks.has(id)}},get:{value:function(id){return _tracks.get(id)||null}}}))},groups:{value:Object.preventExtensions(Object.create(null,{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("group ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='group ID "'.concat(id,'"');if(":"!==id[0]||_badIdRe.test(id.slice(1)))throw new Error("invalid ".concat(what,": group IDs must start with a colon and must not contain colons or whitespace"));if(_specialIds.includes(id))throw new Error("cannot clobber special ".concat(what));var group,trackIds=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{group=new Set(trackIds.map((function(trackId){if(!_tracks.has(trackId))throw new Error('track "'.concat(trackId,'" does not exist'));return trackId})))}catch(ex){throw new Error("".concat(what,": error during group initialization: ").concat(ex.message))}_groups.set(id,Object.freeze(Array.from(group)))}},delete:{value:function(id){return _groups.delete(id)}},clear:{value:function(){_groups.clear()}},has:{value:function(id){return _groups.has(id)}},get:{value:function(id){return _groups.get(id)||null}}}))},lists:{value:Object.preventExtensions(Object.create(null,{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("list ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='list ID "'.concat(id,'"');if(_badIdRe.test(id))return this.error("invalid ".concat(what,": list IDs must not contain colons or whitespace"));var list,descriptors=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{list=new AudioList(descriptors.map((function(desc){if(null===desc)throw new Error("track descriptor must be a string or object (type: null)");switch(_typeof(desc)){case"string":desc={id:desc};break;case"object":if(!desc.hasOwnProperty("id")&&!desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain one of either an "id" or a "sources" property');if(desc.hasOwnProperty("id")&&desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain either an "id" or a "sources" property, not both');break;default:throw new Error("track descriptor must be a string or object (type: ".concat(_typeof(desc),")"))}var own,track,volume;if(desc.hasOwnProperty("id")){if("string"!=typeof desc.id)throw new Error('"id" property must be a string');if(!_tracks.has(desc.id))throw new Error('track "'.concat(desc.id,'" does not exist'));track=_tracks.get(desc.id)}else if(desc.hasOwnProperty("sources")){if(!Array.isArray(desc.sources)||0===desc.sources.length)throw new Error('"sources" property must be a non-empty array');if(desc.hasOwnProperty("own"))throw new Error('"own" property is not allowed with the "sources" property');try{track=_newTrack(desc.sources),own=!0}catch(ex){throw new Error("error during track initialization: ".concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("no supported audio sources found")}if(desc.hasOwnProperty("own")){if("boolean"!=typeof desc.own)throw new Error('"own" property must be a boolean');(own=desc.own)&&(track=track.clone())}if(desc.hasOwnProperty("volume")){if("number"!=typeof desc.volume||Number.isNaN(desc.volume)||!Number.isFinite(desc.volume)||desc.volume<0)throw new Error('"volume" property must be a non-negative finite number');volume=desc.volume}return{own:null!=own&&own,track:track,volume:null!=volume?volume:track.volume()}})))}catch(ex){throw new Error("".concat(what,": error during playlist initialization: ").concat(ex.message))}_lists.has(id)&&_lists.get(id)._destroy(),_lists.set(id,list)}},delete:{value:function(id){return _lists.has(id)&&_lists.get(id)._destroy(),_lists.delete(id)}},clear:{value:function(){_lists.forEach((function(list){return list._destroy()})),_lists.clear()}},has:{value:function(id){return _lists.has(id)}},get:{value:function(id){return _lists.get(id)||null}}}))},select:{value:function(){if(0===arguments.length)throw new Error("no track selector specified");var selector=String(arguments[0]).trim(),trackIds=new Set;try{var renderIds=function renderIds(idObj){var ids,id=idObj.id;switch(id){case":all":ids=allIds;break;case":looped":ids=allIds.filter((function(id){return _tracks.get(id).loop()}));break;case":muted":ids=allIds.filter((function(id){return _tracks.get(id).mute()}));break;case":paused":ids=allIds.filter((function(id){return _tracks.get(id).isPaused()}));break;case":playing":ids=allIds.filter((function(id){return _tracks.get(id).isPlaying()}));break;default:ids=":"===id[0]?_groups.get(id):[id]}if(idObj.hasOwnProperty("not")){var negated=idObj.not.map((function(idObj){return renderIds(idObj)})).flat(1/0);ids=ids.filter((function(id){return!negated.includes(id)}))}return ids},allIds=Array.from(_tracks.keys());_runnerParseSelector(selector).forEach((function(idObj){return renderIds(idObj).forEach((function(id){if(!_tracks.has(id))throw new Error('track "'.concat(id,'" does not exist'));trackIds.add(id)}))}))}catch(ex){throw new Error("error during runner initialization: ".concat(ex.message))}return new AudioRunner(trackIds)}},load:{value:function(){publish("load")}},loadWithScreen:{value:function(){publish("loadwithscreen")}},mute:{value:masterMute},muteOnHidden:{value:function(mute){if(!Visibility.isEnabled())return!1;if(null==mute)return _masterMuteOnHidden;var namespace=".SimpleAudio_masterMuteOnHidden";if(_masterMuteOnHidden=!!mute){var visibilityChange="".concat(Visibility.changeEvent).concat(namespace);jQuery(document).off(namespace).on(visibilityChange,(function(){return masterMute(Visibility.isHidden())})),Visibility.isHidden()&&masterMute(!0)}else jQuery(document).off(namespace)}},rate:{value:function(rate){if(null==rate)return _masterRate;if("number"!=typeof rate||Number.isNaN(rate)||!Number.isFinite(rate))throw new Error("rate must be a finite number");publish("rate",_masterRate=Math.clamp(rate,.2,5))}},stop:{value:function(){publish("stop")}},unload:{value:function(){publish("unload")}},volume:{value:function(volume){if(null==volume)return _masterVolume;if("number"!=typeof volume||Number.isNaN(volume)||!Number.isFinite(volume))throw new Error("volume must be a finite number");publish("volume",_masterVolume=Math.clamp(volume,0,1))}}}))}(),State=function(){var _history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null,_tempVariables={};function stateMarshal(noDelta){var stateObj={index:_activeIndex};return noDelta?stateObj.history=clone(_history):stateObj.delta=historyDeltaEncode(_history),_expired.length>0&&(stateObj.expired=_toConsumableArray(_expired)),null!==_prng&&(stateObj.seed=_prng.seed),stateObj}function stateUnmarshal(stateObj,noDelta){if(null==stateObj)throw new Error("state object is null or undefined");if(!stateObj.hasOwnProperty(noDelta?"history":"delta")||0===stateObj[noDelta?"history":"delta"].length)throw new Error("state object has no history or history is empty");if(!stateObj.hasOwnProperty("index"))throw new Error("state object has no index");if(null!==_prng&&!stateObj.hasOwnProperty("seed"))throw new Error("state object has no seed, but PRNG is enabled");if(null===_prng&&stateObj.hasOwnProperty("seed"))throw new Error("state object has seed, but PRNG is disabled");_history=noDelta?clone(stateObj.history):historyDeltaDecode(stateObj.delta),_activeIndex=stateObj.index,_expired=stateObj.hasOwnProperty("expired")?_toConsumableArray(stateObj.expired):[],stateObj.hasOwnProperty("seed")&&(_prng.seed=stateObj.seed),momentActivate(_activeIndex)}function momentCreate(title,variables){return{title:null==title?"":String(title),variables:null==variables?{}:clone(variables)}}function momentActivate(moment){if(null==moment)throw new Error("moment activation attempted with null or undefined");switch(_typeof(moment)){case"object":_active=clone(moment);break;case"number":if(historyIsEmpty())throw new Error("moment activation attempted with index on empty history");if(moment<0||moment>=historySize())throw new RangeError("moment activation attempted with out-of-bounds index; need [0, ".concat(historySize()-1,"], got ").concat(moment));_active=clone(_history[moment]);break;default:throw new TypeError('moment activation attempted with a "'.concat(_typeof(moment),'"; must be an object or valid history stack index'))}return null!==_prng&&(_prng=PRNGWrapper.unmarshal({seed:_prng.seed,pull:_active.pull})),session.set("state",stateMarshal()),jQuery.event.trigger(":historyupdate"),_active}function historyLength(){return _activeIndex+1}function historySize(){return _history.length}function historyIsEmpty(){return 0===_history.length}function historyTop(){return _history.length>0?_history[_history.length-1]:null}function historyGoTo(index){return!(null==index||index<0||index>=historySize()||index===_activeIndex)&&(momentActivate(_activeIndex=index),!0)}function historyDeltaEncode(historyArr){if(!Array.isArray(historyArr))return null;if(0===historyArr.length)return[];for(var delta=[historyArr[0]],i=1,iend=historyArr.length;i<iend;++i)delta.push(Diff.diff(historyArr[i-1],historyArr[i]));return delta}function historyDeltaDecode(delta){if(!Array.isArray(delta))return null;if(0===delta.length)return[];for(var historyArr=[clone(delta[0])],i=1,iend=delta.length;i<iend;++i)historyArr.push(Diff.patch(historyArr[i-1],delta[i]));return historyArr}function prngInit(seed,useEntropy){var scriptSection;if(!historyIsEmpty())throw scriptSection="the Story JavaScript",new Error("State.prng.init must be called during initialization, within either ".concat(scriptSection," or the StoryInit special passage"));_prng=new PRNGWrapper(seed,useEntropy),_active.pull=_prng.pull}function metadataDelete(key){if("string"!=typeof key)throw new TypeError("State.metadata.delete key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");store&&hasOwn(store,key)&&(1===Object.keys(store).length?storage.delete("metadata"):(delete store[key],storage.set("metadata",store)))}return Object.preventExtensions(Object.create(null,{reset:{value:function(){session.delete("state"),_history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null===_prng?null:new PRNGWrapper(_prng.seed,!1)}},restore:{value:function(){if(session.has("state")){var stateObj=session.get("state");return null!=stateObj&&(stateUnmarshal(stateObj),!0)}return!1}},marshalForSave:{value:function(){return stateMarshal(!0)}},unmarshalForSave:{value:function(stateObj){return stateUnmarshal(stateObj,!0)}},expired:{get:function(){return _expired}},turns:{get:function(){return _expired.length+historyLength()}},passages:{get:function(){return _expired.concat(_history.slice(0,historyLength()).map((function(moment){return moment.title})))}},hasPlayed:{value:function(title){return null!=title&&""!==title&&(!!_expired.includes(title)||!!_history.slice(0,historyLength()).some((function(moment){return moment.title===title})))}},active:{get:function(){return _active}},activeIndex:{get:function(){return _activeIndex}},passage:{get:function(){return _active.title}},variables:{get:function(){return _active.variables}},history:{get:function(){return _history}},length:{get:historyLength},size:{get:historySize},isEmpty:{value:historyIsEmpty},current:{get:function(){return _history.length>0?_history[_activeIndex]:null}},top:{get:historyTop},bottom:{get:function(){return _history.length>0?_history[0]:null}},index:{value:function(index){return historyIsEmpty()||index<0||index>_activeIndex?null:_history[index]}},peek:{value:function(offset){if(historyIsEmpty())return null;var lengthOffset=1+(offset?Math.abs(offset):0);return lengthOffset>historyLength()?null:_history[historyLength()-lengthOffset]}},has:{value:function(title){if(historyIsEmpty()||null==title||""===title)return!1;for(var i=_activeIndex;i>=0;--i)if(_history[i].title===title)return!0;return!1}},create:{value:function(title){for(0,historyLength()<historySize()&&_history.splice(historyLength(),historySize()-historyLength()),_history.push(momentCreate(title,_active.variables)),_prng&&(historyTop().pull=_prng.pull);historySize()>Config.history.maxStates;)_expired.push(_history.shift().title);return momentActivate(_activeIndex=historySize()-1),historyLength()}},goTo:{value:historyGoTo},go:{value:function(offset){return null!=offset&&0!==offset&&historyGoTo(_activeIndex+offset)}},deltaEncode:{value:historyDeltaEncode},deltaDecode:{value:historyDeltaDecode},prng:{value:Object.preventExtensions(Object.create(null,{init:{value:prngInit},isEnabled:{value:function(){return null!==_prng}},pull:{get:function(){return _prng?_prng.pull:NaN}},seed:{get:function(){return _prng?_prng.seed:null}}}))},random:{value:function(){return _prng?_prng.random():Math.random()}},clearTemporary:{value:function(){TempVariables=_tempVariables={}}},temporary:{get:function(){return _tempVariables}},getVar:{value:function(varExpression){try{return Scripting.evalTwineScript(varExpression)}catch(ex){}}},setVar:{value:function(varExpression,value){try{return Scripting.evalTwineScript("".concat(varExpression," = evalTwineScript$Data$"),null,value),!0}catch(ex){}return!1}},metadata:{value:Object.preventExtensions(Object.create(null,{clear:{value:function(){storage.delete("metadata")}},delete:{value:metadataDelete},entries:{value:function(){var store=storage.get("metadata");return store&&Object.entries(store)}},get:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.get key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&hasOwn(store,key)?store[key]:undefined}},has:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.has key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&hasOwn(store,key)}},keys:{value:function(){var store=storage.get("metadata");return store&&Object.keys(store)}},set:{value:function(key,value){if("string"!=typeof key)throw new TypeError("State.metadata.set key parameter must be a string (received: ".concat(_typeof(key),")"));if(void 0===value)metadataDelete(key);else{var store=storage.get("metadata")||{};store[key]=value,storage.set("metadata",store)}}},size:{get:function(){var store=storage.get("metadata");return store?Object.keys(store).length:0}}}))},initPRNG:{value:prngInit},restart:{value:function(){return Engine.restart()}},backward:{value:function(){return Engine.backward()}},forward:{value:function(){return Engine.forward()}},display:{value:function(){return Engine.display.apply(Engine,arguments)}},show:{value:function(){return Engine.show.apply(Engine,arguments)}},play:{value:function(){return Engine.play.apply(Engine,arguments)}}}))}(),Scripting=function(){function addAccessibleClickHandler(targets,selector,handler,one,namespace){if(arguments.length<2)throw new Error("addAccessibleClickHandler insufficient number of parameters");var fn,opts;if("function"==typeof selector?(fn=selector,opts={namespace:one,one:!!handler}):(fn=handler,opts={namespace:namespace,one:!!one,selector:selector}),"function"!=typeof fn)throw new TypeError("addAccessibleClickHandler handler parameter must be a function");return jQuery(targets).ariaClick(opts,fn)}function insertElement(place,type,id,classNames,text,title){var $el=jQuery(document.createElement(type));return id&&$el.attr("id",id),classNames&&$el.addClass(classNames),title&&$el.attr("title",title),text&&$el.text(text),place&&$el.appendTo(place),$el[0]}function insertText(place,text){jQuery(place).append(document.createTextNode(text))}function removeChildren(node){jQuery(node).empty()}function removeElement(node){jQuery(node).remove()}function fade(el,options){var current,intervalId,direction="in"===options.fade?1:-1,proxy=el.cloneNode(!0);function setOpacity(el,opacity){el.style.zoom=1,el.style.filter="alpha(opacity=".concat(Math.floor(100*opacity),")"),el.style.opacity=opacity}el.parentNode.replaceChild(proxy,el),"in"===options.fade?(current=0,proxy.style.visibility="visible"):current=1,setOpacity(proxy,current),intervalId=window.setInterval((function(){current+=.05*direction,setOpacity(proxy,Math.easeInOut(current)),(1===direction&&current>=1||-1===direction&&current<=0)&&(el.style.visibility="in"===options.fade?"visible":"hidden",proxy.parentNode.replaceChild(el,proxy),proxy=null,window.clearInterval(intervalId),options.onComplete&&options.onComplete())}),25)}function scrollWindowTo(el,incrementBy){var increment=null!=incrementBy?Number(incrementBy):.1;Number.isNaN(increment)||!Number.isFinite(increment)||increment<0?increment=.1:increment>1&&(increment=1);var intervalId,start=window.scrollY?window.scrollY:document.body.scrollTop,end=function(el){var posTop=function(el){var curtop=0;for(;el.offsetParent;)curtop+=el.offsetTop,el=el.offsetParent;return curtop}(el),posBottom=posTop+el.offsetHeight,winTop=window.scrollY?window.scrollY:document.body.scrollTop,winHeight=window.innerHeight?window.innerHeight:document.body.clientHeight,winBottom=winTop+winHeight;return posTop>=winTop&&posBottom>winBottom&&el.offsetHeight<winHeight?posTop-(winHeight-el.offsetHeight)+20:posTop}(el),distance=Math.abs(start-end),direction=start>end?-1:1,progress=0;intervalId=window.setInterval((function(){progress+=increment,window.scroll(0,start+direction*(distance*Math.easeInOut(progress))),progress>=1&&window.clearInterval(intervalId)}),25)}function toStringOrDefault(value){return stringFrom(value)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function forget(key){if("string"!=typeof key)throw new TypeError("forget key parameter must be a string (received: ".concat(getTypeOf(key),")"));State.metadata.delete(key)}function hasVisited(){if(0===arguments.length)throw new Error("hasVisited called with insufficient parameters");if(State.isEmpty())return!1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,i=0,iend=needles.length;i<iend;++i)if(!played.includes(needles[i]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error("lastVisited called with insufficient parameters");if(State.isEmpty())return-1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,uBound=played.length-1,turns=State.turns,i=0,iend=needles.length;i<iend&&turns>-1;++i){var lastIndex=played.lastIndexOf(needles[i]);turns=Math.min(turns,-1===lastIndex?-1:uBound-lastIndex)}return turns}function memorize(key,value){if("string"!=typeof key)throw new TypeError("memorize key parameter must be a string (received: ".concat(getTypeOf(key),")"));State.metadata.set(key,value)}function passage(){return State.passage}function previous(){var passages=State.passages;if(arguments.length>0){var offset=Number(arguments[0]);if(!Number.isSafeInteger(offset)||offset<1)throw new RangeError("previous offset parameter must be a positive integer greater than zero");return passages.length>offset?passages[passages.length-1-offset]:""}for(var i=passages.length-2;i>=0;--i)if(passages[i]!==State.passage)return passages[i];return""}function random(){var min,max;switch(arguments.length){case 0:throw new Error("random called with insufficient parameters");case 1:min=0,max=Math.trunc(arguments[0]);break;default:min=Math.trunc(arguments[0]),max=Math.trunc(arguments[1])}if(!Number.isInteger(min))throw new Error("random min parameter must be an integer");if(!Number.isInteger(max))throw new Error("random max parameter must be an integer");if(min>max){var _ref5=[max,min];min=_ref5[0],max=_ref5[1]}return Math.floor(State.random()*(max-min+1))+min}function randomFloat(){var min,max;switch(arguments.length){case 0:throw new Error("randomFloat called with insufficient parameters");case 1:min=0,max=Number(arguments[0]);break;default:min=Number(arguments[0]),max=Number(arguments[1])}if(Number.isNaN(min)||!Number.isFinite(min))throw new Error("randomFloat min parameter must be a number");if(Number.isNaN(max)||!Number.isFinite(max))throw new Error("randomFloat max parameter must be a number");if(min>max){var _ref6=[max,min];min=_ref6[0],max=_ref6[1]}return State.random()*(max-min)+min}function recall(key,defaultValue){if("string"!=typeof key)throw new TypeError("recall key parameter must be a string (received: ".concat(getTypeOf(key),")"));return State.metadata.has(key)?State.metadata.get(key):defaultValue}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);for(var passages=Array.prototype.concat.apply([],arguments),tags=[],i=0,iend=passages.length;i<iend;++i)tags=tags.concat(Story.get(passages[i]).tags);return tags}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),played=State.passages,count=State.turns,i=0,iend=needles.length;i<iend&&count>0;++i)count=Math.min(count,played.count(needles[i]));return count}function visitedTags(){if(0===arguments.length)throw new Error("visitedTags called with insufficient parameters");if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],arguments),nLength=needles.length,played=State.passages,seen=new Map,count=0,i=0,iend=played.length;i<iend;++i){var title=played[i];if(seen.has(title))seen.get(title)&&++count;else{var _tags2=Story.get(title).tags;if(_tags2.length>0){for(var found=0,j=0;j<nLength;++j)_tags2.includes(needles[j])&&++found;found===nLength?(++count,seen.set(title,!0)):seen.set(title,!1)}}}return count}var _ref7=function(){function slugifyUrl(url){return parseURL(url).path.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w]+/g,"-").toLocaleLowerCase()}function addScript(url){return new Promise((function(resolve,reject){jQuery(document.createElement("script")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importScripts failed to load the script "'.concat(url,'".')))})).appendTo(document.head).attr({id:"script-imported-".concat(slugifyUrl(url)),type:"text/javascript",src:url})}))}function addStyle(url){return new Promise((function(resolve,reject){jQuery(document.createElement("link")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importStyles failed to load the stylesheet "'.concat(url,'".')))})).appendTo(document.head).attr({id:"style-imported-".concat(slugifyUrl(url)),rel:"stylesheet",href:url})}))}function sequence(callbacks){return callbacks.reduce((function(seq,fn){return seq.then(fn)}),Promise.resolve())}return{importScripts:function(){for(var _len12=arguments.length,urls=new Array(_len12),_key12=0;_key12<_len12;_key12++)urls[_key12]=arguments[_key12];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addScript(url)}}))):addScript(oneOrSeries)})))},importStyles:function(){for(var _len13=arguments.length,urls=new Array(_len13),_key13=0;_key13<_len13;_key13++)urls[_key13]=arguments[_key13];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addStyle(url)}}))):addStyle(oneOrSeries)})))}}}(),importScripts=_ref7.importScripts,importStyles=_ref7.importStyles,parse=function(){var tokenTable=enumFrom({$:"State.variables.",_:"State.temporary.",to:"=",eq:"==",neq:"!=",is:"===",isnot:"!==",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'}),parseRe=new RegExp(["(?:\"\"|''|``)",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(`(?:\\\\.|[^`\\\\])+`)","(?:[=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)","([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+)"].join("|"),"g"),notSpaceRe=/\S/,varTest=new RegExp("^".concat(Patterns.variable)),withColonTestRe=/^\s*:/,withNotTestRe=/^\s+not\b/;function parse(rawCodeString){if(0!==parseRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start");for(var match,code=rawCodeString;null!==(match=parseRe.exec(code));)if(match[1]){var rawTemplate=match[1],parsedTemplate=parseTemplate(rawTemplate);parsedTemplate!==rawTemplate&&(code=code.splice(match.index,rawTemplate.length,parsedTemplate),parseRe.lastIndex+=parsedTemplate.length-rawTemplate.length)}else if(match[2]){var token=match[2];if("$"===token||"_"===token)continue;if(varTest.test(token))token=token[0];else if("is"===token){var start=parseRe.lastIndex,ahead=code.slice(start);withNotTestRe.test(ahead)&&(code=code.splice(start,ahead.search(notSpaceRe)),token="isnot")}else{var _ahead=code.slice(parseRe.lastIndex);if(withColonTestRe.test(_ahead))continue}tokenTable[token]&&(code=code.splice(match.index,token.length,tokenTable[token]),parseRe.lastIndex+=tokenTable[token].length-token.length)}return code}var templateGroupStartRe=/\$\{/g,templateGroupParseRe=new RegExp(["(?:\"\"|'')",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(\\{)","(\\})"].join("|"),"g");function parseTemplate(rawTemplateLiteral){if(0!==templateGroupStartRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start of template literal");for(var startMatch,template=rawTemplateLiteral;null!==(startMatch=templateGroupStartRe.exec(template));){var startIdx=startMatch.index+2,endIdx=startIdx,depth=1,endMatch=void 0;for(templateGroupParseRe.lastIndex=startIdx;null!==(endMatch=templateGroupParseRe.exec(template));)if(endMatch[1]?++depth:endMatch[2]&&--depth,0===depth){endIdx=endMatch.index;break}if(endIdx>startIdx){var parseIndex=parseRe.lastIndex,rawGroup=template.slice(startIdx,endIdx);parseRe.lastIndex=0;var parsedGroup=parse(rawGroup);parseRe.lastIndex=parseIndex,template=template.splice(startIdx,rawGroup.length,parsedGroup),templateGroupStartRe.lastIndex+=parsedGroup.length-rawGroup.length}}return template}return parse}();function evalJavaScript(code,output,data){return function(code,output,evalJavaScript$Data$){return eval(code)}.call(output?{output:output}:null,String(code),output,data)}function evalTwineScript(code,output,data){return function(code,output,evalTwineScript$Data$){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output,data)}return Object.preventExtensions(Object.create(null,{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))}(),_ref8=function(){var Lexer=function(){function Lexer(source,initialState){if(_classCallCheck(this,Lexer),arguments.length<2)throw new Error("Lexer constructor called with too few parameters (source:string , initialState:function)");Object.defineProperties(this,{source:{value:source},initial:{value:initialState},state:{writable:!0,value:initialState},start:{writable:!0,value:0},pos:{writable:!0,value:0},depth:{writable:!0,value:0},items:{writable:!0,value:[]},data:{writable:!0,value:{}}})}return _createClass(Lexer,[{key:"reset",value:function(){this.state=this.initial,this.start=0,this.pos=0,this.depth=0,this.items=[],this.data={}}},{key:"run",value:function(){for(;null!==this.state;)this.state=this.state(this);return this.items}},{key:"nextItem",value:function(){for(;0===this.items.length&&null!==this.state;)this.state=this.state(this);return this.items.shift()}},{key:"next",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos++]}},{key:"peek",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos]}},{key:"backup",value:function(num){this.pos-=num||1}},{key:"forward",value:function(num){this.pos+=num||1}},{key:"ignore",value:function(){this.start=this.pos}},{key:"accept",value:function(valid){var ch=this.next();return-1!==ch&&(!!valid.includes(ch)||(this.backup(),!1))}},{key:"acceptRe",value:function(validRe){var ch=this.next();return-1!==ch&&(!!validRe.test(ch)||(this.backup(),!1))}},{key:"acceptRun",value:function(valid){for(;;){var ch=this.next();if(-1===ch)return;if(!valid.includes(ch))break}this.backup()}},{key:"acceptRunRe",value:function(validRe){for(;;){var ch=this.next();if(-1===ch)return;if(!validRe.test(ch))break}this.backup()}},{key:"emit",value:function(type){this.items.push({type:type,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),this.start=this.pos}},{key:"error",value:function(type,message){if(arguments.length<2)throw new Error("Lexer.prototype.error called with too few parameters (type:number , message:string)");return this.items.push({type:type,message:message,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),null}}],[{key:"enumFromNames",value:function(names){var obj=names.reduce((function(obj,name,i){return obj[name]=i,obj}),{});return Object.freeze(Object.assign(Object.create(null),obj))}}]),Lexer}();return{EOF:-1,Lexer:Lexer}}(),EOF=_ref8.EOF,Lexer=_ref8.Lexer,Wikifier=function(){var _optionsStack,lookaheadRe,idOrClassRe,_callDepth=0,Wikifier=function(){function Wikifier(destination,source,options){_classCallCheck(this,Wikifier),Wikifier.Parser.Profile.isEmpty()&&Wikifier.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(source)},options:{writable:!0,value:Object.assign({profile:"all"},options)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:""}}),null==destination?this.output=document.createDocumentFragment():destination.jquery?this.output=destination[0]:this.output=destination;try{++_callDepth,this.subWikify(this.output),1===_callDepth&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--_callDepth}}return _createClass(Wikifier,[{key:"subWikify",value:function(output,terminator,options){var newOptions,oldOptions,oldOutput=this.output;this.output=output,Wikifier.Option.length>0&&(newOptions=Object.assign(newOptions||{},Wikifier.Option.options)),null!==options&&"object"===_typeof(options)&&(newOptions=Object.assign(newOptions||{},options)),newOptions&&(oldOptions=this.options,this.options=Object.assign({},this.options,newOptions));var terminatorMatch,parserMatch,parsersProfile=Wikifier.Parser.Profile.get(this.options.profile),terminatorRegExp=terminator?new RegExp("(?:".concat(terminator,")"),this.options.ignoreTerminatorCase?"gim":"gm"):null;do{if(parsersProfile.parserRegExp.lastIndex=this.nextMatch,terminatorRegExp&&(terminatorRegExp.lastIndex=this.nextMatch),parserMatch=parsersProfile.parserRegExp.exec(this.source),(terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null)&&(!parserMatch||terminatorMatch.index<=parserMatch.index))return terminatorMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,terminatorMatch.index),this.matchStart=terminatorMatch.index,this.matchLength=terminatorMatch[0].length,this.matchText=terminatorMatch[0],this.nextMatch=terminatorRegExp.lastIndex,this.output=oldOutput,void(oldOptions&&(this.options=oldOptions));if(parserMatch){parserMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,parserMatch.index),this.matchStart=parserMatch.index,this.matchLength=parserMatch[0].length,this.matchText=parserMatch[0],this.nextMatch=parsersProfile.parserRegExp.lastIndex;for(var matchingParser=void 0,i=1,iend=parserMatch.length;i<iend;++i)if(parserMatch[i]){matchingParser=i-1;break}if(parsersProfile.parsers[matchingParser].handler(this),null!=TempState.break)break}}while(terminatorMatch||parserMatch);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&"BR"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=oldOutput,oldOptions&&(this.options=oldOptions)}},{key:"outputText",value:function(destination,startPos,endPos){jQuery(destination).append(document.createTextNode(this.source.substring(startPos,endPos)))}},{key:"rawArgs",value:function(){return this._rawArgs}},{key:"fullArgs",value:function(){return Scripting.parse(this._rawArgs)}}],[{key:"wikifyEval",value:function(text){var output=document.createDocumentFragment();new Wikifier(output,text);var errors=output.querySelector(".error");if(null!==errors)throw new Error(errors.textContent.replace(errorPrologRegExp,""));return output}},{key:"createInternalLink",value:function(destination,passage,text,callback){var $link=jQuery(document.createElement("a"));return null!=passage&&($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken"),$link.ariaClick({one:!0},(function(){"function"==typeof callback&&callback(),Engine.play(passage)}))),text&&$link.append(document.createTextNode(text)),destination&&$link.appendTo(destination),$link[0]}},{key:"createExternalLink",value:function(destination,url,text){var $link=jQuery(document.createElement("a")).attr("target","_blank").addClass("link-external").text(text).appendTo(destination);return null!=url&&$link.attr({href:url,tabindex:0}),$link[0]}}]),Wikifier}();return Object.defineProperty(Wikifier,"Option",{value:(_optionsStack=[],Object.preventExtensions(Object.create(null,{length:{get:function(){return _optionsStack.length}},options:{get:function(){return Object.assign.apply(Object,[{}].concat(_toConsumableArray(_optionsStack)))}},clear:{value:function(){_optionsStack=[]}},get:{value:function(idx){return _optionsStack[idx]}},pop:{value:function(){return _optionsStack.pop()}},push:{value:function(options){if("object"!==_typeof(options)||null===options)throw new TypeError("Wikifier.Option.push options parameter must be an object (received: ".concat(getTypeOf(options),")"));return _optionsStack.push(options)}}})))}),Object.defineProperty(Wikifier,"Parser",{value:function(){var _profiles,_parsers=[];function parsersHas(name){return!!_parsers.find((function(parser){return parser.name===name}))}return Object.preventExtensions(Object.create(null,{parsers:{get:function(){return _parsers}},add:{value:function(parser){if("object"!==_typeof(parser))throw new Error("Wikifier.Parser.add parser parameter must be an object");if(!parser.hasOwnProperty("name"))throw new Error('parser object missing required "name" property');if("string"!=typeof parser.name)throw new Error('parser object "name" property must be a string');if(!parser.hasOwnProperty("match"))throw new Error('parser object missing required "match" property');if("string"!=typeof parser.match)throw new Error('parser object "match" property must be a string');if(!parser.hasOwnProperty("handler"))throw new Error('parser object missing required "handler" property');if("function"!=typeof parser.handler)throw new Error('parser object "handler" property must be a function');if(parser.hasOwnProperty("profiles")&&!Array.isArray(parser.profiles))throw new Error('parser object "profiles" property must be an array');if(parsersHas(parser.name))throw new Error('cannot clobber existing parser "'.concat(parser.name,'"'));_parsers.push(parser)}},delete:{value:function(name){var parser=_parsers.find((function(parser){return parser.name===name}));parser&&_parsers.delete(parser)}},isEmpty:{value:function(){return 0===_parsers.length}},has:{value:parsersHas},get:{value:function(name){return _parsers.find((function(parser){return parser.name===name}))||null}},Profile:{value:Object.preventExtensions(Object.create(null,{profiles:{get:function(){return _profiles}},compile:{value:function(){var all=_parsers,core=all.filter((function(parser){return!Array.isArray(parser.profiles)||parser.profiles.includes("core")}));return _profiles=Object.freeze({all:{parsers:all,parserRegExp:new RegExp(all.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")},core:{parsers:core,parserRegExp:new RegExp(core.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")}})}},isEmpty:{value:function(){return"object"!==_typeof(_profiles)||0===Object.keys(_profiles).length}},has:{value:function(profile){return"object"===_typeof(_profiles)&&hasOwn(_profiles,profile)}},get:{value:function(profile){if("object"!==_typeof(_profiles)||!hasOwn(_profiles,profile))throw new Error('nonexistent parser profile "'.concat(profile,'"'));return _profiles[profile]}}}))}}))}()}),Object.defineProperties(Wikifier,{helpers:{value:{}},isExternalLink:{value:isExternalLink},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(Wikifier.helpers,{inlineCss:{value:(lookaheadRe=new RegExp(Patterns.inlineCss,"gm"),idOrClassRe=new RegExp("(".concat(Patterns.cssIdOrClassSigil,")(").concat(Patterns.anyLetter,"+)"),"g"),function(w){var matched,css={classes:[],id:"",styles:{}};do{lookaheadRe.lastIndex=w.nextMatch;var match=lookaheadRe.exec(w.source);if(matched=match&&match.index===w.nextMatch){if(match[1])css.styles[cssPropToDOMProp(match[1])]=match[2].trim();else if(match[3])css.styles[cssPropToDOMProp(match[3])]=match[4].trim();else if(match[5]){var subMatch=void 0;for(idOrClassRe.lastIndex=0;null!==(subMatch=idOrClassRe.exec(match[5]));)"."===subMatch[1]?css.classes.push(subMatch[2]):css.id=subMatch[2]}w.nextMatch=lookaheadRe.lastIndex}}while(matched);return css})},evalText:{value:function(text){var result;try{switch(_typeof(result=Scripting.evalTwineScript(text))){case"string":""===result.trim()&&(result=text);break;case"number":result=String(result);break;default:result=text}}catch(ex){result=text}return result}},evalPassageId:{value:function(passage){return null==passage||Story.has(passage)?passage:Wikifier.helpers.evalText(passage)}},hasBlockContext:{value:function(nodes){for(var hasGCS="function"==typeof window.getComputedStyle,i=nodes.length-1;i>=0;--i){var node=nodes[i];switch(node.nodeType){case Node.ELEMENT_NODE:var tagName=node.nodeName.toUpperCase();if("BR"===tagName)return!0;var styles=hasGCS?window.getComputedStyle(node,null):node.currentStyle;if(styles&&styles.display){if("none"===styles.display)continue;return"block"===styles.display}switch(tagName){case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":return!0}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},shadowHandler:{value:function(){var macroParser=null;function getMacroContextShadowView(){for(var macro=macroParser||function(){if(!macroParser&&!(macroParser=Wikifier.Parser.get("macro")))throw new Error('cannot find "macro" parser');return macroParser}(),view=new Set,context=macro.context;null!==context;context=context.parent)context._shadows&&context._shadows.forEach((function(name){return view.add(name)}));return _toConsumableArray(view)}return function(code){var shadowStore=Object.create(null);return getMacroContextShadowView().forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]})),function(){var shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null;try{return shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;hasOwn(store,varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),Scripting.evalJavaScript(code)}finally{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],hasOwn(valueCache,varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}}()},parseSquareBracketedMarkup:{value:function(){var Item=Lexer.enumFromNames(["Error","DelimLTR","DelimRTL","InnerMeta","ImageMeta","LinkMeta","Link","RightMeta","Setter","Source","Text"]),Delim=Lexer.enumFromNames(["None","LTR","RTL"]);function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexLeftMeta(lexer){if(!lexer.accept("["))return lexer.error(Item.Error,"malformed square-bracketed markup");if(lexer.accept("["))lexer.data.isLink=!0,lexer.emit(Item.LinkMeta);else{if(lexer.accept("<>"),!(lexer.accept("Ii")&&lexer.accept("Mm")&&lexer.accept("Gg")&&lexer.accept("[")))return lexer.error(Item.Error,"malformed square-bracketed markup");lexer.data.isLink=!1,lexer.emit(Item.ImageMeta)}return lexer.depth=2,lexCoreComponents}function lexCoreComponents(lexer){for(var what=lexer.data.isLink?"link":"image",delim=Delim.None;;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup"));break;case"|":delim===Delim.None&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(),lexer.emit(Item.DelimLTR));break;case"-":delim===Delim.None&&">"===lexer.peek()&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(2),lexer.emit(Item.DelimLTR));break;case"<":delim===Delim.None&&"-"===lexer.peek()&&(delim=Delim.RTL,lexer.backup(),lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.DelimRTL));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.InnerMeta),lexer.data.isLink?lexSetter:lexImageLink;case"]":return--lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexImageLink(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup link component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.InnerMeta),lexSetter;case"]":return--lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexSetter(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup setter component"));break;case"'":if(slurpQuote(lexer,"'")===EOF)return lexer.error(Item.Error,"unterminated single quoted string in ".concat(what," markup setter component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)return"]"!==lexer.peek()?lexer.error(Item.Error,"malformed ".concat(what," markup")):(--lexer.depth,lexer.backup(),lexer.emit(Item.Setter),lexer.forward(2),lexer.emit(Item.RightMeta),null)}}return function(w){var lexer=new Lexer(w.source,lexLeftMeta);lexer.start=lexer.pos=w.matchStart;var markup={},items=lexer.run(),last=items.last();return last&&last.type===Item.Error?markup.error=last.message:items.forEach((function(item){var text=item.text.trim();switch(item.type){case Item.ImageMeta:markup.isImage=!0,"<"===text[1]?markup.align="left":">"===text[1]&&(markup.align="right");break;case Item.LinkMeta:markup.isLink=!0;break;case Item.Link:"~"===text[0]?(markup.forceInternal=!0,markup.link=text.slice(1)):markup.link=text;break;case Item.Setter:markup.setter=text;break;case Item.Source:markup.source=text;break;case Item.Text:markup.text=text}})),markup.pos=lexer.pos,markup}}()}}),Wikifier}();!function(){function _verbatimTagHandler(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(match[1]).appendTo(w.output))}Wikifier.Parser.add({name:"quoteByBlock",profiles:["block"],match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("blockquote")).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"quoteByLine",profiles:["block"],match:"^>+",lookahead:/^>+/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,i,destStack=[w.output],curLevel=0,newLevel=w.matchLength;do{if(newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement("blockquote")).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();curLevel=newLevel,w.subWikify(destStack[destStack.length-1],this.terminator),jQuery(document.createElement("br")).appendTo(destStack[destStack.length-1]),this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);(matched=match&&match.index===w.nextMatch)&&(newLevel=match[0].length,w.nextMatch+=match[0].length)}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"macro",profiles:["core"],match:"<<",lookahead:new RegExp("<<(/?".concat(Patterns.macroName,")(?:\\s*)((?:(?:/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/)|(?://.*\\n)|(?:`(?:\\\\.|[^`\\\\])*`)|(?:\"(?:\\\\.|[^\"\\\\])*\")|(?:'(?:\\\\.|[^'\\\\])*')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>"),"gm"),working:{source:"",name:"",arguments:"",index:0},context:null,handler:function(w){var matchStart=this.lookahead.lastIndex=w.matchStart;if(this.parseTag(w)){var macro,nextMatch=w.nextMatch,name=this.working.name,rawArgs=this.working.arguments;try{if(!(macro=Macro.get(name))){if(Macro.tags.has(name)){var tags=Macro.tags.get(name);return appendError(w.output,"child tag <<".concat(name,">> was found outside of a call to its parent macro").concat(1===tags.length?"":"s"," <<").concat(tags.join(">>, <<"),">>"),w.source.slice(matchStart,w.nextMatch))}return appendError(w.output,"macro <<".concat(name,">> does not exist"),w.source.slice(matchStart,w.nextMatch))}var payload=null;if(void 0!==macro.tags&&!(payload=this.parseBody(w,macro)))return w.nextMatch=nextMatch,appendError(w.output,"cannot find a closing tag for macro <<".concat(name,">>"),"".concat(w.source.slice(matchStart,w.nextMatch),"…"));if("function"!=typeof macro.handler)return appendError(w.output,"macro <<".concat(name,">> handler function ").concat(void 0===macro.handler?"does not exist":"is not a function"),w.source.slice(matchStart,w.nextMatch));var args=payload?payload[0].args:this.createArgs(rawArgs,this.skipArgs(macro,macro.name));if(void 0!==macro._MACRO_API){this.context=new MacroContext({macro:macro,name:name,args:args,payload:payload,source:w.source.slice(matchStart,w.nextMatch),parent:this.context,parser:w});try{macro.handler.call(this.context)}finally{this.context=this.context.parent}}else{var prevRawArgs=w._rawArgs;w._rawArgs=rawArgs;try{macro.handler(w.output,name,args,w,payload)}finally{w._rawArgs=prevRawArgs}}}catch(ex){return appendError(w.output,"cannot execute ".concat(macro&&macro.isWidget?"widget":"macro"," <<").concat(name,">>: ").concat(ex.message),w.source.slice(matchStart,w.nextMatch))}finally{this.working.source="",this.working.name="",this.working.arguments="",this.working.index=0}}else w.outputText(w.output,w.matchStart,w.nextMatch)},parseTag:function(w){var match=this.lookahead.exec(w.source);return!(!match||match.index!==w.matchStart||!match[1])&&(w.nextMatch=this.lookahead.lastIndex,this.working.source=w.source.slice(match.index,this.lookahead.lastIndex),this.working.name=match[1],this.working.arguments=match[2],this.working.index=match.index,!0)},parseBody:function(w,macro){for(var openTag=this.working.name,closeTag="/".concat(openTag),closeAlt="end".concat(openTag),bodyTags=!!Array.isArray(macro.tags)&&macro.tags,payload=[],end=-1,opened=1,curSource=this.working.source,curTag=this.working.name,curArgument=this.working.arguments,contentStart=w.nextMatch;-1!==(w.matchStart=w.source.indexOf(this.match,w.nextMatch));)if(this.parseTag(w)){var tagSource=this.working.source,tagName=this.working.name,tagArgs=this.working.arguments,tagBegin=this.working.index,tagEnd=w.nextMatch,hasArgs=""!==tagArgs.trim();switch(tagName){case openTag:++opened;break;case closeAlt:case closeTag:if(hasArgs)throw w.nextMatch=tagBegin+2+tagName.length,new Error('malformed closing tag: "'.concat(tagSource,'"'));--opened;break;default:if(hasArgs&&(tagName.startsWith("/")||tagName.startsWith("end"))){this.lookahead.lastIndex=w.nextMatch=tagBegin+2+tagName.length;continue}if(1===opened&&bodyTags)for(var i=0,iend=bodyTags.length;i<iend;++i)tagName===bodyTags[i]&&(payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),curSource=tagSource,curTag=tagName,curArgument=tagArgs,contentStart=tagEnd)}if(0===opened){payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),end=tagEnd;break}}else this.lookahead.lastIndex=w.nextMatch=w.matchStart+this.match.length;return-1!==end?(w.nextMatch=end,payload):null},createArgs:function(rawArgsString,skipArgs){var args=skipArgs?[]:this.parseArgs(rawArgsString);return Object.defineProperties(args,{raw:{value:rawArgsString},full:{value:Scripting.parse(rawArgsString)}}),args},skipArgs:function(macro,tagName){if(void 0!==macro.skipArgs){var sa=macro.skipArgs;return"boolean"==typeof sa&&sa||Array.isArray(sa)&&sa.includes(tagName)}return void 0!==macro.skipArg0&&(macro.skipArg0&&macro.name===tagName)},parseArgs:function(){var Item=Lexer.enumFromNames(["Error","Bareword","Expression","String","SquareBracket"]),spaceRe=new RegExp(Patterns.space),notSpaceRe=new RegExp(Patterns.notSpace),varTest=new RegExp("^".concat(Patterns.variable));function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexSpace(lexer){var offset=lexer.source.slice(lexer.pos).search(notSpaceRe);if(offset===EOF)return null;switch(0!==offset&&(lexer.pos+=offset,lexer.ignore()),lexer.next()){case"`":return lexExpression;case'"':return lexDoubleQuote;case"'":return lexSingleQuote;case"[":return lexSquareBracket;default:return lexBareword}}function lexExpression(lexer){return slurpQuote(lexer,"`")===EOF?lexer.error(Item.Error,"unterminated backquote expression"):(lexer.emit(Item.Expression),lexSpace)}function lexDoubleQuote(lexer){return slurpQuote(lexer,'"')===EOF?lexer.error(Item.Error,"unterminated double quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSingleQuote(lexer){return slurpQuote(lexer,"'")===EOF?lexer.error(Item.Error,"unterminated single quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSquareBracket(lexer){var what;if(lexer.accept("<>IiMmGg")?(what="image",lexer.acceptRun("<>IiMmGg")):what="link",!lexer.accept("["))return lexer.error(Item.Error,"malformed ".concat(what," markup"));lexer.depth=2;loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case"[":++lexer.depth;break;case"]":if(--lexer.depth,lexer.depth<0)return lexer.error(Item.Error,"unexpected right square bracket ']'");if(1===lexer.depth){if("]"===lexer.next()){--lexer.depth;break loop}lexer.backup()}}return lexer.emit(Item.SquareBracket),lexSpace}function lexBareword(lexer){var offset=lexer.source.slice(lexer.pos).search(spaceRe);return lexer.pos=offset===EOF?lexer.source.length:lexer.pos+offset,lexer.emit(Item.Bareword),offset===EOF?null:lexSpace}return function(rawArgsString){var lexer=new Lexer(rawArgsString,lexSpace),args=[];return lexer.run().forEach((function(item){var arg=item.text;switch(item.type){case Item.Error:throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(item.message));case Item.Bareword:if(varTest.test(arg))arg=State.getVar(arg);else if(/^(?:settings|setup)[.[]/.test(arg))try{arg=Scripting.evalTwineScript(arg)}catch(ex){throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(ex.message))}else if("null"===arg)arg=null;else if("undefined"===arg)arg=undefined;else if("true"===arg)arg=!0;else if("false"===arg)arg=!1;else if("NaN"===arg)arg=NaN;else{var argAsNum=Number(arg);Number.isNaN(argAsNum)||(arg=argAsNum)}break;case Item.Expression:if(""===(arg=arg.slice(1,-1).trim()))arg=undefined;else try{arg=Scripting.evalTwineScript("(".concat(arg,")"))}catch(ex){throw new Error('unable to parse macro argument expression "'.concat(arg,'": ').concat(ex.message))}break;case Item.String:try{arg=Scripting.evalJavaScript(arg)}catch(ex){throw new Error('unable to parse macro argument string "'.concat(arg,'": ').concat(ex.message))}break;case Item.SquareBracket:var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:arg,matchStart:0});if(markup.hasOwnProperty("error"))throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(markup.error));if(markup.pos<arg.length)throw new Error('unable to parse macro argument "'.concat(arg,'": unexpected character(s) "').concat(arg.slice(markup.pos),'" (pos: ').concat(markup.pos,")"));markup.isLink?((arg={isLink:!0}).count=markup.hasOwnProperty("text")?2:1,arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):arg.link,arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.shadowHandler(Scripting.parse(markup.setter)):null):markup.isImage&&(arg=function(source){var imgObj={source:source,isImage:!0};if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(imgObj.source=passage.text,imgObj.passage=passage.title)}return imgObj}(Wikifier.helpers.evalPassageId(markup.source)),markup.hasOwnProperty("align")&&(arg.align=markup.align),markup.hasOwnProperty("text")&&(arg.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("link")&&(arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link)),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.shadowHandler(Scripting.parse(markup.setter)):null)}args.push(arg)})),args}}()}),Wikifier.Parser.add({name:"link",profiles:["core"],match:"\\[\\[[^[]",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{w.nextMatch=markup.pos;var link=Wikifier.helpers.evalPassageId(markup.link),text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):link,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.shadowHandler(Scripting.parse(markup.setter)):null,output=(Config.debug?new DebugView(w.output,"link-markup","[[link]]",w.source.slice(w.matchStart,w.nextMatch)):w).output;markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(output,link,text,setFn):Wikifier.createExternalLink(output,link,text)}}}),Wikifier.Parser.add({name:"urlLink",profiles:["core"],match:Patterns.url,handler:function(w){w.outputText(Wikifier.createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch)}}),Wikifier.Parser.add({name:"image",profiles:["core"],match:"\\[[<>]?[Ii][Mm][Gg]\\[",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{var debugView;w.nextMatch=markup.pos,Config.debug&&(debugView=new DebugView(w.output,"image-markup",markup.hasOwnProperty("link")?"[img[][link]]":"[img[]]",w.source.slice(w.matchStart,w.nextMatch))).modes({block:!0});var source,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.shadowHandler(Scripting.parse(markup.setter)):null,el=(Config.debug?debugView:w).output;if(markup.hasOwnProperty("link")){var link=Wikifier.helpers.evalPassageId(markup.link);(el=markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(el,link,null,setFn):Wikifier.createExternalLink(el,link)).classList.add("link-image")}if(el=jQuery(document.createElement("img")).appendTo(el).get(0),"data:"!==(source=Wikifier.helpers.evalPassageId(markup.source)).slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(el.setAttribute("data-passage",passage.title),source=passage.text.trim())}el.src=source,markup.hasOwnProperty("text")&&(el.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("align")&&(el.align=markup.align)}}}),Wikifier.Parser.add({name:"monospacedByBlock",profiles:["block"],match:"^\\{\\{\\{\\n",lookahead:/^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){var pre=jQuery(document.createElement("pre"));jQuery(document.createElement("code")).text(match[1]).appendTo(pre),pre.appendTo(w.output),w.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:"formatByChar",profiles:["core"],match:"''|//|__|\\^\\^|~~|==|\\{\\{\\{",handler:function(w){switch(w.matchText){case"''":w.subWikify(jQuery(document.createElement("strong")).appendTo(w.output).get(0),"''");break;case"//":w.subWikify(jQuery(document.createElement("em")).appendTo(w.output).get(0),"//");break;case"__":w.subWikify(jQuery(document.createElement("u")).appendTo(w.output).get(0),"__");break;case"^^":w.subWikify(jQuery(document.createElement("sup")).appendTo(w.output).get(0),"\\^\\^");break;case"~~":w.subWikify(jQuery(document.createElement("sub")).appendTo(w.output).get(0),"~~");break;case"==":w.subWikify(jQuery(document.createElement("s")).appendTo(w.output).get(0),"==");break;case"{{{":var lookahead=/\{\{\{((?:.|\n)*?)\}\}\}/gm;lookahead.lastIndex=w.matchStart;var match=lookahead.exec(w.source);match&&match.index===w.matchStart&&(jQuery(document.createElement("code")).text(match[1]).appendTo(w.output),w.nextMatch=lookahead.lastIndex)}}}),Wikifier.Parser.add({name:"customStyle",profiles:["core"],match:"@@",terminator:"@@",blockRe:/\s*\n/gm,handler:function(w){var css=Wikifier.helpers.inlineCss(w);this.blockRe.lastIndex=w.nextMatch;var blockMatch=this.blockRe.exec(w.source),blockLevel=blockMatch&&blockMatch.index===w.nextMatch,$el=jQuery(document.createElement(blockLevel?"div":"span")).appendTo(w.output);0===css.classes.length&&""===css.id&&0===Object.keys(css.styles).length?$el.addClass("marked"):(css.classes.forEach((function(className){return $el.addClass(className)})),""!==css.id&&$el.attr("id",css.id),$el.css(css.styles)),blockLevel?(w.nextMatch+=blockMatch[0].length,w.subWikify($el[0],"\\n?".concat(this.terminator))):w.subWikify($el[0],this.terminator)}}),Wikifier.Parser.add({name:"verbatimText",profiles:["core"],match:'"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:"{3}((?:.|\n)*?)"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\n)*?)<\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement("span")).addClass("verbatim").text(match[1]||match[2]).appendTo(w.output))}}),Wikifier.Parser.add({name:"horizontalRule",profiles:["core"],match:"^----+\\s*$",handler:function(w){jQuery(document.createElement("hr")).appendTo(w.output)}}),Wikifier.Parser.add({name:"emdash",profiles:["core"],match:"--",handler:function(w){jQuery(document.createTextNode("—")).appendTo(w.output)}}),Wikifier.Parser.add({name:"doubleDollarSign",profiles:["core"],match:"\\${2}",handler:function(w){jQuery(document.createTextNode("$")).appendTo(w.output)}}),Wikifier.Parser.add({name:"nakedVariable",profiles:["core"],match:"".concat(Patterns.variable,"(?:(?:\\.").concat(Patterns.identifier,")|(?:\\[\\d+\\])|(?:\\[\"(?:\\\\.|[^\"\\\\])+\"\\])|(?:\\['(?:\\\\.|[^'\\\\])+'\\])|(?:\\[").concat(Patterns.variable,"\\]))*"),handler:function(w){var result=State.getVar(w.matchText);null==result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"variable",w.matchText,w.matchText):w).output,stringFrom(result))}}),Wikifier.Parser.add({name:"template",profiles:["core"],match:"\\?".concat(Patterns.templateName),handler:function(w){var name=w.matchText.slice(1),template=Template.get(name),result=null;switch(template instanceof Array&&(template=template.random()),_typeof(template)){case"function":try{result=stringFrom(template.call({name:name}))}catch(ex){return appendError(w.output,"cannot execute function template ?".concat(name,": ").concat(ex.message),w.source.slice(w.matchStart,w.nextMatch))}break;case"string":result=template}null===result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"template",w.matchText,w.matchText):w).output,result)}}),Wikifier.Parser.add({name:"heading",profiles:["block"],match:"^!{1,6}",terminator:"\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("h".concat(w.matchLength))).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"table",profiles:["block"],match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:/^\|([^\n]*)\|([fhck]?)$/gm,rowTerminator:"\\|(?:[cfhk]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[cfhk]?$\\n?)",cellTerminator:"(?:\\u0020*)\\|",rowTypes:{c:"caption",f:"tfoot",h:"thead","":"tbody"},handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,table=jQuery(document.createElement("table")).appendTo(w.output).get(0),prevColumns=[],curRowType=null,$rowContainer=null,rowCount=0;w.nextMatch=w.matchStart;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var nextRowType=match[2];"k"===nextRowType?(table.className=match[1],w.nextMatch+=match[0].length+1):(nextRowType!==curRowType&&(curRowType=nextRowType,$rowContainer=jQuery(document.createElement(this.rowTypes[nextRowType])).appendTo(table)),"c"===curRowType?($rowContainer.css("caption-side",0===rowCount?"top":"bottom"),w.nextMatch+=1,w.subWikify($rowContainer[0],this.rowTerminator)):this.rowHandler(w,jQuery(document.createElement("tr")).appendTo($rowContainer).get(0),prevColumns),++rowCount)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))},rowHandler:function(w,rowEl,prevColumns){var matched,_this10=this,cellRe=new RegExp(this.cellPattern,"gm"),col=0,curColCount=1;do{cellRe.lastIndex=w.nextMatch;var cellMatch=cellRe.exec(w.source);if(matched=cellMatch&&cellMatch.index===w.nextMatch){if("~"===cellMatch[1]){var last=prevColumns[col];last&&(++last.rowCount,last.$element.attr("rowspan",last.rowCount).css("vertical-align","middle")),w.nextMatch=cellMatch.index+cellMatch[0].length-1}else if(">"===cellMatch[1])++curColCount,w.nextMatch=cellMatch.index+cellMatch[0].length-1;else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}!function(){++w.nextMatch;for(var css=Wikifier.helpers.inlineCss(w),spaceLeft=!1,spaceRight=!1,$cell=void 0;" "===w.source.substr(w.nextMatch,1);)spaceLeft=!0,++w.nextMatch;"!"===w.source.substr(w.nextMatch,1)?($cell=jQuery(document.createElement("th")).appendTo(rowEl),++w.nextMatch):$cell=jQuery(document.createElement("td")).appendTo(rowEl),prevColumns[col]={rowCount:1,$element:$cell},curColCount>1&&($cell.attr("colspan",curColCount),curColCount=1),w.subWikify($cell[0],_this10.cellTerminator)," "===w.matchText.substr(w.matchText.length-2,1)&&(spaceRight=!0),css.classes.forEach((function(className){return $cell.addClass(className)})),""!==css.id&&$cell.attr("id",css.id),spaceLeft&&spaceRight?css.styles["text-align"]="center":spaceLeft?css.styles["text-align"]="right":spaceRight&&(css.styles["text-align"]="left"),$cell.css(css.styles),w.nextMatch=w.nextMatch-1}()}++col}}while(matched)}}),Wikifier.Parser.add({name:"list",profiles:["block"],match:"^(?:(?:\\*+)|(?:#+))",lookahead:/^(?:(\*+)|(#+))/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){w.nextMatch=w.matchStart;var matched,i,destStack=[w.output],curType=null,curLevel=0;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var newType=match[2]?"ol":"ul",newLevel=match[0].length;if(w.nextMatch+=match[0].length,newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();else newLevel===curLevel&&newType!==curType&&(destStack.pop(),destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0)));curLevel=newLevel,curType=newType,w.subWikify(jQuery(document.createElement("li")).appendTo(destStack[destStack.length-1]).get(0),this.terminator)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"commentByBlock",profiles:["core"],match:"(?:/(?:%|\\*))|(?:\x3c!--)",lookahead:/(?:\/(%|\*)(?:(?:.|\n)*?)\1\/)|(?:<!--(?:(?:.|\n)*?)-->)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:"lineContinuation",profiles:["core"],match:"\\\\".concat(Patterns.spaceNoTerminator,"*\\n|\\n").concat(Patterns.spaceNoTerminator,"*\\\\|\\n?\\\\").concat(Patterns.spaceNoTerminator,"*$|^").concat(Patterns.spaceNoTerminator,"*\\\\\\n?"),handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"lineBreak",profiles:["core"],match:"\\n",handler:function(w){w.options.nobr||jQuery(document.createElement("br")).appendTo(w.output)}}),Wikifier.Parser.add({name:"htmlCharacterReference",profiles:["core"],match:"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)",handler:function(w){jQuery(document.createDocumentFragment()).append(w.matchText).appendTo(w.output)}}),Wikifier.Parser.add({name:"xmlProlog",profiles:["core"],match:"<\\?[Xx][Mm][Ll][^>]*\\?>",handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"verbatimHtml",profiles:["core"],match:"<[Hh][Tt][Mm][Ll]>",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"verbatimScriptTag",profiles:["core"],match:"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\n)*?<\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"styleTag",profiles:["core"],match:"<[Ss][Tt][Yy][Ll][Ee][^>]*>",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\n)*?)(<\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,"g"),hasImageMarkup:new RegExp(Patterns.cssImage),handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){w.nextMatch=this.lookahead.lastIndex;var css=match[2];this.hasImageMarkup.test(css)&&(this.imageMarkup.lastIndex=0,css=css.replace(this.imageMarkup,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text)}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),jQuery(document.createDocumentFragment()).append(match[1]+css+match[3]).appendTo(w.output)}}}),Wikifier.Parser.add({name:"svgTag",profiles:["core"],match:"<[Ss][Vv][Gg][^>]*>",lookahead:/<(\/?)[Ss][Vv][Gg][^>]*>/gm,namespace:"http://www.w3.org/2000/svg",handler:function(w){var _this11=this;this.lookahead.lastIndex=w.nextMatch;for(var match,depth=1;depth>0&&null!==(match=this.lookahead.exec(w.source));)depth+="/"===match[1]?-1:1;if(0===depth){w.nextMatch=this.lookahead.lastIndex;var svgTag=w.source.slice(w.matchStart,this.lookahead.lastIndex),$frag=jQuery(document.createDocumentFragment()).append(svgTag);$frag.find("a[data-passage],image[data-passage]").each((function(_,el){var tagName=el.tagName.toLowerCase();try{_this11.processAttributeDirectives(el)}catch(ex){return appendError(w.output,"svg|<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}el.hasAttribute("data-passage")&&_this11.processDataAttributes(el,tagName)})),$frag.appendTo(w.output)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref9){var name=_ref9.name,value=_ref9.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if("image"===tagName)"data:"!==passage.slice(0,5)&&Story.has(passage)&&(passage=Story.get(passage)).tags.includes("Twine.image")&&el.setAttribute("href",passage.text.trim());else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.shadowHandler(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}}),Wikifier.Parser.add({name:"htmlTag",profiles:["core"],match:"<".concat(Patterns.htmlTagName,"(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>"),tagRe:new RegExp("^<(".concat(Patterns.htmlTagName,")")),mediaTags:["audio","img","source","track","video"],nobrTags:["audio","colgroup","datalist","dl","figure","meter","ol","optgroup","picture","progress","ruby","select","table","tbody","tfoot","thead","tr","ul","video"],voidTags:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],handler:function(w){var tagMatch=this.tagRe.exec(w.matchText),tag=tagMatch&&tagMatch[1],tagName=tag&&tag.toLowerCase();if(tagName){var terminator,terminatorMatch,isVoid=this.voidTags.includes(tagName)||w.matchText.endsWith("/>"),isNobr=this.nobrTags.includes(tagName);if(!isVoid){terminator="<\\/".concat(tagName,"\\s*>");var terminatorRe=new RegExp(terminator,"gim");terminatorRe.lastIndex=w.matchStart,terminatorMatch=terminatorRe.exec(w.source)}if(!isVoid&&!terminatorMatch)return appendError(w.output,"cannot find a closing tag for HTML <".concat(tag,">"),"".concat(w.matchText,"…"));var debugView,output=w.output,el=document.createElement(w.output.tagName);for(el.innerHTML=w.matchText;el.firstChild;)el=el.firstChild;try{this.processAttributeDirectives(el)}catch(ex){return appendError(w.output,"<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}if(el.hasAttribute("data-passage")){if(el.hasAttribute("href"))return appendError(w.output,"<".concat(tagName,'>: elements may not include both "data-passage" and "href" atttributes'),"".concat(w.matchText,"…"));this.processDataAttributes(el,tagName),Config.debug&&((debugView=new DebugView(w.output,"html-".concat(tagName),tagName,w.matchText)).modes({block:"img"===tagName,nonvoid:terminatorMatch}),output=debugView.output)}else el.hasAttribute("href")&&Wikifier.isExternalLink(el.getAttribute("href"))&&el.classList.add("link-external");if(terminatorMatch){try{Wikifier.Option.push({nobr:isNobr}),w.subWikify(el,terminator,{ignoreTerminatorCase:!0})}finally{Wikifier.Option.pop()}debugView&&jQuery(el).find(".debug.block").length>0&&debugView.modes({block:!0})}output.appendChild("track"===tagName?el.cloneNode(!0):el)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref10){var name=_ref10.name,value=_ref10.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if(this.mediaTags.includes(tagName)){if("data:"!==passage.slice(0,5)&&Story.has(passage)){var parentName,twineTag;switch(passage=Story.get(passage),tagName){case"audio":case"video":twineTag="Twine.".concat(tagName);break;case"img":twineTag="Twine.image";break;case"track":twineTag="Twine.vtt";break;case"source":var $parent=$(el).closest("audio,picture,video");$parent.length&&(parentName=$parent.get(0).tagName.toLowerCase(),twineTag="Twine.".concat("picture"===parentName?"image":parentName))}passage.tags.includes(twineTag)&&(el["picture"===parentName?"srcset":"src"]=passage.text.trim())}}else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.shadowHandler(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}})}();var Template=(_templates=new Map,_validNameRe=new RegExp("^(?:".concat(Patterns.templateName,")$")),_validType=function(template){var templateType=_typeof(template);return"function"===templateType||"string"===templateType},Object.preventExtensions(Object.create(null,{add:{value:function(name,template){if(!(_validType(template)||template instanceof Array&&template.length>0&&template.every(_validType)))throw new TypeError("invalid template type (".concat(name,"); templates must be: functions, strings, or an array of either"));(name instanceof Array?name:[name]).forEach((function(name){if(!_validNameRe.test(name))throw new Error('invalid template name "'.concat(name,'"'));if(_templates.has(name))throw new Error("cannot clobber existing template ?".concat(name));_templates.set(name,template)}))}},delete:{value:function(name){(name instanceof Array?name:[name]).forEach((function(name){return _templates.delete(name)}))}},get:{value:function(name){return _templates.has(name)?_templates.get(name):null}},has:{value:function(name){return _templates.has(name)}},size:{get:function(){return _templates.size}}}))),_templates,_validNameRe,_validType,Macro=function(){var _macros={},_tags={},_validNameRe=new RegExp("^(?:".concat(Patterns.macroName,")$"));function macrosHas(name){return hasOwn(_macros,name)}function tagsRegister(parent,bodyTags){if(!parent)throw new Error("no parent specified");for(var endTags=["/".concat(parent),"end".concat(parent)],allTags=[].concat(endTags,Array.isArray(bodyTags)?bodyTags:[]),i=0;i<allTags.length;++i){var tag=allTags[i];if(macrosHas(tag))throw new Error("cannot register tag for an existing macro");tagsHas(tag)?_tags[tag].includes(parent)||(_tags[tag].push(parent),_tags[tag].sort()):_tags[tag]=[parent]}}function tagsUnregister(parent){if(!parent)throw new Error("no parent specified");Object.keys(_tags).forEach((function(tag){var i=_tags[tag].indexOf(parent);-1!==i&&(1===_tags[tag].length?delete _tags[tag]:_tags[tag].splice(i,1))}))}function tagsHas(name){return hasOwn(_tags,name)}return Object.preventExtensions(Object.create(null,{add:{value:function macrosAdd(name,def){if(Array.isArray(name))name.forEach((function(name){return macrosAdd(name,def)}));else{if(!_validNameRe.test(name))throw new Error('invalid macro name "'.concat(name,'"'));if(macrosHas(name))throw new Error("cannot clobber existing macro <<".concat(name,">>"));if(tagsHas(name))throw new Error("cannot clobber child tag <<".concat(name,">> of parent macro").concat(1===_tags[name].length?"":"s"," <<").concat(_tags[name].join(">>, <<"),">>"));try{if("object"===_typeof(def))_macros[name]=Object.assign(Object.create(null),def,{_MACRO_API:!0});else{if(!macrosHas(def))throw new Error("cannot create alias of nonexistent macro <<".concat(def,">>"));_macros[name]=Object.create(_macros[def],{_ALIAS_OF:{enumerable:!0,value:def}})}Object.defineProperty(_macros,name,{writable:!1})}catch(ex){throw"TypeError"===ex.name?new Error("cannot clobber protected macro <<".concat(name,">>")):new Error("unknown error when attempting to add macro <<".concat(name,">>: [").concat(ex.name,"] ").concat(ex.message))}if(void 0!==_macros[name].tags)if(null==_macros[name].tags)tagsRegister(name);else{if(!Array.isArray(_macros[name].tags))throw new Error('bad value for "tags" property of macro <<'.concat(name,">>"));tagsRegister(name,_macros[name].tags)}}}},delete:{value:function macrosDelete(name){if(Array.isArray(name))name.forEach((function(name){return macrosDelete(name)}));else if(macrosHas(name)){void 0!==_macros[name].tags&&tagsUnregister(name);try{Object.defineProperty(_macros,name,{writable:!0}),delete _macros[name]}catch(ex){throw new Error("unknown error removing macro <<".concat(name,">>: ").concat(ex.message))}}else if(tagsHas(name))throw new Error("cannot remove child tag <<".concat(name,">> of parent macro <<").concat(_tags[name],">>"))}},isEmpty:{value:function(){return 0===Object.keys(_macros).length}},has:{value:macrosHas},get:{value:function(name){var macro=null;return macrosHas(name)&&"function"==typeof _macros[name].handler?macro=_macros[name]:hasOwn(macros,name)&&"function"==typeof macros[name].handler&&(macro=macros[name]),macro}},init:{value:function(){var handler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"init";Object.keys(_macros).forEach((function(name){"function"==typeof _macros[name][handler]&&_macros[name][handler](name)})),Object.keys(macros).forEach((function(name){"function"==typeof macros[name][handler]&&macros[name][handler](name)}))}},tags:{value:Object.preventExtensions(Object.create(null,{register:{value:tagsRegister},unregister:{value:tagsUnregister},has:{value:tagsHas},get:{value:function(name){return tagsHas(name)?_tags[name]:null}}}))},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),MacroContext=function(){var MacroContext=function(){function MacroContext(contextData){_classCallCheck(this,MacroContext);var context=Object.assign({parent:null,macro:null,name:"",displayName:"",args:null,payload:null,parser:null,source:""},contextData);if(null===context.macro||""===context.name||null===context.parser)throw new TypeError("context object missing required properties");Object.defineProperties(this,{self:{value:context.macro},name:{value:void 0===context.macro._ALIAS_OF?context.name:context.macro._ALIAS_OF},displayName:{value:context.name},args:{value:context.args},payload:{value:context.payload},source:{value:context.source},parent:{value:context.parent},parser:{value:context.parser},_output:{value:context.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}return _createClass(MacroContext,[{key:"output",get:function(){return this._debugViewEnabled?this.debugView.output:this._output}},{key:"shadows",get:function(){return _toConsumableArray(this._shadows)}},{key:"shadowView",get:function(){var view=new Set;return this.contextSelectAll((function(ctx){return ctx._shadows})).forEach((function(ctx){return ctx._shadows.forEach((function(name){return view.add(name)}))})),_toConsumableArray(view)}},{key:"debugView",get:function(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}},{key:"contextHas",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return!0;return!1}},{key:"contextSelect",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return context;return null}},{key:"contextSelectAll",value:function(filter){for(var result=[],context=this;null!==(context=context.parent);)filter(context)&&result.push(context);return result}},{key:"addShadow",value:function(){var _this12=this;this._shadows||(this._shadows=new Set);for(var varRe=new RegExp("^".concat(Patterns.variable,"$")),_len14=arguments.length,names=new Array(_len14),_key14=0;_key14<_len14;_key14++)names[_key14]=arguments[_key14];names.flat(1/0).forEach((function(name){if("string"!=typeof name)throw new TypeError("variable name must be a string; type: ".concat(_typeof(name)));if(!varRe.test(name))throw new Error('invalid variable name "'.concat(name,'"'));_this12._shadows.add(name)}))}},{key:"shadowHandler",value:function(callback,doneCallback,startCallback){var shadowStore,shadowContext=this;return"function"==typeof callback&&(shadowStore=Object.create(null),this.shadowView.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]}))),function(){for(var _len15=arguments.length,args=new Array(_len15),_key15=0;_key15<_len15;_key15++)args[_key15]=arguments[_key15];if("function"==typeof startCallback&&startCallback.apply(this,args),"function"==typeof callback){var contextCache,shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null,macroParser=Wikifier.Parser.get("macro");try{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;hasOwn(store,varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),contextCache=macroParser.context,macroParser.context=shadowContext,callback.apply(this,args)}finally{contextCache!==undefined&&(macroParser.context=contextCache),shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],hasOwn(valueCache,varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}"function"==typeof doneCallback&&doneCallback.apply(this,args)}}},{key:"createDebugView",value:function(name,title){return this._debugView=new DebugView(this._output,"macro",name||this.displayName,title||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}},{key:"removeDebugView",value:function(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}},{key:"error",value:function(message,source){return appendError(this._output,"<<".concat(this.displayName,">>: ").concat(message),source||this.source)}}]),MacroContext}();return Object.defineProperties(MacroContext.prototype,{createShadowWrapper:{value:MacroContext.prototype.shadowHandler}}),MacroContext}();Macro.add(["addclass","toggleclass"],{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("selector"),this.args.length<2&&errors.push("class names"),this.error("no ".concat(errors.join(" or ")," specified"))}var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));switch(this.name){case"addclass":$targets.addClass(this.args[1].trim());break;case"toggleclass":$targets.toggleClass(this.args[1].trim())}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["append","prepend","replace"],{tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this13=this;if(0===this.args.length)return this.error("no selector specified");var $insert,$targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));if(""!==this.payload[0].contents)switch(this.args.length>1&&this.self.t8nRe.test(this.args[1])?(($insert=jQuery(document.createElement("span"))).addClass("macro-".concat(this.name,"-insert macro-").concat(this.name,"-in")),setTimeout((function(){return $insert.removeClass("macro-".concat(_this13.name,"-in"))}),Engine.DOM_DELAY)):$insert=jQuery(document.createDocumentFragment()),$insert.wiki(this.payload[0].contents),this.name){case"replace":$targets.empty();case"append":$targets.append($insert);break;case"prepend":$targets.prepend($insert)}else"replace"===this.name&&$targets.empty();Config.debug&&this.debugView.modes({hidden:!0})}}),function(){if(Has.audio){var errorOnePlaybackAction=function(cur,prev){return'only one playback action allowed per invocation, "'.concat(cur,'" cannot be combined with "').concat(prev,'"')};Macro.add("audio",{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track and/or group IDs"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var selected;try{selected=SimpleAudio.select(this.args[0])}catch(ex){return this.error(ex.message)}for(var action,fadeTo,loop,mute,passage,time,volume,args=this.args.slice(1),fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors=[];return args.length<1&&_errors.push("seconds"),args.length<2&&_errors.push("level"),this.error("fadeoverto missing required ".concat(_errors.join(" and ")," value").concat(_errors.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"time":if(0===args.length)return this.error("time missing required seconds value");if(raw=args.shift(),time=Number.parseFloat(raw),Number.isNaN(time)||!Number.isFinite(time))return this.error("cannot parse time: ".concat(raw));break;case"loop":case"unloop":loop="loop"===arg;break;case"goto":if(0===args.length)return this.error("goto missing required passage title");if(raw=args.shift(),passage="object"===_typeof(raw)?raw.link:raw,!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));break;default:return this.error("unknown action: ".concat(arg))}}try{if(null!=volume&&selected.volume(volume),null!=time&&selected.time(time),null!=mute&&selected.mute(mute),null!=loop&&selected.loop(loop),null!=passage){var nsEnded="ended.macros.macro-".concat(this.name,"_goto");selected.off(nsEnded).one(nsEnded,(function(){selected.off(nsEnded),Engine.play(passage)}))}switch(action){case"fade":selected.fade(fadeOver,fadeTo);break;case"load":selected.load();break;case"pause":selected.pause();break;case"play":selected.playWhenAllowed();break;case"stop":selected.stop();break;case"unload":selected.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("cacheaudio",{handler:function(){var _this14=this;if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track ID"),this.args.length<2&&errors.push("sources"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim(),oldFmtRe=/^format:\s*([\w-]+)\s*;\s*/i;try{SimpleAudio.tracks.add(id,this.args.slice(1).map((function(source){if(oldFmtRe.test(source)){if(Config.debug)return _this14.error('track ID "'.concat(id,'": format specifier migration required, "format:formatId;" → "formatId|"'));source=source.replace(oldFmtRe,"$1|")}return source})))}catch(ex){return this.error(ex.message)}if(Config.debug&&!SimpleAudio.tracks.get(id).hasSource())return this.error('track ID "'.concat(id,'": no supported audio sources found'));Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("createaudiogroup",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no group ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var groupId=String(this.args[0]).trim(),trackIds=[],i=1,len=this.payload.length;i<len;++i){if(this.payload[i].args.length<1)return this.error("no track ID specified");trackIds.push(String(this.payload[i].args[0]).trim()),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.groups.add(groupId,trackIds)}catch(ex){return this.error(ex.message)}Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("createplaylist",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no list ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");var playlist=Macro.get("playlist");if(null!==playlist.from&&"createplaylist"!==playlist.from)return this.error("a playlist has already been defined with <<setplaylist>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var listId=String(this.args[0]).trim(),trackObjs=[],i=1,len=this.payload.length;i<len;++i){if(0===this.payload[i].args.length)return this.error("no track ID specified");for(var trackObj={id:String(this.payload[i].args[0]).trim()},args=this.payload[i].args.slice(1);args.length>0;){var arg=args.shift(),raw=void 0,parsed=void 0;switch(arg){case"copy":case"own":trackObj.own=!0;break;case"rate":args.length>0&&args.shift();break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),parsed=Number.parseFloat(raw),Number.isNaN(parsed)||!Number.isFinite(parsed))return this.error("cannot parse volume: ".concat(raw));trackObj.volume=parsed;break;default:return this.error("unknown action: ".concat(arg))}}trackObjs.push(trackObj),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.lists.add(listId,trackObjs)}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="createplaylist"),Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("masteraudio",{handler:function(){if(0===this.args.length)return this.error("no actions specified");for(var action,mute,muteOnHide,volume,args=this.args.slice(0);args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"mute":case"unmute":mute="mute"===arg;break;case"muteonhide":case"nomuteonhide":muteOnHide="muteonhide"===arg;break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=mute&&SimpleAudio.mute(mute),null!=muteOnHide&&SimpleAudio.muteOnHidden(muteOnHide),null!=volume&&SimpleAudio.volume(volume),action){case"load":SimpleAudio.load();break;case"stop":SimpleAudio.stop();break;case"unload":SimpleAudio.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("playlist",{from:null,handler:function(){var list,args,action,from=this.self.from;if(null===from)return this.error("no playlists have been created");if("createplaylist"===from){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("list ID"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));list=SimpleAudio.lists.get(id),args=this.args.slice(1)}else{if(0===this.args.length)return this.error("no actions specified");list=SimpleAudio.lists.get("setplaylist"),args=this.args.slice(0)}for(var fadeTo,loop,mute,shuffle,volume,fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"skip":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors2=[];return args.length<1&&_errors2.push("seconds"),args.length<2&&_errors2.push("level"),this.error("fadeoverto missing required ".concat(_errors2.join(" and ")," value").concat(_errors2.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"loop":case"unloop":loop="loop"===arg;break;case"shuffle":case"unshuffle":shuffle="shuffle"===arg;break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=volume&&list.volume(volume),null!=mute&&list.mute(mute),null!=loop&&list.loop(loop),null!=shuffle&&list.shuffle(shuffle),action){case"fade":list.fade(fadeOver,fadeTo);break;case"load":list.load();break;case"pause":list.pause();break;case"play":list.playWhenAllowed();break;case"skip":list.skip();break;case"stop":list.stop();break;case"unload":list.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("removeaudiogroup",{handler:function(){if(0===this.args.length)return this.error("no group ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.groups.has(id))return this.error('group "'.concat(id,'" does not exist'));SimpleAudio.groups.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeplaylist",{handler:function(){if(0===this.args.length)return this.error("no list ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));SimpleAudio.lists.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("waitforaudio",{skipArgs:!0,handler:function(){SimpleAudio.loadWithScreen()}})}else Macro.add(["audio","cacheaudio","createaudiogroup","createplaylist","masteraudio","playlist","removeaudiogroup","removeplaylist","waitforaudio"],{skipArgs:!0,handler:function(){Config.debug&&this.debugView.modes({hidden:!0})}})}(),Macro.add(["back","return"],{handler:function(){if(this.args.length>1)return this.error("too many arguments specified, check the documentation for details");var passage,text,$image,$link,momentIndex=-1;if(1===this.args.length&&("object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(passage=this.args[0].link)):(1===this.args[0].count||(text=this.args[0].text),passage=this.args[0].link):1===this.args.length&&(text=this.args[0])),null==passage){for(var i=State.length-2;i>=0;--i)if(State.history[i].title!==State.passage){momentIndex=i,passage=State.history[i].title;break}if(null==passage&&"return"===this.name)for(var _i5=State.expired.length-1;_i5>=0;--_i5)if(State.expired[_i5]!==State.passage){passage=State.expired[_i5];break}}else{if(!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));if("back"===this.name){for(var _i6=State.length-2;_i6>=0;--_i6)if(State.history[_i6].title===passage){momentIndex=_i6;break}if(-1===momentIndex)return this.error('cannot find passage "'.concat(passage,'" in the current story history'))}}if(null==passage)return this.error("cannot find passage");"back"!==this.name||-1!==momentIndex?($link=jQuery(document.createElement("a")).addClass("link-internal").ariaClick({one:!0},"return"===this.name?function(){return Engine.play(passage)}:function(){return Engine.goTo(momentIndex)}),$image&&$link.addClass("link-image")):$link=jQuery(document.createElement("span")).addClass("link-disabled"),$link.addClass("macro-".concat(this.name)).append($image||document.createTextNode(text||L10n.get("macro".concat(this.name.toUpperFirst(),"Text")))).appendTo(this.output)}}),Macro.add(["button","link"],{isAsync:!0,tags:null,handler:function(){var _this15=this;if(0===this.args.length)return this.error("no ".concat("button"===this.name?"button":"link"," text specified"));var passage,$link=jQuery(document.createElement("button"===this.name?"button":"a"));if("object"===_typeof(this.args[0]))if(this.args[0].isImage){var $image=jQuery(document.createElement("img")).attr("src",this.args[0].source).appendTo($link);$link.addClass("link-image"),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link}else $link.append(document.createTextNode(this.args[0].text)),passage=this.args[0].link;else $link.wikiWithOptions({profile:"core"},this.args[0]),passage=this.args.length>1?this.args[1]:undefined;null!=passage?($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken")):$link.addClass("link-internal"),$link.addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:null!=passage?"link":"button",one:null!=passage},this.shadowHandler(""!==this.payload[0].contents?function(){return Wikifier.wikifyEval(_this15.payload[0].contents.trim())}:null,null!=passage?function(){return Engine.play(passage)}:null)).appendTo(this.output)}}),Macro.add("capture",{skipArgs:!0,tags:null,tsVarRe:new RegExp("(".concat(Patterns.variable,")"),"g"),handler:function(){if(0===this.args.raw.length)return this.error("no story/temporary variable list specified");var valueCache={};try{for(var match,tsVarRe=this.self.tsVarRe;null!==(match=tsVarRe.exec(this.args.raw));){var varName=match[1],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;hasOwn(store,varKey)&&(valueCache[varKey]=store[varKey]),this.addShadow(varName)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;hasOwn(valueCache,varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}),Macro.add("checkbox",{isAsync:!0,handler:function(){if(this.args.length<3){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("unchecked value"),this.args.length<3&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=createSlug(varName),uncheckValue=this.args[1],checkValue=this.args[2],el=document.createElement("input");switch(jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:"checkbox",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.shadowHandler((function(){State.setVar(varName,this.checked?checkValue:uncheckValue)}))).appendTo(this.output),this.args[3]){case"autocheck":State.getVar(varName)===checkValue?el.checked=!0:State.setVar(varName,uncheckValue);break;case"checked":el.checked=!0,State.setVar(varName,checkValue);break;default:State.setVar(varName,uncheckValue)}}}),Macro.add("copy",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));jQuery(this.output).append($targets.html()),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["cycle","listbox"],{isAsync:!0,skipArgs:["optionsfrom"],tags:["option","optionsfrom"],handler:function(){var _this16=this;if(0===this.args.length)return this.error("no variable name specified");if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=createSlug(varName),len=this.payload.length;if(1===len)return this.error("no options specified");for(var config={autoselect:!1,once:!1},i=1;i<this.args.length;++i){var arg=this.args[i];switch(arg){case"once":config.once=!0;break;case"autoselect":config.autoselect=!0;break;default:return this.error("unknown argument: ".concat(arg))}}for(var options=[],tagCount={option:0,optionsfrom:0},selectedIdx=-1,_i7=1;_i7<len;++_i7){var payload=this.payload[_i7];if("option"===payload.name){if(++tagCount.option,0===payload.args.length)return this.error("no arguments specified for <<".concat(payload.name,">> (#").concat(tagCount.option,")"));var option={label:String(payload.args[0])},isSelected=!1;switch(payload.args.length){case 1:option.value=payload.args[0];break;case 2:"selected"===payload.args[1]?(option.value=payload.args[0],isSelected=!0):option.value=payload.args[1];break;default:option.value=payload.args[1],"selected"===payload.args[2]&&(isSelected=!0)}if(options.push(option),isSelected){if(config.autoselect)return this.error("cannot specify both the autoselect and selected keywords");if(-1!==selectedIdx)return this.error("multiple selected keywords specified for <<".concat(payload.name,">> (#").concat(selectedIdx+1," & #").concat(tagCount.option,")"));selectedIdx=options.length-1}}else{var _ret=function(){if(++tagCount.optionsfrom,0===payload.args.full.length)return{v:_this16.error("no expression specified for <<".concat(payload.name,">> (#").concat(tagCount.optionsfrom,")"))};var result=void 0;try{var exp=payload.args.full;result=Scripting.evalJavaScript("{"===exp[0]?"(".concat(exp,")"):exp)}catch(ex){return{v:_this16.error("bad evaluation: ".concat(getErrorMessage(ex)))}}if("object"!==_typeof(result)||null===result)return{v:_this16.error("expression must yield a supported collection or generic object (type: ".concat(null===result?"null":_typeof(result),")"))};if(result instanceof Array||result instanceof Set)result.forEach((function(val){return options.push({label:String(val),value:val})}));else if(result instanceof Map)result.forEach((function(val,key){return options.push({label:String(key),value:val})}));else{var oType=getToStringTag(result);if("Object"!==oType)return{v:_this16.error("expression must yield a supported collection or generic object (object type: ".concat(oType,")"))};Object.keys(result).forEach((function(key){return options.push({label:key,value:result[key]})}))}}();if("object"===_typeof(_ret))return _ret.v}}if(-1===selectedIdx)if(config.autoselect){var curValue=State.getVar(varName),curValueIdx=options.findIndex((function(opt){return sameValueZero(opt.value,curValue)}));selectedIdx=-1===curValueIdx?0:curValueIdx}else selectedIdx=0;if("cycle"===this.name){var lastIdx=options.length-1;if(config.once&&selectedIdx===lastIdx)jQuery(this.output).wikiWithOptions({profile:"core"},options[selectedIdx].label);else{var cycleIdx=selectedIdx;jQuery(document.createElement("a")).wikiWithOptions({profile:"core"},options[selectedIdx].label).attr("id","".concat(this.name,"-").concat(varId)).addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:"button"},this.shadowHandler((function(){var $this=$(this);cycleIdx=(cycleIdx+1)%options.length,State.setVar(varName,options[cycleIdx].value),$this.empty().wikiWithOptions({profile:"core"},options[cycleIdx].label),config.once&&cycleIdx===lastIdx&&$this.off().contents().unwrap()}))).appendTo(this.output)}}else{var $select=jQuery(document.createElement("select"));options.forEach((function(opt,i){jQuery(document.createElement("option")).val(i).text(opt.label).appendTo($select)})),$select.attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),tabindex:0}).addClass("macro-".concat(this.name)).val(selectedIdx).on("change.macros",this.shadowHandler((function(){State.setVar(varName,options[Number(this.value)].value)}))).appendTo(this.output)}State.setVar(varName,options[selectedIdx].value)}}),jQuery(document).on(":dorefresh",(function(ev){var evTags=ev.detail&&ev.detail.tags||[],selector=0===evTags.length?".".concat("dorefresh-target"):evTags.map((function(tag){return".".concat("dorefresh-target",'[data-do-tags~="').concat(tag,'"]')})).join(", ");jQuery(selector).each((function(_,el){jQuery(el).triggerHandler({type:":dorefresh-internal",detail:ev.detail})}))})),Macro.add("do",{tags:null,handler:function(){for(var elTag="span",tags=[],options=this.args.slice();options.length>0;){var option=options.shift();switch(option){case"tag":if(0===options.length)return this.error("tag option missing required tag name(s)");var raw=String(options.shift()).trim();if(""===raw)throw new Error("tag option tag name(s) must be non-empty");tags=String(raw).trim().splitOrEmpty(" ");break;case"element":if(0===options.length)return this.error("element option missing required element tag name");if(""===(elTag=String(options.shift()).trim()))throw new Error("element option tag name must be non-empty");break;default:return this.error("unknown option: ".concat(option))}}var contents=this.payload[0].contents;if(""!==contents.trim()){Config.debug&&this.debugView.modes({block:"span"!==elTag});var $target=jQuery(document.createElement(elTag)).addClass("macro-".concat(this.name," ").concat("dorefresh-target")).attr("data-do-tags",tags.join(" ")).wiki(contents).on(":dorefresh-internal",this.shadowHandler((function(){var frag=document.createDocumentFragment();new Wikifier(frag,contents),$target.empty().append(frag)}))).appendTo(this.output)}}}),Macro.add("refresh",{handler:function(){var tags=this.args.length>0?String(this.args[0]).trim().splitOrEmpty(" "):[];jQuery(document).trigger({type:":dorefresh",detail:{tags:tags}})}}),Macro.add("done",{skipArgs:!0,tags:null,handler:function(){var contents=this.payload[0].contents.trim();""!==contents&&setTimeout(this.shadowHandler((function(){return $.wiki(contents)})),Engine.DOM_DELAY)}}),Macro.add("for",{skipArgs:!0,tags:null,hasRangeRe:new RegExp("^\\S".concat(Patterns.anyChar,"*?\\s+range\\s+\\S").concat(Patterns.anyChar,"*?$")),rangeRe:new RegExp("^(?:State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")\\s*,\\s*)?State\\.(variables|temporary)\\.(").concat(Patterns.identifier,")\\s+range\\s+(\\S").concat(Patterns.anyChar,"*?)$")),threePartRe:/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/,forInRe:/^\S+\s+in\s+\S+/i,forOfRe:/^\S+\s+of\s+\S+/i,handler:function(){var argsStr=this.args.full.trim(),payload=this.payload[0].contents.replace(/\n$/,"");if(0===argsStr.length)this.self.handleFor.call(this,payload,null,!0,null);else if(this.self.hasRangeRe.test(argsStr)){var parts=argsStr.match(this.self.rangeRe);if(null===parts)return this.error("invalid range form syntax, format: [index ,] value range collection");this.self.handleForRange.call(this,payload,{type:parts[1],name:parts[2]},{type:parts[3],name:parts[4]},parts[5])}else{var init,condition,post;if(-1===argsStr.indexOf(";")){if(this.self.forInRe.test(argsStr))return this.error("invalid syntax, for…in is not supported; see: for…range");if(this.self.forOfRe.test(argsStr))return this.error("invalid syntax, for…of is not supported; see: for…range");condition=argsStr}else{var _parts=argsStr.match(this.self.threePartRe);if(null===_parts)return this.error("invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]");init=_parts[1],condition=_parts[2].trim(),post=_parts[3],0===condition.length&&(condition=!0)}this.self.handleFor.call(this,payload,init,condition,post)}},handleFor:function(payload,init,condition,post){var evalJavaScript=Scripting.evalJavaScript,first=!0,safety=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,init)try{evalJavaScript(init)}catch(ex){return this.error("bad init expression: ".concat(getErrorMessage(ex)))}for(;evalJavaScript(condition);){if(--safety<0)return this.error("exceeded configured maximum loop iterations (".concat(Config.macros.maxLoopIterations,")"));if(new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(post)try{evalJavaScript(post)}catch(ex){return this.error("bad post expression: ".concat(getErrorMessage(ex)))}}}catch(ex){return this.error("bad conditional expression: ".concat(getErrorMessage(ex)))}finally{TempState.break=null}},handleForRange:function(payload,indexVar,valueVar,rangeExp){var rangeList,first=!0;try{rangeList=this.self.toRangeList(rangeExp)}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(var i=0;i<rangeList.length;++i)if(indexVar.name&&(State[indexVar.type][indexVar.name]=rangeList[i][0]),State[valueVar.type][valueVar.name]=rangeList[i][1],new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(ex){return this.error(getErrorMessage(ex))}finally{TempState.break=null}},toRangeList:function(rangeExp){var value,list,evalJavaScript=Scripting.evalJavaScript;try{value=evalJavaScript("{"===rangeExp[0]?"(".concat(rangeExp,")"):rangeExp)}catch(ex){if("object"!==_typeof(ex))throw new Error("bad range expression: ".concat(ex));throw ex.message="bad range expression: ".concat(ex.message),ex}switch(_typeof(value)){case"string":list=[];for(var i=0;i<value.length;){var obj=characterAndPosAt(value,i);list.push([i,obj.char]),i=1+obj.end}break;case"object":if(Array.isArray(value))list=value.map((function(val,i){return[i,val]}));else if(value instanceof Set)list=_toConsumableArray(value).map((function(val,i){return[i,val]}));else if(value instanceof Map)list=_toConsumableArray(value.entries());else{if("Object"!==getToStringTag(value))throw new Error("unsupported range expression type: ".concat(getToStringTag(value)));list=Object.keys(value).map((function(key){return[key,value[key]]}))}break;default:throw new Error("unsupported range expression type: ".concat(_typeof(value)))}return list}}),Macro.add(["break","continue"],{skipArgs:!0,handler:function(){if(!this.contextHas((function(ctx){return"for"===ctx.name})))return this.error("must only be used in conjunction with its parent macro <<for>>");TempState.break="continue"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("goto",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?void setTimeout((function(){return Engine.play(passage)}),Engine.DOM_DELAY):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("if",{skipArgs:!0,tags:["elseif","else"],elseifWsRe:/^\s*if\b/i,ifAssignRe:/[^!=&^|<>*/%+-]=[^=>]/,handler:function(){var i;try{var len=this.payload.length,elseifWsRe=this.self.elseifWsRe,ifAssignRe=this.self.ifAssignRe;for(i=0;i<len;++i)if("else"===this.payload[i].name){if(this.payload[i].args.raw.length>0)return elseifWsRe.test(this.payload[i].args.raw)?this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause'.concat(i>0?" (#".concat(i,")"):"")):this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<else>> must be the final clause")}else{if(0===this.payload[i].args.full.length)return this.error("no conditional expression specified for <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#".concat(i,")"):""));if(Config.macros.ifAssignmentError&&ifAssignRe.test(this.payload[i].args.full))return this.error("assignment operator found within <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#".concat(i,")"):""," (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: ").concat(this.payload[i].args.raw))}var evalJavaScript=Scripting.evalJavaScript,success=!1;for(i=0;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"else"===this.payload[i].name||evalJavaScript(this.payload[i].args.full)){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!success,invalid:!success})}}catch(ex){return this.error("bad conditional expression in <<".concat(0===i?"if":"elseif",">> clause").concat(i>0?" (#".concat(i,")"):"",": ").concat(getErrorMessage(ex)))}}}),Macro.add("include",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?(Config.debug&&this.debugView.modes({block:!0}),passage=Story.get(passage),void(this.args[1]?jQuery(document.createElement(this.args[1])).addClass("".concat(passage.domId," macro-").concat(this.name)).attr("data-passage",passage.title).appendTo(this.output):jQuery(this.output)).wiki(passage.processText())):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add(["linkappend","linkprepend","linkreplace"],{isAsync:!0,tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this17=this;if(0===this.args.length)return this.error("no link text specified");var $link=jQuery(document.createElement("a")),$insert=jQuery(document.createElement("span")),transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]);$link.wikiWithOptions({profile:"core"},this.args[0]).addClass("link-internal macro-".concat(this.name)).ariaClick({namespace:".macros",one:!0},this.shadowHandler((function(){if("linkreplace"===_this17.name?$link.remove():$link.wrap('<span class="macro-'.concat(_this17.name,'"></span>')).replaceWith((function(){return $link.html()})),""!==_this17.payload[0].contents){var frag=document.createDocumentFragment();new Wikifier(frag,_this17.payload[0].contents),$insert.append(frag)}transition&&setTimeout((function(){return $insert.removeClass("macro-".concat(_this17.name,"-in"))}),Engine.DOM_DELAY)}))).appendTo(this.output),$insert.addClass("macro-".concat(this.name,"-insert")),transition&&$insert.addClass("macro-".concat(this.name,"-in")),"linkprepend"===this.name?$insert.insertBefore($link):$insert.insertAfter($link)}}),Macro.add("nobr",{skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/^\n+|\n+$/g,"").replace(/\n+/g," "))}}),Macro.add(["numberbox","textbox"],{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var asNumber="numberbox"===this.name,defaultValue=asNumber?Number(this.args[1]):this.args[1];if(asNumber&&Number.isNaN(defaultValue))return this.error('default value "'.concat(this.args[1],'" is neither a number nor can it be parsed into a number'));var passage,varId=createSlug(varName),el=document.createElement("input"),autofocus=!1;this.args.length>3?(passage=this.args[2],autofocus="autofocus"===this.args[3]):this.args.length>2&&("autofocus"===this.args[2]?autofocus=!0:passage=this.args[2]),"object"===_typeof(passage)&&(passage=passage.link),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:asNumber?"number":"text",inputmode:asNumber?"decimal":"text",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.shadowHandler((function(){State.setVar(varName,asNumber?Number(this.value):this.value)}))).on("keypress.macros",this.shadowHandler((function(ev){13===ev.which&&(ev.preventDefault(),State.setVar(varName,asNumber?Number(this.value):this.value),null!=passage&&Engine.play(passage))}))).appendTo(this.output),asNumber&&(el.step="any"),State.setVar(varName,defaultValue),el.value=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.DOM_DELAY)})}}),Macro.add(["print","=","-"],{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{var result=stringFrom(Scripting.evalJavaScript(this.args.full));null!==result&&new Wikifier(this.output,"-"===this.name?encodeEntities(result):result)}catch(ex){return this.error("bad evaluation: ".concat(getErrorMessage(ex)))}}}),Macro.add("radiobutton",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=createSlug(varName),checkValue=this.args[1],el=document.createElement("input");switch(TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(varId)||(TempState[this.name][varId]=0),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId,"-").concat(TempState[this.name][varId]++),name:"".concat(this.name,"-").concat(varId),type:"radio",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.shadowHandler((function(){this.checked&&State.setVar(varName,checkValue)}))).appendTo(this.output),this.args[2]){case"autocheck":State.getVar(varName)===checkValue&&(el.checked=!0);break;case"checked":el.checked=!0,State.setVar(varName,checkValue)}}}),Macro.add("remove",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));$targets.remove(),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeclass",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));this.args.length>1?$targets.removeClass(this.args[1].trim()):$targets.removeClass(),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("repeat",{isAsync:!0,tags:null,timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){var delay,_this18=this;if(0===this.args.length)return this.error("no time value specified");try{delay=Math.max(Engine.DOM_DELAY,cssTimeToMS(this.args[0]))}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerInterval(this.shadowHandler((function(){var frag=document.createDocumentFragment();new Wikifier(frag,_this18.payload[0].contents);var $output=$wrapper;transition&&($output=jQuery(document.createElement("span")).addClass("macro-repeat-insert macro-repeat-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-repeat-in")}),Engine.DOM_DELAY)})),delay)},registerInterval:function(callback,delay){var _this19=this;if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null;timerId=setInterval((function(){if(State.passage!==passage||State.turns!==turn)return clearInterval(timerId),void timers.delete(timerId);var timerIdCache;try{TempState.break=null,TempState.hasOwnProperty("repeatTimerId")&&(timerIdCache=TempState.repeatTimerId),TempState.repeatTimerId=timerId,callback.call(_this19)}finally{void 0!==timerIdCache?TempState.repeatTimerId=timerIdCache:delete TempState.repeatTimerId,TempState.break=null}}),delay),timers.add(timerId),prehistory.hasOwnProperty("#repeat-timers-cleanup")||(prehistory["#repeat-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearInterval(timerId)})),timers.clear()})}}),Macro.add("stop",{skipArgs:!0,handler:function(){if(!TempState.hasOwnProperty("repeatTimerId"))return this.error("must only be used in conjunction with its parent macro <<repeat>>");var timers=Macro.get("repeat").timers,timerId=TempState.repeatTimerId;clearInterval(timerId),timers.delete(timerId),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("script",{skipArgs:!0,tags:null,handler:function(){var output=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,output)}catch(ex){return this.error("bad evaluation: ".concat(getErrorMessage(ex)))}Config.debug&&this.createDebugView(),output.hasChildNodes()&&this.output.appendChild(output)}}),Macro.add("set",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat(getErrorMessage(ex)))}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("run","set"),Macro.add("silent",{skipArgs:!0,tags:null,handler:function(){var frag=document.createDocumentFragment();if(new Wikifier(frag,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({block:!0,hidden:!0}),this.output.appendChild(frag);else{var errList=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent}));if(errList.length>0)return this.error("error".concat(1===errList.length?"":"s"," within contents (").concat(errList.join("; "),")"))}}}),Macro.add("switch",{skipArgs:["switch"],tags:["case","default"],handler:function(){if(0===this.args.full.length)return this.error("no expression specified");var i,result,len=this.payload.length;if(1===len)return this.error("no cases specified");for(i=1;i<len;++i)if("default"===this.payload[i].name){if(this.payload[i].args.length>0)return this.error("<<default>> does not accept values, invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<default>> must be the final case")}else if(0===this.payload[i].args.length)return this.error("no value(s) specified for <<".concat(this.payload[i].name,">> (#").concat(i,")"));try{result=Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat(getErrorMessage(ex)))}var debugView=this.debugView,success=!1;for(Config.debug&&debugView.modes({nonvoid:!1,hidden:!0}),i=1;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"default"===this.payload[i].name||this.payload[i].args.some((function(val){return val===result}))){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});debugView.modes({nonvoid:!1,hidden:!0,invalid:!success}),this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0,invalid:!success})}}}),Macro.add("textarea",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var varId=createSlug(varName),defaultValue=this.args[1],autofocus="autofocus"===this.args[2],el=document.createElement("textarea");jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),rows:4,tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.shadowHandler((function(){State.setVar(varName,this.value)}))).appendTo(this.output),State.setVar(varName,defaultValue),el.textContent=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.DOM_DELAY)})}}),Macro.add("timed",{isAsync:!0,tags:["next"],timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){if(0===this.args.length)return this.error("no time value specified in <<timed>>");var i,items=[];try{items.push({name:this.name,source:this.source,delay:Math.max(Engine.DOM_DELAY,cssTimeToMS(this.args[0])),content:this.payload[0].contents})}catch(ex){return this.error("".concat(ex.message," in <<timed>>"))}if(this.payload.length>1)try{var len;for(i=1,len=this.payload.length;i<len;++i)items.push({name:this.payload[i].name,source:this.payload[i].source,delay:0===this.payload[i].args.length?items[items.length-1].delay:Math.max(Engine.DOM_DELAY,cssTimeToMS(this.payload[i].args[0])),content:this.payload[i].contents})}catch(ex){return this.error("".concat(ex.message," in <<next>> (#").concat(i,")"))}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerTimeout(this.shadowHandler((function(item){var frag=document.createDocumentFragment();new Wikifier(frag,item.content);var $output=$wrapper;Config.debug&&"next"===item.name&&($output=jQuery(new DebugView($output[0],"macro",item.name,item.source).output)),transition&&($output=jQuery(document.createElement("span")).addClass("macro-timed-insert macro-timed-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-timed-in")}),Engine.DOM_DELAY)})),items)},registerTimeout:function(callback,items){if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null,nextItem=items.shift();timerId=setTimeout((function worker(){if(timers.delete(timerId),State.passage===passage&&State.turns===turn){var curItem=nextItem;null!=(nextItem=items.shift())&&(timerId=setTimeout(worker,nextItem.delay),timers.add(timerId)),callback.call(this,curItem)}}),nextItem.delay),timers.add(timerId),prehistory.hasOwnProperty("#timed-timers-cleanup")||(prehistory["#timed-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearTimeout(timerId)})),timers.clear()})}}),Macro.add("type",{isAsync:!0,tags:null,typeId:0,handler:function(){if(0===this.args.length)return this.error("no speed specified");var cursor,speed=cssTimeToMS(this.args[0]);if(speed<0)return this.error("speed time value must be non-negative (received: ".concat(this.args[0],")"));for(var elClass="",elId="",elTag="div",skipKey=Config.macros.typeSkipKey,start=400,options=this.args.slice(1);options.length>0;){var option=options.shift();switch(option){case"class":if(0===options.length)return this.error("class option missing required class name(s)");if(""===(elClass=options.shift()))throw new Error('class option class name(s) must be non-empty (received: "")');break;case"element":if(0===options.length)return this.error("element option missing required element tag name");if(""===(elTag=options.shift()))throw new Error('element option tag name must be non-empty (received: "")');break;case"id":if(0===options.length)return this.error("id option missing required ID");if(""===(elId=options.shift()))throw new Error('id option ID must be non-empty (received: "")');break;case"keep":cursor="keep";break;case"none":cursor="none";break;case"skipkey":if(0===options.length)return this.error("skipkey option missing required key value");if(""===(skipKey=options.shift()))throw new Error('skipkey option key value must be non-empty (received: "")');break;case"start":if(0===options.length)return this.error("start option missing required time value");var value=options.shift();if((start=cssTimeToMS(value))<0)throw new Error("start option time value must be non-negative (received: ".concat(value,")"));break;default:return this.error("unknown option: ".concat(option))}}var contents=this.payload[0].contents;if(""!==contents.trim()){Config.debug&&this.debugView.modes({block:!0});var className="macro-".concat(this.name),namespace=".".concat(className),$target=jQuery(document.createElement(elTag)).addClass("".concat(className," ").concat(className,"-target")).appendTo(this.output);TempState.macroTypeQueue||(TempState.macroTypeQueue=[],$(document).off(namespace).one(":passageinit".concat(namespace),(function(){return $(document).off(namespace)})));var startTyping=0===TempState.macroTypeQueue.length,selfId=++this.self.typeId;TempState.macroTypeQueue.push({id:selfId,handler:this.shadowHandler((function(){var $wrapper=jQuery(document.createElement(elTag)).addClass(className);elId&&$wrapper.attr("id",elId),elClass&&$wrapper.addClass(elClass),new Wikifier($wrapper,contents);var passage=State.passage,turn=State.turns;if(!Config.macros.typeVisitedPassages&&State.passages.slice(0,-1).some((function(title){return title===passage}))||$wrapper.find(".error").length>0)return $target.replaceWith($wrapper),TempState.macroTypeQueue.shift(),void(TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().handler());var typer=new NodeTyper({targetNode:$wrapper.get(0),classNames:"none"===cursor?null:"".concat(className,"-cursor")});$target.replaceWith($wrapper);var keydownAndNS="keydown".concat(namespace),typingStopAndNS="".concat(":typingstop").concat(namespace);$(document).off(keydownAndNS).on(keydownAndNS,(function(ev){scrubEventKey(ev.key)!==skipKey||ev.target!==document.body&&ev.target!==document.documentElement||(ev.preventDefault(),$(document).off(keydownAndNS),typer.finish())})).one(typingStopAndNS,(function(){TempState.macroTypeQueue&&(0===TempState.macroTypeQueue.length?jQuery.event.trigger(":typingcomplete"):TempState.macroTypeQueue.first().handler())}));var typeNode=function(){var typeNodeMember=function(typeIntervalId){State.passage===passage&&State.turns===turn&&typer.type()||(typeIntervalId&&clearInterval(typeIntervalId),TempState.macroTypeQueue&&TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().id===selfId&&TempState.macroTypeQueue.shift(),$wrapper.trigger(":typingstop"),$wrapper.addClass("".concat(className,"-done")),"keep"===cursor&&$wrapper.addClass("".concat(className,"-cursor")))};$wrapper.trigger(":typingstart"),typeNodeMember();var typeNodeMemberId=setInterval((function(){return typeNodeMember(typeNodeMemberId)}),speed)};start?setTimeout(typeNode,start):typeNode()}))}),startTyping&&(Engine.isPlaying()?$(document).one(":passageend".concat(namespace),(function(){return TempState.macroTypeQueue.first().handler()})):TempState.macroTypeQueue.first().handler())}}}),Macro.add("unset",{skipArgs:!0,jsVarRe:new RegExp("State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story/temporary variable list specified");for(var match,jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var store=State[match[1]],name=match[2];hasOwn(store,name)&&delete store[name]}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("widget",{tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var widgetCode,widgetName=this.args[0],isNonVoid=this.args.length>1&&"container"===this.args[1];if(Macro.has(widgetName)){if(!Macro.get(widgetName).isWidget)return this.error('cannot clobber existing macro "'.concat(widgetName,'"'));Macro.delete(widgetName)}try{var widgetDef={isWidget:!0,handler:(widgetCode=this.payload[0].contents,function(){var shadowStore={};State.temporary.hasOwnProperty("args")&&(shadowStore._args=State.temporary.args),State.temporary.args=_toConsumableArray(this.args),State.temporary.args.raw=this.args.raw,State.temporary.args.full=this.args.full,this.addShadow("_args"),isNonVoid&&(State.temporary.hasOwnProperty("contents")&&(shadowStore._contents=State.temporary.contents),State.temporary.contents=this.payload[0].contents,this.addShadow("_contents")),State.variables.hasOwnProperty("args")&&(shadowStore.$args=State.variables.args),State.variables.args=State.temporary.args,this.addShadow("$args");try{var resFrag=document.createDocumentFragment(),errList=[];if(new Wikifier(resFrag,widgetCode),Array.from(resFrag.querySelectorAll(".error")).forEach((function(errEl){errList.push(errEl.textContent)})),0!==errList.length)return this.error("error".concat(errList.length>1?"s":""," within widget code (").concat(errList.join("; "),")"));this.output.appendChild(resFrag)}catch(ex){return this.error("cannot execute widget: ".concat(ex.message))}finally{shadowStore.hasOwnProperty("_args")?State.temporary.args=shadowStore._args:delete State.temporary.args,isNonVoid&&(shadowStore.hasOwnProperty("_contents")?State.temporary.contents=shadowStore._contents:delete State.temporary.contents),shadowStore.hasOwnProperty("$args")?State.variables.args=shadowStore.$args:delete State.variables.args}})};isNonVoid&&(widgetDef.tags=[]),Macro.add(widgetName,widgetDef),Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error('cannot create widget macro "'.concat(widgetName,'": ').concat(ex.message))}}}),Macro.add("remember",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat(getErrorMessage(ex)))}for(var match,remember=storage.get("remember")||{},jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];remember[name]=State.variables[name]}if(!storage.set("remember",remember))return this.error("unknown error, cannot remember: ".concat(this.args.raw));Config.debug&&this.debugView.modes({hidden:!0})},init:function(){var remember=storage.get("remember");remember&&Object.keys(remember).forEach((function(name){return State.variables[name]=remember[name]}))}}),Macro.add("forget",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story variable list specified");for(var match,remember=storage.get("remember"),jsVarRe=this.self.jsVarRe,needStore=!1;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];hasOwn(State.variables,name)&&delete State.variables[name],remember&&hasOwn(remember,name)&&(needStore=!0,delete remember[name])}if(needStore)if(0===Object.keys(remember).length){if(!storage.delete("remember"))return this.error("unknown error, cannot update remember store")}else if(!storage.set("remember",remember))return this.error("unknown error, cannot update remember store");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("silently","silent"),Macro.add("display","include"),Macro.add("click","link"),Macro.add("actions",{handler:function(){for(var $list=jQuery(document.createElement("ul")).addClass(this.name).appendTo(this.output),i=0;i<this.args.length;++i){var passage=void 0,text=void 0,$image=void 0,setFn=void 0;if("object"===_typeof(this.args[i])?this.args[i].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[i].source),this.args[i].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[i].passage),this.args[i].hasOwnProperty("title")&&$image.attr("title",this.args[i].title),this.args[i].hasOwnProperty("align")&&$image.attr("align",this.args[i].align),passage=this.args[i].link,setFn=this.args[i].setFn):(text=this.args[i].text,passage=this.args[i].link,setFn=this.args[i].setFn):text=passage=this.args[i],!(State.variables.hasOwnProperty("#actions")&&State.variables["#actions"].hasOwnProperty(passage)&&State.variables["#actions"][passage])){var $link=jQuery(Wikifier.createInternalLink(jQuery(document.createElement("li")).appendTo($list),passage,null,function(passage,fn){return function(){State.variables.hasOwnProperty("#actions")||(State.variables["#actions"]={}),State.variables["#actions"][passage]=!0,"function"==typeof fn&&fn()}}(passage,setFn))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text));$image&&$link.addClass("link-image")}}}}),Macro.add("choice",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var passage,text,$image,setFn,$link,choiceId=State.passage;if(1===this.args.length?"object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link,setFn=this.args[0].setFn):(text=this.args[0].text,passage=this.args[0].link,setFn=this.args[0].setFn):text=passage=this.args[0]:(passage=this.args[0],text=this.args[1]),State.variables.hasOwnProperty("#choice")&&State.variables["#choice"].hasOwnProperty(choiceId)&&State.variables["#choice"][choiceId])return $link=jQuery(document.createElement("span")).addClass("link-disabled macro-".concat(this.name)).attr("tabindex",-1).append($image||document.createTextNode(text)).appendTo(this.output),void($image&&$link.addClass("link-image"));$link=jQuery(Wikifier.createInternalLink(this.output,passage,null,(function(){State.variables.hasOwnProperty("#choice")||(State.variables["#choice"]={}),State.variables["#choice"][choiceId]=!0,"function"==typeof setFn&&setFn()}))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text)),$image&&$link.addClass("link-image")}}),Has.audio?(Macro.add("setplaylist",{handler:function(){if(0===this.args.length)return this.error("no track ID(s) specified");var playlist=Macro.get("playlist");if(null!==playlist.from&&"setplaylist"!==playlist.from)return this.error("playlists have already been defined with <<createplaylist>>");try{SimpleAudio.lists.add("setplaylist",this.args.slice(0))}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="setplaylist"),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("stopallaudio",{skipArgs:!0,handler:function(){SimpleAudio.select(":all").stop(),Config.debug&&this.debugView.modes({hidden:!0})}})):Macro.add(["setplaylist","stopallaudio"],{skipArgs:!0,handler:function(){Config.debug&&this.debugView.modes({hidden:!0})}});var Dialog=function(){var _$overlay=null,_$dialog=null,_$dialogTitle=null,_$dialogBody=null,_lastActive=null,_scrollbarWidth=0,_dialogObserver=null;function dialogClose(ev){return _$dialogBody.trigger(":dialogclosing"),jQuery(document).off(".dialog-close"),_dialogObserver?(_dialogObserver.disconnect(),_dialogObserver=null):_$dialogBody.off(".dialog-resize"),jQuery(window).off(".dialog-resize"),_$dialog.removeClass("open").css({left:"",right:"",top:"",bottom:""}),jQuery("#ui-bar,#story").find("[tabindex=-2]").removeAttr("aria-hidden").attr("tabindex",0),jQuery("body>[tabindex=-3]").removeAttr("aria-hidden").removeAttr("tabindex"),_$overlay.removeClass("open"),jQuery(document.documentElement).removeAttr("data-dialog"),_$dialogTitle.empty(),_$dialogBody.empty().removeClass(),null!==_lastActive&&(jQuery(_lastActive).focus(),_lastActive=null),ev&&ev.data&&"function"==typeof ev.data.closeFn&&ev.data.closeFn(ev),_$dialogBody.trigger(":dialogclose"),_$dialogBody.trigger(":dialogclosed"),Dialog}function dialogIsOpen(classNames){return _$dialog.hasClass("open")&&(!classNames||classNames.splitOrEmpty(/\s+/).every((function(cn){return _$dialogBody.hasClass(cn)})))}function dialogOpen(options,closeFn){_$dialogBody.trigger(":dialogopening");var top=jQuery.extend({top:50},options).top;return dialogIsOpen()||(_lastActive=getActiveElement()),jQuery(document.documentElement).attr("data-dialog","open"),_$overlay.addClass("open"),null!==_$dialogBody[0].querySelector("img")&&_$dialogBody.imagesLoaded().always((function(){return _resizeHandler({data:{top:top}})})),jQuery("body>:not(script,#store-area,tw-storydata,#ui-bar,#ui-overlay,#ui-dialog)").attr("tabindex",-3).attr("aria-hidden",!0),jQuery("#ui-bar,#story").find("[tabindex]:not([tabindex^=-])").attr("tabindex",-2).attr("aria-hidden",!0),_$dialog.css(_calcPosition(top)).addClass("open").focus(),jQuery(window).on("resize.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),Has.mutationObserver?(_dialogObserver=new MutationObserver((function(mutations){for(var i=0;i<mutations.length;++i)if("childList"===mutations[i].type){_resizeHandler({data:{top:top}});break}}))).observe(_$dialogBody[0],{childList:!0,subtree:!0}):_$dialogBody.on("DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),jQuery(document).one("click.dialog-close",".ui-close",{closeFn:closeFn},(function(ev){dialogClose(ev)})).one("keypress.dialog-close",".ui-close",(function(ev){13!==ev.which&&32!==ev.which||jQuery(this).trigger("click")})),_$dialogBody.trigger(":dialogopen"),_$dialogBody.trigger(":dialogopened"),Dialog}function _calcPosition(topPos){var top=null!=topPos?topPos:50,$parent=jQuery(window),dialogPos={left:"",right:"",top:"",bottom:""};_$dialog.css(dialogPos);var horzSpace=$parent.width()-_$dialog.outerWidth(!0)-1,vertSpace=$parent.height()-_$dialog.outerHeight(!0)-1;return horzSpace<=32+_scrollbarWidth&&(vertSpace-=_scrollbarWidth),vertSpace<=32+_scrollbarWidth&&(horzSpace-=_scrollbarWidth),dialogPos.left=dialogPos.right=horzSpace<=32?16:horzSpace/2>>0,dialogPos.top=vertSpace<=32?dialogPos.bottom=16:vertSpace/2>top?top:dialogPos.bottom=vertSpace/2>>0,Object.keys(dialogPos).forEach((function(key){""!==dialogPos[key]&&(dialogPos[key]+="px")})),dialogPos}function _resizeHandler(ev){var top=ev&&ev.data&&void 0!==ev.data.top?ev.data.top:50;"block"===_$dialog.css("display")&&(_$dialog.css({display:"none"}),_$dialog.css(jQuery.extend({display:""},_calcPosition(top))))}return Object.preventExtensions(Object.create(null,{append:{value:function(){var _$dialogBody2;return(_$dialogBody2=_$dialogBody).append.apply(_$dialogBody2,arguments),Dialog}},body:{value:function(){return _$dialogBody.get(0)}},close:{value:dialogClose},init:{value:function(){if(!document.getElementById("ui-dialog")){_scrollbarWidth=function(){var scrollbarWidth;try{var inner=document.createElement("p"),outer=document.createElement("div");inner.style.width="100%",inner.style.height="200px",outer.style.position="absolute",outer.style.left="0px",outer.style.top="0px",outer.style.width="100px",outer.style.height="100px",outer.style.visibility="hidden",outer.style.overflow="hidden",outer.appendChild(inner),document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="auto";var w2=inner.offsetWidth;w1===w2&&(w2=outer.clientWidth),document.body.removeChild(outer),scrollbarWidth=w1-w2}catch(ex){}return scrollbarWidth||17}();var $elems=jQuery(document.createDocumentFragment()).append('<div id="ui-overlay" class="ui-close"></div><div id="ui-dialog" tabindex="0" role="dialog" aria-labelledby="ui-dialog-title"><div id="ui-dialog-titlebar"><h1 id="ui-dialog-title"></h1>'+'<button id="ui-dialog-close" class="ui-close" tabindex="0" aria-label="'.concat(L10n.get("close"),'"></button>')+'</div><div id="ui-dialog-body"></div></div>');_$overlay=jQuery($elems.find("#ui-overlay").get(0)),_$dialog=jQuery($elems.find("#ui-dialog").get(0)),_$dialogTitle=jQuery($elems.find("#ui-dialog-title").get(0)),_$dialogBody=jQuery($elems.find("#ui-dialog-body").get(0)),$elems.insertBefore("body>script#script-sugarcube")}}},isOpen:{value:dialogIsOpen},open:{value:dialogOpen},resize:{value:function(data){return _resizeHandler("object"===_typeof(data)?{data:data}:undefined)}},setup:{value:function(title,classNames){return _$dialogBody.empty().removeClass(),null!=classNames&&_$dialogBody.addClass(classNames),_$dialogTitle.empty().append((null!=title?String(title):"")||" "),_$dialogBody.get(0)}},wiki:{value:function(){var _$dialogBody3;return(_$dialogBody3=_$dialogBody).wiki.apply(_$dialogBody3,arguments),Dialog}},addClickHandler:{value:function(targets,options,startFn,doneFn,closeFn){return jQuery(targets).ariaClick((function(ev){ev.preventDefault(),"function"==typeof startFn&&startFn(ev),dialogOpen(options,closeFn),"function"==typeof doneFn&&doneFn(ev)}))}}}))}(),Engine=function(){var States=enumFrom({Init:"init",Idle:"idle",Playing:"playing",Rendering:"rendering"}),_initDebugViews=[],_state=States.Init,_lastPlay=null,_updating=null;function engineGo(offset){var succeded=State.go(offset);return succeded&&engineShow(),succeded}function engineShow(){return enginePlay(State.passage,!0)}function enginePlay(title,noHistory){if(_state===States.Init)return!1;var passageReadyOutput,passageDoneOutput,passageTitle=title;if(_state=States.Playing,TempState={},State.clearTemporary(),"function"==typeof Config.navigation.override)try{var overrideTitle=Config.navigation.override(passageTitle);overrideTitle&&(passageTitle=overrideTitle)}catch(ex){}var passage=Story.get(passageTitle);if(jQuery.event.trigger({type:":passageinit",passage:passage}),Object.keys(prehistory).forEach((function(task){"function"==typeof prehistory[task]&&prehistory[task].call(passage,task)})),noHistory||State.create(passage.title),document.body.className&&(document.body.className=""),_lastPlay=now(),Object.keys(predisplay).forEach((function(task){"function"==typeof predisplay[task]&&predisplay[task].call(passage,task)})),Story.has("PassageReady"))try{passageReadyOutput=Wikifier.wikifyEval(Story.get("PassageReady").text)}catch(ex){console.error(ex),Alert.error("PassageReady",ex.message)}_state=States.Rendering;var dataTags=passage.tags.length>0?passage.tags.join(" "):null,passageEl=document.createElement("div");jQuery(passageEl).attr({id:passage.domId,"data-passage":passage.title,"data-tags":dataTags}).addClass("passage ".concat(passage.className)),jQuery(document.body).attr("data-tags",dataTags).addClass(passage.className),jQuery(document.documentElement).attr("data-tags",dataTags),jQuery.event.trigger({type:":passagestart",content:passageEl,passage:passage}),Object.keys(prerender).forEach((function(task){"function"==typeof prerender[task]&&prerender[task].call(passage,passageEl,task)})),Story.has("PassageHeader")&&new Wikifier(passageEl,Story.get("PassageHeader").processText()),passageEl.appendChild(passage.render()),Story.has("PassageFooter")&&new Wikifier(passageEl,Story.get("PassageFooter").processText()),jQuery.event.trigger({type:":passagerender",content:passageEl,passage:passage}),Object.keys(postrender).forEach((function(task){"function"==typeof postrender[task]&&postrender[task].call(passage,passageEl,task)}));var debugView,containerEl=document.getElementById("passages");if(containerEl.hasChildNodes()&&("number"==typeof Config.passages.transitionOut||"string"==typeof Config.passages.transitionOut&&""!==Config.passages.transitionOut&&Has.transitionEndEvent?_toConsumableArray(containerEl.childNodes).forEach((function(outgoing){var $outgoing=jQuery(outgoing);if(outgoing.nodeType===Node.ELEMENT_NODE&&$outgoing.hasClass("passage")){if($outgoing.hasClass("passage-out"))return;$outgoing.attr({id:"out-".concat($outgoing.attr("id")),"aria-live":"off"}).addClass("passage-out"),"string"==typeof Config.passages.transitionOut?$outgoing.on(Has.transitionEndEvent,(function(ev){ev.propertyName===Config.passages.transitionOut&&$outgoing.remove()})):setTimeout((function(){return $outgoing.remove()}),Math.max(40,Config.passages.transitionOut))}else $outgoing.remove()})):jQuery(containerEl).empty()),jQuery(passageEl).addClass("passage-in").appendTo(containerEl),setTimeout((function(){return jQuery(passageEl).removeClass("passage-in")}),40),Story.has("StoryDisplayTitle")?null===_updating&&Config.ui.updateStoryElements||setDisplayTitle(Story.get("StoryDisplayTitle").processText()):Config.passages.displayTitles&&passage.title!==Config.passages.start&&(document.title="".concat(passage.title," | ").concat(Story.title)),window.scroll(0,0),_state=States.Playing,Story.has("PassageDone"))try{passageDoneOutput=Wikifier.wikifyEval(Story.get("PassageDone").text)}catch(ex){console.error(ex),Alert.error("PassageDone",ex.message)}(jQuery.event.trigger({type:":passagedisplay",content:passageEl,passage:passage}),Object.keys(postdisplay).forEach((function(task){"function"==typeof postdisplay[task]&&postdisplay[task].call(passage,task)})),null!==_updating?_updating.forEach((function(pair){jQuery(pair.element).empty(),new Wikifier(pair.element,Story.get(pair.passage).processText().trim())})):Config.ui.updateStoryElements&&UIBar.update(),Config.debug)&&(null!=passageReadyOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageReady","PassageReady")).modes({hidden:!0}),debugView.append(passageReadyOutput),jQuery(passageEl).prepend(debugView.output)),null!=passageDoneOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageDone","PassageDone")).modes({hidden:!0}),debugView.append(passageDoneOutput),jQuery(passageEl).append(debugView.output)),1===State.turns&&_initDebugViews.length>0&&jQuery(passageEl).prepend(_initDebugViews));switch(jQuery("#story").find("a,link,button,input,select,textarea").not("[tabindex]").attr("tabindex",0),_typeof(Config.saves.autosave)){case"boolean":Config.saves.autosave&&Save.autosave.save();break;case"object":passage.tags.some((function(tag){return Config.saves.autosave.includes(tag)}))&&Save.autosave.save();break;case"function":Config.saves.autosave()&&Save.autosave.save()}return jQuery.event.trigger({type:":passageend",content:passageEl,passage:passage}),_state=States.Idle,_lastPlay=now(),passageEl}return Object.preventExtensions(Object.create(null,{States:{value:States},DOM_DELAY:{value:40},init:{value:function(){_state===States.Init&&(jQuery("#init-no-js,#init-lacking").remove(),function(){var $elems=jQuery(document.createDocumentFragment()),markup=Story.has("StoryInterface")&&Story.get("StoryInterface").text.trim();if(markup){UIBar.destroy(),jQuery(document.head).find("#style-core-display").remove(),$elems.append(markup);var $passages=$elems.find("#passages");if(0===$passages.length)throw new Error('no element with ID "passages" found within "StoryInterface" special passage');$passages.empty().not("[aria-live]").attr("aria-live","polite").end(),$elems.find("[data-init-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-init-passage" content attribute'));var passage=el.getAttribute("data-init-passage").trim();if(el.hasAttribute("data-passage"))throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> must not contain a "data-passage" content attribute'));if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&jQuery(el).empty().wiki(Story.get(passage).processText().trim())}));var updating=[];$elems.find("[data-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-passage" content attribute'));var passage=el.getAttribute("data-passage").trim();if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&updating.push({passage:passage,element:el})})),updating.length>0&&(_updating=updating),Config.ui.updateStoryElements=!1}else $elems.append('<div id="story" role="main"><div id="passages" aria-live="polite"></div></div>');$elems.insertBefore("body>script#script-sugarcube")}())}},runUserScripts:{value:function(){var storyStyle;_state===States.Init&&(storyStyle=document.createElement("style"),new StyleWrapper(storyStyle).add(Story.getAllStylesheet().map((function(style){return style.text.trim()})).join("\n")),jQuery(storyStyle).appendTo(document.head).attr({id:"style-story",type:"text/css"}),Story.getAllScript().forEach((function(script){try{Scripting.evalJavaScript(script.text)}catch(ex){console.error(ex),Alert.error(script.title,getErrorMessage(ex))}})),Story.getAllWidget().forEach((function(widget){try{Wikifier.wikifyEval(widget.processText())}catch(ex){console.error(ex),Alert.error(widget.title,getErrorMessage(ex))}})))}},runUserInit:{value:function(){if(_state===States.Init&&(Story.getAllInit().forEach((function(passage){try{var debugBuffer=Wikifier.wikifyEval(passage.text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","".concat(passage.title," [init-tagged]"),"".concat(passage.title," [init-tagged]"));debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("".concat(passage.title," [init-tagged]"),getErrorMessage(ex))}})),Story.has("StoryInit")))try{var debugBuffer=Wikifier.wikifyEval(Story.get("StoryInit").text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","StoryInit","StoryInit");debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("StoryInit",getErrorMessage(ex))}}},start:{value:function(){if(_state===States.Init){if(null==Config.passages.start)throw new Error("starting passage not selected");if(!Story.has(Config.passages.start))throw new Error('starting passage ("'.concat(Config.passages.start,'") not found'));if(_state=States.Idle,jQuery(document.documentElement).focus(),State.restore())engineShow();else{var loadStart=!0;switch(_typeof(Config.saves.autoload)){case"boolean":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!Save.autosave.load());break;case"string":"prompt"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!1,UI.buildAutoload(),Dialog.open());break;case"function":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(loadStart=!Save.autosave.load())}loadStart&&enginePlay(Config.passages.start)}}}},restart:{value:function(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(":enginerestart"),window.location.reload()}},state:{get:function(){return _state}},isIdle:{value:function(){return _state===States.Idle}},isPlaying:{value:function(){return _state!==States.Idle}},isRendering:{value:function(){return _state===States.Rendering}},lastPlay:{get:function(){return _lastPlay}},goTo:{value:function(idx){var succeded=State.goTo(idx);return succeded&&engineShow(),succeded}},go:{value:engineGo},backward:{value:function(){return engineGo(-1)}},forward:{value:function(){return engineGo(1)}},show:{value:engineShow},play:{value:enginePlay},display:{value:function(title,link,option){var noHistory=!1;switch(option){case undefined:break;case"replace":case"back":noHistory=!0;break;default:throw new Error('Engine.display option parameter called with obsolete value "'.concat(option,'"; please notify the developer'))}enginePlay(title,noHistory)}},minDomActionDelay:{value:40}}))}(),Passage=(_tagsToSkip=/^(?:debug|nobr|passage|widget|twine\..*)$/i,function(){function Passage(title,el){var _this20=this;_classCallCheck(this,Passage),Object.defineProperties(this,{title:{value:decodeEntities(title)},element:{value:el||null},tags:{value:Object.freeze(el&&el.hasAttribute("tags")?Array.from(new Set(el.getAttribute("tags").trim().splitOrEmpty(/\s+/))):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:"passage-".concat(createSlug(this.title))},classes:{value:Object.freeze(0===this.tags.length?[]:_this20.tags.filter((function(tag){return!_tagsToSkip.test(tag)})).map((function(tag){return createSlug(tag)})))}})}return _createClass(Passage,[{key:"className",get:function(){return this.classes.join(" ")}},{key:"text",get:function(){if(null==this.element){var passage=encodeMarkup(this.title),mesg="".concat(L10n.get("errorTitle"),": ").concat(L10n.get("errorNonexistentPassage",{passage:passage}));return'<div class="error-view"><span class="error">'.concat(mesg,"</span></div>")}return this.element.textContent.replace(/\r/g,"")}},{key:"description",value:function(){var descriptions=Config.passages.descriptions;switch(_typeof(descriptions)){case"boolean":if(descriptions)return this.title;break;case"object":if(descriptions.hasOwnProperty(this.title))return descriptions[this.title];break;case"function":var result=descriptions.call(this);if(result)return result}return null===this._excerpt&&(this._excerpt=Passage.getExcerptFromText(this.text)),this._excerpt}},{key:"processText",value:function(){if(null==this.element)return this.text;if(this.tags.includes("Twine.image"))return"[img[".concat(this.text,"]]");var processed=this.text;return Config.passages.onProcess&&(processed=Config.passages.onProcess.call(null,{title:this.title,tags:this.tags,text:processed})),(Config.passages.nobr||this.tags.includes("nobr"))&&(processed=processed.replace(/^\n+|\n+$/g,"").replace(/\n+/g," ")),processed}},{key:"render",value:function(options){var frag=document.createDocumentFragment();return new Wikifier(frag,this.processText(),options),this._excerpt=Passage.getExcerptFromNode(frag),frag}}],[{key:"getExcerptFromNode",value:function(node,count){if(!node.hasChildNodes())return"";var excerpt=node.textContent.trim();if(""!==excerpt){var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})"));excerpt=excerpt.replace(/\s+/g," ").match(excerptRe)}return excerpt?"".concat(excerpt[1],"…"):"…"}},{key:"getExcerptFromText",value:function(text,count){if(""===text)return"";var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})")),excerpt=text.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*?)(?:(?:\||->|<-)[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/'{2}|\/{2}|_{2}|@{2}/g,"").trim().replace(/\s+/g," ").match(excerptRe);return excerpt?"".concat(excerpt[1],"…"):"…"}}]),Passage}()),_tagsToSkip,Save=function(){var Type=enumFrom({Autosave:"autosave",Disk:"disk",Serialize:"serialize",Slot:"slot"}),_slotsUBound=-1,_onLoadHandlers=new Set,_onSaveHandlers=new Set;function savesObjGet(){var saves=storage.get("saves");return null===saves?{autosave:null,slots:_appendSlots([],Config.saves.slots)}:saves}function savesObjClear(){return storage.delete("saves"),!0}function autosaveOk(){return"cookie"!==storage.name&&void 0!==Config.saves.autosave}function slotsOk(){return"cookie"!==storage.name&&-1!==_slotsUBound}function slotsCount(){if(!slotsOk())return 0;for(var saves=savesObjGet(),count=0,i=0,iend=saves.slots.length;i<iend;++i)null!==saves.slots[i]&&++count;return count}function _appendSlots(array,num){for(var i=0;i<num;++i)array.push(null);return array}function _savesObjIsEmpty(saves){for(var slots=saves.slots,isSlotsEmpty=!0,i=0,iend=slots.length;i<iend;++i)if(null!==slots[i]){isSlotsEmpty=!1;break}return null===saves.autosave&&isSlotsEmpty}function _savesObjSave(saves){return _savesObjIsEmpty(saves)?(storage.delete("saves"),!0):storage.set("saves",saves)}function _savesObjUpdate(saveObj){if(null==saveObj||"object"!==_typeof(saveObj))return!1;var updated=!1;return saveObj.hasOwnProperty("state")&&saveObj.state.hasOwnProperty("delta")&&saveObj.state.hasOwnProperty("index")||(saveObj.hasOwnProperty("data")?(delete saveObj.mode,saveObj.state={delta:State.deltaEncode(saveObj.data)},delete saveObj.data):saveObj.state.hasOwnProperty("delta")?saveObj.state.hasOwnProperty("index")||delete saveObj.state.mode:(delete saveObj.state.mode,saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history),saveObj.state.index=saveObj.state.delta.length-1,updated=!0),saveObj.state.hasOwnProperty("rseed")&&(saveObj.state.seed=saveObj.state.rseed,delete saveObj.state.rseed,saveObj.state.delta.forEach((function(_,i,delta){delta[i].hasOwnProperty("rcount")&&(delta[i].pull=delta[i].rcount,delete delta[i].rcount)})),updated=!0),(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired||saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired&&delete saveObj.state.expired,(saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.expired=[],saveObj.state.hasOwnProperty("unique")&&(saveObj.state.expired.push(saveObj.state.unique),delete saveObj.state.unique),saveObj.state.hasOwnProperty("last")&&(saveObj.state.expired.push(saveObj.state.last),delete saveObj.state.last)),updated=!0),updated}function _marshal(supplemental,details){if(null!=supplemental&&"object"!==_typeof(supplemental))throw new Error("supplemental parameter must be an object");var saveObj=Object.assign({},supplemental,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(saveObj.version=Config.saves.version),_onSaveHandlers.forEach((function(fn){return fn(saveObj,details)})),saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history,saveObj}function _unmarshal(saveObj){try{if(_savesObjUpdate(saveObj),!saveObj||!saveObj.hasOwnProperty("id")||!saveObj.hasOwnProperty("state"))throw new Error(L10n.get("errorSaveMissingData"));if(saveObj.state.history=State.deltaDecode(saveObj.state.delta),delete saveObj.state.delta,_onLoadHandlers.forEach((function(fn){return fn(saveObj)})),saveObj.id!==Config.saves.id)throw new Error(L10n.get("errorSaveIdMismatch"));State.unmarshalForSave(saveObj.state),Engine.show()}catch(ex){return UI.alert("".concat(ex.message.toUpperFirst(),".</p><p>").concat(L10n.get("aborting"),".")),!1}return!0}return Object.preventExtensions(Object.create(null,{init:{value:function(){if("cookie"===storage.name)return savesObjClear(),Config.saves.autoload=undefined,Config.saves.autosave=undefined,Config.saves.slots=0,!1;var saves=savesObjGet(),updated=!1;Array.isArray(saves)&&(saves={autosave:null,slots:saves},updated=!0),Config.saves.slots!==saves.slots.length&&(Config.saves.slots<saves.slots.length?(saves.slots.reverse(),saves.slots=saves.slots.filter((function(val){return!(null===val&&this.count>0)||(--this.count,!1)}),{count:saves.slots.length-Config.saves.slots}),saves.slots.reverse()):Config.saves.slots>saves.slots.length&&_appendSlots(saves.slots,Config.saves.slots-saves.slots.length),updated=!0),_savesObjUpdate(saves.autosave)&&(updated=!0);for(var i=0;i<saves.slots.length;++i)_savesObjUpdate(saves.slots[i])&&(updated=!0);return _savesObjIsEmpty(saves)&&(storage.delete("saves"),updated=!1),updated&&_savesObjSave(saves),_slotsUBound=saves.slots.length-1,!0}},get:{value:savesObjGet},clear:{value:savesObjClear},ok:{value:function(){return autosaveOk()||slotsOk()}},autosave:{value:Object.preventExtensions(Object.create(null,{ok:{value:autosaveOk},has:{value:function(){return null!==savesObjGet().autosave}},get:{value:function(){return savesObjGet().autosave}},load:{value:function(){var saves=savesObjGet();return null!==saves.autosave&&_unmarshal(saves.autosave)}},save:{value:function(title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;var saves=savesObjGet(),supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.autosave=_marshal(supplemental,{type:Type.Autosave}),_savesObjSave(saves)}},delete:{value:function(){var saves=savesObjGet();return saves.autosave=null,_savesObjSave(saves)}}}))},slots:{value:Object.preventExtensions(Object.create(null,{ok:{value:slotsOk},length:{get:function(){return _slotsUBound+1}},isEmpty:{value:function(){return 0===slotsCount()}},count:{value:slotsCount},has:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])}},get:{value:function(slot){if(slot<0||slot>_slotsUBound)return null;var saves=savesObjGet();return slot>=saves.slots.length?null:saves.slots[slot]}},load:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])&&_unmarshal(saves.slots[slot])}},save:{value:function(slot,title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),!1;if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();if(slot>=saves.slots.length)return!1;var supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.slots[slot]=_marshal(supplemental,{type:Type.Slot}),_savesObjSave(saves)}},delete:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length)&&(saves.slots[slot]=null,_savesObjSave(saves))}}}))},export:{value:function(filename,metadata){if("function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed()){var baseName=null==filename?Story.domId:createFilename(filename).replace(/[_\s\u2013\u2014-]+/g,"-"),saveName="".concat(baseName,"-").concat(function(){var now=new Date,MM=now.getMonth()+1,DD=now.getDate(),hh=now.getHours(),mm=now.getMinutes(),ss=now.getSeconds();return MM<10&&(MM="0".concat(MM)),DD<10&&(DD="0".concat(DD)),hh<10&&(hh="0".concat(hh)),mm<10&&(mm="0".concat(mm)),ss<10&&(ss="0".concat(ss)),"".concat(now.getFullYear()).concat(MM).concat(DD,"-").concat(hh).concat(mm).concat(ss)}(),".save"),supplemental=null==metadata?{}:{metadata:metadata},saveObj=LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Disk})));saveAs(new Blob([saveObj],{type:"text/plain;charset=UTF-8"}),saveName)}else Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed"))}},import:{value:function(event){var file=event.target.files[0],reader=new FileReader;jQuery(reader).one("loadend",(function(){if(reader.error){var ex=reader.error;UI.alert("".concat(L10n.get("errorSaveDiskLoadFailed").toUpperFirst()," (").concat(ex.name,": ").concat(ex.message,").</p><p>").concat(L10n.get("aborting"),"."))}else{var saveObj;try{saveObj=JSON.parse(/\.json$/i.test(file.name)||/^\{/.test(reader.result)?reader.result:LZString.decompressFromBase64(reader.result))}catch(ex){}_unmarshal(saveObj)}})),reader.readAsText(file)}},serialize:{value:function(metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),null;var supplemental=null==metadata?{}:{metadata:metadata};return LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Serialize})))}},deserialize:{value:function(base64Str){var saveObj;try{saveObj=JSON.parse(LZString.decompressFromBase64(base64Str))}catch(ex){}return _unmarshal(saveObj)?saveObj.metadata:null}},onLoad:{value:Object.preventExtensions(Object.create(null,{add:{value:function(handler){var valueType=getTypeOf(handler);if("function"!==valueType)throw new TypeError("Save.onLoad.add handler parameter must be a function (received: ".concat(valueType,")"));_onLoadHandlers.add(handler)}},clear:{value:function(){_onLoadHandlers.clear()}},delete:{value:function(handler){return _onLoadHandlers.delete(handler)}},size:{get:function(){return _onLoadHandlers.size}}}))},onSave:{value:Object.preventExtensions(Object.create(null,{add:{value:function(handler){var valueType=getTypeOf(handler);if("function"!==valueType)throw new TypeError("Save.onSave.add handler parameter must be a function (received: ".concat(valueType,")"));_onSaveHandlers.add(handler)}},clear:{value:function(){_onSaveHandlers.clear()}},delete:{value:function(handler){return _onSaveHandlers.delete(handler)}},size:{get:function(){return _onSaveHandlers.size}}}))}}))}(),Setting=function(){var Types=enumFrom({Header:0,Toggle:1,List:2,Range:3}),_definitions=[];function settingsCreate(){return Object.create(null)}function settingsSave(){var savedSettings=settingsCreate();return Object.keys(settings).length>0&&_definitions.filter((function(def){return def.type!==Types.Header&&settings[def.name]!==def.default})).forEach((function(def){return savedSettings[def.name]=settings[def.name]})),0===Object.keys(savedSettings).length?(storage.delete("settings"),!0):storage.set("settings",savedSettings)}function settingsLoad(){var defaultSettings=settingsCreate(),loadedSettings=storage.get("settings")||settingsCreate();_definitions.filter((function(def){return def.type!==Types.Header})).forEach((function(def){return defaultSettings[def.name]=def.default})),window.SugarCube.settings=settings=Object.assign(defaultSettings,loadedSettings)}function settingsClear(){return window.SugarCube.settings=settings=settingsCreate(),storage.delete("settings"),!0}function definitionsAdd(type,name,def){if(arguments.length<3){var errors=[];throw arguments.length<1&&errors.push("type"),arguments.length<2&&errors.push("name"),arguments.length<3&&errors.push("definition"),new Error("missing parameters, no ".concat(errors.join(" or ")," specified"))}if("object"!==_typeof(def))throw new TypeError("definition parameter must be an object");if(definitionsHas(name))throw new Error('cannot clobber existing setting "'.concat(name,'"'));var str,pos,definition={type:type,name:name,label:"string"==typeof def.label?def.label.trim():""};if("string"==typeof def.desc){var desc=def.desc.trim();""!==desc&&(definition.desc=desc)}switch(type){case Types.Header:break;case Types.Toggle:definition.default=!!def.default;break;case Types.List:if(!def.hasOwnProperty("list"))throw new Error("no list specified");if(!Array.isArray(def.list))throw new TypeError("list must be an array");if(0===def.list.length)throw new Error("list must not be empty");if(definition.list=Object.freeze(def.list),null==def.default)definition.default=def.list[0];else{var defaultIndex=def.list.indexOf(def.default);if(-1===defaultIndex)throw new Error("list does not contain default");definition.default=def.list[defaultIndex]}break;case Types.Range:if(!def.hasOwnProperty("min"))throw new Error("no min specified");if("number"!=typeof def.min||Number.isNaN(def.min)||!Number.isFinite(def.min))throw new TypeError("min must be a finite number");if(!def.hasOwnProperty("max"))throw new Error("no max specified");if("number"!=typeof def.max||Number.isNaN(def.max)||!Number.isFinite(def.max))throw new TypeError("max must be a finite number");if(!def.hasOwnProperty("step"))throw new Error("no step specified");if("number"!=typeof def.step||Number.isNaN(def.step)||!Number.isFinite(def.step)||def.step<=0)throw new TypeError("step must be a finite number greater than zero");var stepValidate=function(value){if(fracDigits>0){var ma=Number("".concat(def.min,"e").concat(fracDigits)),sa=Number("".concat(def.step,"e").concat(fracDigits)),_va=Number("".concat(value,"e").concat(fracDigits))-ma;return Number("".concat(_va-_va%sa+ma,"e-").concat(fracDigits))}var va=value-def.min;return va-va%def.step+def.min},fracDigits=(str=String(def.step),-1===(pos=str.lastIndexOf("."))?0:str.length-pos-1);if(stepValidate(def.max)!==def.max)throw new RangeError("max (".concat(def.max,") is not a multiple of the step (").concat(def.step,") plus the min (").concat(def.min,")"));if(definition.max=def.max,definition.min=def.min,definition.step=def.step,null==def.default)definition.default=def.max;else{if("number"!=typeof def.default||Number.isNaN(def.default)||!Number.isFinite(def.default))throw new TypeError("default must be a finite number");if(def.default<def.min)throw new RangeError("default (".concat(def.default,") is less than min (").concat(def.min,")"));if(def.default>def.max)throw new RangeError("default (".concat(def.default,") is greater than max (").concat(def.max,")"));definition.default=def.default}break;default:throw new Error("unknown Setting type: ".concat(type))}"function"==typeof def.onInit&&(definition.onInit=Object.freeze(def.onInit)),"function"==typeof def.onChange&&(definition.onChange=Object.freeze(def.onChange)),_definitions.push(Object.freeze(definition))}function definitionsHas(name){return _definitions.some((function(definition){return definition.name===name}))}function definitionsGet(name){return _definitions.find((function(definition){return definition.name===name}))}return Object.preventExtensions(Object.create(null,{Types:{value:Types},init:{value:function(){if(storage.has("options")){var old=storage.get("options");null!==old&&(window.SugarCube.settings=settings=Object.assign(settingsCreate(),old)),settingsSave(),storage.delete("options")}settingsLoad(),_definitions.forEach((function(def){if(def.hasOwnProperty("onInit")){var thisArg={name:def.name,value:settings[def.name],default:def.default};def.hasOwnProperty("list")&&(thisArg.list=def.list),def.onInit.call(thisArg)}}))}},create:{value:settingsCreate},save:{value:settingsSave},load:{value:settingsLoad},clear:{value:settingsClear},reset:{value:function(name){if(0===arguments.length)settingsClear(),settingsLoad();else{if(null==name||!definitionsHas(name))throw new Error('nonexistent setting "'.concat(name,'"'));var def=definitionsGet(name);def.type!==Types.Header&&(settings[name]=def.default)}return settingsSave()}},forEach:{value:function(callback,thisArg){_definitions.forEach(callback,thisArg)}},add:{value:definitionsAdd},addHeader:{value:function(name,desc){definitionsAdd(Types.Header,name,{desc:desc})}},addToggle:{value:function(){for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++)args[_key16]=arguments[_key16];definitionsAdd.apply(void 0,[Types.Toggle].concat(args))}},addList:{value:function(){for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++)args[_key17]=arguments[_key17];definitionsAdd.apply(void 0,[Types.List].concat(args))}},addRange:{value:function(){for(var _len18=arguments.length,args=new Array(_len18),_key18=0;_key18<_len18;_key18++)args[_key18]=arguments[_key18];definitionsAdd.apply(void 0,[Types.Range].concat(args))}},isEmpty:{value:function(){return 0===_definitions.length}},has:{value:definitionsHas},get:{value:definitionsGet},delete:{value:function definitionsDelete(name){definitionsHas(name)&&delete settings[name];for(var i=0;i<_definitions.length;++i)if(_definitions[i].name===name){_definitions.splice(i,1),definitionsDelete(name);break}}}}))}(),Story=function(){var _passages={},_inits=[],_scripts=[],_styles=[],_widgets=[],_title="",_ifId="",_domId="";function _storySetTitle(rawTitle){if(null==rawTitle)throw new Error("story title must not be null or undefined");var title=decodeEntities(String(rawTitle)).trim();if(""===title)throw new Error("story title must not be empty or consist solely of whitespace");if(document.title=_title=title,""===(_domId=createSlug(_title)))if(""!==_ifId)_domId=_ifId;else for(var i=0,len=_title.length;i<len;++i){var _characterAndPosAt2=characterAndPosAt(_title,i),char=_characterAndPosAt2.char,start=_characterAndPosAt2.start,end=_characterAndPosAt2.end;_domId+=char.codePointAt(0).toString(16),i+=end-start}}return Object.preventExtensions(Object.create(null,{load:{value:function(){var validationCodeTags=["init","widget"],validationNoCodeTagPassages=["PassageDone","PassageFooter","PassageHeader","PassageReady","StoryAuthor","StoryBanner","StoryCaption","StoryInit","StoryMenu","StoryShare","StorySubtitle"];function validateStartingPassage(passage){if(passage.tags.includesAny(validationCodeTags))throw new Error('starting passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(passage.tags.filter((function(tag){return validationCodeTags.includes(tag)})).sort().join('", "'),'"'))}function validateSpecialPassages(passage){if(validationNoCodeTagPassages.includes(passage.title)){for(var _len19=arguments.length,tags=new Array(_len19>1?_len19-1:0),_key19=1;_key19<_len19;_key19++)tags[_key19-1]=arguments[_key19];throw new Error('special passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(tags.sort().join('", "'),'"'))}var codeTags=[].concat(validationCodeTags),foundTags=[];if(passage.tags.forEach((function(tag){codeTags.includes(tag)&&foundTags.push.apply(foundTags,_toConsumableArray(codeTags.delete(tag)))})),foundTags.length>1)throw new Error('passage "'.concat(passage.title,'" contains multiple special tags; invalid: "').concat(foundTags.sort().join('", "'),'"'))}var $storydata=jQuery("tw-storydata"),startNode=$storydata.attr("startnode")||"";Config.passages.start=null,Config.debug=/\bdebug\b/.test($storydata.attr("options")),$storydata.children("style").each((function(i){_styles.push(new Passage("tw-user-style-".concat(i),this))})),$storydata.children("script").each((function(i){_scripts.push(new Passage("tw-user-script-".concat(i),this))})),$storydata.children('tw-passagedata:not([tags~="Twine.private"],[tags~="annotation"])').each((function(){var $this=jQuery(this),pid=$this.attr("pid")||"",passage=new Passage($this.attr("name"),this);pid===startNode&&""!==startNode?(Config.passages.start=passage.title,validateStartingPassage(passage),_passages[passage.title]=passage):passage.tags.includes("init")?(validateSpecialPassages(passage,"init"),_inits.push(passage)):passage.tags.includes("widget")?(validateSpecialPassages(passage,"widget"),_widgets.push(passage)):_passages[passage.title]=passage})),_ifId=$storydata.attr("ifid"),_storySetTitle("Spanish Aztec War Ver 1.0.1"),Config.saves.id=Story.domId}},title:{get:function(){return _title}},domId:{get:function(){return _domId}},ifId:{get:function(){return _ifId}},add:{value:function(passage){if(!(passage instanceof Passage))throw new TypeError("Story.add passage parameter must be an instance of Passage");var title=passage.title;return!hasOwn(_passages,title)&&(_passages[title]=passage,!0)}},has:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":return _passages.hasOwnProperty(String(title));case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.has title parameter cannot be ".concat(type))}},get:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":var id=String(title);return hasOwn(_passages,id)?_passages[id]:new Passage(id||"(unknown)");case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.get title parameter cannot be ".concat(type))}},getAllInit:{value:function(){return Object.freeze(Array.from(_inits))}},getAllRegular:{value:function(){return Object.freeze(Object.assign({},_passages))}},getAllScript:{value:function(){return Object.freeze(Array.from(_scripts))}},getAllStylesheet:{value:function(){return Object.freeze(Array.from(_styles))}},getAllWidget:{value:function(){return Object.freeze(Array.from(_widgets))}},lookup:{value:function(key,value){var sortKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"title",results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];"object"===_typeof(passage[key])&&null!==passage[key]?passage[key]instanceof Array&&passage[key].some((function(m){return sameValueZero(m,value)}))&&results.push(passage):sameValueZero(passage[key],value)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}},lookupWith:{value:function(predicate){var sortKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"title";if("function"!=typeof predicate)throw new TypeError("Story.lookupWith predicate parameter must be a function");var results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];predicate(passage)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}}}))}(),UI=function(){function uiAssembleLinkList(passage,listEl){var list=listEl,debugState=Config.debug,cleanState=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==list&&(list=document.createElement("ul"));var frag=document.createDocumentFragment();new Wikifier(frag,Story.get(passage).processText().trim());var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "));for(;frag.hasChildNodes();){var node=frag.firstChild;if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.nodeName.toUpperCase()){var li=document.createElement("li");list.appendChild(li),li.appendChild(node)}else frag.removeChild(node)}}finally{Config.cleanupWikifierOutput=cleanState,Config.debug=debugState}return list}function uiOpenAlert(message){jQuery(Dialog.setup(L10n.get("alertTitle"),"alert")).append("<p>".concat(message,'</p><ul class="buttons">')+'<li><button id="alert-ok" class="ui-close">'.concat(L10n.get(["alertOk","ok"]),"</button></li>")+"</ul>");for(var _len20=arguments.length,args=new Array(_len20>1?_len20-1:0),_key20=1;_key20<_len20;_key20++)args[_key20-1]=arguments[_key20];Dialog.open.apply(Dialog,args)}function uiBuildAutoload(){return jQuery(Dialog.setup(L10n.get("autoloadTitle"),"autoload")).append("<p>".concat(L10n.get("autoloadPrompt"),'</p><ul class="buttons">')+'<li><button id="autoload-ok" class="ui-close">'.concat(L10n.get(["autoloadOk","ok"]),"</button></li>")+'<li><button id="autoload-cancel" class="ui-close">'.concat(L10n.get(["autoloadCancel","cancel"]),"</button></li>")+"</ul>"),jQuery(document).one("click.autoload",".ui-close",(function(ev){var isAutoloadOk="autoload-ok"===ev.target.id;jQuery(document).one(":dialogclosed",(function(){isAutoloadOk&&Save.autosave.load()||Engine.play(Config.passages.start)}))})),!0}function uiBuildJumpto(){var list=document.createElement("ul");jQuery(Dialog.setup(L10n.get("jumptoTitle"),"jumpto list")).append(list);for(var expired=State.expired.length,i=State.size-1;i>=0;--i)if(i!==State.activeIndex){var passage=Story.get(State.history[i].title);passage&&passage.tags.includes("bookmark")&&jQuery(document.createElement("li")).append(jQuery(document.createElement("a")).ariaClick({one:!0},function(idx){return function(){return jQuery(document).one(":dialogclosed",(function(){return Engine.goTo(idx)}))}}(i)).addClass("ui-close").text("".concat(L10n.get("jumptoTurn")," ").concat(expired+i+1,": ").concat(passage.description()))).appendTo(list)}list.hasChildNodes()||jQuery(list).append("<li><a><em>".concat(L10n.get("jumptoUnavailable"),"</em></a></li>"))}function uiBuildRestart(){return jQuery(Dialog.setup(L10n.get("restartTitle"),"restart")).append("<p>".concat(L10n.get("restartPrompt"),'</p><ul class="buttons">')+'<li><button id="restart-ok">'.concat(L10n.get(["restartOk","ok"]),"</button></li>")+'<li><button id="restart-cancel" class="ui-close">'.concat(L10n.get(["restartCancel","cancel"]),"</button></li>")+"</ul>").find("#restart-ok").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){return Engine.restart()})),Dialog.close()})),!0}function uiBuildSaves(){var savesAllowed="function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed();function createActionItem(bId,bClass,bText,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId)).html(bText);return bClass&&$btn.addClass(bClass),bAction?$btn.ariaClick(bAction):$btn.ariaDisabled(!0),jQuery(document.createElement("li")).append($btn)}var $dialogBody=jQuery(Dialog.setup(L10n.get("savesTitle"),"saves")),savesOk=Save.ok(),fileOk=Has.fileAPI&&(Config.saves.tryDiskOnMobile||!Browser.isMobile.any());if(savesOk&&$dialogBody.append(function(){function createButton(bId,bClass,bText,bSlot,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId,"-").concat(bSlot)).addClass(bId).html(bText);return bClass&&$btn.addClass(bClass),bAction?"auto"===bSlot?$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelAuto"))},(function(){return bAction()})):$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelSlot")," ").concat(bSlot+1)},(function(){return bAction(bSlot)})):$btn.ariaDisabled(!0),$btn}var saves=Save.get(),$tbody=jQuery(document.createElement("tbody"));if(Save.autosave.ok()){var $tdSlot=jQuery(document.createElement("td")),$tdLoad=jQuery(document.createElement("td")),$tdDesc=jQuery(document.createElement("td")),$tdDele=jQuery(document.createElement("td"));jQuery(document.createElement("b")).attr({title:L10n.get("savesLabelAuto"),"aria-label":L10n.get("savesLabelAuto")}).text("A").appendTo($tdSlot),saves.autosave?($tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),"auto",(function(){jQuery(document).one(":dialogclosed",(function(){return Save.autosave.load()}))}))),jQuery(document.createElement("div")).text(saves.autosave.title).appendTo($tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.autosave.date?"".concat(new Date(saves.autosave.date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo($tdDesc),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto",(function(){Save.autosave.delete(),uiBuildSaves()})))):($tdLoad.append(createButton("load",null,L10n.get("savesLabelLoad"),"auto")),$tdDesc.addClass("empty").text("•  •  •"),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto"))),jQuery(document.createElement("tr")).append($tdSlot).append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody)}for(var i=0,iend=saves.slots.length;i<iend;++i){var _$tdSlot=jQuery(document.createElement("td")),_$tdLoad=jQuery(document.createElement("td")),_$tdDesc=jQuery(document.createElement("td")),_$tdDele=jQuery(document.createElement("td"));_$tdSlot.append(document.createTextNode(i+1)),saves.slots[i]?(_$tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),i,(function(slot){jQuery(document).one(":dialogclosed",(function(){return Save.slots.load(slot)}))}))),jQuery(document.createElement("div")).text(saves.slots[i].title).appendTo(_$tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.slots[i].date?"".concat(new Date(saves.slots[i].date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo(_$tdDesc),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i,(function(slot){Save.slots.delete(slot),uiBuildSaves()})))):(_$tdLoad.append(createButton("save","ui-close",L10n.get("savesLabelSave"),i,savesAllowed?Save.slots.save:null)),_$tdDesc.addClass("empty").text("•  •  •"),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i))),jQuery(document.createElement("tr")).append(_$tdSlot).append(_$tdLoad).append(_$tdDesc).append(_$tdDele).appendTo($tbody)}return jQuery(document.createElement("table")).attr("id","saves-list").append($tbody)}()),savesOk||fileOk){var $btnBar=jQuery(document.createElement("ul")).addClass("buttons").appendTo($dialogBody);return fileOk&&($btnBar.append(createActionItem("export","ui-close",L10n.get("savesLabelExport"),savesAllowed?function(){return Save.export()}:null)),$btnBar.append(createActionItem("import",null,L10n.get("savesLabelImport"),(function(){return $dialogBody.find("#saves-import-file").trigger("click")}))),jQuery(document.createElement("input")).css({display:"block",visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px",width:"1px",height:"1px"}).attr({type:"file",id:"saves-import-file",tabindex:-1,"aria-hidden":!0}).on("change",(function(ev){jQuery(document).one(":dialogclosed",(function(){return Save.import(ev)})),Dialog.close()})).appendTo($dialogBody)),savesOk&&$btnBar.append(createActionItem("clear",null,L10n.get("savesLabelClear"),Save.autosave.has()||!Save.slots.isEmpty()?function(){Save.clear(),uiBuildSaves()}:null)),!0}return uiOpenAlert(L10n.get("savesIncapable")),!1}function uiBuildSettings(){var $dialogBody=jQuery(Dialog.setup(L10n.get("settingsTitle"),"settings"));return Setting.forEach((function(control){if(control.type===Setting.Types.Header){var _name=control.name,_id=createSlug(_name),$header=jQuery(document.createElement("div")),$heading=jQuery(document.createElement("h2"));return $header.attr("id","header-body-".concat(_id)).append($heading).appendTo($dialogBody),$heading.attr("id","header-heading-".concat(_id)).wiki(_name),void(control.desc&&jQuery(document.createElement("p")).attr("id","header-desc-".concat(_id)).wiki(control.desc).appendTo($header))}var $control,name=control.name,id=createSlug(name),$setting=jQuery(document.createElement("div")),$label=jQuery(document.createElement("label")),$controlBox=jQuery(document.createElement("div"));switch(jQuery(document.createElement("div")).append($label).append($controlBox).appendTo($setting),control.desc&&jQuery(document.createElement("p")).attr("id","setting-desc-".concat(id)).wiki(control.desc).appendTo($setting),$label.attr({id:"setting-label-".concat(id),for:"setting-control-".concat(id)}).wiki(control.label),null==settings[name]&&(settings[name]=control.default),control.type){case Setting.Types.Toggle:$control=jQuery(document.createElement("button")),settings[name]?$control.addClass("enabled").text(L10n.get("settingsOn")):$control.text(L10n.get("settingsOff")),$control.ariaClick((function(){settings[name]?(jQuery(this).removeClass("enabled").text(L10n.get("settingsOff")),settings[name]=!1):(jQuery(this).addClass("enabled").text(L10n.get("settingsOn")),settings[name]=!0),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default})}));break;case Setting.Types.List:$control=jQuery(document.createElement("select"));for(var i=0,iend=control.list.length;i<iend;++i)jQuery(document.createElement("option")).val(i).text(control.list[i]).appendTo($control);$control.val(control.list.indexOf(settings[name])).attr("tabindex",0).on("change",(function(){settings[name]=control.list[Number(this.value)],Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,list:control.list})}));break;case Setting.Types.Range:($control=jQuery(document.createElement("input"))).attr({type:"range",min:control.min,max:control.max,step:control.step,value:settings[name],tabindex:0}).on("change input",(function(){settings[name]=Number(this.value),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,min:control.min,max:control.max,step:control.step})})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$control.trigger("change"))}))}$control.attr("id","setting-control-".concat(id)).appendTo($controlBox),$setting.attr("id","setting-body-".concat(id)).appendTo($dialogBody)})),$dialogBody.append('<ul class="buttons">'+'<li><button id="settings-ok" class="ui-close">'.concat(L10n.get(["settingsOk","ok"]),"</button></li>")+'<li><button id="settings-reset">'.concat(L10n.get("settingsReset"),"</button></li>")+"</ul>").find("#settings-reset").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){Setting.reset(),window.location.reload()})),Dialog.close()})),!0}function uiBuildShare(){try{jQuery(Dialog.setup(L10n.get("shareTitle"),"share list")).append(uiAssembleLinkList("StoryShare"))}catch(ex){return console.error(ex),Alert.error("StoryShare",ex.message),!1}return!0}return Object.preventExtensions(Object.create(null,{assembleLinkList:{value:uiAssembleLinkList},alert:{value:uiOpenAlert},jumpto:{value:function(){uiBuildJumpto(),Dialog.open.apply(Dialog,arguments)}},restart:{value:function(){uiBuildRestart(),Dialog.open.apply(Dialog,arguments)}},saves:{value:function(){uiBuildSaves(),Dialog.open.apply(Dialog,arguments)}},settings:{value:function(){uiBuildSettings(),Dialog.open.apply(Dialog,arguments)}},share:{value:function(){uiBuildShare(),Dialog.open.apply(Dialog,arguments)}},buildAutoload:{value:uiBuildAutoload},buildJumpto:{value:uiBuildJumpto},buildRestart:{value:uiBuildRestart},buildSaves:{value:uiBuildSaves},buildSettings:{value:uiBuildSettings},buildShare:{value:uiBuildShare},stow:{value:function(){return UIBar.stow()}},unstow:{value:function(){return UIBar.unstow()}},setStoryElements:{value:function(){return UIBar.update()}},isOpen:{value:function(){return Dialog.isOpen.apply(Dialog,arguments)}},body:{value:function(){return Dialog.body()}},setup:{value:function(){return Dialog.setup.apply(Dialog,arguments)}},addClickHandler:{value:function(){return Dialog.addClickHandler.apply(Dialog,arguments)}},open:{value:function(){return Dialog.open.apply(Dialog,arguments)}},close:{value:function(){return Dialog.close.apply(Dialog,arguments)}},resize:{value:function(){return Dialog.resize()}},buildDialogAutoload:{value:uiBuildAutoload},buildDialogJumpto:{value:uiBuildJumpto},buildDialogRestart:{value:uiBuildRestart},buildDialogSaves:{value:uiBuildSaves},buildDialogSettings:{value:uiBuildSettings},buildDialogShare:{value:uiBuildShare},buildLinkListFromPassage:{value:uiAssembleLinkList}}))}(),UIBar=function(){var _$uiBar=null;function uiBarStow(noAnimation){var $story;_$uiBar&&!_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.addClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.DOM_DELAY));return this}function uiBarUpdate(){if(Story.has("StoryDisplayTitle")&&setDisplayTitle(Story.get("StoryDisplayTitle").processText()),_$uiBar){setPageElement("story-banner","StoryBanner"),setPageElement("story-subtitle","StorySubtitle"),setPageElement("story-author","StoryAuthor"),setPageElement("story-caption","StoryCaption");var menuStory=document.getElementById("menu-story");if(null!==menuStory&&(jQuery(menuStory).empty(),Story.has("StoryMenu")))try{UI.assembleLinkList("StoryMenu",menuStory)}catch(ex){console.error(ex),Alert.error("StoryMenu",ex.message)}}}return Object.preventExtensions(Object.create(null,{destroy:{value:function(){_$uiBar&&(_$uiBar.hide(),jQuery(document).off(".ui-bar"),jQuery(document.head).find("#style-ui-bar").remove(),_$uiBar.remove(),_$uiBar=null)}},hide:{value:function(){return _$uiBar&&_$uiBar.hide(),this}},init:{value:function(){if(!document.getElementById("ui-bar")){var toggleLabel,backwardLabel,jumptoLabel,forwardLabel,$backward,$forward,$elems=(toggleLabel=L10n.get("uiBarToggle"),backwardLabel=L10n.get("uiBarBackward"),jumptoLabel=L10n.get("uiBarJumpto"),forwardLabel=L10n.get("uiBarForward"),jQuery(document.createDocumentFragment()).append('<div id="ui-bar" aria-live="polite"><div id="ui-bar-tray">'+'<button id="ui-bar-toggle" tabindex="0" title="'.concat(toggleLabel,'" aria-label="').concat(toggleLabel,'"></button>')+'<div id="ui-bar-history">'+'<button id="history-backward" tabindex="0" title="'.concat(backwardLabel,'" aria-label="').concat(backwardLabel,'"></button>')+'<button id="history-jumpto" tabindex="0" title="'.concat(jumptoLabel,'" aria-label="').concat(jumptoLabel,'"></button>')+'<button id="history-forward" tabindex="0" title="'.concat(forwardLabel,'" aria-label="').concat(forwardLabel,'"></button>')+'</div></div><div id="ui-bar-body"><header id="title" role="banner"><div id="story-banner"></div><h1 id="story-title"></h1><div id="story-subtitle"></div><div id="story-title-separator"></div><p id="story-author"></p></header><div id="story-caption"></div><nav id="menu" role="navigation"><ul id="menu-story"></ul><ul id="menu-core">'+'<li id="menu-item-saves"><a tabindex="0">'.concat(L10n.get("savesTitle"),"</a></li>")+'<li id="menu-item-settings"><a tabindex="0">'.concat(L10n.get("settingsTitle"),"</a></li>")+'<li id="menu-item-restart"><a tabindex="0">'.concat(L10n.get("restartTitle"),"</a></li>")+'<li id="menu-item-share"><a tabindex="0">'.concat(L10n.get("shareTitle"),"</a></li>")+"</ul></nav></div></div>"));_$uiBar=jQuery($elems.find("#ui-bar").get(0)),$elems.insertBefore("body>script#script-sugarcube"),jQuery(document).on(":historyupdate.ui-bar",($backward=jQuery("#history-backward"),$forward=jQuery("#history-forward"),function(){$backward.ariaDisabled(State.length<2),$forward.ariaDisabled(State.length===State.size)}))}}},isHidden:{value:function(){return _$uiBar&&"none"===_$uiBar.css("display")}},isStowed:{value:function(){return _$uiBar&&_$uiBar.hasClass("stowed")}},show:{value:function(){return _$uiBar&&_$uiBar.show(),this}},start:{value:function(){_$uiBar&&(("boolean"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&uiBarStow(!0),jQuery("#ui-bar-toggle").ariaClick({label:L10n.get("uiBarToggle")},(function(){return _$uiBar.toggleClass("stowed")})),Config.history.controls?(jQuery("#history-backward").ariaDisabled(State.length<2).ariaClick({label:L10n.get("uiBarBackward")},(function(){return Engine.backward()})),Story.lookup("tags","bookmark").length>0?jQuery("#history-jumpto").ariaClick({label:L10n.get("uiBarJumpto")},(function(){return UI.jumpto()})):jQuery("#history-jumpto").remove(),jQuery("#history-forward").ariaDisabled(State.length===State.size).ariaClick({label:L10n.get("uiBarForward")},(function(){return Engine.forward()}))):jQuery("#ui-bar-history").remove(),Story.has("StoryDisplayTitle")?setDisplayTitle(Story.get("StoryDisplayTitle").processText()):jQuery("#story-title").text(Story.title),Story.has("StoryCaption")||jQuery("#story-caption").remove(),Story.has("StoryMenu")||jQuery("#menu-story").remove(),Config.ui.updateStoryElements||uiBarUpdate(),jQuery("#menu-item-saves a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSaves(),Dialog.open()})).text(L10n.get("savesTitle")),Setting.isEmpty()?jQuery("#menu-item-settings").remove():jQuery("#menu-item-settings a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSettings(),Dialog.open()})).text(L10n.get("settingsTitle")),jQuery("#menu-item-restart a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildRestart(),Dialog.open()})).text(L10n.get("restartTitle")),Story.has("StoryShare")?jQuery("#menu-item-share a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildShare(),Dialog.open()})).text(L10n.get("shareTitle")):jQuery("#menu-item-share").remove())}},stow:{value:uiBarStow},unstow:{value:function(noAnimation){var $story;return _$uiBar&&_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.removeClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.DOM_DELAY)),this}},update:{value:uiBarUpdate},setStoryElements:{value:uiBarUpdate}}))}(),DebugBar=function(){var _variableRe=new RegExp("^".concat(Patterns.variable,"$")),_numericKeyRe=/^\d+$/,_watchList=[],_$debugBar=null,_$watchBody=null,_$watchList=null,_$turnSelect=null,_stowed=!0;function debugBarStow(){_$debugBar.css("right","-".concat(_$debugBar.outerWidth(),"px")),_stowed=!0,_updateSession()}function debugBarUnstow(){_$debugBar.css("right",0),_stowed=!1,_updateSession()}function debugBarToggle(){_stowed?debugBarUnstow():debugBarStow()}function debugBarWatchAdd(varName){_variableRe.test(varName)&&(_watchList.pushUnique(varName),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession())}function debugBarWatchAddAll(){Object.keys(State.variables).map((function(name){return _watchList.pushUnique("$".concat(name))})),Object.keys(State.temporary).map((function(name){return _watchList.pushUnique("_".concat(name))})),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchClear(){for(var i=_watchList.length-1;i>=0;--i)_watchList.pop();_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDelete(varName){_watchList.delete(varName),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDisable(){_debugBarWatchDisableNoUpdate(),_updateSession()}function debugBarWatchEnable(){_debugBarWatchEnableNoUpdate(),_updateSession()}function debugBarWatchIsEnabled(){return!_$watchBody.attr("hidden")}function debugBarWatchToggle(){_$watchBody.attr("hidden")?debugBarWatchEnable():debugBarWatchDisable()}function _debugBarWatchDisableNoUpdate(){_$watchBody.attr({"aria-hidden":!0,hidden:"hidden"})}function _debugBarWatchEnableNoUpdate(){_$watchBody.removeAttr("aria-hidden hidden")}function _clearSession(){session.delete("debugState")}function _hasSession(){return session.has("debugState")}function _updateSession(){session.set("debugState",{stowed:_stowed,watchList:_watchList,watchEnabled:debugBarWatchIsEnabled(),viewsEnabled:DebugView.isEnabled()})}function _updateWatchBody(){if(0!==_watchList.length){for(var delLabel=L10n.get("debugBarDeleteWatch"),$table=jQuery(document.createElement("table")),$tbody=jQuery(document.createElement("tbody")),_loop4=function(i,len){var varName=_watchList[i],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary,$row=jQuery(document.createElement("tr")),$delBtn=jQuery(document.createElement("button")),$code=jQuery(document.createElement("code"));$delBtn.addClass("watch-delete").attr("data-name",varName).ariaClick({one:!0,label:delLabel},(function(){return debugBarWatchDelete(varName)})),$code.text(_toWatchString(store[varKey])),jQuery(document.createElement("td")).append($delBtn).appendTo($row),jQuery(document.createElement("td")).text(varName).appendTo($row),jQuery(document.createElement("td")).append($code).appendTo($row),$row.appendTo($tbody)},i=0,len=_watchList.length;i<len;++i)_loop4(i);$table.append($tbody),_$watchBody.empty().append($table)}else _$watchBody.empty().append("<div>".concat(L10n.get("debugBarNoWatches"),"</div>"))}function _updateWatchList(){var svn=Object.keys(State.variables),tvn=Object.keys(State.temporary);if(0!==svn.length||0!==tvn.length){var names=[].concat(_toConsumableArray(svn.map((function(name){return"$".concat(name)}))),_toConsumableArray(tvn.map((function(name){return"_".concat(name)})))).sort(),options=document.createDocumentFragment();names.delete(_watchList);for(var i=0,len=names.length;i<len;++i)jQuery(document.createElement("option")).val(names[i]).appendTo(options);_$watchList.empty().append(options)}else _$watchList.empty()}function _updateTurnSelect(){for(var histLen=State.size,expLen=State.expired.length,options=document.createDocumentFragment(),i=0;i<histLen;++i)jQuery(document.createElement("option")).val(i).text("".concat(expLen+i+1,". ").concat(encodeEntities(State.history[i].title))).appendTo(options);_$turnSelect.empty().ariaDisabled(histLen<2).append(options).val(State.activeIndex)}function _toWatchString(value){if(null===value)return"null";switch(_typeof(value)){case"number":if(Number.isNaN(value))return"NaN";if(!Number.isFinite(value))return"Infinity";case"boolean":case"symbol":case"undefined":return String(value);case"string":return JSON.stringify(value);case"function":return"Function"}var objType=getToStringTag(value);if("Date"===objType)return"Date {".concat(value.toLocaleString(),"}");if("RegExp"===objType)return"RegExp ".concat(value.toString());var result=[];if(value instanceof Array||value instanceof Set){for(var list=value instanceof Array?value:Array.from(value),i=0,len=list.length;i<len;++i)result.push(hasOwn(list,i)?_toWatchString(list[i]):"<empty>");return Object.keys(list).filter((function(key){return!_numericKeyRe.test(key)})).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(list[key])))})),"".concat(objType,"(").concat(list.length,") [").concat(result.join(", "),"]")}return value instanceof Map?(value.forEach((function(val,key){return result.push("".concat(_toWatchString(key)," → ").concat(_toWatchString(val)))})),"".concat(objType,"(").concat(value.size,") {").concat(result.join(", "),"}")):(Object.keys(value).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(value[key])))})),"".concat(objType," {").concat(result.join(", "),"}"))}return Object.preventExtensions(Object.create(null,{init:{value:function(){var barToggleLabel=L10n.get("debugBarToggle"),watchAddLabel=L10n.get("debugBarAddWatch"),watchAllLabel=L10n.get("debugBarWatchAll"),watchNoneLabel=L10n.get("debugBarWatchNone"),watchToggleLabel=L10n.get("debugBarWatchToggle"),viewsToggleLabel=L10n.get("debugBarViewsToggle");jQuery(document.createDocumentFragment()).append('<div id="debug-bar"><div id="debug-bar-watch">'+"<div>".concat(L10n.get("debugBarNoWatches"),"</div>>")+"</div><div>"+'<button id="debug-bar-watch-toggle" tabindex="0" title="'.concat(watchToggleLabel,'" aria-label="').concat(watchToggleLabel,'">').concat(L10n.get("debugBarLabelWatch"),"</button>")+'<label id="debug-bar-watch-label" for="debug-bar-watch-input">'.concat(L10n.get("debugBarLabelAdd"),"</label>")+'<input id="debug-bar-watch-input" name="debug-bar-watch-input" type="text" list="debug-bar-watch-list" tabindex="0"><datalist id="debug-bar-watch-list" aria-hidden="true" hidden="hidden"></datalist>'+'<button id="debug-bar-watch-add" tabindex="0" title="'.concat(watchAddLabel,'" aria-label="').concat(watchAddLabel,'"></button>')+'<button id="debug-bar-watch-all" tabindex="0" title="'.concat(watchAllLabel,'" aria-label="').concat(watchAllLabel,'"></button>')+'<button id="debug-bar-watch-none" tabindex="0" title="'.concat(watchNoneLabel,'" aria-label="').concat(watchNoneLabel,'"></button>')+"</div><div>"+'<button id="debug-bar-views-toggle" tabindex="0" title="'.concat(viewsToggleLabel,'" aria-label="').concat(viewsToggleLabel,'">').concat(L10n.get("debugBarLabelViews"),"</button>")+'<label id="debug-bar-turn-label" for="debug-bar-turn-select">'.concat(L10n.get("debugBarLabelTurn"),"</label>")+'<select id="debug-bar-turn-select" tabindex="0"></select></div>'+'<button id="debug-bar-toggle" tabindex="0" title="'.concat(barToggleLabel,'" aria-label="').concat(barToggleLabel,'"></button>')+'</div><div id="debug-bar-hint"></div>').appendTo("body"),_$debugBar=jQuery("#debug-bar"),_$watchBody=jQuery(_$debugBar.find("#debug-bar-watch").get(0)),_$watchList=jQuery(_$debugBar.find("#debug-bar-watch-list").get(0)),_$turnSelect=jQuery(_$debugBar.find("#debug-bar-turn-select").get(0));var $barToggle=jQuery(_$debugBar.find("#debug-bar-toggle").get(0)),$watchToggle=jQuery(_$debugBar.find("#debug-bar-watch-toggle").get(0)),$watchInput=jQuery(_$debugBar.find("#debug-bar-watch-input").get(0)),$watchAdd=jQuery(_$debugBar.find("#debug-bar-watch-add").get(0)),$watchAll=jQuery(_$debugBar.find("#debug-bar-watch-all").get(0)),$watchNone=jQuery(_$debugBar.find("#debug-bar-watch-none").get(0)),$viewsToggle=jQuery(_$debugBar.find("#debug-bar-views-toggle").get(0));$barToggle.ariaClick(debugBarToggle),$watchToggle.ariaClick(debugBarWatchToggle),$watchInput.on(":addwatch",(function(){debugBarWatchAdd(this.value.trim()),this.value=""})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$watchInput.trigger(":addwatch"))})),$watchAdd.ariaClick((function(){return $watchInput.trigger(":addwatch")})),$watchAll.ariaClick(debugBarWatchAddAll),$watchNone.ariaClick(debugBarWatchClear),_$turnSelect.on("change",(function(){Engine.goTo(Number(this.value))})),$viewsToggle.ariaClick((function(){DebugView.toggle(),_updateSession()})),jQuery(document).on(":historyupdate.debug-bar",_updateTurnSelect).on(":passageend.debug-bar",(function(){_updateWatchBody(),_updateWatchList()})).on(":enginerestart.debug-bar",_clearSession),_hasSession()||DebugView.enable()}},isStowed:{value:function(){return _stowed}},start:{value:function(){(function(){if(!_hasSession())return!1;var debugState=session.get("debugState");_stowed=debugState.stowed,_watchList.push.apply(_watchList,_toConsumableArray(debugState.watchList)),debugState.watchEnabled?_debugBarWatchEnableNoUpdate():_debugBarWatchDisableNoUpdate();debugState.viewsEnabled?DebugView.enable():DebugView.disable()})(),_stowed?debugBarStow():debugBarUnstow(),_updateTurnSelect(),_updateWatchBody(),_updateWatchList()}},stow:{value:debugBarStow},toggle:{value:debugBarToggle},unstow:{value:debugBarUnstow},watch:{value:Object.preventExtensions(Object.create(null,{add:{value:debugBarWatchAdd},all:{value:debugBarWatchAddAll},clear:{value:debugBarWatchClear},delete:{value:debugBarWatchDelete},disable:{value:debugBarWatchDisable},enable:{value:debugBarWatchEnable},isEnabled:{value:debugBarWatchIsEnabled},toggle:{value:debugBarWatchToggle}}))}}))}(),LoadScreen=function(){var _locks=new Set,_autoId=0;function loadScreenHide(){jQuery(document.documentElement).removeAttr("data-init")}function loadScreenShow(){jQuery(document.documentElement).attr("data-init","loading")}return Object.preventExtensions(Object.create(null,{init:{value:function(){jQuery(document).on("readystatechange.SugarCube",(function(){_locks.size>0||("complete"===document.readyState?"loading"===jQuery(document.documentElement).attr("data-init")&&(Config.loadDelay>0?setTimeout((function(){0===_locks.size&&loadScreenHide()}),Math.max(Engine.DOM_DELAY,Config.loadDelay)):loadScreenHide()):loadScreenShow())}))}},clear:{value:function(){jQuery(document).off("readystatechange.SugarCube"),_locks.clear(),loadScreenHide()}},hide:{value:loadScreenHide},show:{value:loadScreenShow},lock:{value:function(){return++_autoId,_locks.add(_autoId),loadScreenShow(),_autoId}},unlock:{value:function(id){if(null==id)throw new Error("LoadScreen.unlock called with a null or undefined ID");_locks.has(id)&&_locks.delete(id),0===_locks.size&&jQuery(document).trigger("readystatechange")}},size:{get:function(){return _locks.size}}}))}(),Util=Object.preventExtensions(Object.create(null,{charAndPosAt:{value:characterAndPosAt},escape:{value:encodeEntities},escapeMarkup:{value:encodeMarkup},fromCssProperty:{value:cssPropToDOMProp},fromCssTime:{value:cssTimeToMS},getType:{value:getTypeOf},hasMediaQuery:{value:hasMediaQuery},isIterable:{value:isIterable},newExceptionFrom:{value:exceptionFrom},now:{value:now},parseUrl:{value:parseURL},sameValueZero:{value:sameValueZero},sanitizeFilename:{value:createFilename},scrubEventKey:{value:scrubEventKey},slugify:{value:createSlug},toCssTime:{value:msToCSSTime},toEnum:{value:enumFrom},toStringTag:{value:getToStringTag},unescape:{value:decodeEntities},entityDecode:{value:decodeEntities},entityEncode:{value:encodeEntities},evalExpression:{value:Scripting.evalJavaScript},evalStatements:{value:Scripting.evalJavaScript},random:{value:Math.random}})),version=Object.freeze({title:"SugarCube",major:2,minor:37,patch:0,prerelease:"alpha.5",build:43,date:new Date("2022-10-08T14:09:59.572Z"),extensions:{},toString:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,"+").concat(this.build)},short:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.title," (v").concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,")")},long:function(){return"".concat(this.title," v").concat(this.toString()," (").concat(this.date.toUTCString(),")")}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;Object.defineProperty(window,"SugarCube",{value:Object.seal(Object.assign(Object.create(null),{Browser:Browser,Config:Config,Dialog:Dialog,Engine:Engine,Fullscreen:Fullscreen,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Visibility:Visibility,Wikifier:Wikifier,session:session,settings:settings,setup:setup,storage:storage,version:version}))}),jQuery((function(){var lockId=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),new Promise((function(resolve){Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Outliner.init(),Engine.runUserScripts(),L10n.init(),session.has("rcWarn")||"cookie"!==storage.name||(session.set("rcWarn",1),window.alert(L10n.get("warningNoWebStorage"))),Save.init(),Setting.init(),Macro.init(),Config.debug&&DebugBar.init();var $window=jQuery(window),vpReadyId=setInterval((function(){$window.width()&&LoadScreen.size<=1&&(clearInterval(vpReadyId),resolve())}),Engine.DOM_DELAY)})).then((function(){Engine.runUserInit(),UIBar.start(),Engine.start(),Config.debug&&DebugBar.start(),jQuery.event.trigger({type:":storyready"}),setTimeout((function(){return LoadScreen.unlock(lockId)}),2*Engine.DOM_DELAY)})).catch((function(ex){return console.error(ex),LoadScreen.clear(),Alert.fatal(null,ex.message,ex)}))}))})(window,window.document,jQuery);}
	</script>
</body>
</html>
